<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Data Analysis - 20&nbsp; Categorical Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./exercise-01.html" rel="next">
<link href="./19-module.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./20-module.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Preliminaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Logistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-typography-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Typography and Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-programming-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>RStudio</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Extending the Functionality of <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentals of the <strong><em>R</em></strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basics of Version Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Additional Data Structures in <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting Data into <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part II - Statistics and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Descriptive Statisics and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Probability and Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classical Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error, Power, and Effect Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Linear Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-module.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 06</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 06 Solution</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-analysis-replication-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis Replication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Packages Used</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">20.1</span> Objectives</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">20.2</span> Preliminaries</a></li>
  <li><a href="#categorical-predictors" id="toc-categorical-predictors" class="nav-link" data-scroll-target="#categorical-predictors"><span class="header-section-number">20.3</span> Categorical Predictors</a></li>
  <li><a href="#one-way-anova" id="toc-one-way-anova" class="nav-link" data-scroll-target="#one-way-anova"><span class="header-section-number">20.4</span> One-Way ANOVA</a></li>
  <li><a href="#simulation-based-inference" id="toc-simulation-based-inference" class="nav-link" data-scroll-target="#simulation-based-inference"><span class="header-section-number">20.5</span> Simulation-Based Inference</a>
  <ul class="collapse">
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#post-hoc-tests-in-anova" id="toc-post-hoc-tests-in-anova" class="nav-link" data-scroll-target="#post-hoc-tests-in-anova"><span class="header-section-number">20.6</span> Post-Hoc Tests in ANOVA</a></li>
  <li><a href="#a-non-parametric-alternative" id="toc-a-non-parametric-alternative" class="nav-link" data-scroll-target="#a-non-parametric-alternative"><span class="header-section-number">20.7</span> A Non-Parametric Alternative</a>
  <ul class="collapse">
  <li><a href="#effect-sizes" id="toc-effect-sizes" class="nav-link" data-scroll-target="#effect-sizes"><span class="header-section-number">20.7.1</span> Effect Sizes</a></li>
  </ul></li>
  <li><a href="#multiple-factor-anova" id="toc-multiple-factor-anova" class="nav-link" data-scroll-target="#multiple-factor-anova"><span class="header-section-number">20.8</span> Multiple Factor ANOVA</a></li>
  <li><a href="#type-i-ii-and-iii-anova" id="toc-type-i-ii-and-iii-anova" class="nav-link" data-scroll-target="#type-i-ii-and-iii-anova"><span class="header-section-number">20.9</span> Type I, II, and III ANOVA</a></li>
  <li><a href="#chi-square-tests" id="toc-chi-square-tests" class="nav-link" data-scroll-target="#chi-square-tests"><span class="header-section-number">20.10</span> Chi-Square Tests</a>
  <ul class="collapse">
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#concept-review" id="toc-concept-review" class="nav-link" data-scroll-target="#concept-review">Concept Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./20-module.html"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="module-20" class="quarto-section-identifier"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">20.1</span> Objectives</h2>
<blockquote class="blockquote">
<p>In this module, we examine how simple linear regression can be applied to datasets where our predictor variable is discrete or categorical rather than continuous. Indeed, we will see that One-Way (and Two-Way) Analysis of Variance (ANOVA) is a specific application of simple (and multiple) linear regression. We also look at other methods for basic statistical analysis of categorical data.</p>
</blockquote>
</section>
<section id="preliminaries" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">20.2</span> Preliminaries</h2>
<ul>
<li>Install these packages in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/permuco/permuco.pdf">{permuco}</a>, <a href="https://cran.r-project.org/web/packages/dunn.test/dunn.test.pdf">{dunn.test}</a>, <a href="https://cran.r-project.org/web/packages/conover.test/conover.test.pdf">{conover.test}</a></li>
<li>Install and load this package in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/effectsize/effectsize.pdf">{effectsize}</a></li>
<li>Load {tidyverse}, {broom}, and {infer}</li>
</ul>
</section>
<section id="categorical-predictors" class="level2" data-number="20.3">
<h2 data-number="20.3" class="anchored" data-anchor-id="categorical-predictors"><span class="header-section-number">20.3</span> Categorical Predictors</h2>
<p>Thus far we have used simple linear regression models involving continuous explanatory variables, but we can also use a discrete or categorical explanatory variable, made up of 2 or more groups that are coded as “factors” (i.e., we use integer values from 1 to <span class="math inline">\(k\)</span> discrete groups as dummy values for our categorical variables). Let’s load in our zombie apocalpyse survivor data again, but this time after doing so, we will convert <strong>gender</strong> and <strong>major</strong> to factors using the function <code>as.factor()</code>. [We could also do this by reading the data in using <code>read.csv()</code>, which has as a default argument <code>stringsAsFactors=TRUE</code>.] Then look at the <code>class()</code> and <code>summary()</code> of the variable <strong>gender</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/zombies.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Rows: 1000 Columns: 10
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (4): first_name, last_name, gender, major
## dbl (6): id, height, weight, zombies_killed, years_of_education, age
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>gender)  <span class="co"># can also use `as.factor()`</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>major <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>major)  <span class="co"># can also use `as.factor()`</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(z<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Female   Male 
##    494    506</code></pre>
</div>
</div>
<p>As with our prior simple regression analysis, we want to evaluate the effect of a predictor variable on a response variable (e.g., <strong>height</strong>), but this time we want our predictor to be a discrete, or categorical, variable (e.g., <strong>gender</strong>) rather than a continuous one. We can start off by plotting <strong>height</strong> by <strong>gender</strong> using the same formula notation we have been using.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(z<span class="sc">$</span>height <span class="sc">~</span> z<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or, with {ggplot}</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> z, <span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y =</span> height)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This immediately gives us a nice boxplot. Note that if we’d try to use this command after loading in <strong>gender</strong> as character rather than factor data, <strong><em>R</em></strong> would have thrown an error.</p>
<p>Based on our plot, there indeed seems to be a difference in height between males and females. We can test this directly using linear regression (and, recall, we already know another way to test this, using <span class="math inline">\(Z\)</span> or t tests to compare means).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we take a look at the <code>summary()</code> of our model, <strong>m</strong>, we see the same kind of table of results we have seen before, but because the predictor variable in this case is a factor vector instead of a numeric vector, the coefficients are reported and interpreted a bit differently.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = height ~ gender, data = z)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.4642  -2.4861   0.0876   2.5425  11.0065 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  65.5983     0.1717  382.13   &lt;2e-16 ***
## genderMale    4.0154     0.2413   16.64   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.815 on 998 degrees of freedom
## Multiple R-squared:  0.2172, Adjusted R-squared:  0.2164 
## F-statistic: 276.9 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The coefficient for the intercept, i.e., <span class="math inline">\(\beta_0\)</span>, reflects the estimate of the mean height for the first of our level variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>gender)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "Female" "Male"</code></pre>
</div>
</div>
<p>The estimate for <span class="math inline">\(\beta_1\)</span> is reported as “genderMale” and the value for that coefficient, 4.0154, is the estimated difference in mean height associated with being a male. The regression equation is basically:</p>
<p><span class="math display">\[height = 65.5983 + 4.0154 \times gender\]</span></p>
<p>with males assigned a gender value of 1 and females of 0.</p>
<p>In this case, the p value associated with the <strong>t statistic</strong> for <span class="math inline">\(\beta_1\)</span> is extremely low, so we conclude that <strong>gender</strong> has a significant effect on <strong>height</strong>.</p>
<p>We can easily <code>relevel()</code> what is the baseline group. The result is very similar, but the sign of <span class="math inline">\(\beta_1\)</span> is changed.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">relevel</span>(z<span class="sc">$</span>gender, <span class="at">ref =</span> <span class="st">"Male"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> gender)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = height ~ gender, data = z)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -15.4642  -2.4861   0.0876   2.5425  11.0065 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   69.6137     0.1696  410.42   &lt;2e-16 ***
## genderFemale  -4.0154     0.2413  -16.64   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.815 on 998 degrees of freedom
## Multiple R-squared:  0.2172, Adjusted R-squared:  0.2164 
## F-statistic: 276.9 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>The last line of the <code>summary()</code> output shows the results of the global test of significance of the regression model based on an F statistic compared to an F distribution with, in this case, 1 and 998 degrees of freedom.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> <span class="fl">276.9</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0</code></pre>
</div>
</div>
<p>We can extend this approach to the case where we have more than two categories for a variable… in this case we need to dummy code our factor variable into multiple binary variables. <strong><em>R</em></strong> takes care of this for us automatically, but it is good to recognize the procedure.</p>
<p>Let’s explore this by re-coding the variable <strong>major</strong> into four levels. We can first use the <code>unique()</code> or <code>levels()</code> function to list all of the different majors in our dataset. The latter does this alphabetically.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(z<span class="sc">$</span>major)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  [1] medicine/nursing                      criminal justice administration      
##  [3] education                             energy studies                       
##  [5] logistics                             psychology                           
##  [7] botany                                communication                        
##  [9] military strategy                     economics                            
## [11] mechanical engineering                physical education                   
## [13] philosophy                            biology                              
## [15] applied sciences                      animal husbandry                     
## [17] agricultural sciences                 culinary services                    
## [19] city planning                         integrated water resources management
## [21] pharmacology                          environmental science                
## [23] human services                        epidemiology                         
## [25] business administration               architecture                         
## 26 Levels: agricultural sciences animal husbandry ... psychology</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>major)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  [1] "agricultural sciences"                
##  [2] "animal husbandry"                     
##  [3] "applied sciences"                     
##  [4] "architecture"                         
##  [5] "biology"                              
##  [6] "botany"                               
##  [7] "business administration"              
##  [8] "city planning"                        
##  [9] "communication"                        
## [10] "criminal justice administration"      
## [11] "culinary services"                    
## [12] "economics"                            
## [13] "education"                            
## [14] "energy studies"                       
## [15] "environmental science"                
## [16] "epidemiology"                         
## [17] "human services"                       
## [18] "integrated water resources management"
## [19] "logistics"                            
## [20] "mechanical engineering"               
## [21] "medicine/nursing"                     
## [22] "military strategy"                    
## [23] "pharmacology"                         
## [24] "philosophy"                           
## [25] "physical education"                   
## [26] "psychology"</code></pre>
</div>
</div>
<p>We can then also do some cool batch recoding using the <code>%in%</code> operator and the <code>mutate()</code> function from {dplyr}…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> z <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occupation =</span> <span class="fu">case_when</span>(major <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"agricultural sciences"</span>, <span class="st">"animal husbandry"</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"applied sciences"</span>, <span class="st">"biology"</span>, <span class="st">"botany"</span>, <span class="st">"energy studies"</span>, <span class="st">"environmental science"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"epidemiology"</span>, <span class="st">"medicine/nursing"</span>, <span class="st">"pharmacology"</span>) <span class="sc">~</span> <span class="st">"natural science"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        major <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"business administration"</span>, <span class="st">"city planning"</span>, <span class="st">"economics"</span>, <span class="st">"human services"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"logistics"</span>, <span class="st">"military strategy"</span>) <span class="sc">~</span> <span class="st">"logistics"</span>, major <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"architecture"</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"integrated water resources management"</span>, <span class="st">"mechanical engineering"</span>) <span class="sc">~</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"engineering"</span>, major <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"communication"</span>, <span class="st">"criminal justice administration"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">"culinary services"</span>, <span class="st">"education"</span>, <span class="st">"philosophy"</span>, <span class="st">"physical education"</span>,</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"psychology"</span>) <span class="sc">~</span> <span class="st">"other"</span>))</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>occupation <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>occupation)  <span class="co"># can also use `as.factor()`</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>occupation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "engineering"     "logistics"       "natural science" "other"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>occupation <span class="ot">&lt;-</span> <span class="fu">relevel</span>(z<span class="sc">$</span>occupation, <span class="at">ref =</span> <span class="st">"natural science"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>occupation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] "natural science" "engineering"     "logistics"       "other"</code></pre>
</div>
</div>
<p>Again, we can plot our variable by group and run a multilevel linear regression. Each <span class="math inline">\(\beta\)</span> estimate reflects the difference from the estimated mean for the reference level. The <code>lm()</code> function also returns the results of the global significance test of our model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = zombies_killed ~ occupation, data = z)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3061 -1.0068 -0.0068  1.0092  8.0974 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            2.90256    0.08848  32.804   &lt;2e-16 ***
## occupationengineering  0.40356    0.19745   2.044   0.0412 *  
## occupationlogistics    0.08826    0.14777   0.597   0.5504    
## occupationother        0.10424    0.13496   0.772   0.4401    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.747 on 996 degrees of freedom
## Multiple R-squared:  0.004209,   Adjusted R-squared:  0.00121 
## F-statistic: 1.403 on 3 and 996 DF,  p-value: 0.2403</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> <span class="fl">0.489</span>, <span class="at">df1 =</span> <span class="dv">3</span>, <span class="at">df2 =</span> <span class="dv">996</span>)  <span class="co"># F test</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.6899872</code></pre>
</div>
</div>
<p>In this case, we see no significant effect of <strong>occupation</strong> (based on a broad categorization of college major) on zombie killing proficiency.</p>
</section>
<section id="one-way-anova" class="level2" data-number="20.4">
<h2 data-number="20.4" class="anchored" data-anchor-id="one-way-anova"><span class="header-section-number">20.4</span> One-Way ANOVA</h2>
<p>Regression with a single categorical predictor run as we have just done above is exactly equivalent to a “One-Way” or “one-factor” Analysis of Variance, or ANOVA. That is, ANOVA is just one type of special case of least squares regression.</p>
<p>We can, of course, run an ANOVA with one line in <strong><em>R</em></strong>. Compare the results presented in the <code>summary()</code> output table (or <code>tidy()</code> output table) from an ANOVA with that from the global test reported in <code>summary()</code> (or <code>tidy()</code>) from <code>lm()</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)
## occupation    3   12.9   4.285   1.403   0.24
## Residuals   996 3041.1   3.053</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m.aov)  <span class="co"># a neater table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 6
##   term          df  sumsq meansq statistic p.value
##   &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 occupation     3   12.9   4.28      1.40   0.240
## 2 Residuals    996 3041.    3.05     NA     NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>m.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = zombies_killed ~ occupation, data = z)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3061 -1.0068 -0.0068  1.0092  8.0974 
## 
## Coefficients:
##                       Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)            2.90256    0.08848  32.804   &lt;2e-16 ***
## occupationengineering  0.40356    0.19745   2.044   0.0412 *  
## occupationlogistics    0.08826    0.14777   0.597   0.5504    
## occupationother        0.10424    0.13496   0.772   0.4401    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.747 on 996 degrees of freedom
## Multiple R-squared:  0.004209,   Adjusted R-squared:  0.00121 
## F-statistic: 1.403 on 3 and 996 DF,  p-value: 0.2403</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m.lm)  <span class="co"># a neater table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 4 × 5
##   term                  estimate std.error statistic   p.value
##   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)             2.90      0.0885    32.8   1.27e-160
## 2 occupationengineering   0.404     0.197      2.04  4.12e-  2
## 3 occupationlogistics     0.0883    0.148      0.597 5.50e-  1
## 4 occupationother         0.104     0.135      0.772 4.40e-  1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.lm)  <span class="co"># plot(m.aov) is equivalent</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These two model summaries produce somewhat different tables for the same analysis. The <strong>F statistic</strong> and omnibus p value given in the <code>aov()</code> ANOVA table indicates whether there are differences between at least some treatments, but we do not know where those differences occur. The summary from <code>lm()</code> shows the effects of the categorical treatments arranged as sequential contrasts (the default in R). The first row gives the mean of the first level of the first factor specified in the model. The following rows give differences <strong>from this first mean</strong> for each subsequent factor level. Likewise the standard error in the first row is a standard error of a mean, while the entries in subsequent rows are standard errors of the differences between two means.</p>
<p>In general, in ANOVA and simple regression using a single categorical variable, we aim to test the <span class="math inline">\(H_0\)</span> that the means of a variable of interest do not differ among groups, i.e., that <span class="math inline">\(\mu_1 = \mu_2 = ... = \mu_k\)</span> are all equal. This is an extension of our comparison of two means that we did with z and t tests.</p>
<p>The basic linear model formulation for ANOVA is:</p>
<p><span class="math display">\[Y_{i,j} = \mu + \beta_i X_i + \epsilon_{i,j}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\mu\)</span> is the grand (overall) population mean</li>
<li><span class="math inline">\(\beta_i\)</span> is the deviation of the mean of treatment level <span class="math inline">\(i\)</span> from the grand mean</li>
<li><span class="math inline">\(\epsilon_{i,j}\)</span> is error variance of individual points, <span class="math inline">\(j\)</span>, within each level, <span class="math inline">\(i\)</span>, from the grand mean</li>
</ul>
<p>The assumptions of ANOVA, similar to those of simple regression, are:</p>
<ul>
<li>that samples are independent and identically distributed (<span class="math inline">\(iid\)</span>)</li>
<li>that the residuals, <span class="math inline">\(\epsilon_{i,j}\)</span>, are normally distributed</li>
<li>that within-group variances are similar across all groups (“homoscedastic”)</li>
</ul>
<p>Additionally, the following assumption of standard ANOVA makes the interpretation of results more straightforward, but it is not strictly required…</p>
<ul>
<li>that our experiment/observations have a balanced design (i.e., an equal number of cases in all groups)</li>
</ul>
<p>If this last assumption is violated, it ceases to be true that the <strong>total SS of our dataset = within group SS + between group SS</strong>, and then the calculations of our MSE and the F statistic, and our associated p value, would be off.</p>
</section>
<section id="simulation-based-inference" class="level2" data-number="20.5">
<h2 data-number="20.5" class="anchored" data-anchor-id="simulation-based-inference"><span class="header-section-number">20.5</span> Simulation-Based Inference</h2>
<p>Note that the ANOVA functions used above (<code>aov()</code>, <code>lm()</code>) are evaluating statistical significance and estimating p values based on mathematical theory, i.e., by comparing F statistic values to a theoretical, parametric <span class="math inline">\(F\)</span> distribution to determine how likely we are to see an F statistic as extreme as our observed one by chance under the null model of no difference between groups. However, as with other tests of statistical inference, we can also use permutation/randomization methods to determine p values for ANOVA.</p>
<p>One easy way to do this is with the {infer} package. Using {infer}, we can easily permute, a large number of times, the association between our response variable the categorical explanatory variable and, each time, then calculate the associated F statistic. This generates a permutation-based null distribution of F statistics to which we can compare the F statistic generated from our original data. The permutation-based p value is then the proportion of F statistic values generated by simulation that are equal to or greater than our observed F statistic value.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>original.F <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation) <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"occupation"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># show aov results for F statistic and p value for omnibus F test</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>original.F</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 6
##   term          df sumsq meansq statistic p.value
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 occupation     3  12.9   4.28      1.40   0.240</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>permuted.F <span class="ot">&lt;-</span> z <span class="sc">|&gt;</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># specify model</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">specify</span>(zombies_killed <span class="sc">~</span> occupation) <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># null hypothesis of independence</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># generate permutations</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the F statistic for the AOV</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"F"</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot our F statistic on the distribution of F statistic values generated by</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># permutation</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(permuted.F) <span class="sc">+</span> <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> original.F<span class="sc">$</span>statistic, <span class="at">direction =</span> <span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>(p.value <span class="ot">&lt;-</span> permuted.F <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_p_value</span>(<span class="at">obs_stat =</span> original.F<span class="sc">$</span>statistic, <span class="at">direction =</span> <span class="st">"greater"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 1
##   p_value
##     &lt;dbl&gt;
## 1   0.233</code></pre>
</div>
</div>
<p>Note that, for these data, the p value estimated through simulated based inference is very similar to that calculated paramterically based on mathematical theory. This is not always the case!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>original.F<span class="sc">$</span>p.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.2403441</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>p.value</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 1
##   p_value
##     &lt;dbl&gt;
## 1   0.233</code></pre>
</div>
</div>
<p>Alternatively, the {permuco} package introduces the <code>aovperm()</code> and <code>lmperm()</code> functions as analogs for <code>aov()</code> and <code>lm()</code> for analysis of variance and simple linear regression, where p values are calculated by permutation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(permuco)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>m.aovperm <span class="ot">&lt;-</span> <span class="fu">aovperm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aovperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Anova Table
## Resampling test using freedman_lane to handle nuisance variables and 5000 permutations.
##                 SS  df     F parametric P(&gt;F) resampled P(&gt;F)
## occupation   12.85   3 1.403           0.2403            0.24
## Residuals  3041.08 996</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.aovperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>m.lmperm <span class="ot">&lt;-</span> <span class="fu">lmperm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.lmperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Table of marginal t-test of the betas
## Resampling test using freedman_lane to handle nuisance variables and 5000 permutations.
##                       Estimate Std. Error t value parametric Pr(&gt;|t|)
## (Intercept)            2.90256    0.08848 32.8042          1.269e-160
## occupationengineering  0.40356    0.19745  2.0439           4.123e-02
## occupationlogistics    0.08826    0.14777  0.5973           5.504e-01
## occupationother        0.10424    0.13496  0.7724           4.401e-01
##                       resampled Pr(&lt;t) resampled Pr(&gt;t) resampled Pr(&gt;|t|)
## (Intercept)                                                               
## occupationengineering           0.9788           0.0214             0.0434
## occupationlogistics             0.7336           0.2666             0.5554
## occupationother                 0.7844           0.2158             0.4466</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>permuco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar to {infer}, the {coin} package also implements permutation-based tests of independence, including One-Way ANOVA. Instead of F statistics, the test statistic implemented in {coin} is a <strong>Chi-Square statistic</strong> (which is essentially to equivalent to an F statistic, normalized by the residual degrees of freedom), and it is tested against a permutation-based null distribution of Chi-Square values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coin)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">oneway_test</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation, <span class="at">distribution =</span> <span class="st">"approximate"</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># by default, 10000 replicates are used</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>m.aov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Approximative K-Sample Fisher-Pitman Permutation Test
## 
## data:  zombies_killed by
##   occupation (natural science, engineering, logistics, other)
## chi-squared = 4.2048, p-value = 0.2497</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>coin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="challenge" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge">CHALLENGE</h3>
<p>Load in the “gibbon-femurs.csv” dataset, which contains the lengths, in centimeters, of the femurs of 400 juvenile, subadult, and adult individuals gibbons. Use both ANOVA and simple linear regression to examine the relationship between age and femur length.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/gibbon-femurs.csv"</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Rows: 525 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (2): age, sex
## dbl (2): id, femur_length
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"inf"</span>, <span class="st">"juv"</span>, <span class="st">"subadult"</span>, <span class="st">"adult"</span>))</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># converts age to a factor and order the age levels so that they are in</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ascending chronological order several ANOVA functions require that</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># categorical variables are represented as factors rather than strings</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>))</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="co"># convert sex to a factor</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 4
##      id age   sex    femur_length
##   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;         &lt;dbl&gt;
## 1     1 inf   female         7.28
## 2     2 inf   male           6.3 
## 3     3 inf   female         7.44
## 4     4 inf   male           8.69
## 5     5 inf   female         9.13
## 6     6 inf   male           9.28</code></pre>
</div>
</div>
<p>Before beginning, check for normality of data overall…</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># not great overall...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, do a boxplot of the data by each age group and check for normality within each group.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age)  <span class="co"># boxplot with medians</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate average and SD by group</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age) <span class="sc">|&gt;</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="st">`</span><span class="at">mean(femur_length)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(femur_length), <span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(femur_length))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># add means to plot</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, stats<span class="sc">$</span><span class="st">`</span><span class="at">mean(femur_length)</span><span class="st">`</span>, <span class="at">pch =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subtract relevant group mean from each data point</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>means.centered <span class="ot">&lt;-</span> d<span class="sc">$</span>femur_length <span class="sc">-</span> stats[<span class="fu">as.numeric</span>(d<span class="sc">$</span>age), <span class="dv">2</span>]</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># graphical test for normality of group-centered means</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(means.centered<span class="sc">$</span><span class="st">`</span><span class="at">mean(femur_length)</span><span class="st">`</span>)  <span class="co"># looks good!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now do graphical test within each group</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"inf"</span>], <span class="at">main =</span> <span class="st">"Infant"</span>, <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"inf"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"juv"</span>], <span class="at">main =</span> <span class="st">"Juvenile"</span>, <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"juv"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-19-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"subadult"</span>], <span class="at">main =</span> <span class="st">"Subadult"</span>, <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"subadult"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-19-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"adult"</span>], <span class="at">main =</span> <span class="st">"Adult"</span>, <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"adult"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-19-6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Also, check whether the different groups have roughly equal variances. As a general rule of thumb, we can compare the largest and smallest within-group standard deviations; if the ratio of max-to-min is less, than 2 then the assumption of “equal” variances is usually reasonable.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check that variances are roughly equal (ratio of max/min is &lt;2)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)<span class="sc">/</span><span class="fu">min</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## [1] 1.767635</code></pre>
</details>
</div>
</div>
<p>All this checking done, we can again plot our data by group and then run our linear or ANOVA model…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age, <span class="at">xlab =</span> <span class="st">"Age"</span>, <span class="at">ylab =</span> <span class="st">"Femur Length (cm)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = femur_length ~ age, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2052 -1.1104  0.1089  1.0396  5.6748 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   7.7104     0.1180   65.32   &lt;2e-16 ***
## agejuv        2.3406     0.1803   12.98   &lt;2e-16 ***
## agesubadult   6.0460     0.2045   29.57   &lt;2e-16 ***
## ageadult      9.7147     0.2260   42.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.669 on 521 degrees of freedom
## Multiple R-squared:  0.809,  Adjusted R-squared:  0.8079 
## F-statistic: 735.8 on 3 and 521 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age)  <span class="co"># femur length related to age</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## age           3   6152  2050.6   735.8 &lt;2e-16 ***
## Residuals   521   1452     2.8                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Is the omnibus test of the relationship between age category and femur length significant? YES! Are femur lengths significantly different for juveniles versus subadults? Subadults versus adults? Juveniles versus adults?</p>
<blockquote class="blockquote">
<p><strong>HINT:</strong> To test some of these additional bivariate options, you will need to <code>relevel()</code> your factors for simple linear regression. Currently, we are just testing each group relative to the first level of the factor <strong>age</strong>.</p>
</blockquote>
</section>
</section>
<section id="post-hoc-tests-in-anova" class="level2" data-number="20.6">
<h2 data-number="20.6" class="anchored" data-anchor-id="post-hoc-tests-in-anova"><span class="header-section-number">20.6</span> Post-Hoc Tests in ANOVA</h2>
<p>After finding a significant omnibus F statistic in an ANOVA, we can test, post-hoc, what group means are different from one another using <strong>pairwise t tests</strong> with an appropriate p value correction for multiple tests.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(d<span class="sc">$</span>femur_length, d<span class="sc">$</span>age, <span class="at">p.adj =</span> <span class="st">"bonferroni"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  d$femur_length and d$age 
## 
##          inf    juv    subadult
## juv      &lt;2e-16 -      -       
## subadult &lt;2e-16 &lt;2e-16 -       
## adult    &lt;2e-16 &lt;2e-16 &lt;2e-16  
## 
## P value adjustment method: bonferroni</code></pre>
</div>
</div>
<p>After an ANOVA, we can also use a <strong>Tukey Honest Significant Differences</strong> test with the model as the argument to evaluate this.</p>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> The <code>TukeyHSD()</code> function is run on the output of the ANOVA (<code>aov()</code>) function.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># renaming age categories so we get nice axis labels on plot...</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">case_when</span>(age <span class="sc">==</span> <span class="st">"adult"</span> <span class="sc">~</span> <span class="st">"A"</span>, age <span class="sc">==</span> <span class="st">"subadult"</span> <span class="sc">~</span> <span class="st">"S"</span>, age <span class="sc">==</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">"juv"</span> <span class="sc">~</span> <span class="st">"J"</span>, age <span class="sc">==</span> <span class="st">"inf"</span> <span class="sc">~</span> <span class="st">"I"</span>))</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">aov</span>(femur_length <span class="sc">~</span> age, <span class="at">data =</span> d)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>posthoc <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(m, <span class="at">which =</span> <span class="st">"age"</span>, <span class="at">ordered =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>posthoc  <span class="co"># all age-sex classes differ</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
##     factor levels have been ordered
## 
## Fit: aov(formula = femur_length ~ age, data = d)
## 
## $age
##         diff      lwr       upr p adj
## J-I 2.340617 1.875875  2.805359     0
## S-I 6.045950 5.518982  6.572918     0
## A-I 9.714750 9.132165 10.297335     0
## S-J 3.705333 3.149860  4.260806     0
## A-J 7.374133 6.765643  7.982623     0
## A-S 3.668800 3.011556  4.326044     0</code></pre>
</div>
</div>
<p>We can get a visual summary of difference in means between each group and their confidence intervals by passing the Tukey test output to a <code>plot()</code> function. Confidence intervals that cross the vertical line indicate pairs of groups where the difference in mean is not significant, according to the threshold we set.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(posthoc, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">12</span>))  <span class="co"># xlim set to show zero</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="a-non-parametric-alternative" class="level2" data-number="20.7">
<h2 data-number="20.7" class="anchored" data-anchor-id="a-non-parametric-alternative"><span class="header-section-number">20.7</span> A Non-Parametric Alternative</h2>
<p>The <strong>Kruskal-Wallis</strong> test is a nonparametric alternative to One-Way ANOVA that relaxes the need for normality in the distribution of data in each group (the different groups should still have roughly equal variances). Essentially, rather than testing the null hypothesis that the means for each group do not differ we are instead testing the null hypothesis that the <strong>medians</strong> do not differ. The test converts the continuous response variable to a set of RANKS (i.e., it does a uniform transformation) and then works with those ranks. The <strong>p</strong> value associated with the Kruskall-Wallis test statistic is calculated mathematically relative to a Chi-Square distribution.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>(m.kruskal <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  femur_length by age
## Kruskal-Wallis chi-squared = 407.13, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to show that this is the same as the test using ranks...  use {dplyr} to sort</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># by femur.length...</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">arrange</span>(d, femur_length)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># then use {dplyr} to add new variable of rank femur_length</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d, <span class="at">femur_rank =</span> <span class="fu">row</span>(<span class="fu">data.frame</span>(d<span class="sc">$</span>femur_length)))</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>(m.kruskal <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(<span class="at">data =</span> d, femur_rank <span class="sc">~</span> age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  femur_rank by age
## Kruskal-Wallis chi-squared = 407.43, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>For a post-hoc test of which groups are different following a Kruskall-Wallis test, we can use either a pairwise Mann-Whitney U test, a Dunn test, or a Conover-Iman test. The latter two tests are implemented using <code>dunn.test()</code> from the {dunn.test} package or <code>conover.test()</code> from the {conover.test} package, which both allow us to show the calculated Krusal-Wallis test statistic as well.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pairwise Mann-Whitney U test the arguments are a vector of data, a vector</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># with the grouping factor, and the multiple test correction method...</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.wilcox.test</span>(d<span class="sc">$</span>femur_length, d<span class="sc">$</span>age, <span class="at">p.adjust.method =</span> <span class="st">"bonferroni"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Pairwise comparisons using Wilcoxon rank sum test with continuity correction 
## 
## data:  d$femur_length and d$age 
## 
##   A      I      J     
## I &lt;2e-16 -      -     
## J &lt;2e-16 &lt;2e-16 -     
## S &lt;2e-16 &lt;2e-16 &lt;2e-16
## 
## P value adjustment method: bonferroni</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `dunn.test()` and `conover.test()` include another argument, `kw=` which is</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># whether or not to output KW results</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dunn.test)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dunn.test</span>(d<span class="sc">$</span>femur_length, <span class="at">g =</span> d<span class="sc">$</span>age, <span class="at">method =</span> <span class="st">"bonferroni"</span>, <span class="at">kw =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##   Kruskal-Wallis rank sum test
## 
## data: x and group
## Kruskal-Wallis chi-squared = 407.1264, df = 3, p-value = 0
## 
## 
##                            Comparison of x by group                            
##                                  (Bonferroni)                                  
## Col Mean-|
## Row Mean |          A          I          J
## ---------+---------------------------------
##        I |   17.43010
##          |    0.0000*
##          |
##        J |   10.06368  -8.673333
##          |    0.0000*    0.0000*
##          |
##        S |   3.468151  -14.94416  -6.920645
##          |    0.0016*    0.0000*    0.0000*
## 
## alpha = 0.05
## Reject Ho if p &lt;= alpha/2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>dunn.test)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conover.test)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">conover.test</span>(d<span class="sc">$</span>femur_length, <span class="at">g =</span> d<span class="sc">$</span>age, <span class="at">method =</span> <span class="st">"bonferroni"</span>, <span class="at">kw =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##   Kruskal-Wallis rank sum test
## 
## data: x and group
## Kruskal-Wallis chi-squared = 407.1264, df = 3, p-value = 0
## 
## 
##                            Comparison of x by group                            
##                                  (Bonferroni)                                  
## Col Mean-|
## Row Mean |          A          I          J
## ---------+---------------------------------
##        I |   36.80108
##          |    0.0000*
##          |
##        J |   21.24798  -18.31245
##          |    0.0000*    0.0000*
##          |
##        S |   7.322488  -31.55238  -14.61191
##          |    0.0000*    0.0000*    0.0000*
## 
## alpha = 0.05
## Reject Ho if p &lt;= alpha/2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>conover.test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="effect-sizes" class="level3" data-number="20.7.1">
<h3 data-number="20.7.1" class="anchored" data-anchor-id="effect-sizes"><span class="header-section-number">20.7.1</span> Effect Sizes</h3>
<p>We can apply the <code>effectsize()</code> function from the {effectsize} package to our model objects to better interpret the meaning of our coefficients.</p>
<p>For an ANOVA, the effect sizes represent the amount of variance in the response variable explained by each of the model’s terms. For this model, we are asking what percent of the total variance in <strong>femur length</strong> is explained by the categorical variable of <strong>age</strong> class. This measure is called <span class="math inline">\(\eta^2\)</span> (“eta-squared”) and is analogous to r-squared.</p>
<p><span class="math display">\[\eta^2 = \frac{SS_{predictor}}{SS_{total}} = \frac{SS_{predictor}}{SS_{predictor} + SS_{residuals}}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## For one-way between subjects designs, partial eta squared is equivalent
##   to eta squared. Returning eta squared.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Eta2 |       95% CI
## -------------------------------
## age       | 0.81 | [0.79, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or `eta_squared(m.aov)` we can hand-calculate this same value from the ANOVA</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># table as 6152/(6152 + 1452)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, 81% of the variance in <strong>femur length</strong> is accounted for by variance in <strong>age</strong>.</p>
<p>Applied to a linear model object, the <code>effectsize()</code> function refits the model and returns <strong>standardized</strong> coefficients rather than unstandardized ones. This is equivalent to running the original linear model after standardizing all of the variables so that they are represented on the same scale, which is typically done via a <span class="math inline">\(Z\)</span> transformation (i.e., by subtracting its mean from each variable observation and divide by its standard deviation): <span class="math inline">\(z_i = \frac{x_i - \mu_x}{SD_x}\)</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## For one-way between subjects designs, partial eta squared is equivalent
##   to eta squared. Returning eta squared.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Eta2 |       95% CI
## -------------------------------
## age       | 0.81 | [0.79, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: The {datawizard} package provides the function <code>standardize()</code>, which will take a model and refit it using standardized parameters and return a refitted model object. The {parameters} package function <code>standardize_parameters()</code> will also return standardized coefficients when passed a model object. These two function are designed to replace the <code>effectsize()</code> function from the {effectsize} package.</p>
</blockquote>
</section>
</section>
<section id="multiple-factor-anova" class="level2" data-number="20.8">
<h2 data-number="20.8" class="anchored" data-anchor-id="multiple-factor-anova"><span class="header-section-number">20.8</span> Multiple Factor ANOVA</h2>
<p>Sometimes the data we are interested in is characterized by multiple grouping variables (e.g., <strong>age</strong> and <strong>sex</strong>). In the case of the gibbon femur length data, we are interested in the <strong>main effect</strong> of each factor on the variable of interest (e.g., do femur lengths vary by <strong>age</strong> or <strong>sex</strong>) while accounting for the effects of the other factor. We may also be interested in any <strong>interactive effects</strong> among factors. Thus, in multiple factor ANOVA we are interested in testing several null hypotheses simultaneously: [1] that each factor has no effect on the mean of our continuous response variable and [2] that there are no interactive effects of sets of factors on the mean of our continuous response variable.</p>
<p>Model description and testing for multiple-factor ANOVA is a simple extension of the formula notation which we’ve used for single factors. First, though, let’s quickly check that our groups have similar variance.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(age, sex) <span class="sc">|&gt;</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="st">`</span><span class="at">mean(femur_length)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(femur_length), <span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sd</span>(femur_length))</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># first we calculate averages by combination of factors</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)<span class="sc">/</span><span class="fu">min</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 1.882171</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check that variances in each group are roughly equal (ratio of max/min is &lt;2)</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">y =</span> femur_length, <span class="at">x =</span> sex)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>age,</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Sex"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and let's plot what the data look like p &lt;- p + geom_point() # uncommenting</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="co"># this shows all points</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">y =</span> femur_length, <span class="at">x =</span> sex), <span class="at">fun =</span> base<span class="sc">::</span>mean,</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">shape =</span> <span class="dv">8</span>, <span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure we use {base} version of mean</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we look at each variable separately using ANOVA, we see there is an effect of <strong>age</strong> but not of <strong>sex</strong>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## age           3   6152  2050.6   735.8 &lt;2e-16 ***
## Residuals   521   1452     2.8                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)
## sex           1     28   28.33   1.956  0.163
## Residuals   523   7576   14.48</code></pre>
</div>
</div>
<p>However, if we do a Two-Way ANOVA and consider the factors together, we see that there is still a main effect of <strong>age</strong> when taking <strong>sex</strong> into account <strong>and</strong> there is a main effect of <strong>sex</strong> when we take <strong>age</strong> into account.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex))</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>m.aov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## age           3   6152  2050.6   756.4  &lt; 2e-16 ***
## sex           1     42    42.3    15.6 8.89e-05 ***
## Residuals   520   1410     2.7                     
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>To examine whether there is an interaction effect, we would modify our model formula a bit using the colon operator (<code>:</code>) to specify a particular interaction term…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> age<span class="sc">:</span>sex)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the colon (:) operator includes specific interaction terms</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## age           3   6152  2050.6   735.8 &lt;2e-16 ***
## Residuals   521   1452     2.8                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We could also use the asterisk (<code>*</code>) operator, which expands to include all interactions among terms, including 3-way, 4-way, etc., interactions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">*</span> sex)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="co"># asterisk (*) operator includes all interaction terms</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## age           3   6152  2050.6  816.35  &lt; 2e-16 ***
## sex           1     42    42.3   16.84 4.72e-05 ***
## age:sex       3    111    37.0   14.73 3.21e-09 ***
## Residuals   517   1299     2.5                     
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">*</span> sex)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or using the lm() function...</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = femur_length ~ age * sex, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.8727 -1.0088  0.1336  1.0469  4.6773 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   16.7159     0.2389  69.960  &lt; 2e-16 ***
## ageI          -8.8909     0.2854 -31.148  &lt; 2e-16 ***
## ageJ          -6.7395     0.2968 -22.706  &lt; 2e-16 ***
## ageS          -4.0428     0.3360 -12.031  &lt; 2e-16 ***
## sexmale        1.7160     0.3716   4.617 4.91e-06 ***
## ageI:sexmale  -1.9523     0.4341  -4.498 8.48e-06 ***
## ageJ:sexmale  -1.5538     0.4534  -3.427 0.000658 ***
## ageS:sexmale   0.2536     0.4895   0.518 0.604641    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.585 on 517 degrees of freedom
## Multiple R-squared:  0.8292, Adjusted R-squared:  0.8269 
## F-statistic: 358.6 on 7 and 517 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We can use the function <code>interaction.plot()</code> to visualize interactions among categorical variables.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(<span class="at">x.factor =</span> d<span class="sc">$</span>age, <span class="at">xlab =</span> <span class="st">"Age"</span>, <span class="at">trace.factor =</span> d<span class="sc">$</span>sex, <span class="at">trace.label =</span> <span class="st">"Sex"</span>,</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> d<span class="sc">$</span>femur_length, <span class="at">fun =</span> base<span class="sc">::</span>mean, <span class="at">ylab =</span> <span class="st">"Mean Femur Length"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
</div>
<p>Here, it looks like there is indeed a significant main effect of each term as well as an interaction between our two categorical variables. We will return to comparing models to one another (e.g., our model with and without interactions) and to post-hoc tests of what group mean differences are significant when we get into model selection in another few lectures.</p>
<p>When we do <code>summary()</code> of the results of the <code>lm()</code> function, we are estimating eight <span class="math inline">\(\beta\)</span> coefficients (equivalent to the number of groups we have). <span class="math inline">\(\beta_0\)</span>, the intercept, is the mean femur length for the base level (in this case, “adult females”). Then we have coefficients showing how the different factor combination groups would differ from that base level (e.g., adult males have mean femur lengths 1.716 greater than adult females, etc).</p>
<p>The {permuco} package also lets us run multiple factor ANOVA using permutation/randomization to estimate p values.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(permuco)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>m.aovperm <span class="ot">&lt;-</span> <span class="fu">aovperm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> age<span class="sc">:</span>sex)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aovperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Anova Table
## Resampling test using freedman_lane to handle nuisance variables and 5000 permutations.
##               SS  df      F parametric P(&gt;F) resampled P(&gt;F)
## age       6136.3   3 814.28        0.000e+00           2e-04
## sex         91.7   1  36.51        2.914e-09           2e-04
## age:sex    111.0   3  14.73        3.210e-09           2e-04
## Residuals 1298.7 517</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>permuco)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When we run <code>effectsize()</code> on a model object resulting from a multiple factor ANOVA, the function by default returns partial <span class="math inline">\(\eta^2\)</span> values, which is the proportion of the variance in the response variable that is accounted by each predictor <em>when controlling for the other predictors</em>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m.aov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA (Type I)
## 
## Parameter | Eta2 (partial) |       95% CI
## -----------------------------------------
## age       |           0.83 | [0.81, 1.00]
## sex       |           0.03 | [0.01, 1.00]
## age:sex   |           0.08 | [0.04, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or effectsize(m.aov, partial = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="type-i-ii-and-iii-anova" class="level2" data-number="20.9">
<h2 data-number="20.9" class="anchored" data-anchor-id="type-i-ii-and-iii-anova"><span class="header-section-number">20.9</span> Type I, II, and III ANOVA</h2>
<p>It is important to recognize that the ORDER in which our factors are entered into a linear model using categorical predictors can result in different values for the entries in our ANOVA table, while the estimation of our regression coefficients is identical regardless. Take a look at this example, where the variables <strong>age</strong> and <strong>sex</strong> are entered into our ANOVA formula in different orders:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## age           3   6152  2050.6   756.4  &lt; 2e-16 ***
## sex           1     42    42.3    15.6 8.89e-05 ***
## Residuals   520   1410     2.7                     
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex <span class="sc">+</span> age)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## sex           1     28    28.3   10.45 0.00131 ** 
## age           3   6166  2055.3  758.13 &lt; 2e-16 ***
## Residuals   520   1410     2.7                    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = femur_length ~ age + sex, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2429 -1.1040  0.1011  1.0560  5.3403 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  17.1896     0.1993   86.27  &lt; 2e-16 ***
## ageI         -9.7556     0.2232  -43.71  &lt; 2e-16 ***
## ageJ         -7.4007     0.2329  -31.77  &lt; 2e-16 ***
## ageS         -3.7467     0.2523  -14.85  &lt; 2e-16 ***
## sexmale       0.5701     0.1443    3.95 8.89e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.647 on 520 degrees of freedom
## Multiple R-squared:  0.8146, Adjusted R-squared:  0.8132 
## F-statistic: 571.2 on 4 and 520 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex <span class="sc">+</span> age)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = femur_length ~ sex + age, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2429 -1.1040  0.1011  1.0560  5.3403 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  17.1896     0.1993   86.27  &lt; 2e-16 ***
## sexmale       0.5701     0.1443    3.95 8.89e-05 ***
## ageI         -9.7556     0.2232  -43.71  &lt; 2e-16 ***
## ageJ         -7.4007     0.2329  -31.77  &lt; 2e-16 ***
## ageS         -3.7467     0.2523  -14.85  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.647 on 520 degrees of freedom
## Multiple R-squared:  0.8146, Adjusted R-squared:  0.8132 
## F-statistic: 571.2 on 4 and 520 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Why is this? In the first model, we are looking at the variance <em>within each age group</em> that is <em>explained by gender</em> while in the second case we are looking at the variance <em>within each gender</em> that is <em>explained by age</em>… but we have different numbers of observations in our different groups. This is known as an unbalanced design.</p>
<p>We can see the unbalanced design by tabulating the cases for each combination of factors.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>sex, d<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##         
##            A   I   J   S
##   female  44 103  81  45
##   male    31  97  69  55</code></pre>
</div>
</div>
<p>Recall that ANOVA is based on splitting up the sums of squares, so that for a model like:</p>
<p><span class="math display">\[Y_{i,j,k} = \mu + a_i + b_j + ab_{i,j} + \epsilon_{i,j,k}\]</span></p>
<p>The sums of squares add up such that:</p>
<p><span class="math display">\[SS_{total} = SS_a + SS_b + SS_{ab} + SS_{residual}\]</span></p>
<p>By default, the <code>aov()</code> function uses something called <strong>Type I Sums of Squares</strong> (also called “sequential sum of squares”), which gives greater emphasis to the first factor in the model, leaving only residual variation to the remaining factors. It should be used when you want to first control for one factor, leaving the others to explain only any remaining differences. In a <strong>Type I</strong> ANOVA, the sums of squares for the first term are calculated around the grand mean of our observations, but the next terms are calculated as residuals around the average of the grand mean and the first group mean. This sequential procedure means our results depend on which term shows up first. This can have a marked effect on the sums of squares calculated, and hence on p values, when using an unbalanced design.</p>
<p>By contrast, what are know as <strong>Type II</strong> and <strong>Type III Sums of Squares</strong> both calculate the deviations between the individual observations within each group from the grand mean rather than the group mean.</p>
<p><strong>Type II Sum of Squares</strong> compares the main effects of each factor, assuming that the interaction between factors is minimal. Generally it is a much more appropriate test for comparing among different main effects and is more appropriate for us to use when there is an unbalanced design.</p>
<p><strong>Type III Sum of Squares</strong> (or “marginal sum of squares”) is most appropriate when there is a significant interaction effect between factors. Since both <strong>Type II</strong> and <strong>Type III</strong> ANOVA calculate sums of squares around the grand mean, these are unaffected by different sample sizes across different categorical groups and do not arbitrarily give preference to one effect over another.</p>
<p>To summarize:</p>
<ul>
<li>When our data are balanced, our factors are orthogonal, and all three types of sums of squares give the same results.</li>
<li>If our data are strongly unbalanced, we should generally be using Type II or Type III Sums of Squares, since we are generally interested in exploring the significance of one factor while controlling for the level of the other factors.</li>
<li>In general, if there is no significant interaction effect between factors, then Type II is more powerful than Type III.</li>
<li>If an important interaction is present, then Type II analysis is inappropriate, while Type III analysis can still be used, but the results need to be interpreted with caution (in the presence of interactions, individual main effects of different factors difficult to interpret).</li>
</ul>
<p>See <a href="http://md.psych.bio.uni-goettingen.de/mv/unit/lm_cat/lm_cat_unbal_ss_explained.html">this post</a> or <a href="http://goanna.cs.rmit.edu.au/~fscholer/anova.php">this post</a> for further treatments of the issue.</p>
<p>We can use the <code>Anova()</code> function in the {car} package to run ANOVA with Type II and Type III Sums of Squares. In the examples below, both linear models, where the order of factors are reversed, give the same results for Type II and Type III ANOVA, but not for Type I. The <code>Anova()</code> function takes as its argument a model object, e.g., the result from a call to either <code>lm()</code> or <code>aov()</code> and recalculates the appropriate sums of squares. Note how the effect sizes (partial <span class="math inline">\(\eta^2\)</span> values) are slightly different depending on whether they are being calculated from Type I or Type II ANOVA objects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## 
## Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## The following object is masked from 'package:dplyr':
## 
##     recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## The following object is masked from 'package:purrr':
## 
##     some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA (Type I)
## 
## Parameter | Eta2 (partial) |       95% CI
## -----------------------------------------
## age       |           0.81 | [0.79, 1.00]
## sex       |           0.03 | [0.01, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m1, <span class="at">type =</span> <span class="st">"II"</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>m1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Anova Table (Type II tests)
## 
## Response: femur_length
##           Sum Sq  Df F value    Pr(&gt;F)    
## age       6165.8   3 758.126 &lt; 2.2e-16 ***
## sex         42.3   1  15.604 8.888e-05 ***
## Residuals 1409.7 520                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex <span class="sc">+</span> age)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA (Type I)
## 
## Parameter | Eta2 (partial) |       95% CI
## -----------------------------------------
## sex       |           0.02 | [0.00, 1.00]
## age       |           0.81 | [0.79, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m2, <span class="at">type =</span> <span class="st">"II"</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>m2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Anova Table (Type II tests)
## 
## Response: femur_length
##           Sum Sq  Df F value    Pr(&gt;F)    
## sex         42.3   1  15.604 8.888e-05 ***
## age       6165.8   3 758.126 &lt; 2.2e-16 ***
## Residuals 1409.7 520                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA (Type II)
## 
## Parameter | Eta2 (partial) |       95% CI
## -----------------------------------------
## age       |           0.81 | [0.79, 1.00]
## sex       |           0.03 | [0.01, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # Effect Size for ANOVA (Type II)
## 
## Parameter | Eta2 (partial) |       95% CI
## -----------------------------------------
## sex       |           0.03 | [0.01, 1.00]
## age       |           0.81 | [0.79, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">*</span> sex)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m1, <span class="at">type =</span> <span class="st">"III"</span>)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>m1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Anova Table (Type III tests)
## 
## Response: femur_length
##              Sum Sq  Df  F value    Pr(&gt;F)    
## (Intercept) 12294.6   1 4894.442 &lt; 2.2e-16 ***
## age          2661.3   3  353.158 &lt; 2.2e-16 ***
## sex            53.6   1   21.320  4.91e-06 ***
## age:sex       111.0   3   14.735  3.21e-09 ***
## Residuals    1298.7 517                       
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex <span class="sc">*</span> age)</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m2, <span class="at">type =</span> <span class="st">"III"</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>m2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Anova Table (Type III tests)
## 
## Response: femur_length
##              Sum Sq  Df  F value    Pr(&gt;F)    
## (Intercept) 12294.6   1 4894.442 &lt; 2.2e-16 ***
## sex            53.6   1   21.320  4.91e-06 ***
## age          2661.3   3  353.158 &lt; 2.2e-16 ***
## sex:age       111.0   3   14.735  3.21e-09 ***
## Residuals    1298.7 517                       
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="chi-square-tests" class="level2" data-number="20.10">
<h2 data-number="20.10" class="anchored" data-anchor-id="chi-square-tests"><span class="header-section-number">20.10</span> Chi-Square Tests</h2>
<p>One additional type of categorical data we will often encounter are counts of observations that fall into two or more categories (when we were dealing with <span class="math inline">\(Z\)</span> tests for proportion data, we were interested in something similar, though with two categories only). We can use <strong>Chi-Square tests</strong> to evaluate statistically the distribution of observations across levels of one or more categorical variables. To use the Chi-Square test we first derive a <strong>Chi-Square</strong> <strong>statistic</strong> (<span class="math inline">\(\chi^2\)</span>) , which is calculated as…</p>
<p><span class="math display">\[\chi^2 = \displaystyle\sum_{i=1}^k \frac{(O_i - E_i)^2}{E_i}\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(O_i\)</span> = number of observations in the <span class="math inline">\(i\)</span>th category</li>
<li><span class="math inline">\(E_i\)</span> = number of observations in the <span class="math inline">\(i\)</span>th category</li>
</ul>
<p>We then compare the value of the <span class="math inline">\(\chi^2\)</span> statistic to the Chi-Square distribution with <span class="math inline">\(k-1\)</span> degrees of freedom. The Chi-Square distribution, like the <span class="math inline">\(F\)</span> distribution, is a continuous probability distribution, defined for <span class="math inline">\(x≥0\)</span>. It is governed by a single parameter, <span class="math inline">\(df\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x, <span class="at">df =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>), <span class="at">main =</span> <span class="st">"Some Example Chi-Square Distributions"</span>,</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">sub =</span> <span class="st">"(vertical line shows critical value for df=3)"</span>, <span class="at">ylab =</span> <span class="st">"f(x)"</span>, <span class="at">xlab =</span> <span class="st">"x"</span>)</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x, <span class="at">df =</span> <span class="dv">3</span>), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x, <span class="at">df =</span> <span class="dv">5</span>), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x, <span class="at">df =</span> <span class="dv">10</span>), <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"right"</span>, <span class="fu">c</span>(<span class="st">"df=1"</span>, <span class="st">"df=3"</span>, <span class="st">"df=5"</span>, <span class="st">"df=10"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>), <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"black"</span>), <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)</span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb154-11"><a href="#cb154-11" aria-hidden="true" tabindex="-1"></a>crit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 7.814728</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> crit)</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(crit, <span class="fu">seq</span>(<span class="at">from =</span> crit, <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> <span class="dv">1000</span>), <span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">dchisq</span>(<span class="fu">seq</span>(<span class="at">from =</span> crit,</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="dv">20</span>, <span class="at">length.out =</span> <span class="dv">1000</span>), <span class="at">df =</span> <span class="dv">3</span>), <span class="dv">0</span>)), <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>,</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="challenge-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-1">CHALLENGE</h3>
<p>Let’s return to the zombie apocalypse survivors dataset, where we defined an occupation based on major for survivors of the zombie apocalypse. Use a Chi-Square test to evaluate the hypothesis that survivors of the zombie apocalypse are more likely than expected by chance to be natural science majors. Assume that assume our null hypothesis is that the proportions of different post-apocalypse occupations are equivalent, i.e., that <span class="math inline">\(\pi_{natural science}\)</span> = <span class="math inline">\(\pi_{engineering}\)</span>= <span class="math inline">\(\pi_{logistics}\)</span> = <span class="math inline">\(\pi_{other}\)</span> = 0.25.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>(obs.table <span class="ot">&lt;-</span> <span class="fu">table</span>(z<span class="sc">$</span>occupation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## 
## natural science     engineering       logistics           other 
##             390              98             218             294</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># returns the same as summary()</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>(exp.table <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.25</span> <span class="sc">*</span> <span class="fu">length</span>(z<span class="sc">$</span>occupation), <span class="dv">4</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## [1] 250 250 250 250</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># equal expectation for each of 4 categories</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>occupation.matrix <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(obs.table, exp.table, (obs.table <span class="sc">-</span> exp.table)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>exp.table))</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(occupation.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Oi"</span>, <span class="st">"Ei"</span>, <span class="st">"(Oi-Ei)^2/Ei"</span>)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>occupation.matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>##                  Oi  Ei (Oi-Ei)^2/Ei
## natural science 390 250       78.400
## engineering      98 250       92.416
## logistics       218 250        4.096
## other           294 250        7.744</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>(X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(occupation.matrix[, <span class="dv">3</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## [1] 182.656</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> X2, <span class="fu">length</span>(obs.table) <span class="sc">-</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## [1] 0</code></pre>
</details>
</div>
</div>
<p>Here, we reject the null hypothesis that the proportions of different occupations among the survivors of the zombie apocalypse is equivalent.</p>
<p>We can do all this with a 1-liner in <strong><em>R</em></strong>, too.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table, <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Chi-squared test for given probabilities
## 
## data:  obs.table
## X-squared = 182.66, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here p is a vector of expected proportions... default is uniform</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Chi-squared test for given probabilities
## 
## data:  obs.table
## X-squared = 182.66, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table, <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.42</span>, <span class="fl">0.07</span>, <span class="fl">0.22</span>, <span class="fl">0.29</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Chi-squared test for given probabilities
## 
## data:  obs.table
## X-squared = 13.416, df = 3, p-value = 0.003818</code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># with a different set of expected proportions... fail to reject H0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The above was a <strong>Chi-Square goodness of fit</strong> test for one categorical variable… what about if we have two categorical variables and we are curious if there is an association among them? Then we do a <strong>Chi-Square test of independence</strong>. In this case, our Chi-Square statistic would be the sum of <span class="math inline">\(\frac{(O-E)^2}{E}\)</span> across all cells in our table, and our degrees of freedom is (number of rows - 1) <span class="math inline">\(\times\)</span> (number of columns - 1). Let’s suppose we want to see if there is a relationship among zombie apocalypse survivors between gender and occupation.</p>
<p>First, we determine our table of observed proportions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">obs.table =</span> <span class="fu">table</span>(z<span class="sc">$</span>gender, z<span class="sc">$</span>occupation))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##         
##          natural science engineering logistics other
##   Male               198          49       109   150
##   Female             192          49       109   144</code></pre>
</div>
</div>
<p>We can view our data graphically using the <code>mosaic plot()</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">t</span>(obs.table), <span class="at">main =</span> <span class="st">"Contingency Table"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"darkseagreen"</span>, <span class="st">"gray"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="20-module_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the `t()` function transposes the table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we determine our table of expected proportions:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(obs.table))  <span class="co"># row margins</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##   Male Female 
##    506    494</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>(c <span class="ot">&lt;-</span> <span class="fu">colSums</span>(obs.table))  <span class="co"># column margins</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## natural science     engineering       logistics           other 
##             390              98             218             294</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>(nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(obs.table))  <span class="co"># row dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>(nc <span class="ot">&lt;-</span> <span class="fu">ncol</span>(obs.table))  <span class="co"># column dimensions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>(exp.table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(c, <span class="at">each =</span> nr) <span class="sc">*</span> r<span class="sc">/</span><span class="fu">sum</span>(obs.table), <span class="at">nrow =</span> nr, <span class="at">ncol =</span> nc,</span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">dimnames =</span> <span class="fu">dimnames</span>(obs.table), <span class="at">byrow =</span> <span class="cn">FALSE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##         
##          natural science engineering logistics   other
##   Male            197.34      49.588   110.308 148.764
##   Female          192.66      48.412   107.692 145.236</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculates the product of c*r and divides by total</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>(X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((obs.table <span class="sc">-</span> exp.table)<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>exp.table))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.07076686</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> X2, <span class="at">df =</span> (nr <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (nc <span class="sc">-</span> <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.9950981</code></pre>
</div>
</div>
<p>Again, we can do a one-liner for a test of independence…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Pearson's Chi-squared test
## 
## data:  obs.table
## X-squared = 0.070767, df = 3, p-value = 0.9951</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="concept-review" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="concept-review">Concept Review</h2>
<ul>
<li>ANOVA is conceptually equivalent linear regression, but with one or more categorical predictor variables</li>
<li>ANOVA effectively tests whether the means of different groups are different</li>
<li>The Kruskall-Wallis test is a nonparametric alternative to a One-Way ANOVA that relaxes the need for normality in the distribution of data in each group and tests for a difference in the <strong>medians</strong> of different groups</li>
<li>ANOVAs should have balanced or roughly balanced numbers of observations within each categorical group</li>
<li>Chi-Square (<span class="math inline">\(\chi^2\)</span>) goodness-of-fit tests are another type of factor-based categorical data analysis, where we compare between observed and expected counts of observations in different grouping categories for either a single variable or two variables</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./19-module.html" class="pagination-link  aria-label=" &lt;span="" of="" regression="" analysis&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./exercise-01.html" class="pagination-link" aria-label="Exercise 01">
        <span class="nav-page-text">Exercise 01</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb194" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Categorical Data Analysis {#module-20}</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objectives</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In this module, we examine how simple linear regression can be applied to datasets where our predictor variable is discrete or categorical rather than continuous. Indeed, we will see that One-Way (and Two-Way) Analysis of Variance (ANOVA) is a specific application of simple (and multiple) linear regression. We also look at other methods for basic statistical analysis of categorical data.</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install these packages in ***R***: <span class="co">[</span><span class="ot">{permuco}</span><span class="co">](https://cran.r-project.org/web/packages/permuco/permuco.pdf)</span>, <span class="co">[</span><span class="ot">{dunn.test}</span><span class="co">](https://cran.r-project.org/web/packages/dunn.test/dunn.test.pdf)</span>, <span class="co">[</span><span class="ot">{conover.test}</span><span class="co">](https://cran.r-project.org/web/packages/conover.test/conover.test.pdf)</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install and load this package in ***R***:</span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">{effectsize}</span><span class="co">](https://cran.r-project.org/web/packages/effectsize/effectsize.pdf)</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load {tidyverse}, {broom}, and {infer}</span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-16"><a href="#cb194-16" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-17"><a href="#cb194-17" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb194-18"><a href="#cb194-18" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb194-19"><a href="#cb194-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb194-20"><a href="#cb194-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb194-21"><a href="#cb194-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)</span>
<span id="cb194-22"><a href="#cb194-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effectsize)</span>
<span id="cb194-23"><a href="#cb194-23" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-24"><a href="#cb194-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-25"><a href="#cb194-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Categorical Predictors</span></span>
<span id="cb194-26"><a href="#cb194-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-27"><a href="#cb194-27" aria-hidden="true" tabindex="-1"></a>Thus far we have used simple linear regression models involving continuous explanatory variables, but we can also use a discrete or categorical explanatory variable, made up of 2 or more groups that are coded as "factors" (i.e., we use integer values from 1 to $k$ discrete groups as dummy values for our categorical variables). Let's load in our zombie apocalpyse survivor data again, but this time after doing so, we will convert **gender** and **major** to factors using the function `as.factor()`. [We could also do this by reading the data in using `read.csv()`, which has as a default argument `stringsAsFactors=TRUE`.] Then look at the `class()` and `summary()` of the variable **gender**.</span>
<span id="cb194-28"><a href="#cb194-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-31"><a href="#cb194-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-32"><a href="#cb194-32" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/zombies.csv"</span></span>
<span id="cb194-33"><a href="#cb194-33" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb194-34"><a href="#cb194-34" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>gender) <span class="co"># can also use `as.factor()`</span></span>
<span id="cb194-35"><a href="#cb194-35" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>major <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>major) <span class="co"># can also use `as.factor()`</span></span>
<span id="cb194-36"><a href="#cb194-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-37"><a href="#cb194-37" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(z<span class="sc">$</span>gender)</span>
<span id="cb194-38"><a href="#cb194-38" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(z<span class="sc">$</span>gender)</span>
<span id="cb194-39"><a href="#cb194-39" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-40"><a href="#cb194-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-41"><a href="#cb194-41" aria-hidden="true" tabindex="-1"></a>As with our prior simple regression analysis, we want to evaluate the effect of a predictor variable on a response variable (e.g., **height**), but this time we want our predictor to be a discrete, or categorical, variable (e.g., **gender**) rather than a continuous one. We can start off by plotting **height** by **gender** using the same formula notation we have been using.</span>
<span id="cb194-42"><a href="#cb194-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-45"><a href="#cb194-45" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-46"><a href="#cb194-46" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb194-47"><a href="#cb194-47" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(z<span class="sc">$</span>height <span class="sc">~</span> z<span class="sc">$</span>gender)</span>
<span id="cb194-48"><a href="#cb194-48" aria-hidden="true" tabindex="-1"></a><span class="co"># or, with {ggplot}</span></span>
<span id="cb194-49"><a href="#cb194-49" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> z, <span class="fu">aes</span>(<span class="at">x =</span> gender, <span class="at">y =</span> height)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb194-50"><a href="#cb194-50" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-51"><a href="#cb194-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-52"><a href="#cb194-52" aria-hidden="true" tabindex="-1"></a>This immediately gives us a nice boxplot. Note that if we'd try to use this command after loading in **gender** as character rather than factor data, ***R*** would have thrown an error.</span>
<span id="cb194-53"><a href="#cb194-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-54"><a href="#cb194-54" aria-hidden="true" tabindex="-1"></a>Based on our plot, there indeed seems to be a difference in height between males and females. We can test this directly using linear regression (and, recall, we already know another way to test this, using $Z$ or t tests to compare means).</span>
<span id="cb194-55"><a href="#cb194-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-58"><a href="#cb194-58" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-59"><a href="#cb194-59" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> gender)</span>
<span id="cb194-60"><a href="#cb194-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-61"><a href="#cb194-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-62"><a href="#cb194-62" aria-hidden="true" tabindex="-1"></a>If we take a look at the <span class="in">`summary()`</span> of our model, **m**, we see the same kind of table of results we have seen before, but because the predictor variable in this case is a factor vector instead of a numeric vector, the coefficients are reported and interpreted a bit differently.</span>
<span id="cb194-63"><a href="#cb194-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-66"><a href="#cb194-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-67"><a href="#cb194-67" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb194-68"><a href="#cb194-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-69"><a href="#cb194-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-70"><a href="#cb194-70" aria-hidden="true" tabindex="-1"></a>The coefficient for the intercept, i.e., $\beta_0$, reflects the estimate of the mean height for the first of our level variables.</span>
<span id="cb194-71"><a href="#cb194-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-74"><a href="#cb194-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-75"><a href="#cb194-75" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>gender)</span>
<span id="cb194-76"><a href="#cb194-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-77"><a href="#cb194-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-78"><a href="#cb194-78" aria-hidden="true" tabindex="-1"></a>The estimate for $\beta_1$ is reported as "genderMale" and the value for that coefficient, 4.0154, is the estimated difference in mean height associated with being a male. The regression equation is basically:</span>
<span id="cb194-79"><a href="#cb194-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-80"><a href="#cb194-80" aria-hidden="true" tabindex="-1"></a>$$height = 65.5983 + 4.0154 \times gender$$</span>
<span id="cb194-81"><a href="#cb194-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-82"><a href="#cb194-82" aria-hidden="true" tabindex="-1"></a>with males assigned a gender value of 1 and females of 0.</span>
<span id="cb194-83"><a href="#cb194-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-84"><a href="#cb194-84" aria-hidden="true" tabindex="-1"></a>In this case, the p value associated with the **t statistic** for $\beta_1$ is extremely low, so we conclude that **gender** has a significant effect on **height**.</span>
<span id="cb194-85"><a href="#cb194-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-86"><a href="#cb194-86" aria-hidden="true" tabindex="-1"></a>We can easily <span class="in">`relevel()`</span> what is the baseline group. The result is very similar, but the sign of $\beta_1$ is changed.</span>
<span id="cb194-87"><a href="#cb194-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-90"><a href="#cb194-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-91"><a href="#cb194-91" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">relevel</span>(z<span class="sc">$</span>gender, <span class="at">ref =</span> <span class="st">"Male"</span>)</span>
<span id="cb194-92"><a href="#cb194-92" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> gender)</span>
<span id="cb194-93"><a href="#cb194-93" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb194-94"><a href="#cb194-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-95"><a href="#cb194-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-96"><a href="#cb194-96" aria-hidden="true" tabindex="-1"></a>The last line of the <span class="in">`summary()`</span> output shows the results of the global test of significance of the regression model based on an F statistic compared to an F distribution with, in this case, 1 and 998 degrees of freedom.</span>
<span id="cb194-97"><a href="#cb194-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-100"><a href="#cb194-100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-101"><a href="#cb194-101" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> <span class="fl">276.9</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb194-102"><a href="#cb194-102" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb194-103"><a href="#cb194-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-104"><a href="#cb194-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-105"><a href="#cb194-105" aria-hidden="true" tabindex="-1"></a>We can extend this approach to the case where we have more than two categories for a variable... in this case we need to dummy code our factor variable into multiple binary variables. ***R*** takes care of this for us automatically, but it is good to recognize the procedure.</span>
<span id="cb194-106"><a href="#cb194-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-107"><a href="#cb194-107" aria-hidden="true" tabindex="-1"></a>Let's explore this by re-coding the variable **major** into four levels. We can first use the <span class="in">`unique()`</span> or <span class="in">`levels()`</span> function to list all of the different majors in our dataset. The latter does this alphabetically.</span>
<span id="cb194-108"><a href="#cb194-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-111"><a href="#cb194-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-112"><a href="#cb194-112" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(z<span class="sc">$</span>major)</span>
<span id="cb194-113"><a href="#cb194-113" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>major)</span>
<span id="cb194-114"><a href="#cb194-114" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-115"><a href="#cb194-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-116"><a href="#cb194-116" aria-hidden="true" tabindex="-1"></a>We can then also do some cool batch recoding using the <span class="in">`%in%`</span> operator and the <span class="in">`mutate()`</span> function from {dplyr}...</span>
<span id="cb194-117"><a href="#cb194-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-120"><a href="#cb194-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-121"><a href="#cb194-121" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> z <span class="sc">|&gt;</span></span>
<span id="cb194-122"><a href="#cb194-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb194-123"><a href="#cb194-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">occupation =</span> <span class="fu">case_when</span>(</span>
<span id="cb194-124"><a href="#cb194-124" aria-hidden="true" tabindex="-1"></a>      major <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb194-125"><a href="#cb194-125" aria-hidden="true" tabindex="-1"></a>        <span class="st">"agricultural sciences"</span>,</span>
<span id="cb194-126"><a href="#cb194-126" aria-hidden="true" tabindex="-1"></a>        <span class="st">"animal husbandry"</span>,</span>
<span id="cb194-127"><a href="#cb194-127" aria-hidden="true" tabindex="-1"></a>        <span class="st">"applied sciences"</span>,</span>
<span id="cb194-128"><a href="#cb194-128" aria-hidden="true" tabindex="-1"></a>        <span class="st">"biology"</span>,</span>
<span id="cb194-129"><a href="#cb194-129" aria-hidden="true" tabindex="-1"></a>        <span class="st">"botany"</span>,</span>
<span id="cb194-130"><a href="#cb194-130" aria-hidden="true" tabindex="-1"></a>        <span class="st">"energy studies"</span>,</span>
<span id="cb194-131"><a href="#cb194-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">"environmental science"</span>,</span>
<span id="cb194-132"><a href="#cb194-132" aria-hidden="true" tabindex="-1"></a>        <span class="st">"epidemiology"</span>,</span>
<span id="cb194-133"><a href="#cb194-133" aria-hidden="true" tabindex="-1"></a>        <span class="st">"medicine/nursing"</span>,</span>
<span id="cb194-134"><a href="#cb194-134" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pharmacology"</span></span>
<span id="cb194-135"><a href="#cb194-135" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">~</span> <span class="st">"natural science"</span>,</span>
<span id="cb194-136"><a href="#cb194-136" aria-hidden="true" tabindex="-1"></a>      major <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb194-137"><a href="#cb194-137" aria-hidden="true" tabindex="-1"></a>        <span class="st">"business administration"</span>,</span>
<span id="cb194-138"><a href="#cb194-138" aria-hidden="true" tabindex="-1"></a>        <span class="st">"city planning"</span>,</span>
<span id="cb194-139"><a href="#cb194-139" aria-hidden="true" tabindex="-1"></a>        <span class="st">"economics"</span>,</span>
<span id="cb194-140"><a href="#cb194-140" aria-hidden="true" tabindex="-1"></a>        <span class="st">"human services"</span>,</span>
<span id="cb194-141"><a href="#cb194-141" aria-hidden="true" tabindex="-1"></a>        <span class="st">"logistics"</span>,</span>
<span id="cb194-142"><a href="#cb194-142" aria-hidden="true" tabindex="-1"></a>        <span class="st">"military strategy"</span></span>
<span id="cb194-143"><a href="#cb194-143" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">~</span> <span class="st">"logistics"</span>,</span>
<span id="cb194-144"><a href="#cb194-144" aria-hidden="true" tabindex="-1"></a>      major <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb194-145"><a href="#cb194-145" aria-hidden="true" tabindex="-1"></a>        <span class="st">"architecture"</span>,</span>
<span id="cb194-146"><a href="#cb194-146" aria-hidden="true" tabindex="-1"></a>        <span class="st">"integrated water resources management"</span>,</span>
<span id="cb194-147"><a href="#cb194-147" aria-hidden="true" tabindex="-1"></a>        <span class="st">"mechanical engineering"</span></span>
<span id="cb194-148"><a href="#cb194-148" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">~</span> <span class="st">"engineering"</span>,</span>
<span id="cb194-149"><a href="#cb194-149" aria-hidden="true" tabindex="-1"></a>      major <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb194-150"><a href="#cb194-150" aria-hidden="true" tabindex="-1"></a>        <span class="st">"communication"</span>,</span>
<span id="cb194-151"><a href="#cb194-151" aria-hidden="true" tabindex="-1"></a>        <span class="st">"criminal justice administration"</span>,</span>
<span id="cb194-152"><a href="#cb194-152" aria-hidden="true" tabindex="-1"></a>        <span class="st">"culinary services"</span>,</span>
<span id="cb194-153"><a href="#cb194-153" aria-hidden="true" tabindex="-1"></a>        <span class="st">"education"</span>,</span>
<span id="cb194-154"><a href="#cb194-154" aria-hidden="true" tabindex="-1"></a>        <span class="st">"philosophy"</span>,</span>
<span id="cb194-155"><a href="#cb194-155" aria-hidden="true" tabindex="-1"></a>        <span class="st">"physical education"</span>,</span>
<span id="cb194-156"><a href="#cb194-156" aria-hidden="true" tabindex="-1"></a>        <span class="st">"psychology"</span></span>
<span id="cb194-157"><a href="#cb194-157" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">~</span> <span class="st">"other"</span></span>
<span id="cb194-158"><a href="#cb194-158" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb194-159"><a href="#cb194-159" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-160"><a href="#cb194-160" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>occupation <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>occupation) <span class="co"># can also use `as.factor()`</span></span>
<span id="cb194-161"><a href="#cb194-161" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>occupation)</span>
<span id="cb194-162"><a href="#cb194-162" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>occupation <span class="ot">&lt;-</span> <span class="fu">relevel</span>(z<span class="sc">$</span>occupation, <span class="at">ref =</span> <span class="st">"natural science"</span>)</span>
<span id="cb194-163"><a href="#cb194-163" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(z<span class="sc">$</span>occupation)</span>
<span id="cb194-164"><a href="#cb194-164" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-165"><a href="#cb194-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-166"><a href="#cb194-166" aria-hidden="true" tabindex="-1"></a>Again, we can plot our variable by group and run a multilevel linear regression. Each $\beta$ estimate reflects the difference from the estimated mean for the reference level. The <span class="in">`lm()`</span> function also returns the results of the global significance test of our model.</span>
<span id="cb194-167"><a href="#cb194-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-170"><a href="#cb194-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-171"><a href="#cb194-171" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb194-172"><a href="#cb194-172" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb194-173"><a href="#cb194-173" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb194-174"><a href="#cb194-174" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> <span class="fl">0.489</span>, <span class="at">df1 =</span> <span class="dv">3</span>, <span class="at">df2 =</span> <span class="dv">996</span>) <span class="co"># F test</span></span>
<span id="cb194-175"><a href="#cb194-175" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb194-176"><a href="#cb194-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-177"><a href="#cb194-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-178"><a href="#cb194-178" aria-hidden="true" tabindex="-1"></a>In this case, we see no significant effect of **occupation** (based on a broad categorization of college major) on zombie killing proficiency.</span>
<span id="cb194-179"><a href="#cb194-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-180"><a href="#cb194-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## One-Way ANOVA</span></span>
<span id="cb194-181"><a href="#cb194-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-182"><a href="#cb194-182" aria-hidden="true" tabindex="-1"></a>Regression with a single categorical predictor run as we have just done above is exactly equivalent to a "One-Way" or "one-factor" Analysis of Variance, or ANOVA. That is, ANOVA is just one type of special case of least squares regression.</span>
<span id="cb194-183"><a href="#cb194-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-184"><a href="#cb194-184" aria-hidden="true" tabindex="-1"></a>We can, of course, run an ANOVA with one line in ***R***. Compare the results presented in the <span class="in">`summary()`</span> output table (or <span class="in">`tidy()`</span> output table) from an ANOVA with that from the global test reported in <span class="in">`summary()`</span> (or <span class="in">`tidy()`</span>) from <span class="in">`lm()`</span></span>
<span id="cb194-185"><a href="#cb194-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-188"><a href="#cb194-188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-189"><a href="#cb194-189" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb194-190"><a href="#cb194-190" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aov)</span>
<span id="cb194-191"><a href="#cb194-191" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m.aov) <span class="co"># a neater table</span></span>
<span id="cb194-192"><a href="#cb194-192" aria-hidden="true" tabindex="-1"></a>m.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb194-193"><a href="#cb194-193" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.lm)</span>
<span id="cb194-194"><a href="#cb194-194" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(m.lm) <span class="co"># a neater table</span></span>
<span id="cb194-195"><a href="#cb194-195" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb194-196"><a href="#cb194-196" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.lm) <span class="co"># plot(m.aov) is equivalent</span></span>
<span id="cb194-197"><a href="#cb194-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-198"><a href="#cb194-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-199"><a href="#cb194-199" aria-hidden="true" tabindex="-1"></a>These two model summaries produce somewhat different tables for the same analysis. The **F statistic** and omnibus p value given in the `aov()` ANOVA table indicates whether there are differences between at least some treatments, but we do not know where those differences occur. The summary from `lm()` shows the effects of the categorical treatments arranged as sequential contrasts (the default in R). The first row gives the mean of the first level of the first factor specified in the model. The following rows give differences **from this first mean** for each subsequent factor level. Likewise the standard error in the first row is a standard error of a mean, while the entries in subsequent rows are standard errors of the differences between two means.</span>
<span id="cb194-200"><a href="#cb194-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-201"><a href="#cb194-201" aria-hidden="true" tabindex="-1"></a>In general, in ANOVA and simple regression using a single categorical variable, we aim to test the $H_0$ that the means of a variable of interest do not differ among groups, i.e., that $\mu_1 = \mu_2 = ... = \mu_k$ are all equal. This is an extension of our comparison of two means that we did with z and t tests.</span>
<span id="cb194-202"><a href="#cb194-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-203"><a href="#cb194-203" aria-hidden="true" tabindex="-1"></a>The basic linear model formulation for ANOVA is:</span>
<span id="cb194-204"><a href="#cb194-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-205"><a href="#cb194-205" aria-hidden="true" tabindex="-1"></a>$$Y_{i,j} = \mu + \beta_i X_i + \epsilon_{i,j}$$</span>
<span id="cb194-206"><a href="#cb194-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-207"><a href="#cb194-207" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb194-208"><a href="#cb194-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-209"><a href="#cb194-209" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\mu$ is the grand (overall) population mean</span>
<span id="cb194-210"><a href="#cb194-210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_i$ is the deviation of the mean of treatment level $i$ from the grand mean</span>
<span id="cb194-211"><a href="#cb194-211" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\epsilon_{i,j}$ is error variance of individual points, $j$, within each level, $i$, from the grand mean</span>
<span id="cb194-212"><a href="#cb194-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-213"><a href="#cb194-213" aria-hidden="true" tabindex="-1"></a>The assumptions of ANOVA, similar to those of simple regression, are:</span>
<span id="cb194-214"><a href="#cb194-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-215"><a href="#cb194-215" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>that samples are independent and identically distributed ($iid$)</span>
<span id="cb194-216"><a href="#cb194-216" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>that the residuals, $\epsilon_{i,j}$, are normally distributed</span>
<span id="cb194-217"><a href="#cb194-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>that within-group variances are similar across all groups ("homoscedastic")</span>
<span id="cb194-218"><a href="#cb194-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-219"><a href="#cb194-219" aria-hidden="true" tabindex="-1"></a>Additionally, the following assumption of standard ANOVA makes the interpretation of results more straightforward, but it is not strictly required...</span>
<span id="cb194-220"><a href="#cb194-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-221"><a href="#cb194-221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>that our experiment/observations have a balanced design (i.e., an equal number of cases in all groups)</span>
<span id="cb194-222"><a href="#cb194-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-223"><a href="#cb194-223" aria-hidden="true" tabindex="-1"></a>If this last assumption is violated, it ceases to be true that the **total SS of our dataset = within group SS + between group SS**, and then the calculations of our MSE and the F statistic, and our associated p value, would be off.</span>
<span id="cb194-224"><a href="#cb194-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-225"><a href="#cb194-225" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulation-Based Inference</span></span>
<span id="cb194-226"><a href="#cb194-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-227"><a href="#cb194-227" aria-hidden="true" tabindex="-1"></a>Note that the ANOVA functions used above (<span class="in">`aov()`</span>, <span class="in">`lm()`</span>) are evaluating statistical significance and estimating p values based on mathematical theory, i.e., by comparing F statistic values to a theoretical, parametric $F$ distribution to determine how likely we are to see an F statistic as extreme as our observed one by chance under the null model of no difference between groups. However, as with other tests of statistical inference, we can also use permutation/randomization methods to determine p values for ANOVA.</span>
<span id="cb194-228"><a href="#cb194-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-229"><a href="#cb194-229" aria-hidden="true" tabindex="-1"></a>One easy way to do this is with the {infer} package. Using {infer}, we can easily permute, a large number of times, the association between our response variable the categorical explanatory variable and, each time, then calculate the associated F statistic. This generates a permutation-based null distribution of F statistics to which we can compare the F statistic generated from our original data. The permutation-based p value is then the proportion of F statistic values generated by simulation that are equal to or greater than our observed F statistic value.</span>
<span id="cb194-230"><a href="#cb194-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-233"><a href="#cb194-233" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-234"><a href="#cb194-234" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb194-235"><a href="#cb194-235" aria-hidden="true" tabindex="-1"></a>original.F <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation) <span class="sc">|&gt;</span></span>
<span id="cb194-236"><a href="#cb194-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb194-237"><a href="#cb194-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"occupation"</span>)</span>
<span id="cb194-238"><a href="#cb194-238" aria-hidden="true" tabindex="-1"></a><span class="co"># show aov results for F statistic and p value for omnibus F test</span></span>
<span id="cb194-239"><a href="#cb194-239" aria-hidden="true" tabindex="-1"></a>original.F</span>
<span id="cb194-240"><a href="#cb194-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-241"><a href="#cb194-241" aria-hidden="true" tabindex="-1"></a>permuted.F <span class="ot">&lt;-</span> z <span class="sc">|&gt;</span></span>
<span id="cb194-242"><a href="#cb194-242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify model</span></span>
<span id="cb194-243"><a href="#cb194-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(zombies_killed <span class="sc">~</span> occupation) <span class="sc">|&gt;</span></span>
<span id="cb194-244"><a href="#cb194-244" aria-hidden="true" tabindex="-1"></a>  <span class="co"># null hypothesis of independence</span></span>
<span id="cb194-245"><a href="#cb194-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb194-246"><a href="#cb194-246" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generate permutations</span></span>
<span id="cb194-247"><a href="#cb194-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">|&gt;</span></span>
<span id="cb194-248"><a href="#cb194-248" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate the F statistic for the AOV</span></span>
<span id="cb194-249"><a href="#cb194-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"F"</span>)</span>
<span id="cb194-250"><a href="#cb194-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-251"><a href="#cb194-251" aria-hidden="true" tabindex="-1"></a><span class="co"># plot our F statistic on the distribution of F statistic values generated by permutation</span></span>
<span id="cb194-252"><a href="#cb194-252" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(permuted.F) <span class="sc">+</span></span>
<span id="cb194-253"><a href="#cb194-253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> original.F<span class="sc">$</span>statistic, <span class="at">direction =</span> <span class="st">"greater"</span>)</span>
<span id="cb194-254"><a href="#cb194-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-255"><a href="#cb194-255" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb194-256"><a href="#cb194-256" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> permuted.F <span class="sc">|&gt;</span></span>
<span id="cb194-257"><a href="#cb194-257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">get_p_value</span>(<span class="at">obs_stat =</span> original.F<span class="sc">$</span>statistic, <span class="at">direction =</span> <span class="st">"greater"</span>)</span>
<span id="cb194-258"><a href="#cb194-258" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-259"><a href="#cb194-259" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-260"><a href="#cb194-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-261"><a href="#cb194-261" aria-hidden="true" tabindex="-1"></a>Note that, for these data, the p value estimated through simulated based inference is very similar to that calculated paramterically based on mathematical theory. This is not always the case!</span>
<span id="cb194-262"><a href="#cb194-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-265"><a href="#cb194-265" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-266"><a href="#cb194-266" aria-hidden="true" tabindex="-1"></a>original.F<span class="sc">$</span>p.value</span>
<span id="cb194-267"><a href="#cb194-267" aria-hidden="true" tabindex="-1"></a>p.value</span>
<span id="cb194-268"><a href="#cb194-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-269"><a href="#cb194-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-270"><a href="#cb194-270" aria-hidden="true" tabindex="-1"></a>Alternatively, the {permuco} package introduces the <span class="in">`aovperm()`</span> and <span class="in">`lmperm()`</span> functions as analogs for <span class="in">`aov()`</span> and <span class="in">`lm()`</span> for analysis of variance and simple linear regression, where p values are calculated by permutation.</span>
<span id="cb194-271"><a href="#cb194-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-274"><a href="#cb194-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-275"><a href="#cb194-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb194-276"><a href="#cb194-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb194-277"><a href="#cb194-277" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(permuco)</span>
<span id="cb194-278"><a href="#cb194-278" aria-hidden="true" tabindex="-1"></a>m.aovperm <span class="ot">&lt;-</span> <span class="fu">aovperm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb194-279"><a href="#cb194-279" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aovperm)</span>
<span id="cb194-280"><a href="#cb194-280" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m.aovperm)</span>
<span id="cb194-281"><a href="#cb194-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-282"><a href="#cb194-282" aria-hidden="true" tabindex="-1"></a>m.lmperm <span class="ot">&lt;-</span> <span class="fu">lmperm</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation)</span>
<span id="cb194-283"><a href="#cb194-283" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.lmperm)</span>
<span id="cb194-284"><a href="#cb194-284" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>permuco)</span>
<span id="cb194-285"><a href="#cb194-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-286"><a href="#cb194-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-287"><a href="#cb194-287" aria-hidden="true" tabindex="-1"></a>Similar to {infer}, the {coin} package also implements permutation-based tests of independence, including One-Way ANOVA. Instead of F statistics, the test statistic implemented in {coin} is a **Chi-Square statistic** (which is essentially to equivalent to an F statistic, normalized by the residual degrees of freedom), and it is tested against a permutation-based null distribution of Chi-Square values.</span>
<span id="cb194-288"><a href="#cb194-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-291"><a href="#cb194-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-292"><a href="#cb194-292" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb194-293"><a href="#cb194-293" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coin)</span>
<span id="cb194-294"><a href="#cb194-294" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">oneway_test</span>(<span class="at">data =</span> z, zombies_killed <span class="sc">~</span> occupation, <span class="at">distribution=</span><span class="st">"approximate"</span>)</span>
<span id="cb194-295"><a href="#cb194-295" aria-hidden="true" tabindex="-1"></a><span class="co"># by default, 10000 replicates are used</span></span>
<span id="cb194-296"><a href="#cb194-296" aria-hidden="true" tabindex="-1"></a>m.aov</span>
<span id="cb194-297"><a href="#cb194-297" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>coin)</span>
<span id="cb194-298"><a href="#cb194-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-299"><a href="#cb194-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-300"><a href="#cb194-300" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb194-301"><a href="#cb194-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-302"><a href="#cb194-302" aria-hidden="true" tabindex="-1"></a>Load in the "gibbon-femurs.csv" dataset, which contains the lengths, in centimeters, of the femurs of 400 juvenile, subadult, and adult individuals gibbons. Use both ANOVA and simple linear regression to examine the relationship between age and femur length.</span>
<span id="cb194-303"><a href="#cb194-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-306"><a href="#cb194-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-307"><a href="#cb194-307" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/gibbon-femurs.csv"</span></span>
<span id="cb194-308"><a href="#cb194-308" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-309"><a href="#cb194-309" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"inf"</span>, <span class="st">"juv"</span>, <span class="st">"subadult"</span>, <span class="st">"adult"</span>))</span>
<span id="cb194-310"><a href="#cb194-310" aria-hidden="true" tabindex="-1"></a><span class="co"># converts age to a factor and order the age levels so that</span></span>
<span id="cb194-311"><a href="#cb194-311" aria-hidden="true" tabindex="-1"></a><span class="co"># they are in ascending chronological order</span></span>
<span id="cb194-312"><a href="#cb194-312" aria-hidden="true" tabindex="-1"></a><span class="co"># several ANOVA functions require that categorical variables</span></span>
<span id="cb194-313"><a href="#cb194-313" aria-hidden="true" tabindex="-1"></a><span class="co"># are represented as factors rather than strings</span></span>
<span id="cb194-314"><a href="#cb194-314" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>))</span>
<span id="cb194-315"><a href="#cb194-315" aria-hidden="true" tabindex="-1"></a><span class="co"># convert sex to a factor</span></span>
<span id="cb194-316"><a href="#cb194-316" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb194-317"><a href="#cb194-317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-318"><a href="#cb194-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-319"><a href="#cb194-319" aria-hidden="true" tabindex="-1"></a>Before beginning, check for normality of data overall...</span>
<span id="cb194-320"><a href="#cb194-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-323"><a href="#cb194-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-324"><a href="#cb194-324" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb194-325"><a href="#cb194-325" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb194-326"><a href="#cb194-326" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length)</span>
<span id="cb194-327"><a href="#cb194-327" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length)</span>
<span id="cb194-328"><a href="#cb194-328" aria-hidden="true" tabindex="-1"></a><span class="co"># not great overall...</span></span>
<span id="cb194-329"><a href="#cb194-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-330"><a href="#cb194-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-331"><a href="#cb194-331" aria-hidden="true" tabindex="-1"></a>Then, do a boxplot of the data by each age group and check for normality within each group.</span>
<span id="cb194-332"><a href="#cb194-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-335"><a href="#cb194-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-336"><a href="#cb194-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb194-337"><a href="#cb194-337" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb194-338"><a href="#cb194-338" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb194-339"><a href="#cb194-339" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb194-340"><a href="#cb194-340" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age) <span class="co"># boxplot with medians</span></span>
<span id="cb194-341"><a href="#cb194-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-342"><a href="#cb194-342" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate average and SD by group</span></span>
<span id="cb194-343"><a href="#cb194-343" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb194-344"><a href="#cb194-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age) <span class="sc">|&gt;</span></span>
<span id="cb194-345"><a href="#cb194-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb194-346"><a href="#cb194-346" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean(femur_length)"</span> <span class="ot">=</span> <span class="fu">mean</span>(femur_length),</span>
<span id="cb194-347"><a href="#cb194-347" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sd(femur_length)"</span> <span class="ot">=</span> <span class="fu">sd</span>(femur_length)</span>
<span id="cb194-348"><a href="#cb194-348" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-349"><a href="#cb194-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-350"><a href="#cb194-350" aria-hidden="true" tabindex="-1"></a><span class="co"># add means to plot</span></span>
<span id="cb194-351"><a href="#cb194-351" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, stats<span class="sc">$</span><span class="st">`</span><span class="at">mean(femur_length)</span><span class="st">`</span>, <span class="at">pch =</span> <span class="dv">4</span>, <span class="at">cex =</span> <span class="fl">1.5</span>)</span>
<span id="cb194-352"><a href="#cb194-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-353"><a href="#cb194-353" aria-hidden="true" tabindex="-1"></a><span class="co"># subtract relevant group mean from each data point</span></span>
<span id="cb194-354"><a href="#cb194-354" aria-hidden="true" tabindex="-1"></a>means.centered <span class="ot">&lt;-</span> d<span class="sc">$</span>femur_length <span class="sc">-</span> stats[<span class="fu">as.numeric</span>(d<span class="sc">$</span>age), <span class="dv">2</span>]</span>
<span id="cb194-355"><a href="#cb194-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-356"><a href="#cb194-356" aria-hidden="true" tabindex="-1"></a><span class="co"># graphical test for normality of group-centered means</span></span>
<span id="cb194-357"><a href="#cb194-357" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(means.centered<span class="sc">$</span><span class="st">`</span><span class="at">mean(femur_length)</span><span class="st">`</span>) <span class="co"># looks good!</span></span>
<span id="cb194-358"><a href="#cb194-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-359"><a href="#cb194-359" aria-hidden="true" tabindex="-1"></a><span class="co"># now do graphical test within each group</span></span>
<span id="cb194-360"><a href="#cb194-360" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb194-361"><a href="#cb194-361" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"inf"</span>], <span class="at">main =</span> <span class="st">"Infant"</span>,</span>
<span id="cb194-362"><a href="#cb194-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb194-363"><a href="#cb194-363" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"inf"</span>])</span>
<span id="cb194-364"><a href="#cb194-364" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"juv"</span>], <span class="at">main =</span> <span class="st">"Juvenile"</span>,</span>
<span id="cb194-365"><a href="#cb194-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb194-366"><a href="#cb194-366" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"juv"</span>])</span>
<span id="cb194-367"><a href="#cb194-367" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"subadult"</span>], <span class="at">main =</span> <span class="st">"Subadult"</span>,</span>
<span id="cb194-368"><a href="#cb194-368" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb194-369"><a href="#cb194-369" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"subadult"</span>])</span>
<span id="cb194-370"><a href="#cb194-370" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"adult"</span>], <span class="at">main =</span> <span class="st">"Adult"</span>,</span>
<span id="cb194-371"><a href="#cb194-371" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb194-372"><a href="#cb194-372" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(d<span class="sc">$</span>femur_length[d<span class="sc">$</span>age <span class="sc">==</span> <span class="st">"adult"</span>])</span>
<span id="cb194-373"><a href="#cb194-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-374"><a href="#cb194-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-375"><a href="#cb194-375" aria-hidden="true" tabindex="-1"></a>Also, check whether the different groups have roughly equal variances. As a general rule of thumb, we can compare the largest and smallest within-group standard deviations; if the ratio of max-to-min is less, than 2 then the assumption of "equal" variances is usually reasonable.</span>
<span id="cb194-376"><a href="#cb194-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-379"><a href="#cb194-379" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-380"><a href="#cb194-380" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb194-381"><a href="#cb194-381" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb194-382"><a href="#cb194-382" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb194-383"><a href="#cb194-383" aria-hidden="true" tabindex="-1"></a><span class="co"># check that variances are roughly equal (ratio of max/min is &lt;2)</span></span>
<span id="cb194-384"><a href="#cb194-384" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>) <span class="sc">/</span> <span class="fu">min</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)</span>
<span id="cb194-385"><a href="#cb194-385" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-386"><a href="#cb194-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-387"><a href="#cb194-387" aria-hidden="true" tabindex="-1"></a>All this checking done, we can again plot our data by group and then run our linear or ANOVA model...</span>
<span id="cb194-388"><a href="#cb194-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-391"><a href="#cb194-391" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-392"><a href="#cb194-392" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb194-393"><a href="#cb194-393" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age,</span>
<span id="cb194-394"><a href="#cb194-394" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Age"</span>, <span class="at">ylab =</span> <span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb194-395"><a href="#cb194-395" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age)</span>
<span id="cb194-396"><a href="#cb194-396" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb194-397"><a href="#cb194-397" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age) <span class="co"># femur length related to age</span></span>
<span id="cb194-398"><a href="#cb194-398" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aov)</span>
<span id="cb194-399"><a href="#cb194-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-400"><a href="#cb194-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-401"><a href="#cb194-401" aria-hidden="true" tabindex="-1"></a>Is the omnibus test of the relationship between age category and femur length significant? YES! Are femur lengths significantly different for juveniles versus subadults? Subadults versus adults? Juveniles versus adults?</span>
<span id="cb194-402"><a href="#cb194-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-403"><a href="#cb194-403" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **HINT:** To test some of these additional bivariate options, you will need to `relevel()` your factors for simple linear regression. Currently, we are just testing each group relative to the first level of the factor **age**.</span></span>
<span id="cb194-404"><a href="#cb194-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-405"><a href="#cb194-405" aria-hidden="true" tabindex="-1"></a><span class="fu">## Post-Hoc Tests in ANOVA</span></span>
<span id="cb194-406"><a href="#cb194-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-407"><a href="#cb194-407" aria-hidden="true" tabindex="-1"></a>After finding a significant omnibus F statistic in an ANOVA, we can test, post-hoc, what group means are different from one another using **pairwise t tests** with an appropriate p value correction for multiple tests.</span>
<span id="cb194-408"><a href="#cb194-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-411"><a href="#cb194-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-412"><a href="#cb194-412" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(d<span class="sc">$</span>femur_length, d<span class="sc">$</span>age, <span class="at">p.adj =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb194-413"><a href="#cb194-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-414"><a href="#cb194-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-415"><a href="#cb194-415" aria-hidden="true" tabindex="-1"></a>After an ANOVA, we can also use a **Tukey Honest Significant Differences** test with the model as the argument to evaluate this.</span>
<span id="cb194-416"><a href="#cb194-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-417"><a href="#cb194-417" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** The </span><span class="in">`TukeyHSD()`</span><span class="at"> function is run on the output of the ANOVA (</span><span class="in">`aov()`</span><span class="at">) function.</span></span>
<span id="cb194-418"><a href="#cb194-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-421"><a href="#cb194-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-422"><a href="#cb194-422" aria-hidden="true" tabindex="-1"></a><span class="co"># renaming age categories so we get nice axis labels on plot...</span></span>
<span id="cb194-423"><a href="#cb194-423" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb194-424"><a href="#cb194-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">case_when</span>(</span>
<span id="cb194-425"><a href="#cb194-425" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"adult"</span> <span class="sc">~</span> <span class="st">"A"</span>,</span>
<span id="cb194-426"><a href="#cb194-426" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"subadult"</span> <span class="sc">~</span> <span class="st">"S"</span>,</span>
<span id="cb194-427"><a href="#cb194-427" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"juv"</span> <span class="sc">~</span> <span class="st">"J"</span>,</span>
<span id="cb194-428"><a href="#cb194-428" aria-hidden="true" tabindex="-1"></a>    age <span class="sc">==</span> <span class="st">"inf"</span> <span class="sc">~</span> <span class="st">"I"</span></span>
<span id="cb194-429"><a href="#cb194-429" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb194-430"><a href="#cb194-430" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">aov</span>(femur_length <span class="sc">~</span> age, <span class="at">data =</span> d)</span>
<span id="cb194-431"><a href="#cb194-431" aria-hidden="true" tabindex="-1"></a>posthoc <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(m,</span>
<span id="cb194-432"><a href="#cb194-432" aria-hidden="true" tabindex="-1"></a>                    <span class="at">which =</span> <span class="st">"age"</span>,</span>
<span id="cb194-433"><a href="#cb194-433" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ordered =</span> <span class="cn">TRUE</span>,</span>
<span id="cb194-434"><a href="#cb194-434" aria-hidden="true" tabindex="-1"></a>                    <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb194-435"><a href="#cb194-435" aria-hidden="true" tabindex="-1"></a>posthoc <span class="co"># all age-sex classes differ</span></span>
<span id="cb194-436"><a href="#cb194-436" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-437"><a href="#cb194-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-438"><a href="#cb194-438" aria-hidden="true" tabindex="-1"></a>We can get a visual summary of difference in means between each group and their confidence intervals by passing the Tukey test output to a <span class="in">`plot()`</span> function. Confidence intervals that cross the vertical line indicate pairs of groups where the difference in mean is not significant, according to the threshold we set.</span>
<span id="cb194-439"><a href="#cb194-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-442"><a href="#cb194-442" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-443"><a href="#cb194-443" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(posthoc, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">12</span>)) <span class="co"># xlim set to show zero</span></span>
<span id="cb194-444"><a href="#cb194-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-445"><a href="#cb194-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-446"><a href="#cb194-446" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Non-Parametric Alternative</span></span>
<span id="cb194-447"><a href="#cb194-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-448"><a href="#cb194-448" aria-hidden="true" tabindex="-1"></a>The **Kruskal-Wallis** test is a nonparametric alternative to One-Way ANOVA that relaxes the need for normality in the distribution of data in each group (the different groups should still have roughly equal variances). Essentially, rather than testing the null hypothesis that the means for each group do not differ we are instead testing the null hypothesis that the **medians** do not differ. The test converts the continuous response variable to a set of RANKS (i.e., it does a uniform transformation) and then works with those ranks. The **p** value associated with the Kruskall-Wallis test statistic is calculated mathematically relative to a Chi-Square distribution.</span>
<span id="cb194-449"><a href="#cb194-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-452"><a href="#cb194-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-453"><a href="#cb194-453" aria-hidden="true" tabindex="-1"></a>(m.kruskal <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age))</span>
<span id="cb194-454"><a href="#cb194-454" aria-hidden="true" tabindex="-1"></a><span class="co"># to show that this is the same as the test using ranks...</span></span>
<span id="cb194-455"><a href="#cb194-455" aria-hidden="true" tabindex="-1"></a><span class="co"># use {dplyr} to sort by femur.length...</span></span>
<span id="cb194-456"><a href="#cb194-456" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">arrange</span>(d, femur_length)</span>
<span id="cb194-457"><a href="#cb194-457" aria-hidden="true" tabindex="-1"></a><span class="co"># then use {dplyr} to add new variable of rank femur_length</span></span>
<span id="cb194-458"><a href="#cb194-458" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">mutate</span>(d, <span class="at">femur_rank =</span> <span class="fu">row</span>(<span class="fu">data.frame</span>(d<span class="sc">$</span>femur_length)))</span>
<span id="cb194-459"><a href="#cb194-459" aria-hidden="true" tabindex="-1"></a>(m.kruskal <span class="ot">&lt;-</span> <span class="fu">kruskal.test</span>(<span class="at">data =</span> d, femur_rank <span class="sc">~</span> age))</span>
<span id="cb194-460"><a href="#cb194-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-461"><a href="#cb194-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-462"><a href="#cb194-462" aria-hidden="true" tabindex="-1"></a>For a post-hoc test of which groups are different following a Kruskall-Wallis test, we can use either a pairwise Mann-Whitney U test, a Dunn test, or a Conover-Iman test. The latter two tests are implemented using <span class="in">`dunn.test()`</span> from the {dunn.test} package or <span class="in">`conover.test()`</span> from the {conover.test} package, which both allow us to show the calculated Krusal-Wallis test statistic as well.</span>
<span id="cb194-463"><a href="#cb194-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-466"><a href="#cb194-466" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-467"><a href="#cb194-467" aria-hidden="true" tabindex="-1"></a><span class="co"># pairwise Mann-Whitney U test</span></span>
<span id="cb194-468"><a href="#cb194-468" aria-hidden="true" tabindex="-1"></a><span class="co"># the arguments are a vector of data, a vector with the grouping</span></span>
<span id="cb194-469"><a href="#cb194-469" aria-hidden="true" tabindex="-1"></a><span class="co"># factor, and the multiple test correction method...</span></span>
<span id="cb194-470"><a href="#cb194-470" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.wilcox.test</span>(d<span class="sc">$</span>femur_length, d<span class="sc">$</span>age,</span>
<span id="cb194-471"><a href="#cb194-471" aria-hidden="true" tabindex="-1"></a>  <span class="at">p.adjust.method=</span><span class="st">"bonferroni"</span>)</span>
<span id="cb194-472"><a href="#cb194-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-473"><a href="#cb194-473" aria-hidden="true" tabindex="-1"></a><span class="co"># `dunn.test()` and `conover.test()` include another argument, `kw=`</span></span>
<span id="cb194-474"><a href="#cb194-474" aria-hidden="true" tabindex="-1"></a><span class="co"># which is whether or not to output KW results</span></span>
<span id="cb194-475"><a href="#cb194-475" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dunn.test)</span>
<span id="cb194-476"><a href="#cb194-476" aria-hidden="true" tabindex="-1"></a><span class="fu">dunn.test</span>(d<span class="sc">$</span>femur_length, <span class="at">g=</span>d<span class="sc">$</span>age, <span class="at">method=</span><span class="st">"bonferroni"</span>, <span class="at">kw=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-477"><a href="#cb194-477" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>dunn.test)</span>
<span id="cb194-478"><a href="#cb194-478" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conover.test)</span>
<span id="cb194-479"><a href="#cb194-479" aria-hidden="true" tabindex="-1"></a><span class="fu">conover.test</span>(d<span class="sc">$</span>femur_length, <span class="at">g=</span>d<span class="sc">$</span>age, <span class="at">method=</span><span class="st">"bonferroni"</span>, <span class="at">kw=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-480"><a href="#cb194-480" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>conover.test)</span>
<span id="cb194-481"><a href="#cb194-481" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-482"><a href="#cb194-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-483"><a href="#cb194-483" aria-hidden="true" tabindex="-1"></a><span class="fu">### Effect Sizes</span></span>
<span id="cb194-484"><a href="#cb194-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-485"><a href="#cb194-485" aria-hidden="true" tabindex="-1"></a>We can apply the <span class="in">`effectsize()`</span> function from the {effectsize} package to our model objects to better interpret the meaning of our coefficients.</span>
<span id="cb194-486"><a href="#cb194-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-487"><a href="#cb194-487" aria-hidden="true" tabindex="-1"></a>For an ANOVA, the effect sizes represent the amount of variance in the response variable explained by each of the model’s terms. For this model, we are asking what percent of the total variance in **femur length** is explained by the categorical variable of **age** class. This measure is called $\eta^2$ ("eta-squared") and is analogous to r-squared.</span>
<span id="cb194-488"><a href="#cb194-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-489"><a href="#cb194-489" aria-hidden="true" tabindex="-1"></a>$$\eta^2 = \frac{SS_{predictor}}{SS_{total}} = \frac{SS_{predictor}}{SS_{predictor} + SS_{residuals}}$$</span>
<span id="cb194-490"><a href="#cb194-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-493"><a href="#cb194-493" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-494"><a href="#cb194-494" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m.aov)</span>
<span id="cb194-495"><a href="#cb194-495" aria-hidden="true" tabindex="-1"></a><span class="co"># or `eta_squared(m.aov)`</span></span>
<span id="cb194-496"><a href="#cb194-496" aria-hidden="true" tabindex="-1"></a><span class="co"># we can hand-calculate this same value from the ANOVA table as 6152/(6152 + 1452)</span></span>
<span id="cb194-497"><a href="#cb194-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-498"><a href="#cb194-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-499"><a href="#cb194-499" aria-hidden="true" tabindex="-1"></a>Here, 81% of the variance in **femur length** is accounted for by variance in **age**.</span>
<span id="cb194-500"><a href="#cb194-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-501"><a href="#cb194-501" aria-hidden="true" tabindex="-1"></a>Applied to a linear model object, the <span class="in">`effectsize()`</span> function refits the model and returns **standardized** coefficients rather than unstandardized ones. This is equivalent to running the original linear model after standardizing all of the variables so that they are represented on the same scale, which is typically done via a $Z$ transformation (i.e., by subtracting its mean from each variable observation and divide by its standard deviation): $z_i = \frac{x_i - \mu_x}{SD_x}$</span>
<span id="cb194-502"><a href="#cb194-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-505"><a href="#cb194-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-506"><a href="#cb194-506" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m)</span>
<span id="cb194-507"><a href="#cb194-507" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-508"><a href="#cb194-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-509"><a href="#cb194-509" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: The {datawizard} package provides the function </span><span class="in">`standardize()`</span><span class="at">, which will take a model and refit it using standardized parameters and return a refitted model object. The {parameters} package function </span><span class="in">`standardize_parameters()`</span><span class="at"> will also return standardized coefficients when passed a model object. These two function are designed to replace the </span><span class="in">`effectsize()`</span><span class="at"> function from the {effectsize} package.</span></span>
<span id="cb194-510"><a href="#cb194-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-511"><a href="#cb194-511" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple Factor ANOVA</span></span>
<span id="cb194-512"><a href="#cb194-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-513"><a href="#cb194-513" aria-hidden="true" tabindex="-1"></a>Sometimes the data we are interested in is characterized by multiple grouping variables (e.g., **age** and **sex**). In the case of the gibbon femur length data, we are interested in the **main effect** of each factor on the variable of interest (e.g., do femur lengths vary by **age** or **sex**) while accounting for the effects of the other factor. We may also be interested in any **interactive effects** among factors. Thus, in multiple factor ANOVA we are interested in testing several null hypotheses simultaneously: <span class="co">[</span><span class="ot">1</span><span class="co">]</span> that each factor has no effect on the mean of our continuous response variable and <span class="co">[</span><span class="ot">2</span><span class="co">]</span> that there are no interactive effects of sets of factors on the mean of our continuous response variable.</span>
<span id="cb194-514"><a href="#cb194-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-515"><a href="#cb194-515" aria-hidden="true" tabindex="-1"></a>Model description and testing for multiple-factor ANOVA is a simple extension of the formula notation which we've used for single factors. First, though, let's quickly check that our groups have similar variance.</span>
<span id="cb194-516"><a href="#cb194-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-519"><a href="#cb194-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-520"><a href="#cb194-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb194-521"><a href="#cb194-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb194-522"><a href="#cb194-522" aria-hidden="true" tabindex="-1"></a>stats <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb194-523"><a href="#cb194-523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age, sex) <span class="sc">|&gt;</span></span>
<span id="cb194-524"><a href="#cb194-524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb194-525"><a href="#cb194-525" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean(femur_length)"</span> <span class="ot">=</span> <span class="fu">mean</span>(femur_length),</span>
<span id="cb194-526"><a href="#cb194-526" aria-hidden="true" tabindex="-1"></a>    <span class="st">"sd(femur_length)"</span> <span class="ot">=</span> <span class="fu">sd</span>(femur_length)</span>
<span id="cb194-527"><a href="#cb194-527" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb194-528"><a href="#cb194-528" aria-hidden="true" tabindex="-1"></a><span class="co"># first we calculate averages by combination of factors</span></span>
<span id="cb194-529"><a href="#cb194-529" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)<span class="sc">/</span><span class="fu">min</span>(stats<span class="sc">$</span><span class="st">`</span><span class="at">sd(femur_length)</span><span class="st">`</span>)</span>
<span id="cb194-530"><a href="#cb194-530" aria-hidden="true" tabindex="-1"></a><span class="co"># check that variances in each group are roughly equal (ratio of max/min is &lt;2)</span></span>
<span id="cb194-531"><a href="#cb194-531" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>d, <span class="fu">aes</span>(<span class="at">y =</span> femur_length, <span class="at">x =</span> sex)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb194-532"><a href="#cb194-532" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>age, <span class="at">ncol=</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb194-533"><a href="#cb194-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Sex"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Femur Length (cm)"</span>)</span>
<span id="cb194-534"><a href="#cb194-534" aria-hidden="true" tabindex="-1"></a><span class="co"># and let's plot what the data look like</span></span>
<span id="cb194-535"><a href="#cb194-535" aria-hidden="true" tabindex="-1"></a><span class="co"># p &lt;- p + geom_point() # uncommenting this shows all points</span></span>
<span id="cb194-536"><a href="#cb194-536" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">stat_summary</span>(<span class="at">data=</span>d, <span class="fu">aes</span>(<span class="at">y =</span> femur_length, <span class="at">x =</span> sex),</span>
<span id="cb194-537"><a href="#cb194-537" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> base<span class="sc">::</span>mean, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">shape =</span> <span class="dv">8</span>, <span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb194-538"><a href="#cb194-538" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure we use {base} version of mean</span></span>
<span id="cb194-539"><a href="#cb194-539" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb194-540"><a href="#cb194-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-541"><a href="#cb194-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-542"><a href="#cb194-542" aria-hidden="true" tabindex="-1"></a>If we look at each variable separately using ANOVA, we see there is an effect of **age** but not of **sex**.</span>
<span id="cb194-543"><a href="#cb194-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-546"><a href="#cb194-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-547"><a href="#cb194-547" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age))</span>
<span id="cb194-548"><a href="#cb194-548" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex))</span>
<span id="cb194-549"><a href="#cb194-549" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-550"><a href="#cb194-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-551"><a href="#cb194-551" aria-hidden="true" tabindex="-1"></a>However, if we do a Two-Way ANOVA and consider the factors together, we see that there is still a main effect of **age** when taking **sex** into account **and** there is a main effect of **sex** when we take **age** into account.</span>
<span id="cb194-552"><a href="#cb194-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-555"><a href="#cb194-555" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-556"><a href="#cb194-556" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex))</span>
<span id="cb194-557"><a href="#cb194-557" aria-hidden="true" tabindex="-1"></a>m.aov</span>
<span id="cb194-558"><a href="#cb194-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-559"><a href="#cb194-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-560"><a href="#cb194-560" aria-hidden="true" tabindex="-1"></a>To examine whether there is an interaction effect, we would modify our model formula a bit using the colon operator (<span class="in">`:`</span>) to specify a particular interaction term...</span>
<span id="cb194-561"><a href="#cb194-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-564"><a href="#cb194-564" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-565"><a href="#cb194-565" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> age<span class="sc">:</span>sex)</span>
<span id="cb194-566"><a href="#cb194-566" aria-hidden="true" tabindex="-1"></a><span class="co"># the colon (:) operator includes specific interaction terms</span></span>
<span id="cb194-567"><a href="#cb194-567" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb194-568"><a href="#cb194-568" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-569"><a href="#cb194-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-570"><a href="#cb194-570" aria-hidden="true" tabindex="-1"></a>We could also use the asterisk (<span class="in">`*`</span>) operator, which expands to include all interactions among terms, including 3-way, 4-way, etc., interactions.</span>
<span id="cb194-571"><a href="#cb194-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-574"><a href="#cb194-574" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-575"><a href="#cb194-575" aria-hidden="true" tabindex="-1"></a>m.aov <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">*</span> sex)</span>
<span id="cb194-576"><a href="#cb194-576" aria-hidden="true" tabindex="-1"></a><span class="co"># asterisk (*) operator includes all interaction terms</span></span>
<span id="cb194-577"><a href="#cb194-577" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aov)</span>
<span id="cb194-578"><a href="#cb194-578" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">*</span> sex)</span>
<span id="cb194-579"><a href="#cb194-579" aria-hidden="true" tabindex="-1"></a><span class="co"># or using the lm() function...</span></span>
<span id="cb194-580"><a href="#cb194-580" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb194-581"><a href="#cb194-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-582"><a href="#cb194-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-583"><a href="#cb194-583" aria-hidden="true" tabindex="-1"></a>We can use the function <span class="in">`interaction.plot()`</span> to visualize interactions among categorical variables.</span>
<span id="cb194-584"><a href="#cb194-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-587"><a href="#cb194-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-588"><a href="#cb194-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb194-589"><a href="#cb194-589" aria-hidden="true" tabindex="-1"></a><span class="fu">interaction.plot</span>(</span>
<span id="cb194-590"><a href="#cb194-590" aria-hidden="true" tabindex="-1"></a>  <span class="at">x.factor =</span> d<span class="sc">$</span>age,</span>
<span id="cb194-591"><a href="#cb194-591" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Age"</span>,</span>
<span id="cb194-592"><a href="#cb194-592" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.factor =</span> d<span class="sc">$</span>sex,</span>
<span id="cb194-593"><a href="#cb194-593" aria-hidden="true" tabindex="-1"></a>  <span class="at">trace.label =</span> <span class="st">"Sex"</span>,</span>
<span id="cb194-594"><a href="#cb194-594" aria-hidden="true" tabindex="-1"></a>  <span class="at">response =</span> d<span class="sc">$</span>femur_length,</span>
<span id="cb194-595"><a href="#cb194-595" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> base<span class="sc">::</span>mean,</span>
<span id="cb194-596"><a href="#cb194-596" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"Mean Femur Length"</span></span>
<span id="cb194-597"><a href="#cb194-597" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-598"><a href="#cb194-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-599"><a href="#cb194-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-600"><a href="#cb194-600" aria-hidden="true" tabindex="-1"></a>Here, it looks like there is indeed a significant main effect of each term as well as an interaction between our two categorical variables. We will return to comparing models to one another (e.g., our model with and without interactions) and to post-hoc tests of what group mean differences are significant when we get into model selection in another few lectures.</span>
<span id="cb194-601"><a href="#cb194-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-602"><a href="#cb194-602" aria-hidden="true" tabindex="-1"></a>When we do <span class="in">`summary()`</span> of the results of the <span class="in">`lm()`</span> function, we are estimating eight $\beta$ coefficients (equivalent to the number of groups we have). $\beta_0$, the intercept, is the mean femur length for the base level (in this case, "adult females"). Then we have coefficients showing how the different factor combination groups would differ from that base level (e.g., adult males have mean femur lengths 1.716 greater than adult females, etc).</span>
<span id="cb194-603"><a href="#cb194-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-604"><a href="#cb194-604" aria-hidden="true" tabindex="-1"></a>The {permuco} package also lets us run multiple factor ANOVA using permutation/randomization to estimate p values.</span>
<span id="cb194-605"><a href="#cb194-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-608"><a href="#cb194-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-609"><a href="#cb194-609" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(permuco)</span>
<span id="cb194-610"><a href="#cb194-610" aria-hidden="true" tabindex="-1"></a>m.aovperm <span class="ot">&lt;-</span> <span class="fu">aovperm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> age<span class="sc">:</span>sex)</span>
<span id="cb194-611"><a href="#cb194-611" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m.aovperm)</span>
<span id="cb194-612"><a href="#cb194-612" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>permuco)</span>
<span id="cb194-613"><a href="#cb194-613" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-614"><a href="#cb194-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-615"><a href="#cb194-615" aria-hidden="true" tabindex="-1"></a>When we run <span class="in">`effectsize()`</span> on a model object resulting from a multiple factor ANOVA, the function by default returns partial $\eta^2$ values, which is the proportion of the variance in the response variable that is accounted by each predictor *when controlling for the other predictors*.</span>
<span id="cb194-616"><a href="#cb194-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-619"><a href="#cb194-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-620"><a href="#cb194-620" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m.aov)</span>
<span id="cb194-621"><a href="#cb194-621" aria-hidden="true" tabindex="-1"></a><span class="co"># or effectsize(m.aov, partial = TRUE)</span></span>
<span id="cb194-622"><a href="#cb194-622" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-623"><a href="#cb194-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-624"><a href="#cb194-624" aria-hidden="true" tabindex="-1"></a><span class="fu">## Type I, II, and III ANOVA</span></span>
<span id="cb194-625"><a href="#cb194-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-626"><a href="#cb194-626" aria-hidden="true" tabindex="-1"></a>It is important to recognize that the ORDER in which our factors are entered into a linear model using categorical predictors can result in different values for the entries in our ANOVA table, while the estimation of our regression coefficients is identical regardless. Take a look at this example, where the variables **age** and **sex** are entered into our ANOVA formula in different orders:</span>
<span id="cb194-627"><a href="#cb194-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-630"><a href="#cb194-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-631"><a href="#cb194-631" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex)</span>
<span id="cb194-632"><a href="#cb194-632" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span>
<span id="cb194-633"><a href="#cb194-633" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex <span class="sc">+</span> age)</span>
<span id="cb194-634"><a href="#cb194-634" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span>
<span id="cb194-635"><a href="#cb194-635" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> age <span class="sc">+</span> sex)</span>
<span id="cb194-636"><a href="#cb194-636" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span>
<span id="cb194-637"><a href="#cb194-637" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, femur_length <span class="sc">~</span> sex <span class="sc">+</span> age)</span>
<span id="cb194-638"><a href="#cb194-638" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m2)</span>
<span id="cb194-639"><a href="#cb194-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-640"><a href="#cb194-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-641"><a href="#cb194-641" aria-hidden="true" tabindex="-1"></a>Why is this? In the first model, we are looking at the variance *within each age group* that is *explained by gender* while in the second case we are looking at the variance *within each gender* that is *explained by age*... but we have different numbers of observations in our different groups. This is known as an unbalanced design.</span>
<span id="cb194-642"><a href="#cb194-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-643"><a href="#cb194-643" aria-hidden="true" tabindex="-1"></a>We can see the unbalanced design by tabulating the cases for each combination of factors.</span>
<span id="cb194-644"><a href="#cb194-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-647"><a href="#cb194-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-648"><a href="#cb194-648" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>sex, d<span class="sc">$</span>age)</span>
<span id="cb194-649"><a href="#cb194-649" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-650"><a href="#cb194-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-651"><a href="#cb194-651" aria-hidden="true" tabindex="-1"></a>Recall that ANOVA is based on splitting up the sums of squares, so that for a model like:</span>
<span id="cb194-652"><a href="#cb194-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-653"><a href="#cb194-653" aria-hidden="true" tabindex="-1"></a>$$Y_{i,j,k} = \mu + a_i + b_j + ab_{i,j} + \epsilon_{i,j,k}$$</span>
<span id="cb194-654"><a href="#cb194-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-655"><a href="#cb194-655" aria-hidden="true" tabindex="-1"></a>The sums of squares add up such that:</span>
<span id="cb194-656"><a href="#cb194-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-657"><a href="#cb194-657" aria-hidden="true" tabindex="-1"></a>$$SS_{total} = SS_a + SS_b + SS_{ab} + SS_{residual}$$</span>
<span id="cb194-658"><a href="#cb194-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-659"><a href="#cb194-659" aria-hidden="true" tabindex="-1"></a>By default, the <span class="in">`aov()`</span> function uses something called **Type I Sums of Squares** (also called "sequential sum of squares"), which gives greater emphasis to the first factor in the model, leaving only residual variation to the remaining factors. It should be used when you want to first control for one factor, leaving the others to explain only any remaining differences. In a **Type I** ANOVA, the sums of squares for the first term are calculated around the grand mean of our observations, but the next terms are calculated as residuals around the average of the grand mean and the first group mean. This sequential procedure means our results depend on which term shows up first. This can have a marked effect on the sums of squares calculated, and hence on p values, when using an unbalanced design.</span>
<span id="cb194-660"><a href="#cb194-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-661"><a href="#cb194-661" aria-hidden="true" tabindex="-1"></a>By contrast, what are know as **Type II** and **Type III Sums of Squares** both calculate the deviations between the individual observations within each group from the grand mean rather than the group mean.</span>
<span id="cb194-662"><a href="#cb194-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-663"><a href="#cb194-663" aria-hidden="true" tabindex="-1"></a>**Type II Sum of Squares** compares the main effects of each factor, assuming that the interaction between factors is minimal. Generally it is a much more appropriate test for comparing among different main effects and is more appropriate for us to use when there is an unbalanced design.</span>
<span id="cb194-664"><a href="#cb194-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-665"><a href="#cb194-665" aria-hidden="true" tabindex="-1"></a>**Type III Sum of Squares** (or "marginal sum of squares") is most appropriate when there is a significant interaction effect between factors. Since both **Type II** and **Type III** ANOVA calculate sums of squares around the grand mean, these are unaffected by different sample sizes across different categorical groups and do not arbitrarily give preference to one effect over another.</span>
<span id="cb194-666"><a href="#cb194-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-667"><a href="#cb194-667" aria-hidden="true" tabindex="-1"></a>To summarize:</span>
<span id="cb194-668"><a href="#cb194-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-669"><a href="#cb194-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When our data are balanced, our factors are orthogonal, and all three types of sums of squares give the same results.</span>
<span id="cb194-670"><a href="#cb194-670" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If our data are strongly unbalanced, we should generally be using Type II or Type III Sums of Squares, since we are generally interested in exploring the significance of one factor while controlling for the level of the other factors.</span>
<span id="cb194-671"><a href="#cb194-671" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In general, if there is no significant interaction effect between factors, then Type II is more powerful than Type III.</span>
<span id="cb194-672"><a href="#cb194-672" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If an important interaction is present, then Type II analysis is inappropriate, while Type III analysis can still be used, but the results need to be interpreted with caution (in the presence of interactions, individual main effects of different factors difficult to interpret).</span>
<span id="cb194-673"><a href="#cb194-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-674"><a href="#cb194-674" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">this post</span><span class="co">](http://md.psych.bio.uni-goettingen.de/mv/unit/lm_cat/lm_cat_unbal_ss_explained.html)</span> or <span class="co">[</span><span class="ot">this post</span><span class="co">](http://goanna.cs.rmit.edu.au/~fscholer/anova.php)</span> for further treatments of the issue.</span>
<span id="cb194-675"><a href="#cb194-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-676"><a href="#cb194-676" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`Anova()`</span> function in the {car} package to run ANOVA with Type II and Type III Sums of Squares. In the examples below, both linear models, where the order of factors are reversed, give the same results for Type II and Type III ANOVA, but not for Type I. The <span class="in">`Anova()`</span> function takes as its argument a model object, e.g., the result from a call to either <span class="in">`lm()`</span> or <span class="in">`aov()`</span> and recalculates the appropriate sums of squares. Note how the effect sizes (partial $\eta^2$ values) are slightly different depending on whether they are being calculated from Type I or Type II ANOVA objects.</span>
<span id="cb194-677"><a href="#cb194-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-680"><a href="#cb194-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-681"><a href="#cb194-681" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb194-682"><a href="#cb194-682" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data=</span>d,femur_length<span class="sc">~</span>age<span class="sc">+</span>sex)</span>
<span id="cb194-683"><a href="#cb194-683" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m1)</span>
<span id="cb194-684"><a href="#cb194-684" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m1, <span class="at">type =</span> <span class="st">"II"</span>)</span>
<span id="cb194-685"><a href="#cb194-685" aria-hidden="true" tabindex="-1"></a>m1 </span>
<span id="cb194-686"><a href="#cb194-686" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data=</span>d,femur_length<span class="sc">~</span>sex<span class="sc">+</span>age)</span>
<span id="cb194-687"><a href="#cb194-687" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m2)</span>
<span id="cb194-688"><a href="#cb194-688" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m2, <span class="at">type =</span> <span class="st">"II"</span>)</span>
<span id="cb194-689"><a href="#cb194-689" aria-hidden="true" tabindex="-1"></a>m2</span>
<span id="cb194-690"><a href="#cb194-690" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m1)</span>
<span id="cb194-691"><a href="#cb194-691" aria-hidden="true" tabindex="-1"></a><span class="fu">effectsize</span>(m2)</span>
<span id="cb194-692"><a href="#cb194-692" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data=</span>d,femur_length<span class="sc">~</span>age<span class="sc">*</span>sex)</span>
<span id="cb194-693"><a href="#cb194-693" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m1, <span class="at">type =</span> <span class="st">"III"</span>)</span>
<span id="cb194-694"><a href="#cb194-694" aria-hidden="true" tabindex="-1"></a>m1</span>
<span id="cb194-695"><a href="#cb194-695" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data=</span>d,femur_length<span class="sc">~</span>sex<span class="sc">*</span>age)</span>
<span id="cb194-696"><a href="#cb194-696" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">Anova</span>(m2, <span class="at">type =</span> <span class="st">"III"</span>)</span>
<span id="cb194-697"><a href="#cb194-697" aria-hidden="true" tabindex="-1"></a>m2</span>
<span id="cb194-698"><a href="#cb194-698" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>car)</span>
<span id="cb194-699"><a href="#cb194-699" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-700"><a href="#cb194-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-701"><a href="#cb194-701" aria-hidden="true" tabindex="-1"></a><span class="fu">## Chi-Square Tests</span></span>
<span id="cb194-702"><a href="#cb194-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-703"><a href="#cb194-703" aria-hidden="true" tabindex="-1"></a>One additional type of categorical data we will often encounter are counts of observations that fall into two or more categories (when we were dealing with $Z$ tests for proportion data, we were interested in something similar, though with two categories only). We can use **Chi-Square tests** to evaluate statistically the distribution of observations across levels of one or more categorical variables. To use the Chi-Square test we first derive a **Chi-Square** **statistic** ($\chi^2$) , which is calculated as...</span>
<span id="cb194-704"><a href="#cb194-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-705"><a href="#cb194-705" aria-hidden="true" tabindex="-1"></a>$$\chi^2 = \displaystyle\sum_{i=1}^k \frac{(O_i - E_i)^2}{E_i}$$</span>
<span id="cb194-706"><a href="#cb194-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-707"><a href="#cb194-707" aria-hidden="true" tabindex="-1"></a>where:</span>
<span id="cb194-708"><a href="#cb194-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-709"><a href="#cb194-709" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$O_i$ = number of observations in the $i$th category</span>
<span id="cb194-710"><a href="#cb194-710" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$E_i$ = number of observations in the $i$th category</span>
<span id="cb194-711"><a href="#cb194-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-712"><a href="#cb194-712" aria-hidden="true" tabindex="-1"></a>We then compare the value of the $\chi^2$ statistic to the Chi-Square distribution with $k-1$ degrees of freedom. The Chi-Square distribution, like the $F$ distribution, is a continuous probability distribution, defined for $x≥0$. It is governed by a single parameter, $df$.</span>
<span id="cb194-713"><a href="#cb194-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-716"><a href="#cb194-716" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-717"><a href="#cb194-717" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb194-718"><a href="#cb194-718" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x,<span class="at">df=</span><span class="dv">1</span>), <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>),</span>
<span id="cb194-719"><a href="#cb194-719" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Some Example Chi-Square Distributions"</span>,</span>
<span id="cb194-720"><a href="#cb194-720" aria-hidden="true" tabindex="-1"></a>  <span class="at">sub =</span> <span class="st">"(vertical line shows critical value for df=3)"</span>,</span>
<span id="cb194-721"><a href="#cb194-721" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"f(x)"</span>, <span class="at">xlab=</span><span class="st">"x"</span>)</span>
<span id="cb194-722"><a href="#cb194-722" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x,<span class="at">df=</span><span class="dv">3</span>), <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-723"><a href="#cb194-723" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x,<span class="at">df=</span><span class="dv">5</span>), <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-724"><a href="#cb194-724" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dchisq</span>(x,<span class="at">df=</span><span class="dv">10</span>), <span class="at">col=</span><span class="st">"purple"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb194-725"><a href="#cb194-725" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"right"</span>, <span class="fu">c</span>(<span class="st">"df=1"</span>,<span class="st">"df=3"</span>,<span class="st">"df=5"</span>,<span class="st">"df=10"</span>),</span>
<span id="cb194-726"><a href="#cb194-726" aria-hidden="true" tabindex="-1"></a>  <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb194-727"><a href="#cb194-727" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span><span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>,<span class="st">"purple"</span>,<span class="st">"black"</span>),</span>
<span id="cb194-728"><a href="#cb194-728" aria-hidden="true" tabindex="-1"></a>  <span class="at">bty=</span><span class="st">'n'</span>, <span class="at">cex=</span>.<span class="dv">75</span>)</span>
<span id="cb194-729"><a href="#cb194-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-730"><a href="#cb194-730" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> <span class="fu">qchisq</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">df =</span> <span class="dv">3</span>)</span>
<span id="cb194-731"><a href="#cb194-731" aria-hidden="true" tabindex="-1"></a>crit</span>
<span id="cb194-732"><a href="#cb194-732" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> crit)</span>
<span id="cb194-733"><a href="#cb194-733" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>)</span>
<span id="cb194-734"><a href="#cb194-734" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(crit, <span class="fu">seq</span>(<span class="at">from=</span>crit, <span class="at">to=</span><span class="dv">20</span>, <span class="at">length.out=</span><span class="dv">1000</span>), <span class="dv">8</span>),</span>
<span id="cb194-735"><a href="#cb194-735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">dchisq</span>(<span class="fu">seq</span>(<span class="at">from=</span>crit, <span class="at">to=</span><span class="dv">20</span>, <span class="at">length.out=</span><span class="dv">1000</span>),<span class="at">df=</span><span class="dv">3</span>),<span class="dv">0</span>)),</span>
<span id="cb194-736"><a href="#cb194-736" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"black"</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb194-737"><a href="#cb194-737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-738"><a href="#cb194-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-739"><a href="#cb194-739" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb194-740"><a href="#cb194-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-741"><a href="#cb194-741" aria-hidden="true" tabindex="-1"></a>Let's return to the zombie apocalypse survivors dataset, where we defined an occupation based on major for survivors of the zombie apocalypse. Use a Chi-Square test to evaluate the hypothesis that survivors of the zombie apocalypse are more likely than expected by chance to be natural science majors. Assume that assume our null hypothesis is that the proportions of different post-apocalypse occupations are equivalent, i.e., that $\pi_{natural science}$ = $\pi_{engineering}$= $\pi_{logistics}$ = $\pi_{other}$ = 0.25.</span>
<span id="cb194-742"><a href="#cb194-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-745"><a href="#cb194-745" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-746"><a href="#cb194-746" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb194-747"><a href="#cb194-747" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb194-748"><a href="#cb194-748" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb194-749"><a href="#cb194-749" aria-hidden="true" tabindex="-1"></a>(obs.table <span class="ot">&lt;-</span> <span class="fu">table</span>(z<span class="sc">$</span>occupation))</span>
<span id="cb194-750"><a href="#cb194-750" aria-hidden="true" tabindex="-1"></a><span class="co"># returns the same as summary()</span></span>
<span id="cb194-751"><a href="#cb194-751" aria-hidden="true" tabindex="-1"></a>(exp.table <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fl">0.25</span> <span class="sc">*</span> <span class="fu">length</span>(z<span class="sc">$</span>occupation), <span class="dv">4</span>))</span>
<span id="cb194-752"><a href="#cb194-752" aria-hidden="true" tabindex="-1"></a><span class="co"># equal expectation for each of 4 categories</span></span>
<span id="cb194-753"><a href="#cb194-753" aria-hidden="true" tabindex="-1"></a>occupation.matrix <span class="ot">&lt;-</span></span>
<span id="cb194-754"><a href="#cb194-754" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">cbind</span>(obs.table, exp.table,</span>
<span id="cb194-755"><a href="#cb194-755" aria-hidden="true" tabindex="-1"></a>    (obs.table <span class="sc">-</span> exp.table) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> exp.table))</span>
<span id="cb194-756"><a href="#cb194-756" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(occupation.matrix) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Oi"</span>, <span class="st">"Ei"</span>, <span class="st">"(Oi-Ei)^2/Ei"</span>)</span>
<span id="cb194-757"><a href="#cb194-757" aria-hidden="true" tabindex="-1"></a>occupation.matrix</span>
<span id="cb194-758"><a href="#cb194-758" aria-hidden="true" tabindex="-1"></a>(X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>(occupation.matrix[, <span class="dv">3</span>]))</span>
<span id="cb194-759"><a href="#cb194-759" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> X2, <span class="fu">length</span>(obs.table) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb194-760"><a href="#cb194-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-761"><a href="#cb194-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-762"><a href="#cb194-762" aria-hidden="true" tabindex="-1"></a>Here, we reject the null hypothesis that the proportions of different occupations among the survivors of the zombie apocalypse is equivalent.</span>
<span id="cb194-763"><a href="#cb194-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-764"><a href="#cb194-764" aria-hidden="true" tabindex="-1"></a>We can do all this with a 1-liner in ***R***, too.</span>
<span id="cb194-765"><a href="#cb194-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-768"><a href="#cb194-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-769"><a href="#cb194-769" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table, <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>))</span>
<span id="cb194-770"><a href="#cb194-770" aria-hidden="true" tabindex="-1"></a><span class="co"># here p is a vector of expected proportions... default is uniform</span></span>
<span id="cb194-771"><a href="#cb194-771" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table)</span>
<span id="cb194-772"><a href="#cb194-772" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table, <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.42</span>, <span class="fl">0.07</span>, <span class="fl">0.22</span>, <span class="fl">0.29</span>))</span>
<span id="cb194-773"><a href="#cb194-773" aria-hidden="true" tabindex="-1"></a><span class="co"># with a different set of expected proportions... fail to reject H0</span></span>
<span id="cb194-774"><a href="#cb194-774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-775"><a href="#cb194-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-776"><a href="#cb194-776" aria-hidden="true" tabindex="-1"></a>The above was a **Chi-Square goodness of fit** test for one categorical variable... what about if we have two categorical variables and we are curious if there is an association among them? Then we do a **Chi-Square test of independence**. In this case, our Chi-Square statistic would be the sum of $\frac{(O-E)^2}{E}$ across all cells in our table, and our degrees of freedom is (number of rows - 1) $\times$ (number of columns - 1). Let's suppose we want to see if there is a relationship among zombie apocalypse survivors between gender and occupation.</span>
<span id="cb194-777"><a href="#cb194-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-778"><a href="#cb194-778" aria-hidden="true" tabindex="-1"></a>First, we determine our table of observed proportions:</span>
<span id="cb194-779"><a href="#cb194-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-782"><a href="#cb194-782" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-783"><a href="#cb194-783" aria-hidden="true" tabindex="-1"></a>(<span class="at">obs.table =</span> <span class="fu">table</span>(z<span class="sc">$</span>gender, z<span class="sc">$</span>occupation))</span>
<span id="cb194-784"><a href="#cb194-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-785"><a href="#cb194-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-786"><a href="#cb194-786" aria-hidden="true" tabindex="-1"></a>We can view our data graphically using the <span class="in">`mosaic plot()`</span> function.</span>
<span id="cb194-787"><a href="#cb194-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-790"><a href="#cb194-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-791"><a href="#cb194-791" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb194-792"><a href="#cb194-792" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">t</span>(obs.table), <span class="at">main=</span><span class="st">"Contingency Table"</span>,</span>
<span id="cb194-793"><a href="#cb194-793" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"darkseagreen"</span>, <span class="st">"gray"</span>))</span>
<span id="cb194-794"><a href="#cb194-794" aria-hidden="true" tabindex="-1"></a><span class="co"># the `t()` function transposes the table</span></span>
<span id="cb194-795"><a href="#cb194-795" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-796"><a href="#cb194-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-797"><a href="#cb194-797" aria-hidden="true" tabindex="-1"></a>Then, we determine our table of expected proportions:</span>
<span id="cb194-798"><a href="#cb194-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-801"><a href="#cb194-801" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-802"><a href="#cb194-802" aria-hidden="true" tabindex="-1"></a>(r <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(obs.table)) <span class="co"># row margins</span></span>
<span id="cb194-803"><a href="#cb194-803" aria-hidden="true" tabindex="-1"></a>(c <span class="ot">&lt;-</span> <span class="fu">colSums</span>(obs.table)) <span class="co"># column margins</span></span>
<span id="cb194-804"><a href="#cb194-804" aria-hidden="true" tabindex="-1"></a>(nr <span class="ot">&lt;-</span> <span class="fu">nrow</span>(obs.table)) <span class="co"># row dimensions</span></span>
<span id="cb194-805"><a href="#cb194-805" aria-hidden="true" tabindex="-1"></a>(nc <span class="ot">&lt;-</span> <span class="fu">ncol</span>(obs.table)) <span class="co"># column dimensions</span></span>
<span id="cb194-806"><a href="#cb194-806" aria-hidden="true" tabindex="-1"></a>(exp.table <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(c, <span class="at">each =</span> nr) <span class="sc">*</span> r<span class="sc">/</span><span class="fu">sum</span>(obs.table),</span>
<span id="cb194-807"><a href="#cb194-807" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> nr,</span>
<span id="cb194-808"><a href="#cb194-808" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> nc,</span>
<span id="cb194-809"><a href="#cb194-809" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">dimnames</span>(obs.table),</span>
<span id="cb194-810"><a href="#cb194-810" aria-hidden="true" tabindex="-1"></a>  <span class="at">byrow =</span> <span class="cn">FALSE</span>))</span>
<span id="cb194-811"><a href="#cb194-811" aria-hidden="true" tabindex="-1"></a><span class="co"># calculates the product of c*r and divides by total</span></span>
<span id="cb194-812"><a href="#cb194-812" aria-hidden="true" tabindex="-1"></a>(X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((obs.table <span class="sc">-</span> exp.table) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> exp.table))</span>
<span id="cb194-813"><a href="#cb194-813" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> X2, <span class="at">df =</span> (nr <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (nc <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="cb194-814"><a href="#cb194-814" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-815"><a href="#cb194-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-816"><a href="#cb194-816" aria-hidden="true" tabindex="-1"></a>Again, we can do a one-liner for a test of independence...</span>
<span id="cb194-817"><a href="#cb194-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-820"><a href="#cb194-820" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-821"><a href="#cb194-821" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(<span class="at">x =</span> obs.table)</span>
<span id="cb194-822"><a href="#cb194-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-823"><a href="#cb194-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-826"><a href="#cb194-826" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb194-827"><a href="#cb194-827" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb194-828"><a href="#cb194-828" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>effectsize)</span>
<span id="cb194-829"><a href="#cb194-829" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>infer)</span>
<span id="cb194-830"><a href="#cb194-830" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>broom)</span>
<span id="cb194-831"><a href="#cb194-831" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>tidyverse)</span>
<span id="cb194-832"><a href="#cb194-832" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb194-833"><a href="#cb194-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-834"><a href="#cb194-834" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb194-835"><a href="#cb194-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-836"><a href="#cb194-836" aria-hidden="true" tabindex="-1"></a><span class="fu">## Concept Review {.unnumbered}</span></span>
<span id="cb194-837"><a href="#cb194-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-838"><a href="#cb194-838" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ANOVA is conceptually equivalent linear regression, but with one or more categorical predictor variables</span>
<span id="cb194-839"><a href="#cb194-839" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ANOVA effectively tests whether the means of different groups are different</span>
<span id="cb194-840"><a href="#cb194-840" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The Kruskall-Wallis test is a nonparametric alternative to a One-Way ANOVA that relaxes the need for normality in the distribution of data in each group and tests for a difference in the **medians** of different groups</span>
<span id="cb194-841"><a href="#cb194-841" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>ANOVAs should have balanced or roughly balanced numbers of observations within each categorical group</span>
<span id="cb194-842"><a href="#cb194-842" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Chi-Square ($\chi^2$) goodness-of-fit tests are another type of factor-based categorical data analysis, where we compare between observed and expected counts of observations in different grouping categories for either a single variable or two variables</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>