<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Data Analysis - 24&nbsp; Mixed Effects or Multilevel Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./99-maximum_likelihood.html" rel="next">
<link href="./23-module.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./24-module.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixed Effects or Multilevel Modeling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Preliminaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Logistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-typography-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Typography and Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-programming-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>RStudio</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Extending the Functionality of <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentals of the <strong><em>R</em></strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basics of Version Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Additional Data Structures in <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting Data into <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part II - Statistics and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Descriptive Statisics and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Probability and Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classical Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error, Power, and Effect Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Linear Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Multiple Regression and ANCOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Model Selection in Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-module.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixed Effects or Multilevel Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Part III - Miscellany</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-maximum_likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maximum Likelihood Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-python-from-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using <strong><em>Python</em></strong> from <strong><em>R</em></strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-r-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building Custom <strong><em>R</em></strong> Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building Interactive Web Apps</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-using-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with and Managing Packages</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-05-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 05 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 06</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 06 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 07</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 08</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-08-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 08 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 09</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-09-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 09 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 10</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-10-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 10 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 11</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-11-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 11 Solution</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-analysis-replication-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis Replication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./collaborative-data-science-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Collaborative Data Science Project</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./creative-dataviz-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creative Data Visualization</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Packages Used</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">24.1</span> Objectives</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">24.2</span> Preliminaries</a></li>
  <li><a href="#overview-of-mixed-models" id="toc-overview-of-mixed-models" class="nav-link" data-scroll-target="#overview-of-mixed-models"><span class="header-section-number">24.3</span> Overview of “Mixed” Models</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">EXAMPLE:</a></li>
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#random-intercept-models" id="toc-random-intercept-models" class="nav-link" data-scroll-target="#random-intercept-models"><span class="header-section-number">24.4</span> Random Intercept Models</a>
  <ul class="collapse">
  <li><a href="#visualizing-model-results" id="toc-visualizing-model-results" class="nav-link" data-scroll-target="#visualizing-model-results"><span class="header-section-number">24.4.1</span> Visualizing Model Results</a></li>
  <li><a href="#residual-analysis" id="toc-residual-analysis" class="nav-link" data-scroll-target="#residual-analysis"><span class="header-section-number">24.4.2</span> Residual Analysis</a></li>
  <li><a href="#inference-using-lrts" id="toc-inference-using-lrts" class="nav-link" data-scroll-target="#inference-using-lrts">Inference using LRTs</a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">CHALLENGE</a></li>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#random-slope-models" id="toc-random-slope-models" class="nav-link" data-scroll-target="#random-slope-models"><span class="header-section-number">24.5</span> Random Slope Models</a>
  <ul class="collapse">
  <li><a href="#residual-analysis-1" id="toc-residual-analysis-1" class="nav-link" data-scroll-target="#residual-analysis-1"><span class="header-section-number">24.5.1</span> Residual Analysis</a></li>
  <li><a href="#inference-using-lrts-1" id="toc-inference-using-lrts-1" class="nav-link" data-scroll-target="#inference-using-lrts-1">Inference using LRTs</a></li>
  <li><a href="#inference-using-aic" id="toc-inference-using-aic" class="nav-link" data-scroll-target="#inference-using-aic">Inference using AIC</a></li>
  <li><a href="#other-methods-for-assessing-fit" id="toc-other-methods-for-assessing-fit" class="nav-link" data-scroll-target="#other-methods-for-assessing-fit">Other Methods for Assessing Fit</a></li>
  <li><a href="#challenge-3" id="toc-challenge-3" class="nav-link" data-scroll-target="#challenge-3">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#generalized-lmms" id="toc-generalized-lmms" class="nav-link" data-scroll-target="#generalized-lmms"><span class="header-section-number">24.6</span> Generalized LMMs</a>
  <ul class="collapse">
  <li><a href="#challenge-4" id="toc-challenge-4" class="nav-link" data-scroll-target="#challenge-4">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#concept-review" id="toc-concept-review" class="nav-link" data-scroll-target="#concept-review">Concept Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./24-module.html"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixed Effects or Multilevel Modeling</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="module-24" class="quarto-section-identifier"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixed Effects or Multilevel Modeling</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2" data-number="24.1">
<h2 data-number="24.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">24.1</span> Objectives</h2>
<blockquote class="blockquote">
<p>In this module, we extend our discussion of regression modeling even further to include “mixed effects” or “multilevel” models.</p>
</blockquote>
</section>
<section id="preliminaries" class="level2" data-number="24.2">
<h2 data-number="24.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">24.2</span> Preliminaries</h2>
<ul>
<li>Install and load these packages in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/lme4/lme4.pdf">{lme4}</a>, <a href="https://cran.r-project.org/web/packages/redres/redres.pdf">{redres}</a>, <a href="https://cran.r-project.org/web/packages/glmmTMB/glmmTMB.pdf">{glmmTMB}</a>, <a href="https://cran.r-project.org/web/packages/sjPlot/sjPlot.pdf">{sjPlot}</a>, and <a href="https://github.com/m-clark/mixedup/">{mixedup}</a></li>
<li>Load {tidyverse} and {effects}</li>
<li>Be sure you have the packages {car}, {cowplot}, {lmtest}, and {MASS} installed</li>
</ul>
</section>
<section id="overview-of-mixed-models" class="level2" data-number="24.3">
<h2 data-number="24.3" class="anchored" data-anchor-id="overview-of-mixed-models"><span class="header-section-number">24.3</span> Overview of “Mixed” Models</h2>
<p>A final extension of linear regression modeling that we will talk about is so-called “multilevel” or “mixed effects” modeling. This is a very complex topic, and we will only scratch the surface!</p>
<p>In a (general or generalized) linear mixed model, we have a reponse variable, <span class="math inline">\(Y\)</span>, and observations that fall into different factor categories each with some set of levels (e.g., “sex” with levels “male” and “female”), and we are interested in the effects of the various factors <strong>and</strong> factor levels on the response variable. Generically, if <span class="math inline">\(\mu\)</span> = a population mean response and <span class="math inline">\(\mu_A\)</span> = mean response for observations belonging to factor level A, then the effect of A is given by <span class="math inline">\(\mu\)</span> - <span class="math inline">\(\mu_A\)</span>. We have already dealt with factors and factor levels in our linear regression models when we looked at categorical predictors (e.g., <em>sex</em>, <em>rank category</em>) in our discussions of ANOVA and ANCOVA.</p>
<p>We can conceptualize these factor effects as being either <em>fixed</em> or <em>random</em>. <em>Fixed</em> factors are those that reflect all levels of interest in our study, while <em>random</em> effects are those that represent only a sample of the levels of interest. For example, if we include <strong>sex</strong> as a factor in a model with the factor levels “male” and “female”, this (typically) will cover the entire gamut of levels of interest our study, thus we would consider <strong>sex</strong> a fixed factor. When we were doing ANOVA and ANCOVA analyses previously, we were implicitly looking at the effects of such fixed factors.</p>
<p>However, if our observational data were to consist of repeated observations of the same sampling unit, e.g., measurements taken on the same set of individuals on different dates, <strong>individual ID</strong> would be considered a random factor because it is unlikely that we will have collected data from all possible “levels of interest”, i.e., from all possible individual subjects. We have not yet dealt with such random factors as an additional source of variance in our modeling.</p>
<p>So-called <strong>mixed models</strong>, then, are those that include BOTH fixed and random effects. Including random effects in addition to fixed effects in our models has several ramifications:</p>
<ul>
<li>Using random effects broadens the scope of inference. That is, we can use statistical methods to infer something about the population from which the levels of the random factor have been drawn.</li>
<li>Using random effects naturally incorporates dependence in the model and helps us account for pseudoreplication in our dataset. Observations that share the same level of the random effects are explicitly modeled as being correlated. This makes mixed effect modeling very useful for dealing with time series data, spatially correlated data, or situations where we have repeated observations/measures from the same subjects or sampling unit.</li>
<li>Using random factors often gives more accurate parameter estimates.</li>
<li>Incorporating random factors, however, does require the use of more sophisticated estimation and fitting methods.</li>
</ul>
<p>Not surprisingly, there several different varieties of mixed modeling approaches, which are supported in a variety of different packages in <strong><em>R</em></strong>:</p>
<ul>
<li>Standard or general <strong>Linear Mixed Models (LMM)</strong>, analogous to standard or general linear regression - used when we are dealing with normally distributed variables and error structures.</li>
<li><strong>Generalized Linear Mixed Models (GLMM)</strong>, analogous to generalized linear regresseion - used when we are dealing with various other variable types and error structure (e.g., binary, proportion, or count data).</li>
<li><strong>Nonlinear Mixed Models (NLMM)</strong>, analogous to nonlinear regression - used if we are dealing with situations where our response variable is best modeled by a nonlinear combination of predictor variables.</li>
</ul>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> We have not talked at all in this course about general or generalized NONLINEAR modeling, but it is worth knowing that such approaches are also possible. NONLINEAR modeling is where our regression equation is a <strong>nonlinear</strong> function of the model parameters.</p>
</blockquote>
<p>We will explore “mixed effects” modeling using an example based on this <a href="http://www.bodowinter.com/tutorial/bw_LME_tutorial2.pdf">excellent tutorial</a>.</p>
<section id="example" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example">EXAMPLE:</h3>
<p>Suppose we have measured the amount of grooming received by female chimpanzees when they are either in their periovulatory period (i.e., the window of 2-3 days around the likely time of ovulation) or duing other portions of their reproductive cycle. We collected data on the <strong>duration of grooming bouts received</strong> and scored a female’s <strong>reproductive condition</strong> at the time as a categorical factor with two levels: “POP” versus “NONPOP”. On top of that, we also recorded data on female parity at the time of the grooming bout, i.e., whether the female had given birth previously (was “parous”, or “P”) or had not yet had an offspring (was “nulliparous”, or “N”).</p>
<p>If we are interested in how reproductive condition and parity influence how much grooming a female receives, our simple regression model would look like this:</p>
<p><span class="math display">\[grooming\ duration \sim reproductive\ condition + parity + \epsilon\]</span></p>
<p>Also imagine that our study design was such that we took multiple observations per subject. That is, our data set includes records of multiple grooming bouts received by each subject. This situation violates the assumption of independence of observations that we make for standard linear regression: multiple responses/measures from the same subject cannot be regarded as independent from each other.</p>
<p>Using a mixed effects model, we can deal with this situation by adding <strong>subject ID</strong> as a random effect in our model. Doing so allows us to address the nonindependence issue by estimating a different set of parameters for each level of the factor “subject”. We can either estimate a different <em>intercept</em> for each subject (which would correspond to each female having a different “baseline” level of grooming received) or estimate a different <em>intercept</em> <strong>and</strong> <em>slope</em> (where individual subjects are presumed to differ both in the baseline level of grooming received and the strength of the relationship between grooming duration, on the one hand, and reproductive condition and parity, on the other). Our mixed effects model estimates these individual level parameters in addition to the main effects of each variable.</p>
<p>This is why a “mixed effects” model is called a <strong>mixed</strong> model. The models that we have considered so far have been <strong>fixed effects only</strong> models and included only one or more “fixed” predictor variables and a general error term. We essentially divided the world into things that we somehow understand or that are systematic (the fixed effects, or the explanatory variables) and things that we could not control for or do not understand (the general error, or <span class="math inline">\(\epsilon\)</span>). These fixed effects models did not examine possible structure <em>within</em> the error term.</p>
<p>In a mixed model, by contrast, we add one or more random effects to our fixed effects that may explain a portion of the variance in our error term.</p>
</section>
<section id="challenge" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge">CHALLENGE</h3>
<p>Let’s explore these idea using some actual data. First, load in the dataset “chimpgrooming.csv” and do some exploratory data analysis:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/chimpgrooming.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 5
##   subject parity season reprocondition duration
##   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;             &lt;dbl&gt;
## 1 Nina    P      WS     NONPOP             214.
## 2 Nina    P      WS     POP                206.
## 3 Nina    P      WS     NONPOP             294.
## 4 Nina    P      WS     POP                269.
## 5 Nina    P      WS     NONPOP             205.
## 6 Nina    P      WS     POP                287.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##    subject             parity             season          reprocondition    
##  Length:84          Length:84          Length:84          Length:84         
##  Class :character   Class :character   Class :character   Class :character  
##  Mode  :character   Mode  :character   Mode  :character   Mode  :character  
##                                                                             
##                                                                             
##                                                                             
##     duration     
##  Min.   : 86.34  
##  1st Qu.:132.36  
##  Median :205.41  
##  Mean   :197.81  
##  3rd Qu.:252.27  
##  Max.   :316.23</code></pre>
</div>
</div>
<ul>
<li>Plot grooming received duration in relation to subject ID…</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> subject, <span class="at">y =</span> duration)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"subject"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot grooming received in relation to reproductive condition…</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> reprocondition, <span class="at">y =</span> duration)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"reproductive condition"</span>) <span class="sc">+</span> <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot grooming received in relation to reproductive condition <em>and</em> parity…</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> reprocondition, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(parity))) <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"reproductive condition"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"parity"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> parity, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(reprocondition))) <span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"parity"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"reprocondition"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From these plots, we can see lots of [a] individual variation in how much grooming is received (some females seem to receive more than others, overall), [b] variation in response to reproductive condition (where grooming in the POP seems to be higher, overall), [c] limited variation due to parity, and [d] variation in response to this combination of fixed effects.</p>
<ul>
<li>Finally, plot grooming received into relation to both a fixed effect (reprocondition) and a random effect (subject)…</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> reprocondition, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(subject))) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"reproductive condition"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"subject"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> subject, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(reprocondition))) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"subject"</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"reproductive condition"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What patterns do you see? There is, again, lots of apparent variation, and some of it seems to be associated with female ID and/or reproductive condition.</p>
</section>
</section>
<section id="random-intercept-models" class="level2" data-number="24.4">
<h2 data-number="24.4" class="anchored" data-anchor-id="random-intercept-models"><span class="header-section-number">24.4</span> Random Intercept Models</h2>
<p>We will now perform an initial mixed effects analysis where we look in more detail at how reproductive condition and parity (as fixed effects) affect grooming duration, where we include individual subject ID as a random effect.</p>
<p>Here is a first mixed effects model that we will fit, using one extension of formula notation that is commonly used in <strong><em>R</em></strong>:</p>
<p><span class="math display">\[grooming\ duration \sim reproductive\ condition + parity + (1|subject) + \epsilon\]</span></p>
<p>Here, the 1 refers to the fact that we want to estimate an <em>intercept</em> and the pipe operator(“|”) following the “1” signifies that we want to estimate a <em>different intercept for each subject</em>. Note that this generic formula still contains a general error term, <span class="math inline">\(\epsilon\)</span>, to highlight that there will still be unexplained “error” variance after accounting for both fixed and random effects in the model.</p>
<p>We can think of this formula as saying that we expect our dataset to include multiple observations of the response variable per subject, and these responses will depend, in part, on each subject’s baseline level. This effectively accounts the nonindependence that stems from having multiple responses by the same subject.</p>
<p>The {lme4} package in <strong>R</strong> is commonly used for mixed effects modeling, and the function <code>lmer()</code> is the mixed model equivalent of the function <code>lm()</code>. In the formula syntax for mixed effects models using the {lme4} package, fixed effects are included without parentheses while random effects are included in parentheses (the error, <span class="math inline">\(\epsilon\)</span>, is understood and is not included explicitly).</p>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> We could also use the package {nlme} for mixed effects modeling (which requires a slightly different formula syntax than that used here). That same package also allows us to do <strong>nonlinear</strong> mixed effects modeling, which we will not be talking about. It is important to note that {lme4} uses, by default, a slightly different parameter estimation algorithm than {nlme}. Unless otherwise specified, {lme4} uses “restricted maximum likelihood” (REML) rather than ordinary maximum likelihood estimation, which is what is used in {nlme}. In practice, these often give very similar results. We will see below that when we want to compare different models using {lme4}, we will need to tell {lme4} to use ordinary maximum likelihood.</p>
</blockquote>
<p>The code block below implements this first “mixed effects” model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Linear mixed model fit by REML ['lmerMod']
## Formula: duration ~ reprocondition + parity + (1 | subject)
##    Data: d
## 
## REML criterion at convergence: 796.1
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.2611 -0.5349 -0.1890  0.3918  3.1994 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subject  (Intercept) 611.9    24.74   
##  Residual             847.3    29.11   
## Number of obs: 84, groups:  subject, 6
## 
## Fixed effects:
##                   Estimate Std. Error t value
## (Intercept)        132.841     15.305   8.680
## reproconditionPOP   20.293      6.352   3.195
## parityP            109.650     21.173   5.179
## 
## Correlation of Fixed Effects:
##             (Intr) rprPOP
## rprcndtnPOP -0.208       
## parityP     -0.692  0.000</code></pre>
</div>
</div>
<p>Let’s focus on the output for the random effects first. Have a look at the column <strong>Std.Dev.</strong>. The entry for <em>subject</em> shows us how much variability in grooming duration (apart from that explained by the fixed effects) is due to subject ID. The entry for <em>Residual</em> summarizes the remaining variability in grooming duration that is not due to <em>subject</em> or to our fixed effects. The latter is our <span class="math inline">\(\epsilon\)</span>, the “random” deviations from the predicted values that are not due to either subject or our fixed effects.</p>
<p>The fixed effects output mirrors the coefficient tables that we have seen previously in our linear models that have focused only on fixed effects. The coefficient “reproconditionPOP” is the <span class="math inline">\(\beta\)</span> coefficient for the categorical effect of reproductive condition. The positive sign for the coefficient means that grooming duration is GREATER by 20.293 units for POP than for NONPOP females. Then, there is a standard error associated with this slope, and a t value, which is simply the estimate divided by the standard error.</p>
<p>The coefficient “parityP” is the <span class="math inline">\(\beta\)</span> coefficient for the categorical effect of parity. The grooming duration associated with being parous versus nulliparous is GREATER by 109.65 units.</p>
<p>The INTERCEPT in this case is the grooming duration associated with being an average, nulliparous, NONPOP female. Like the <code>lm()</code> function, the <code>lmer()</code> took whatever factor level came first in the alphabet to be the reference level for each fixed effect variable.</p>
<p>Let’s also look at the coefficients coming out of the model and their confidence intervals.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $subject
##       (Intercept) reproconditionPOP parityP
## Luna    142.76558          20.29286  109.65
## Maya    137.37902          20.29286  109.65
## Nina    118.37755          20.29286  109.65
## Nipa    160.80050          20.29286  109.65
## Sofia    99.80117          20.29286  109.65
## Vita    137.92047          20.29286  109.65
## 
## attr(,"class")
## [1] "coef.mer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or, for just the fixed effects...  coefficients(summary(m))</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">method =</span> <span class="st">"boot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Computing bootstrap confidence intervals ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## 
## 8 message(s): boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##                        2.5 %    97.5 %
## .sig01              5.487574  40.29990
## .sigma             24.976942  33.86394
## (Intercept)       103.943092 163.37933
## reproconditionPOP  10.269535  31.98414
## parityP            70.263987 150.62310</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: For the <code>confint()</code> function, we can set <code>method =</code> argument to “boot” (to generate a CI based on bootstrapping), “profile” (to generate a CI based on likelihoods), or “Wald” (which generates a CI for the fixed effects only). Also, in the output from running <code>confint()</code>, “.sigXX” is the square root of the variance associated with each of the random parameter levels and “.sigma” is the square root of the variance associated with the residuals of the model.</p>
</blockquote>
<p>We can see the separate intercepts, i.e., the “baseline” level of grooming received, for each female when they are (presumably) nulliparous and in a NONPOP reproductive condition.</p>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> Some females may not ever be seen both parity or reproductive conditions!</p>
</blockquote>
<section id="visualizing-model-results" class="level3" data-number="24.4.1">
<h3 data-number="24.4.1" class="anchored" data-anchor-id="visualizing-model-results"><span class="header-section-number">24.4.1</span> Visualizing Model Results</h3>
<p>As in earlier modules, we can use the <code>predictorEffects()</code> function from the {effects} package to visualize our mixed model results in terms of how the response variable is expected to differ across levels of each predictor variable when the other predictor and the random effect of <strong>subject</strong> are controlled for.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(m, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similar effects plots for our predictors can be created using <code>plot_model()</code> from the {sjPlot} package.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"reprocondition"</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"parity"</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can also use <code>plot_model()</code> to visualize estimates and confidence intervals for the fixed effect coefficients and for the random effects.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"est"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"re"</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The package {mixedup}, installable from <a href="https://github.com/m-clark/mixedup/">here</a>, is a useful package that provides several functions for extracting relevant summary information from mixed models.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(m)  <span class="co"># clean model summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##     Group    Effect Variance    SD SD_2.5 SD_97.5 Var_prop
##   subject Intercept   611.94 24.74  10.57   41.75     0.42
##  Residual             847.28 29.11  24.91   34.13     0.58</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##               Term  Value    SE    t P_value Lower_2.5 Upper_97.5
##          Intercept 132.84 15.30 8.68    0.00    102.84     162.84
##  reproconditionPOP  20.29  6.35 3.19    0.00      7.84      32.74
##            parityP 109.65 21.17 5.18    0.00     68.15     151.15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixed_effects</span>(m)  <span class="co"># table of fixed effects coefficients</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 3 × 7
##   term              value    se     t p_value lower_2.5 upper_97.5
##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Intercept         133.  15.3   8.68   0        103.        163. 
## 2 reproconditionPOP  20.3  6.35  3.20   0.001      7.84       32.7
## 3 parityP           110.  21.2   5.18   0         68.2       151.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_coefficients</span>(m)  <span class="co"># table of coefficients for random effects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 7
##   group_var effect    group value    se lower_2.5 upper_97.5
##   &lt;chr&gt;     &lt;chr&gt;     &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 subject   Intercept Luna  143.   17.0     109.        176.
## 2 subject   Intercept Maya  137.   17.0     104.        171.
## 3 subject   Intercept Nina  118.   17.0      85.0       152.
## 4 subject   Intercept Nipa  161.   17.0     127.        194.
## 5 subject   Intercept Sofia  99.8  17.0      66.5       133.
## 6 subject   Intercept Vita  138.   17.0     105.        171.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_effects</span>(m)  <span class="co"># table of coefficients for each level of random effect</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 7
##   group_var effect    group  value    se lower_2.5 upper_97.5
##   &lt;chr&gt;     &lt;chr&gt;     &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 subject   Intercept Luna    9.93  7.42     -4.62     24.5  
## 2 subject   Intercept Maya    4.54  7.42    -10.0      19.1  
## 3 subject   Intercept Nina  -14.5   7.42    -29.0       0.082
## 4 subject   Intercept Nipa   28.0   7.42     13.4      42.5  
## 5 subject   Intercept Sofia -33.0   7.42    -47.6     -18.5  
## 6 subject   Intercept Vita    5.08  7.42     -9.46     19.6</code></pre>
</div>
</div>
</section>
<section id="residual-analysis" class="level3" data-number="24.4.2">
<h3 data-number="24.4.2" class="anchored" data-anchor-id="residual-analysis"><span class="header-section-number">24.4.2</span> Residual Analysis</h3>
<p>We can use functions from the {redres} package to conduct some analyses on the residuals resulting from a mixed effects model. The <code>plot_resqq()</code> function creates a QQ plot of the overall residuals from the model. Ideally, these should fall along a line, and we can see that ours do not…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resqq</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required namespace: testthat</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">compute_redres</span>(m))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">compute_redres</span>(m))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">qqPlot</span>(<span class="fu">compute_redres</span>(m), <span class="at">id =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>… rather, the residuals from this model appear to deviate from a normal distribution, thus the appropriatess of using linear regression here is suspect!</p>
<p>The <code>plot_redres()</code> function plots the residuals with respect to fitted values of the response variable.</p>
<p>We can also pass an “xvar =” argument to <code>plot_redres()</code> to view our residuals by our different predictor variables, e.g., <strong>reprocondition</strong>, <strong>parity</strong>, or <strong>subject</strong>.</p>
<p>The code below generates and prints all of these plots…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"reprocondition"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"parity"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"subject"</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the plot of residuals by fitted values (upper left), the residuals should roughly form a horizonal belt around the zero line, with the points randomly scattered above and below 0. Such a pattern would be consistent with “homoskedasticity”, or equal variance, in the error term across values of the predictor terms and the response. Here, things look pretty good (although perhaps the width of the “belt” of points looks like it may be wider at larger values of the fitted response).</p>
<p>In the other plots, we are looking to see whether the scatter (variance) above and below the zero line is similar across levels of the predictor variables.</p>
<p>Finally, we can use the <code>plot_ranef()</code> function to plot estimate modal values for the random effects (i.e., in our model, for each <strong>subject</strong> conditioned on the fixed effects) against quantiles of the normal distribution. For linear regression to be appropriate, the random effects should not deviate from normal expectations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ranef</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, we can use the {sjPlot} function <code>plot_model()</code> with the “type =” argument set to “diag” to produce a similar set of diagnostic plots.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"diag"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p[[<span class="dv">1</span>]], p[[<span class="dv">3</span>]], p[[<span class="dv">4</span>]], <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="inference-using-lrts" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="inference-using-lrts">Inference using LRTs</h3>
<p>In mixed effects models, it is not as straightforward as it is for standard linear models to determine p values associated with either overall models or individual coefficients. However, using <strong>likelihood ratio tests</strong>, which we previously used for comparing among generalized linear models, is one common approach. Likelihood is the probability of seeing the data we have actually collected <em>given</em> a particular model. The logic of the likelihood ratio test is to compare the likelihood of two models with each other, i.e., a model that includes the factor that we are interested in versus a reduced, nested model with that factor excluded.</p>
<p>So… if we are interested in the effect of <strong>reproductive condition</strong> on grooming duration, we could compare a more complex model…</p>
<p><span class="math display">\[grooming\ duration \sim reproductive\ condition + parity + (1|subject) + \epsilon\]</span></p>
<p>to a nested, less complex model…</p>
<p><span class="math display">\[grooming\ duration \sim parity + (1|subject) + \epsilon\]</span></p>
<p>In <strong><em>R</em></strong>, we would do this as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># note the additional `REML=` argument</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Linear mixed model fit by maximum likelihood  ['lmerMod']
## Formula: duration ~ reprocondition + parity + (1 | subject)
##    Data: d
## 
##       AIC       BIC    logLik -2*log(L)  df.resid 
##     825.7     837.9    -407.9     815.7        79 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.2996 -0.5283 -0.1783  0.4032  3.2285 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subject  (Intercept) 388.6    19.71   
##  Residual             836.4    28.92   
## Number of obs: 84, groups:  subject, 6
## 
## Fixed effects:
##                   Estimate Std. Error t value
## (Intercept)        132.841     12.625  10.522
## reproconditionPOP   20.293      6.311   3.215
## parityP            109.650     17.288   6.343
## 
## Correlation of Fixed Effects:
##             (Intr) rprPOP
## rprcndtnPOP -0.250       
## parityP     -0.685  0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reduced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Linear mixed model fit by maximum likelihood  ['lmerMod']
## Formula: duration ~ parity + (1 | subject)
##    Data: d
## 
##       AIC       BIC    logLik -2*log(L)  df.resid 
##     833.4     843.2    -412.7     825.4        80 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.4996 -0.6492 -0.1198  0.6594  2.7072 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subject  (Intercept) 380.6    19.51   
##  Residual             947.3    30.78   
## Number of obs: 84, groups:  subject, 6
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   142.99      12.22  11.697
## parityP       109.65      17.29   6.343
## 
## Correlation of Fixed Effects:
##         (Intr)
## parityP -0.707</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> Here, we added the argument “REML = FALSE” to the <code>lmer()</code> function. This is necessary to do when we want to compare models using the likelihood ratio test. Basically, REML uses a different algorithm to determine likelihood values than ordinary likelihood, and, if we want to use these likelihoods to execute an LRT, we need to use ordinary likelihood. See <a href="http://users.stat.umn.edu/~gary/classes/5303/handouts/REML.pdf">this site</a> for a more complete explanation of this issue.</p>
</blockquote>
<p>We then perform the likelihood ratio test using the <code>anova()</code> function or the <code>lrtest()</code> function from {lmtest}.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Data: d
## Models:
## reduced: duration ~ parity + (1 | subject)
## full: duration ~ reprocondition + parity + (1 | subject)
##         npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)   
## reduced    4 833.43 843.15 -412.72    825.43                        
## full       5 825.72 837.88 -407.86    815.72 9.7089  1   0.001834 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">lrtest</span>(reduced, full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: duration ~ parity + (1 | subject)
## Model 2: duration ~ reprocondition + parity + (1 | subject)
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)   
## 1   4 -412.72                        
## 2   5 -407.86  1 9.7089   0.001834 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>These results tell us that the model containing both <strong>reproductive condition</strong> and <strong>parity</strong> as <em>fixed</em> effects fits the data better than a model lacking <strong>reproductive condition</strong> and containing only <strong>parity</strong> as a <em>fixed</em> effect, while accounting for <strong>subject</strong> as a <em>random</em> effect.</p>
</section>
<section id="challenge-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-1">CHALLENGE</h3>
<p>Now, compare a model containing <strong>reproductive condition</strong> and <strong>parity</strong> to one containing just <strong>reproductive condition</strong>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## Data: d
## Models:
## reduced: duration ~ reprocondition + (1 | subject)
## full: duration ~ reprocondition + parity + (1 | subject)
##         npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    
## reduced    4 835.97 845.70 -413.99    827.97                         
## full       5 825.72 837.88 -407.86    815.72 12.251  1   0.000465 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(full, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on this result, including <strong>parity</strong> as well as <strong>reproductive condition</strong> as fixed effects also significantly improves the fit of our model.</p>
</section>
<section id="challenge-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-2">CHALLENGE</h3>
<p>Construct a model that includes an interaction of <strong>reproductive condition</strong> and <strong>parity</strong> and compare it to a model without the interaction term. Is the interaction of these two fixed effects significant?</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">*</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## Data: d
## Models:
## reduced: duration ~ reprocondition + parity + (1 | subject)
## full: duration ~ reprocondition * parity + (1 | subject)
##         npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)
## reduced    5 825.72 837.88 -407.86    815.72                     
## full       6 826.41 840.99 -407.20    814.41 1.3124  1      0.252</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(full, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this case, adding the interaction of <strong>reproductive condition</strong> and <strong>parity</strong> does not significantly improve the explanatory power of the model.</p>
</section>
</section>
<section id="random-slope-models" class="level2" data-number="24.5">
<h2 data-number="24.5" class="anchored" data-anchor-id="random-slope-models"><span class="header-section-number">24.5</span> Random Slope Models</h2>
<p>In the exercise above, we included only estimation of a separate INTERCEPT for each female and presumed that the same relationships (SLOPES) between grooming duration and reproductive condition + parity obtained for all females. But we can also allow that relationship to vary from subject to subject. We would indicate this model in formula notation as follows:</p>
<p><span class="math display">\[grooming\ duration \sim reproductive\ condition + parity\ +\]</span> <span class="math display">\[(1 + reproductive\ condition|subject) + (1 + parity|subject) + \epsilon\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Linear mixed model fit by maximum likelihood  ['lmerMod']
## Formula: duration ~ reprocondition + parity + (1 + reprocondition | subject) +  
##     (1 + parity | subject)
##    Data: d
## 
##       AIC       BIC    logLik -2*log(L)  df.resid 
##     833.6     857.9    -406.8     813.6        74 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.4514 -0.6093 -0.1559  0.3851  3.2152 
## 
## Random effects:
##  Groups    Name              Variance Std.Dev. Corr 
##  subject   (Intercept)        84.020   9.166        
##            reproconditionPOP   1.469   1.212   -1.00
##  subject.1 (Intercept)       628.419  25.068        
##            parityP           627.945  25.059   -1.00
##  Residual                    835.801  28.910        
## Number of obs: 84, groups:  subject, 6
## 
## Fixed effects:
##                   Estimate Std. Error t value
## (Intercept)        132.530     16.293   8.134
## reproconditionPOP   20.293      6.328   3.207
## parityP            110.272     17.258   6.390
## 
## Correlation of Fixed Effects:
##             (Intr) rprPOP
## rprcndtnPOP -0.211       
## parityP     -0.902  0.000
## optimizer (nloptwrap) convergence code: 0 (OK)
## boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
<p>Here, we have changed the random effects, which now look a little more complicated. The notation “(1 + reprocondition | subject)” tells the model to estimate differing baseline levels of grooming duration (the intercept, represented by 1) as well as differing responses to the main factor in question, which is reproductive condition in this case. We do the same for parity.</p>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: It is equivalent to use just “(reprocondition | subject)” rather than “(1 + reprocondition | subject)” to specify that we want our analysis to estimate both an intercept and slope coefficient for each subject. We use the latter to be explicit, though, as we could used “(0 + reprocondition | subject)” to return a single intercept but different slopes for each subject, which is sometimes referred to as a “fixed intercept” model.</p>
</blockquote>
<p>Looking at the coefficients of the new model, we see the effects. Each female now has a different intercept <strong>and</strong> a different coefficient for the slopes of grooming duration as a function of both reproductive condition and parity.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## $subject
##       (Intercept) reproconditionPOP   parityP
## Luna     144.8594          19.47768 110.25259
## Maya     137.6452          19.95465 110.26271
## Nina     113.0874          21.57830 110.30006
## Nipa     139.1961          19.85212  84.78083
## Sofia    125.3318          20.76876 140.06436
## Vita     135.0590          20.12564 105.97018
## 
## attr(,"class")
## [1] "coef.mer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">method =</span> <span class="st">"boot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##                           2.5 %    97.5 %
## .sig01             0.0000000000  19.66290
## .sig02            -1.0000000000   1.00000
## .sig03             0.0001650544  18.04298
## .sig04             0.0000000000  40.50267
## .sig05            -1.0000000000   0.00000
## .sig06             0.0003883994  40.41846
## .sigma            23.1246426566  32.62857
## (Intercept)       97.9868021375 165.80294
## reproconditionPOP  8.3643030584  32.85792
## parityP           78.2581517047 146.12287</code></pre>
</div>
</div>
<p>Finally, effects plots of how the expected amount of grooming received varies with the fixed effects (<strong>reprocondition</strong> and <strong>parity</strong>) under our new random slope model is the same as that under the random intercept model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(m, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">term =</span> <span class="st">"reprocondition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">term =</span> <span class="st">"parity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-23-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##      Group            Effect Variance    SD SD_2.5 SD_97.5 Var_prop
##    subject         Intercept    84.02  9.17   0.00    0.10     0.04
##    subject reproconditionPOP     1.47  1.21   0.00   15.20     0.00
##  subject.1         Intercept   628.42 25.07   0.00    0.10     0.29
##  subject.1           parityP   627.95 25.06   0.00  177.15     0.29
##   Residual                     835.80 28.91  24.90   34.12     0.38</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##               Term  Value    SE    t P_value Lower_2.5 Upper_97.5
##          Intercept 132.53 16.29 8.13    0.00    100.60     164.46
##  reproconditionPOP  20.29  6.33 3.21    0.00      7.89      32.70
##            parityP 110.27 17.26 6.39    0.00     76.45     144.10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixed_effects</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 3 × 7
##   term              value    se     t p_value lower_2.5 upper_97.5
##   &lt;chr&gt;             &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Intercept         133.  16.3   8.13   0        101.        164. 
## 2 reproconditionPOP  20.3  6.33  3.21   0.001      7.89       32.7
## 3 parityP           110.  17.3   6.39   0         76.4       144.</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: Here, running the functions <code>extract_random_coefficients()</code> and <code>extract_random_effect()</code> would throw an error because we would be generating two (Intercept) terms per random effect level, one for each of two predictors.</p>
</blockquote>
<section id="residual-analysis-1" class="level3" data-number="24.5.1">
<h3 data-number="24.5.1" class="anchored" data-anchor-id="residual-analysis-1"><span class="header-section-number">24.5.1</span> Residual Analysis</h3>
<p>Once again, we can use the {redres} package to do some visual residual analysis…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resqq</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_redres</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-25-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"subject"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-25-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: Here, running the functions <code>plot_ranef()</code> would throw an error because we would be generating two (Intercept) terms per random effect level, one for each of two predictors. If we wanted, we could run the <code>ranef()</code> function on the model, look at the <code>$subject</code> dataframe, and pull out the columns we wanted to plot against normal quantiles using <code>qqPlot()</code> or <code>qqnorm()</code>.</p>
</blockquote>
</section>
<section id="inference-using-lrts-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="inference-using-lrts-1">Inference using LRTs</h3>
<p>To then get p values associated with each of the fixed factors, we can use likelihood ratio tests…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects only</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>null <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co"># full model with both fixed effects</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    subject) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="co"># model without reproductive condition as a fixed effect</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>minusRC <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> parity <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    parity <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="co"># model without parity as a fixed effect</span></span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>minusP <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d, duration <span class="sc">~</span> reprocondition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject), <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a><span class="co"># p value for reproductive condition as a fixed effect</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(minusRC, full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Data: d
## Models:
## minusRC: duration ~ parity + (1 + reprocondition | subject) + (1 + parity | subject)
## full: duration ~ reprocondition + parity + (1 + reprocondition | subject) + (1 + parity | subject)
##         npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)   
## minusRC    9 840.23 862.11 -411.11    822.23                        
## full      10 833.63 857.94 -406.82    813.63 8.5963  1   0.003368 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># p value for parity as a fixed effect</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(minusP, full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Data: d
## Models:
## minusP: duration ~ reprocondition + (1 + reprocondition | subject) + (1 + parity | subject)
## full: duration ~ reprocondition + parity + (1 + reprocondition | subject) + (1 + parity | subject)
##        npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)   
## minusP    9 840.08 861.96 -411.04    822.08                        
## full     10 833.63 857.94 -406.82    813.63 8.4473  1   0.003656 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(full, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="inference-using-aic" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="inference-using-aic">Inference using AIC</h3>
<p>For a long time, the appropriateness of our mixed models was assessed as above - i.e., by evaluating the significance of each fixed effect using LRTs. As information theoretic approaches have become more popular, it is increasingly common to assess model fit by comparing the AIC values of different models, acknowledging the caveat that AIC can only tell us about the <em>relative</em> fit of alternative models, but not whether a particular model is a good fit, overall. Recall that AIC values are a way of inverting and scaling model log-likelihoods that penalizes models with greater numbers of parameters.</p>
<p>The <code>aictab()</code> function from {AICcmodavg} neatly prints out tables with AIC, Delta AIC, and log-likelihood values, along with AIC “weights”.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>(aic_table <span class="ot">&lt;-</span> <span class="fu">aictab</span>(<span class="fu">list</span>(full, minusRC, minusP, null), <span class="at">modnames =</span> <span class="fu">c</span>(<span class="st">"full"</span>, <span class="st">"minusRC"</span>,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"minusP"</span>, <span class="st">"null"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Model selection based on AICc:
## 
##          K   AICc Delta_AICc AICcWt Cum.Wt      LL
## full    10 836.65       0.00   0.91   0.91 -406.82
## minusP   9 842.51       5.87   0.05   0.95 -411.04
## minusRC  9 842.66       6.02   0.04   1.00 -411.11
## null     8 851.47      14.82   0.00   1.00 -416.77</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>AICcmodavg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> Here we are printing out AICc values, rather than AIC values. AICc is simply a version of AIC with a correction added for small sample sizes. To print the uncorrected AIC values, which appear in the <code>anova()</code> LRT output, we can add the argument “second.ord = TRUE” to the <code>aictab()</code> function.</p>
</blockquote>
<p><span class="math display">\[AIC_c = AIC + \frac{2K^2 + 2K}{n-K-1}\]</span></p>
<p>where <span class="math inline">\(K\)</span> is the number of parameters and <span class="math inline">\(n\)</span> is the sample size.</p>
<p>In the table, for each model, <span class="math inline">\(K\)</span> is the number of model parameters, the <span class="math inline">\(Delta\  AICc\)</span> value is the difference between that model’s AICc and the best model’s AICc (again, here, that is the full model), and the <span class="math inline">\(AICc\ weight\)</span> is the relative likelihood of that model. [The weights for a particular set of models sum to 1, with each weight equal to the model’s likelihood divided by the summed likelihoods across all models.]</p>
<p>Where the best model has a very high Akaike weight, e.g., &gt;0.9, it is reasonable to base inferences about the included variables on that single most parsimonious model, but when several models rank highly (e.g., several models have Delta AICc values &lt;2 to 4), it is common to model-average effect sizes for the variables that have the most support across that set of models. That is, “model averaging” means making inferences based on a <strong>set</strong> of candidate models, instead of on a single “best” model.</p>
<p>Here, note that the full model containing both <em>reproductive condition</em> and <em>parity</em> has the highest likelihood (the least negative log-likelihood value) and a much lower AICc than any of the less complex alternative models tested. It also has a very high Akaike weight (0.91).</p>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> When running a number of the above models and/or in doing the likelihood ratio tests, we saw a significant result but we also got either a warning that our null models “failed to converge” or we saw a warning about a “boundary (singular) fit”. Both of these warning are due to having a LOT of parameters we are trying to estimate relative to the number of observations we have. Dealing with lack of convergence in fitting maximum likelihood models is beyond what we can cover here, but I encourage you to explore that on your own!</p>
</blockquote>
</section>
<section id="other-methods-for-assessing-fit" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="other-methods-for-assessing-fit">Other Methods for Assessing Fit</h3>
<p>Using AIC values for evaluating and expressing how well a particular model fits a dataset has some critical limitations:</p>
<ul>
<li>While AIC provides an estimate of the <em>relative</em> fit of various models, it does not say anything about the absolute fit</li>
<li>AIC does not address the amount of variance in a response variable explained by a model</li>
<li>AIC is not comparable across datasets, and so fit is not generalizable</li>
</ul>
<p>Nakagawa &amp; Schielzeth (2013) and Nakagawa et al.&nbsp;(2017) have published a simple and effective method for calculating a type of <em>pseudo-</em><span class="math inline">\(R^2\)</span> (or coefficient of determination) value for generalized linear mixed models, and because linear mixed models are a specific type of GLMM, this method can be used with LMMs as well.</p>
<blockquote class="blockquote">
<p>See:</p>
<ul>
<li><p>Nakagawa, S., &amp; Schielzeth, H. (2013). A general and simple method for obtaining R2 from generalized linear mixed-effects models. <em>Methods in Ecology and Evolution</em>, 4, 133–142.</p></li>
<li><p>Nakagawa, S., Johnson, P. C. D., &amp; Schielzeth, H. (2017). The coefficient of determination R2 and intra-class correlation coefficient from generalized linear mixed-effects models revisited and expanded. <em>Journal of the Royal Society Interface</em>, 14, article 20170213.</p></li>
</ul>
</blockquote>
<p>In these papers, two measures are proposed for characterizing the amount of “variance explained” for mixed effects models:</p>
<ul>
<li><span class="math inline">\(Marginal\ R2GLMM(m)^2\)</span> is the amount of variance explained on the latent (or link) scale rather than the original scale. We can interpret this as a measure of the variance explained by only the fixed effects.</li>
<li><span class="math inline">\(Conditional\ R2GLMM(c)^2\)</span> is the amount of variance explained by both fixed and random effects, i.e., by the entire model.</li>
</ul>
<p>There is an easy way to calculate these two R2GLMM values in <strong><em>R</em></strong> using the <code>r.squaredGLMM()</code> function in the package {MuMIn}.</p>
</section>
<section id="challenge-3" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-3">CHALLENGE</h3>
<p>Compare the full, the two reduced, and the null mixed effects models from our random slope exercise using an information theoretic approach. Is the best model (full) the one that explains the greatest amount of variance in the dataset? In the full model, how much more of the total variance is explained by the random effects than by the fixed effects alone?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>aic_table  <span class="co"># re-print the AIC table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Model selection based on AICc:
## 
##          K   AICc Delta_AICc AICcWt Cum.Wt      LL
## full    10 836.65       0.00   0.91   0.91 -406.82
## minusP   9 842.51       5.87   0.05   0.95 -411.04
## minusRC  9 842.66       6.02   0.04   1.00 -411.11
## null     8 851.47      14.82   0.00   1.00 -416.77</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##            R2m       R2c
## [1,] 0.7221769 0.8102366</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(minusRC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##            R2m    R2c
## [1,] 0.6778132 0.7898</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(minusP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##             R2m       R2c
## [1,] 0.01443171 0.8841458</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##      R2m       R2c
## [1,]   0 0.8714428</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>MuMIn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="generalized-lmms" class="level2" data-number="24.6">
<h2 data-number="24.6" class="anchored" data-anchor-id="generalized-lmms"><span class="header-section-number">24.6</span> Generalized LMMs</h2>
<p>Just as we extended our standard linear modeling approach to include non-normally distributed response variables/error structures, so too can we extend our mixed effects modeling to such situations. This is referred to as <strong>generalized linear mixed modeling, or GLMM</strong>. There are several <strong><em>R</em></strong> packages we can use to do this under either a maximum likelihood (e.g., {lme4}, {glmmML}, the no-longer-maintained {glmmboot}) or Bayesian (e.g., {MCMCglmm}, {glmmTMB}, {brms}) framework. The methods for generating maximum likelihood and Bayesian parameter estimates under GLMMs are more complicated, but conceptually, the process is an extension of what we have talked about already. Below, we explore such a scenario.</p>
<section id="challenge-4" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-4">CHALLENGE</h3>
<p>Boden-Parry et al.&nbsp;(2020) studied the effect of food type and abundance on the begging and food sharing behavior of otters in captivity. Here, we work with the dataset provided in the article below and replicate one of their models.</p>
<ul>
<li>Bowden-Parry, M.; Postma, E.; and Boogert, N.J. (2020). Effects of food type and abundance on begging and sharing in Asian small-clawed otters (<em>Aonyx cinereus</em>). <em>PeerJ</em> 8: e10369.</li>
</ul>
<section id="step-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="step-1">Step 1</h4>
<ul>
<li>Read in the data set and look at the variables included.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/Bowden-ParryOtterdata.csv"</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 22
##   zoo   ID    fooddensity foodtype trialorder forcedclaim unsuccessfulforcedcl…¹
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;                  &lt;dbl&gt;
## 1 T     Feet  medium      trout             7           0                      0
## 2 T     Feet  a_low       trout             8           0                      0
## 3 T     Feet  high        trout             9           0                      0
## 4 T     Feet  medium      crab              1           0                      0
## 5 T     Feet  a_low       crab              2           0                      0
## 6 T     Feet  high        crab              3           0                      0
## # ℹ abbreviated name: ¹​unsuccessfulforcedclaim
## # ℹ 15 more variables: activebeg &lt;dbl&gt;, passivebeg &lt;dbl&gt;, totalbeg &lt;dbl&gt;,
## #   collectnear &lt;dbl&gt;, relaxedclaim &lt;dbl&gt;, foodgiving &lt;dbl&gt;,
## #   totalshareproonly &lt;dbl&gt;, attackfromowner &lt;dbl&gt;, trialduration &lt;dbl&gt;,
## #   agecategory &lt;chr&gt;, sex &lt;chr&gt;, begreceived &lt;dbl&gt;,
## #   ownersharebecauseharassed &lt;dbl&gt;, TotalSharebothharasspro &lt;dbl&gt;,
## #   sharingbybegonly &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="step-2" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="step-2">Step 2</h4>
<ul>
<li>Create a new random variable, <strong>trial</strong>, that joins together the variables <strong>zoo</strong> and <strong>trialorder</strong>. This will be used as a random effect.</li>
<li>Create a new random variable, <strong>obs</strong>, that is simply an observation number. This will also be used as a random effect.</li>
</ul>
<blockquote class="blockquote">
<p><strong>HINT:</strong> Check out the useful function <code>row_to_column_id()</code></p>
</blockquote>
<ul>
<li>Rename the variable <strong>TotalSharebothharasspro</strong> as <strong>Shared</strong>.</li>
<li>Rename the variable <strong>begreceived</strong> as <strong>BegRec</strong>.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">trial =</span> <span class="fu">paste0</span>(zoo, trialorder))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rowid_to_column</span>(d, <span class="at">var =</span> <span class="st">"obs"</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Shared =</span> TotalSharebothharasspro, <span class="at">BegRec =</span> begreceived)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="step-3" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="step-3">Step 3</h4>
<ul>
<li>Plot total food transferred (<strong>Shared</strong>) in relation to begging received (<strong>BegReceived</strong>).</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> BegRec, <span class="at">y =</span> Shared)) <span class="sc">+</span> <span class="fu">geom_jitter</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Begging Received (total number)"</span>) <span class="sc">+</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Food Transfers (total number)"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="24-module_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-4" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="step-4">Step 4</h4>
<ul>
<li>Does the amount of begging received influence sharing frequency?</li>
</ul>
<p>To test this, the researchers used a GLMM with Poisson error distribution to examine how the number of “food transfers” between otters (<strong>Shared</strong>) in trials was related to the total number of instances of “begging received” (<strong>BegRec</strong>) as a fixed effect.</p>
<p>We also need to consider that the response variable, <strong>Shared</strong>, is implicitly expressed as a <em>rate</em>, i.e., it represents a count of the number of events that occured in over a particular length of time (the variable, <strong>trial duration</strong>). This allows the observation time to vary among records in the dataset. Our regression model, then, needs to contain time on the right-hand side of the regression formula in some way to acknowledge that counts are in some way dependent on the time over which they are collected (i.e., counts are expected to only increase with time).</p>
<p>Additionally, recall that, in Poisson regression, given that our response variable is a <em>count</em> of events that occur within a given amount of time, what we are actually modeling as a function of our predictors is <em>log(count)</em>… so we need to include <em>log(time)</em> as what known as an <em>offset term</em> on the right-hand side of the formula. In <strong><em>R</em></strong>, we use the function <code>offset()</code> to indicate this in our regression formula. The offset term is, essentially, modeled an additional fixed effect though we will not generate a coefficient for it.</p>
<p><span class="math display">\[log(count) \sim offset(log(time))\ +\ ...\ other\ predictors\]</span> Finally, the researchers included three random effects in their model: otter ID, trial, and an observation-level random effect. The first of these appears in the author’s data frame, and latter two are our variables <strong>trial</strong> and <strong>obs</strong>.</p>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: To me, it makes little sense to include the third of these random effects as there is no variance associated with this term, but to replicate the researchers’ model, we include it.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(Shared <span class="sc">~</span> BegRec <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> trial) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> obs), <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: Shared ~ BegRec + offset(log(trialduration/60)) + (1 | ID) +  
##     (1 | trial) + (1 | obs)
##    Data: d
## 
##       AIC       BIC    logLik -2*log(L)  df.resid 
##     666.9     682.9    -328.5     656.9       175 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.34822 -0.80347 -0.04456  0.48868  2.15072 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  obs    (Intercept) 0.23311  0.4828  
##  ID     (Intercept) 0.06723  0.2593  
##  trial  (Intercept) 0.14429  0.3799  
## Number of obs: 180, groups:  obs, 180; ID, 20; trial, 18
## 
## Fixed effects:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -2.65525    0.14568 -18.226  &lt; 2e-16 ***
## BegRec       0.09057    0.02543   3.562 0.000368 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##        (Intr)
## BegRec -0.372</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(Shared <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> trial) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    obs), <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> log))</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1, m2, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## Data: d
## Models:
## m2: Shared ~ offset(log(trialduration/60)) + (1 | ID) + (1 | trial) + (1 | obs)
## m1: Shared ~ BegRec + offset(log(trialduration/60)) + (1 | ID) + (1 | trial) + (1 | obs)
##    npar    AIC    BIC  logLik -2*log(L)  Chisq Df Pr(&gt;Chisq)    
## m2    4 678.11 690.88 -335.05    670.11                         
## m1    5 666.91 682.88 -328.46    656.91 13.193  1   0.000281 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">lrtest</span>(m1, m2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## Likelihood ratio test
## 
## Model 1: Shared ~ BegRec + offset(log(trialduration/60)) + (1 | ID) + 
##     (1 | trial) + (1 | obs)
## Model 2: Shared ~ offset(log(trialduration/60)) + (1 | ID) + (1 | trial) + 
##     (1 | obs)
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   5 -328.46                         
## 2   4 -335.05 -1 13.193   0.000281 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</details>
</div>
</div>
<p>Looking at these results, we would conclude that the model with <strong>BegRec</strong> has a lower AIC, higher log likelihood, lower deviance than the model without <strong>BegRec</strong>, thus variance in the food sharing is associated with the amount of begging received. The coefficent for <strong>BegRec</strong> (~0.09) is positive, indicating that sharing increases with the amount of begging received.</p>
<p>Again, the {mixedup} package allows us to neatly extract summary information from mixed effects models.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Group    Effect Variance   SD Var_prop
##    obs Intercept     0.23 0.48     0.52
##     ID Intercept     0.07 0.26     0.15
##  trial Intercept     0.14 0.38     0.32</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##       Term Value   SE      Z P_value Lower_2.5 Upper_97.5
##  Intercept -2.66 0.15 -18.23    0.00     -2.94      -2.37
##     BegRec  0.09 0.03   3.56    0.00      0.04       0.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixed_effects</span>(m1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 7
##   term       value    se      z p_value lower_2.5 upper_97.5
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 Intercept -2.66  0.146 -18.2        0    -2.94       -2.37
## 2 BegRec     0.091 0.025   3.56       0     0.041       0.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_coefficients</span>(m1) <span class="sc">|&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 7
##   group_var effect    group value    se lower_2.5 upper_97.5
##   &lt;chr&gt;     &lt;chr&gt;     &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 obs       Intercept 1     -2.81 0.475     -3.74      -1.88
## 2 obs       Intercept 2     -2.80 0.475     -3.74      -1.87
## 3 obs       Intercept 3     -2.46 0.458     -3.35      -1.56
## 4 obs       Intercept 4     -2.90 0.461     -3.80      -1.99
## 5 obs       Intercept 5     -2.78 0.479     -3.72      -1.85
## 6 obs       Intercept 6     -2.77 0.482     -3.71      -1.82</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_effects</span>(m1) <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 7
##   group_var effect    group  value    se lower_2.5 upper_97.5
##   &lt;chr&gt;     &lt;chr&gt;     &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 obs       Intercept 1     -0.154 0.452    -1.04       0.732
## 2 obs       Intercept 2     -0.15  0.452    -1.04       0.736
## 3 obs       Intercept 3      0.198 0.434    -0.652      1.05 
## 4 obs       Intercept 4     -0.241 0.437    -1.10       0.616
## 5 obs       Intercept 5     -0.13  0.456    -1.02       0.763
## 6 obs       Intercept 6     -0.114 0.459    -1.01       0.785</code></pre>
</div>
</div>
<p>The <code>glmmTMB()</code> function from {glmmTMB} can also be used for mixed effects modeling and gives very similar results…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Shared <span class="sc">~</span> BegRec <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> trial) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> obs), <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## 
## Variance Components:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##  Group    Effect Variance   SD SD_2.5 SD_97.5 Var_prop
##     ID Intercept     0.07 0.26   0.11    0.61     0.15
##  trial Intercept     0.14 0.38   0.22    0.65     0.32
##    obs Intercept     0.23 0.48   0.32    0.74     0.52</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## 
## Fixed Effects:</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##       Term Value   SE      Z P_value Lower_2.5 Upper_97.5
##  Intercept -2.66 0.15 -18.23    0.00     -2.94      -2.37
##     BegRec  0.09 0.03   3.56    0.00      0.04       0.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(Shared <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> trial) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    obs), <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m3, m4, <span class="at">test =</span> <span class="st">"F"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Data: d
## Models:
## m4: Shared ~ offset(log(trialduration/60)) + (1 | ID) + (1 | trial) + , zi=~0, disp=~1
## m4:     (1 | obs), zi=~0, disp=~1
## m3: Shared ~ BegRec + offset(log(trialduration/60)) + (1 | ID) + , zi=~0, disp=~1
## m3:     (1 | trial) + (1 | obs), zi=~0, disp=~1
##    Df    AIC    BIC  logLik deviance  Chisq Chi Df Pr(&gt;Chisq)    
## m4  4 678.10 690.87 -335.05   670.10                             
## m3  5 666.91 682.88 -328.46   656.91 13.185      1  0.0002823 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Finally, the {MASS} package provides yet another function, <code>glmmPQL()</code>, that can be used for mixed effects modeling. The structure for specifying the model is different than we have used before, with a list of the random effects being presented as a separate argument from the model including the fixed effects. Note the absence of <strong>obs</strong> as a random effect in the model below… including it causes the model to fail to run due to singular convergence, i.e., the variance in that random effect variable is essentially zero.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(Shared <span class="sc">~</span> BegRec <span class="sc">+</span> <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)), <span class="at">random =</span> <span class="fu">list</span>(<span class="at">ID =</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">trial =</span> <span class="sc">~</span><span class="dv">1</span>), <span class="at">data =</span> d, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(m5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##     Group    Effect Variance   SD Var_prop
##        ID Intercept     0.00 0.00     0.00
##     trial Intercept     0.00 0.00     0.00
##  Residual        NA     2.08 1.44     1.00</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>##       Term Value   SE      Z P_value Lower_2.5 Upper_97.5
##  Intercept -2.51 0.09 -27.76    0.00     -2.69      -2.33
##     BegRec  0.08 0.02   4.83    0.00      0.05       0.11</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE</strong>: The coefficient values estimated by <code>glmmPQL()</code> are similar to, but not the same, as those estimated by <code>glmer()</code> and <code>glmmTMB()</code>.</p>
</blockquote>
<hr>
</section>
</section>
</section>
<section id="concept-review" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="concept-review">Concept Review</h2>
<ul>
<li>“Mixed” modeling extends general and generalized linear modeling to consider cases where we have additional “random” factors that are another source of possible variation in our response variable</li>
<li>The approach allows us to estimate either different intercepts or different slopes <em>and</em> intercepts for each level of the random factor</li>
<li>As in generalized linear modeling, likelihood ratio tests and information criteria approaches can be used to compare the explanatory power of different models</li>
<li>Though we do not address it in this class, regression modeling can be extended further to consider NONLINEAR relationships among predictor variables
<ul>
<li>The <strong><em>R</em></strong> packages {lme4} and {nlme} include functions for performing for “nonlinear mixed effects modeling”</li>
</ul></li>
</ul>
<p>The website <a href="https://m-clark.github.io/mixed-models-with-R/">Mixed Models with R</a> is great resource for information about mixed effects modeling.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./23-module.html" class="pagination-link  aria-label=" &lt;span="" linear="" models&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./99-maximum_likelihood.html" class="pagination-link" aria-label="Maximum Likelihood Estimation">
        <span class="nav-page-text">Maximum Likelihood Estimation</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb117" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Mixed Effects or Multilevel Modeling {#module-24}</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objectives</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In this module, we extend our discussion of regression modeling even further to include "mixed effects" or "multilevel" models.</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install and load these packages in ***R***: <span class="co">[</span><span class="ot">{lme4}</span><span class="co">](https://cran.r-project.org/web/packages/lme4/lme4.pdf)</span>,</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">{redres}</span><span class="co">](https://cran.r-project.org/web/packages/redres/redres.pdf)</span>,</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">{glmmTMB}</span><span class="co">](https://cran.r-project.org/web/packages/glmmTMB/glmmTMB.pdf)</span>, </span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">{sjPlot}</span><span class="co">](https://cran.r-project.org/web/packages/sjPlot/sjPlot.pdf)</span>,</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">{mixedup}</span><span class="co">](https://github.com/m-clark/mixedup/)</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load {tidyverse} and {effects}</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Be sure you have the packages {car}, {cowplot}, {lmtest}, and {MASS} installed</span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(redres)</span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sjPlot)</span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview of "Mixed" Models</span></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a>A final extension of linear regression modeling that we will talk about is so-called "multilevel" or "mixed effects" modeling. This is a very complex topic, and we will only scratch the surface!</span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a>In a (general or generalized) linear mixed model, we have a reponse variable, $Y$, and observations that fall into different factor categories each with some set of levels (e.g., "sex" with levels "male" and "female"), and we are interested in the effects of the various factors **and** factor levels on the response variable. Generically, if $\mu$ = a population mean response and $\mu_A$ = mean response for observations belonging to factor level A, then the effect of A is given by $\mu$ - $\mu_A$. We have already dealt with factors and factor levels in our linear regression models when we looked at categorical predictors (e.g., *sex*, *rank category*) in our discussions of ANOVA and ANCOVA.</span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>We can conceptualize these factor effects as being either *fixed* or *random*. *Fixed* factors are those that reflect all levels of interest in our study, while *random* effects are those that represent only a sample of the levels of interest. For example, if we include **sex** as a factor in a model with the factor levels "male" and "female", this (typically) will cover the entire gamut of levels of interest our study, thus we would consider **sex** a fixed factor. When we were doing ANOVA and ANCOVA analyses previously, we were implicitly looking at the effects of such fixed factors.</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a>However, if our observational data were to consist of repeated observations of the same sampling unit, e.g., measurements taken on the same set of individuals on different dates, **individual ID** would be considered a random factor because it is unlikely that we will have collected data from all possible "levels of interest", i.e., from all possible individual subjects. We have not yet dealt with such random factors as an additional source of variance in our modeling.</span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>So-called **mixed models**, then, are those that include BOTH fixed and random effects. Including random effects in addition to fixed effects in our models has several ramifications:</span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using random effects broadens the scope of inference. That is, we can use statistical methods to infer something about the population from which the levels of the random factor have been drawn.</span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using random effects naturally incorporates dependence in the model and helps us account for pseudoreplication in our dataset. Observations that share the same level of the random effects are explicitly modeled as being correlated. This makes mixed effect modeling very useful for dealing with time series data, spatially correlated data, or situations where we have repeated observations/measures from the same subjects or sampling unit.</span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using random factors often gives more accurate parameter estimates.</span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Incorporating random factors, however, does require the use of more sophisticated estimation and fitting methods.</span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a>Not surprisingly, there several different varieties of mixed modeling approaches, which are supported in a variety of different packages in ***R***:</span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Standard or general **Linear Mixed Models (LMM)**, analogous to standard or general linear regression - used when we are dealing with normally distributed variables and error structures.</span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Generalized Linear Mixed Models (GLMM)**, analogous to generalized linear regresseion - used when we are dealing with various other variable types and error structure (e.g., binary, proportion, or count data).</span>
<span id="cb117-52"><a href="#cb117-52" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Nonlinear Mixed Models (NLMM)**, analogous to nonlinear regression - used if we are dealing with situations where our response variable is best modeled by a nonlinear combination of predictor variables.</span>
<span id="cb117-53"><a href="#cb117-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-54"><a href="#cb117-54" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** We have not talked at all in this course about general or generalized NONLINEAR modeling, but it is worth knowing that such approaches are also possible. NONLINEAR modeling is where our regression equation is a **nonlinear** function of the model parameters.</span></span>
<span id="cb117-55"><a href="#cb117-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-56"><a href="#cb117-56" aria-hidden="true" tabindex="-1"></a>We will explore "mixed effects" modeling using an example based on this <span class="co">[</span><span class="ot">excellent tutorial</span><span class="co">](http://www.bodowinter.com/tutorial/bw_LME_tutorial2.pdf)</span>.</span>
<span id="cb117-57"><a href="#cb117-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-58"><a href="#cb117-58" aria-hidden="true" tabindex="-1"></a><span class="fu">### EXAMPLE: {.unnumbered}</span></span>
<span id="cb117-59"><a href="#cb117-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-60"><a href="#cb117-60" aria-hidden="true" tabindex="-1"></a>Suppose we have measured the amount of grooming received by female chimpanzees when they are either in their periovulatory period (i.e., the window of 2-3 days around the likely time of ovulation) or duing other portions of their reproductive cycle. We collected data on the **duration of grooming bouts received** and scored a female's **reproductive condition** at the time as a categorical factor with two levels: "POP" versus "NONPOP". On top of that, we also recorded data on female parity at the time of the grooming bout, i.e., whether the female had given birth previously (was "parous", or "P") or had not yet had an offspring (was "nulliparous", or "N").</span>
<span id="cb117-61"><a href="#cb117-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-62"><a href="#cb117-62" aria-hidden="true" tabindex="-1"></a>If we are interested in how reproductive condition and parity influence how much grooming a female receives, our simple regression model would look like this:</span>
<span id="cb117-63"><a href="#cb117-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-64"><a href="#cb117-64" aria-hidden="true" tabindex="-1"></a>$$grooming\ duration \sim reproductive\ condition + parity + \epsilon$$</span>
<span id="cb117-65"><a href="#cb117-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-66"><a href="#cb117-66" aria-hidden="true" tabindex="-1"></a>Also imagine that our study design was such that we took multiple observations per subject. That is, our data set includes records of multiple grooming bouts received by each subject. This situation violates the assumption of independence of observations that we make for standard linear regression: multiple responses/measures from the same subject cannot be regarded as independent from each other.</span>
<span id="cb117-67"><a href="#cb117-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-68"><a href="#cb117-68" aria-hidden="true" tabindex="-1"></a>Using a mixed effects model, we can deal with this situation by adding **subject ID** as a random effect in our model. Doing so allows us to address the nonindependence issue by estimating a different set of parameters for each level of the factor "subject". We can either estimate a different *intercept* for each subject (which would correspond to each female having a different "baseline" level of grooming received) or estimate a different *intercept* **and** *slope* (where individual subjects are presumed to differ both in the baseline level of grooming received and the strength of the relationship between grooming duration, on the one hand, and reproductive condition and parity, on the other). Our mixed effects model estimates these individual level parameters in addition to the main effects of each variable.</span>
<span id="cb117-69"><a href="#cb117-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-70"><a href="#cb117-70" aria-hidden="true" tabindex="-1"></a>This is why a "mixed effects" model is called a **mixed** model. The models that we have considered so far have been **fixed effects only** models and included only one or more "fixed" predictor variables and a general error term. We essentially divided the world into things that we somehow understand or that are systematic (the fixed effects, or the explanatory variables) and things that we could not control for or do not understand (the general error, or $\epsilon$). These fixed effects models did not examine possible structure *within* the error term.</span>
<span id="cb117-71"><a href="#cb117-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-72"><a href="#cb117-72" aria-hidden="true" tabindex="-1"></a>In a mixed model, by contrast, we add one or more random effects to our fixed effects that may explain a portion of the variance in our error term.</span>
<span id="cb117-73"><a href="#cb117-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-74"><a href="#cb117-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb117-75"><a href="#cb117-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-76"><a href="#cb117-76" aria-hidden="true" tabindex="-1"></a>Let's explore these idea using some actual data. First, load in the dataset "chimpgrooming.csv" and do some exploratory data analysis:</span>
<span id="cb117-77"><a href="#cb117-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-80"><a href="#cb117-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-81"><a href="#cb117-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-82"><a href="#cb117-82" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/chimpgrooming.csv"</span></span>
<span id="cb117-83"><a href="#cb117-83" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb117-84"><a href="#cb117-84" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb117-85"><a href="#cb117-85" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span>
<span id="cb117-86"><a href="#cb117-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-87"><a href="#cb117-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-88"><a href="#cb117-88" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot grooming received duration in relation to subject ID...</span>
<span id="cb117-89"><a href="#cb117-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-92"><a href="#cb117-92" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-93"><a href="#cb117-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-94"><a href="#cb117-94" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-95"><a href="#cb117-95" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-96"><a href="#cb117-96" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb117-97"><a href="#cb117-97" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> subject, <span class="at">y =</span> duration)) <span class="sc">+</span></span>
<span id="cb117-98"><a href="#cb117-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb117-99"><a href="#cb117-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb117-100"><a href="#cb117-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"subject"</span>) <span class="sc">+</span></span>
<span id="cb117-101"><a href="#cb117-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span>
<span id="cb117-102"><a href="#cb117-102" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-103"><a href="#cb117-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-104"><a href="#cb117-104" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot grooming received in relation to reproductive condition...</span>
<span id="cb117-105"><a href="#cb117-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-108"><a href="#cb117-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-109"><a href="#cb117-109" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-110"><a href="#cb117-110" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-111"><a href="#cb117-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-112"><a href="#cb117-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb117-113"><a href="#cb117-113" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> reprocondition, <span class="at">y =</span> duration)) <span class="sc">+</span></span>
<span id="cb117-114"><a href="#cb117-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb117-115"><a href="#cb117-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"reproductive condition"</span>) <span class="sc">+</span></span>
<span id="cb117-116"><a href="#cb117-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb117-117"><a href="#cb117-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span>
<span id="cb117-118"><a href="#cb117-118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-119"><a href="#cb117-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-120"><a href="#cb117-120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot grooming received in relation to reproductive condition *and* parity...</span>
<span id="cb117-121"><a href="#cb117-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-124"><a href="#cb117-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-125"><a href="#cb117-125" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-126"><a href="#cb117-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-127"><a href="#cb117-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-128"><a href="#cb117-128" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb117-129"><a href="#cb117-129" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb117-130"><a href="#cb117-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-131"><a href="#cb117-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> reprocondition, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(parity))) <span class="sc">+</span></span>
<span id="cb117-132"><a href="#cb117-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb117-133"><a href="#cb117-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"reproductive condition"</span>) <span class="sc">+</span></span>
<span id="cb117-134"><a href="#cb117-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"parity"</span>) <span class="sc">+</span></span>
<span id="cb117-135"><a href="#cb117-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span>
<span id="cb117-136"><a href="#cb117-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-137"><a href="#cb117-137" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-138"><a href="#cb117-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-139"><a href="#cb117-139" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb117-140"><a href="#cb117-140" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-141"><a href="#cb117-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> parity, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(reprocondition))) <span class="sc">+</span></span>
<span id="cb117-142"><a href="#cb117-142" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb117-143"><a href="#cb117-143" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"parity"</span>) <span class="sc">+</span></span>
<span id="cb117-144"><a href="#cb117-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"reprocondition"</span>) <span class="sc">+</span></span>
<span id="cb117-145"><a href="#cb117-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span>
<span id="cb117-146"><a href="#cb117-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-147"><a href="#cb117-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-148"><a href="#cb117-148" aria-hidden="true" tabindex="-1"></a>From these plots, we can see lots of <span class="co">[</span><span class="ot">a</span><span class="co">]</span> individual variation in how much grooming is received (some females seem to receive more than others, overall), <span class="co">[</span><span class="ot">b</span><span class="co">]</span> variation in response to reproductive condition (where grooming in the POP seems to be higher, overall), <span class="co">[</span><span class="ot">c</span><span class="co">]</span> limited variation due to parity, and <span class="co">[</span><span class="ot">d</span><span class="co">]</span> variation in response to this combination of fixed effects.</span>
<span id="cb117-149"><a href="#cb117-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-150"><a href="#cb117-150" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finally, plot grooming received into relation to both a fixed effect (reprocondition) and a random effect (subject)...</span>
<span id="cb117-151"><a href="#cb117-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-154"><a href="#cb117-154" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-155"><a href="#cb117-155" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-156"><a href="#cb117-156" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-157"><a href="#cb117-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-158"><a href="#cb117-158" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb117-159"><a href="#cb117-159" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb117-160"><a href="#cb117-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-161"><a href="#cb117-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> reprocondition, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(subject))) <span class="sc">+</span></span>
<span id="cb117-162"><a href="#cb117-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb117-163"><a href="#cb117-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"reproductive condition"</span>) <span class="sc">+</span></span>
<span id="cb117-164"><a href="#cb117-164" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"subject"</span>) <span class="sc">+</span></span>
<span id="cb117-165"><a href="#cb117-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span>
<span id="cb117-166"><a href="#cb117-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-167"><a href="#cb117-167" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-168"><a href="#cb117-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-169"><a href="#cb117-169" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb117-170"><a href="#cb117-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-171"><a href="#cb117-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> subject, <span class="at">y =</span> duration, <span class="at">fill =</span> <span class="fu">factor</span>(reprocondition))) <span class="sc">+</span></span>
<span id="cb117-172"><a href="#cb117-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb117-173"><a href="#cb117-173" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"subject"</span>) <span class="sc">+</span></span>
<span id="cb117-174"><a href="#cb117-174" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"reproductive condition"</span>) <span class="sc">+</span></span>
<span id="cb117-175"><a href="#cb117-175" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>)))</span>
<span id="cb117-176"><a href="#cb117-176" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-177"><a href="#cb117-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-178"><a href="#cb117-178" aria-hidden="true" tabindex="-1"></a>What patterns do you see? There is, again, lots of apparent variation, and some of it seems to be associated with female ID and/or reproductive condition.</span>
<span id="cb117-179"><a href="#cb117-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-180"><a href="#cb117-180" aria-hidden="true" tabindex="-1"></a><span class="fu">## Random Intercept Models</span></span>
<span id="cb117-181"><a href="#cb117-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-182"><a href="#cb117-182" aria-hidden="true" tabindex="-1"></a>We will now perform an initial mixed effects analysis where we look in more detail at how reproductive condition and parity (as fixed effects) affect grooming duration, where we include individual subject ID as a random effect.</span>
<span id="cb117-183"><a href="#cb117-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-184"><a href="#cb117-184" aria-hidden="true" tabindex="-1"></a>Here is a first mixed effects model that we will fit, using one extension of formula notation that is commonly used in ***R***:</span>
<span id="cb117-185"><a href="#cb117-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-186"><a href="#cb117-186" aria-hidden="true" tabindex="-1"></a>$$grooming\ duration \sim reproductive\ condition + parity + (1|subject) + \epsilon$$</span>
<span id="cb117-187"><a href="#cb117-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-188"><a href="#cb117-188" aria-hidden="true" tabindex="-1"></a>Here, the 1 refers to the fact that we want to estimate an *intercept* and the pipe operator("|") following the "1" signifies that we want to estimate a *different intercept for each subject*. Note that this generic formula still contains a general error term, $\epsilon$, to highlight that there will still be unexplained "error" variance after accounting for both fixed and random effects in the model.</span>
<span id="cb117-189"><a href="#cb117-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-190"><a href="#cb117-190" aria-hidden="true" tabindex="-1"></a>We can think of this formula as saying that we expect our dataset to include multiple observations of the response variable per subject, and these responses will depend, in part, on each subject's baseline level. This effectively accounts the nonindependence that stems from having multiple responses by the same subject.</span>
<span id="cb117-191"><a href="#cb117-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-192"><a href="#cb117-192" aria-hidden="true" tabindex="-1"></a>The {lme4} package in **R** is commonly used for mixed effects modeling, and the function <span class="in">`lmer()`</span> is the mixed model equivalent of the function <span class="in">`lm()`</span>. In the formula syntax for mixed effects models using the {lme4} package, fixed effects are included without parentheses while random effects are included in parentheses (the error, $\epsilon$, is understood and is not included explicitly).</span>
<span id="cb117-193"><a href="#cb117-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-194"><a href="#cb117-194" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** We could also use the package {nlme} for mixed effects modeling (which requires a slightly different formula syntax than that used here). That same package also allows us to do **nonlinear** mixed effects modeling, which we will not be talking about. It is important to note that {lme4} uses, by default, a slightly different parameter estimation algorithm than {nlme}. Unless otherwise specified, {lme4} uses "restricted maximum likelihood" (REML) rather than ordinary maximum likelihood estimation, which is what is used in {nlme}. In practice, these often give very similar results. We will see below that when we want to compare different models using {lme4}, we will need to tell {lme4} to use ordinary maximum likelihood.</span></span>
<span id="cb117-195"><a href="#cb117-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-196"><a href="#cb117-196" aria-hidden="true" tabindex="-1"></a>The code block below implements this first "mixed effects" model:</span>
<span id="cb117-197"><a href="#cb117-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-200"><a href="#cb117-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-201"><a href="#cb117-201" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-202"><a href="#cb117-202" aria-hidden="true" tabindex="-1"></a>          duration <span class="sc">~</span></span>
<span id="cb117-203"><a href="#cb117-203" aria-hidden="true" tabindex="-1"></a>            reprocondition <span class="sc">+</span></span>
<span id="cb117-204"><a href="#cb117-204" aria-hidden="true" tabindex="-1"></a>            parity <span class="sc">+</span></span>
<span id="cb117-205"><a href="#cb117-205" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">|</span> subject))</span>
<span id="cb117-206"><a href="#cb117-206" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb117-207"><a href="#cb117-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-208"><a href="#cb117-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-209"><a href="#cb117-209" aria-hidden="true" tabindex="-1"></a>Let's focus on the output for the random effects first. Have a look at the column **Std.Dev.**. The entry for *subject* shows us how much variability in grooming duration (apart from that explained by the fixed effects) is due to subject ID. The entry for *Residual* summarizes the remaining variability in grooming duration that is not due to *subject* or to our fixed effects. The latter is our $\epsilon$, the "random" deviations from the predicted values that are not due to either subject or our fixed effects.</span>
<span id="cb117-210"><a href="#cb117-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-211"><a href="#cb117-211" aria-hidden="true" tabindex="-1"></a>The fixed effects output mirrors the coefficient tables that we have seen previously in our linear models that have focused only on fixed effects. The coefficient "reproconditionPOP" is the $\beta$ coefficient for the categorical effect of reproductive condition. The positive sign for the coefficient means that grooming duration is GREATER by 20.293 units for POP than for NONPOP females. Then, there is a standard error associated with this slope, and a t value, which is simply the estimate divided by the standard error.</span>
<span id="cb117-212"><a href="#cb117-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-213"><a href="#cb117-213" aria-hidden="true" tabindex="-1"></a>The coefficient "parityP" is the $\beta$ coefficient for the categorical effect of parity. The grooming duration associated with being parous versus nulliparous is GREATER by 109.65 units.</span>
<span id="cb117-214"><a href="#cb117-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-215"><a href="#cb117-215" aria-hidden="true" tabindex="-1"></a>The INTERCEPT in this case is the grooming duration associated with being an average, nulliparous, NONPOP female. Like the <span class="in">`lm()`</span> function, the <span class="in">`lmer()`</span> took whatever factor level came first in the alphabet to be the reference level for each fixed effect variable.</span>
<span id="cb117-216"><a href="#cb117-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-217"><a href="#cb117-217" aria-hidden="true" tabindex="-1"></a>Let's also look at the coefficients coming out of the model and their confidence intervals.</span>
<span id="cb117-218"><a href="#cb117-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-221"><a href="#cb117-221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-222"><a href="#cb117-222" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(m)</span>
<span id="cb117-223"><a href="#cb117-223" aria-hidden="true" tabindex="-1"></a><span class="co"># or, for just the fixed effects...</span></span>
<span id="cb117-224"><a href="#cb117-224" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficients(summary(m))</span></span>
<span id="cb117-225"><a href="#cb117-225" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">method =</span> <span class="st">"boot"</span>)</span>
<span id="cb117-226"><a href="#cb117-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-227"><a href="#cb117-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-228"><a href="#cb117-228" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: For the </span><span class="in">`confint()`</span><span class="at"> function, we can set </span><span class="in">`method =`</span><span class="at"> argument to "boot" (to generate a CI based on bootstrapping), "profile" (to generate a CI based on likelihoods), or "Wald" (which generates a CI for the fixed effects only). Also, in the output from running </span><span class="in">`confint()`</span><span class="at">, ".sigXX" is the square root of the variance associated with each of the random parameter levels and ".sigma" is the square root of the variance associated with the residuals of the model.</span></span>
<span id="cb117-229"><a href="#cb117-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-230"><a href="#cb117-230" aria-hidden="true" tabindex="-1"></a>We can see the separate intercepts, i.e., the "baseline" level of grooming received, for each female when they are (presumably) nulliparous and in a NONPOP reproductive condition.</span>
<span id="cb117-231"><a href="#cb117-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-232"><a href="#cb117-232" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** Some females may not ever be seen both parity or reproductive conditions!</span></span>
<span id="cb117-233"><a href="#cb117-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-234"><a href="#cb117-234" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualizing Model Results</span></span>
<span id="cb117-235"><a href="#cb117-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-236"><a href="#cb117-236" aria-hidden="true" tabindex="-1"></a>As in earlier modules, we can use the <span class="in">`predictorEffects()`</span> function from the {effects} package to visualize our mixed model results in terms of how the response variable is expected to differ across levels of each predictor variable when the other predictor and the random effect of **subject** are controlled for.</span>
<span id="cb117-237"><a href="#cb117-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-240"><a href="#cb117-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-241"><a href="#cb117-241" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(m, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb117-242"><a href="#cb117-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-243"><a href="#cb117-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-244"><a href="#cb117-244" aria-hidden="true" tabindex="-1"></a>Similar effects plots for our predictors can be created using <span class="in">`plot_model()`</span> from the {sjPlot} package.</span>
<span id="cb117-245"><a href="#cb117-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-248"><a href="#cb117-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-249"><a href="#cb117-249" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"reprocondition"</span>))</span>
<span id="cb117-250"><a href="#cb117-250" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"parity"</span>))</span>
<span id="cb117-251"><a href="#cb117-251" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb117-252"><a href="#cb117-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-253"><a href="#cb117-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-254"><a href="#cb117-254" aria-hidden="true" tabindex="-1"></a>We can also use <span class="in">`plot_model()`</span> to visualize estimates and confidence intervals for the fixed effect coefficients and for the random effects.</span>
<span id="cb117-255"><a href="#cb117-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-258"><a href="#cb117-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-259"><a href="#cb117-259" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"est"</span>)</span>
<span id="cb117-260"><a href="#cb117-260" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"re"</span>)</span>
<span id="cb117-261"><a href="#cb117-261" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb117-262"><a href="#cb117-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-263"><a href="#cb117-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-264"><a href="#cb117-264" aria-hidden="true" tabindex="-1"></a>The package {mixedup}, installable from <span class="co">[</span><span class="ot">here</span><span class="co">](https://github.com/m-clark/mixedup/)</span>, is a useful package that provides several functions for extracting relevant summary information from mixed models.</span>
<span id="cb117-265"><a href="#cb117-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-268"><a href="#cb117-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-269"><a href="#cb117-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-270"><a href="#cb117-270" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(m) <span class="co"># clean model summary</span></span>
<span id="cb117-271"><a href="#cb117-271" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixed_effects</span>(m) <span class="co"># table of fixed effects coefficients</span></span>
<span id="cb117-272"><a href="#cb117-272" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_coefficients</span>(m) <span class="co"># table of coefficients for random effects</span></span>
<span id="cb117-273"><a href="#cb117-273" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_effects</span>(m) <span class="co"># table of coefficients for each level of random effect</span></span>
<span id="cb117-274"><a href="#cb117-274" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-275"><a href="#cb117-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-276"><a href="#cb117-276" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residual Analysis</span></span>
<span id="cb117-277"><a href="#cb117-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-278"><a href="#cb117-278" aria-hidden="true" tabindex="-1"></a>We can use functions from the {redres} package to conduct some analyses on the residuals resulting from a mixed effects model. The <span class="in">`plot_resqq()`</span> function creates a QQ plot of the overall residuals from the model. Ideally, these should fall along a line, and we can see that ours do not... </span>
<span id="cb117-279"><a href="#cb117-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-282"><a href="#cb117-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-283"><a href="#cb117-283" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resqq</span>(m)</span>
<span id="cb117-284"><a href="#cb117-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-285"><a href="#cb117-285" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-286"><a href="#cb117-286" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">compute_redres</span>(m))</span>
<span id="cb117-287"><a href="#cb117-287" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">compute_redres</span>(m))</span>
<span id="cb117-288"><a href="#cb117-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-289"><a href="#cb117-289" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-290"><a href="#cb117-290" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">qqPlot</span>(<span class="fu">compute_redres</span>(m), <span class="at">id =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-291"><a href="#cb117-291" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-292"><a href="#cb117-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-293"><a href="#cb117-293" aria-hidden="true" tabindex="-1"></a>... rather, the residuals from this model appear to deviate from a normal distribution, thus the appropriatess of using linear regression here is suspect!</span>
<span id="cb117-294"><a href="#cb117-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-295"><a href="#cb117-295" aria-hidden="true" tabindex="-1"></a>The <span class="in">`plot_redres()`</span> function plots the residuals with respect to fitted values of the response variable.</span>
<span id="cb117-296"><a href="#cb117-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-297"><a href="#cb117-297" aria-hidden="true" tabindex="-1"></a>We can also pass an "xvar =" argument to <span class="in">`plot_redres()`</span> to view our residuals by our different predictor variables, e.g., **reprocondition**, **parity**, or **subject**.</span>
<span id="cb117-298"><a href="#cb117-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-299"><a href="#cb117-299" aria-hidden="true" tabindex="-1"></a>The code below generates and prints all of these plots...</span>
<span id="cb117-300"><a href="#cb117-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-303"><a href="#cb117-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-304"><a href="#cb117-304" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m)</span>
<span id="cb117-305"><a href="#cb117-305" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"reprocondition"</span>)</span>
<span id="cb117-306"><a href="#cb117-306" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"parity"</span>)</span>
<span id="cb117-307"><a href="#cb117-307" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"subject"</span>)</span>
<span id="cb117-308"><a href="#cb117-308" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb117-309"><a href="#cb117-309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-310"><a href="#cb117-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-311"><a href="#cb117-311" aria-hidden="true" tabindex="-1"></a>In the plot of residuals by fitted values (upper left), the residuals should roughly form a horizonal belt around the zero line, with the points randomly scattered above and below 0. Such a pattern would be consistent with "homoskedasticity", or equal variance, in the error term across values of the predictor terms and the response. Here, things look pretty good (although perhaps the width of the "belt" of points looks like it may be wider at larger values of the fitted response).</span>
<span id="cb117-312"><a href="#cb117-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-313"><a href="#cb117-313" aria-hidden="true" tabindex="-1"></a>In the other plots, we are looking to see whether the scatter (variance) above and below the zero line is similar across levels of the predictor variables.</span>
<span id="cb117-314"><a href="#cb117-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-315"><a href="#cb117-315" aria-hidden="true" tabindex="-1"></a>Finally, we can use the <span class="in">`plot_ranef()`</span> function to plot estimate modal values for the random effects (i.e., in our model, for each **subject** conditioned on the fixed effects) against quantiles of the normal distribution. For linear regression to be appropriate, the random effects should not deviate from normal expectations.</span>
<span id="cb117-316"><a href="#cb117-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-319"><a href="#cb117-319" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-320"><a href="#cb117-320" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ranef</span>(m)</span>
<span id="cb117-321"><a href="#cb117-321" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-322"><a href="#cb117-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-323"><a href="#cb117-323" aria-hidden="true" tabindex="-1"></a>Alternatively, we can use the {sjPlot} function <span class="in">`plot_model()`</span> with the "type = " argument set to "diag" to produce a similar set of diagnostic plots.</span>
<span id="cb117-324"><a href="#cb117-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-327"><a href="#cb117-327" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-328"><a href="#cb117-328" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-329"><a href="#cb117-329" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb117-330"><a href="#cb117-330" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"diag"</span>)</span>
<span id="cb117-331"><a href="#cb117-331" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p[[<span class="dv">1</span>]], p[[<span class="dv">3</span>]], p[[<span class="dv">4</span>]], <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb117-332"><a href="#cb117-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-333"><a href="#cb117-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-334"><a href="#cb117-334" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inference using LRTs {.unnumbered}</span></span>
<span id="cb117-335"><a href="#cb117-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-336"><a href="#cb117-336" aria-hidden="true" tabindex="-1"></a>In mixed effects models, it is not as straightforward as it is for standard linear models to determine p values associated with either overall models or individual coefficients. However, using **likelihood ratio tests**, which we previously used for comparing among generalized linear models, is one common approach. Likelihood is the probability of seeing the data we have actually collected *given* a particular model. The logic of the likelihood ratio test is to compare the likelihood of two models with each other, i.e., a model that includes the factor that we are interested in versus a reduced, nested model with that factor excluded.</span>
<span id="cb117-337"><a href="#cb117-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-338"><a href="#cb117-338" aria-hidden="true" tabindex="-1"></a>So... if we are interested in the effect of **reproductive condition** on grooming duration, we could compare a more complex model...</span>
<span id="cb117-339"><a href="#cb117-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-340"><a href="#cb117-340" aria-hidden="true" tabindex="-1"></a>$$grooming\ duration \sim reproductive\ condition + parity + (1|subject) + \epsilon$$</span>
<span id="cb117-341"><a href="#cb117-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-342"><a href="#cb117-342" aria-hidden="true" tabindex="-1"></a>to a nested, less complex model...</span>
<span id="cb117-343"><a href="#cb117-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-344"><a href="#cb117-344" aria-hidden="true" tabindex="-1"></a>$$grooming\ duration \sim parity + (1|subject) + \epsilon$$</span>
<span id="cb117-345"><a href="#cb117-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-346"><a href="#cb117-346" aria-hidden="true" tabindex="-1"></a>In ***R***, we would do this as follows:</span>
<span id="cb117-347"><a href="#cb117-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-350"><a href="#cb117-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-351"><a href="#cb117-351" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-352"><a href="#cb117-352" aria-hidden="true" tabindex="-1"></a>             duration <span class="sc">~</span></span>
<span id="cb117-353"><a href="#cb117-353" aria-hidden="true" tabindex="-1"></a>               reprocondition <span class="sc">+</span></span>
<span id="cb117-354"><a href="#cb117-354" aria-hidden="true" tabindex="-1"></a>               parity <span class="sc">+</span></span>
<span id="cb117-355"><a href="#cb117-355" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span> <span class="sc">|</span> subject),</span>
<span id="cb117-356"><a href="#cb117-356" aria-hidden="true" tabindex="-1"></a>             <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-357"><a href="#cb117-357" aria-hidden="true" tabindex="-1"></a><span class="co"># note the additional `REML=` argument</span></span>
<span id="cb117-358"><a href="#cb117-358" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full)</span>
<span id="cb117-359"><a href="#cb117-359" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-360"><a href="#cb117-360" aria-hidden="true" tabindex="-1"></a>                duration <span class="sc">~</span></span>
<span id="cb117-361"><a href="#cb117-361" aria-hidden="true" tabindex="-1"></a>                  parity <span class="sc">+</span></span>
<span id="cb117-362"><a href="#cb117-362" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">|</span> subject),</span>
<span id="cb117-363"><a href="#cb117-363" aria-hidden="true" tabindex="-1"></a>                <span class="at">REML =</span> <span class="cn">FALSE</span>) </span>
<span id="cb117-364"><a href="#cb117-364" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(reduced)</span>
<span id="cb117-365"><a href="#cb117-365" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-366"><a href="#cb117-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-367"><a href="#cb117-367" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** Here, we added the argument "REML = FALSE" to the </span><span class="in">`lmer()`</span><span class="at"> function. This is necessary to do when we want to compare models using the likelihood ratio test. Basically, REML uses a different algorithm to determine likelihood values than ordinary likelihood, and, if we want to use these likelihoods to execute an LRT, we need to use ordinary likelihood. See </span><span class="co">[</span><span class="ot">this site</span><span class="co">](http://users.stat.umn.edu/~gary/classes/5303/handouts/REML.pdf)</span><span class="at"> for a more complete explanation of this issue.</span></span>
<span id="cb117-368"><a href="#cb117-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-369"><a href="#cb117-369" aria-hidden="true" tabindex="-1"></a>We then perform the likelihood ratio test using the <span class="in">`anova()`</span> function or the <span class="in">`lrtest()`</span> function from {lmtest}.</span>
<span id="cb117-370"><a href="#cb117-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-373"><a href="#cb117-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-374"><a href="#cb117-374" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-375"><a href="#cb117-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-376"><a href="#cb117-376" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, full)</span>
<span id="cb117-377"><a href="#cb117-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-378"><a href="#cb117-378" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-379"><a href="#cb117-379" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">lrtest</span>(reduced, full)</span>
<span id="cb117-380"><a href="#cb117-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-381"><a href="#cb117-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-382"><a href="#cb117-382" aria-hidden="true" tabindex="-1"></a>These results tell us that the model containing both **reproductive condition** and **parity** as *fixed* effects fits the data better than a model lacking **reproductive condition** and containing only **parity** as a *fixed* effect, while accounting for **subject** as a *random* effect.</span>
<span id="cb117-383"><a href="#cb117-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-384"><a href="#cb117-384" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb117-385"><a href="#cb117-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-386"><a href="#cb117-386" aria-hidden="true" tabindex="-1"></a>Now, compare a model containing **reproductive condition** and **parity** to one containing just **reproductive condition**.</span>
<span id="cb117-387"><a href="#cb117-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-390"><a href="#cb117-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-391"><a href="#cb117-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-392"><a href="#cb117-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-393"><a href="#cb117-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-394"><a href="#cb117-394" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-395"><a href="#cb117-395" aria-hidden="true" tabindex="-1"></a>             duration <span class="sc">~</span></span>
<span id="cb117-396"><a href="#cb117-396" aria-hidden="true" tabindex="-1"></a>               reprocondition <span class="sc">+</span></span>
<span id="cb117-397"><a href="#cb117-397" aria-hidden="true" tabindex="-1"></a>               parity <span class="sc">+</span></span>
<span id="cb117-398"><a href="#cb117-398" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span><span class="sc">|</span>subject),</span>
<span id="cb117-399"><a href="#cb117-399" aria-hidden="true" tabindex="-1"></a>             <span class="at">REML=</span><span class="cn">FALSE</span>)</span>
<span id="cb117-400"><a href="#cb117-400" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-401"><a href="#cb117-401" aria-hidden="true" tabindex="-1"></a>                duration <span class="sc">~</span> reprocondition <span class="sc">+</span></span>
<span id="cb117-402"><a href="#cb117-402" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span><span class="sc">|</span>subject),</span>
<span id="cb117-403"><a href="#cb117-403" aria-hidden="true" tabindex="-1"></a>                <span class="at">REML=</span><span class="cn">FALSE</span>)</span>
<span id="cb117-404"><a href="#cb117-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-405"><a href="#cb117-405" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, full)</span>
<span id="cb117-406"><a href="#cb117-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-407"><a href="#cb117-407" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(full, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb117-408"><a href="#cb117-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-409"><a href="#cb117-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-410"><a href="#cb117-410" aria-hidden="true" tabindex="-1"></a>Based on this result, including **parity** as well as **reproductive condition** as fixed effects also significantly improves the fit of our model.</span>
<span id="cb117-411"><a href="#cb117-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-412"><a href="#cb117-412" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb117-413"><a href="#cb117-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-414"><a href="#cb117-414" aria-hidden="true" tabindex="-1"></a>Construct a model that includes an interaction of **reproductive condition** and **parity** and compare it to a model without the interaction term. Is the interaction of these two fixed effects significant?</span>
<span id="cb117-415"><a href="#cb117-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-418"><a href="#cb117-418" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-419"><a href="#cb117-419" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-420"><a href="#cb117-420" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-421"><a href="#cb117-421" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-422"><a href="#cb117-422" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-423"><a href="#cb117-423" aria-hidden="true" tabindex="-1"></a>             duration <span class="sc">~</span></span>
<span id="cb117-424"><a href="#cb117-424" aria-hidden="true" tabindex="-1"></a>               reprocondition <span class="sc">*</span> parity <span class="sc">+</span></span>
<span id="cb117-425"><a href="#cb117-425" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span> <span class="sc">|</span> subject),</span>
<span id="cb117-426"><a href="#cb117-426" aria-hidden="true" tabindex="-1"></a>             <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-427"><a href="#cb117-427" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-428"><a href="#cb117-428" aria-hidden="true" tabindex="-1"></a>                duration <span class="sc">~</span></span>
<span id="cb117-429"><a href="#cb117-429" aria-hidden="true" tabindex="-1"></a>                  reprocondition <span class="sc">+</span></span>
<span id="cb117-430"><a href="#cb117-430" aria-hidden="true" tabindex="-1"></a>                  parity <span class="sc">+</span></span>
<span id="cb117-431"><a href="#cb117-431" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">|</span> subject),</span>
<span id="cb117-432"><a href="#cb117-432" aria-hidden="true" tabindex="-1"></a>                <span class="at">REML=</span><span class="cn">FALSE</span>)</span>
<span id="cb117-433"><a href="#cb117-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-434"><a href="#cb117-434" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, full)</span>
<span id="cb117-435"><a href="#cb117-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-436"><a href="#cb117-436" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(full, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb117-437"><a href="#cb117-437" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-438"><a href="#cb117-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-439"><a href="#cb117-439" aria-hidden="true" tabindex="-1"></a>In this case, adding the interaction of **reproductive condition** and **parity** does not significantly improve the explanatory power of the model.</span>
<span id="cb117-440"><a href="#cb117-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-441"><a href="#cb117-441" aria-hidden="true" tabindex="-1"></a><span class="fu">## Random Slope Models</span></span>
<span id="cb117-442"><a href="#cb117-442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-443"><a href="#cb117-443" aria-hidden="true" tabindex="-1"></a>In the exercise above, we included only estimation of a separate INTERCEPT for each female and presumed that the same relationships (SLOPES) between grooming duration and reproductive condition + parity obtained for all females. But we can also allow that relationship to vary from subject to subject. We would indicate this model in formula notation as follows:</span>
<span id="cb117-444"><a href="#cb117-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-445"><a href="#cb117-445" aria-hidden="true" tabindex="-1"></a>$$grooming\ duration \sim reproductive\ condition + parity\ +$$ $$(1 + reproductive\ condition|subject) + (1 + parity|subject) + \epsilon$$</span>
<span id="cb117-446"><a href="#cb117-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-449"><a href="#cb117-449" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-450"><a href="#cb117-450" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-451"><a href="#cb117-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-452"><a href="#cb117-452" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-453"><a href="#cb117-453" aria-hidden="true" tabindex="-1"></a>          duration <span class="sc">~</span></span>
<span id="cb117-454"><a href="#cb117-454" aria-hidden="true" tabindex="-1"></a>            reprocondition <span class="sc">+</span></span>
<span id="cb117-455"><a href="#cb117-455" aria-hidden="true" tabindex="-1"></a>            parity <span class="sc">+</span> </span>
<span id="cb117-456"><a href="#cb117-456" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb117-457"><a href="#cb117-457" aria-hidden="true" tabindex="-1"></a>            (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject),</span>
<span id="cb117-458"><a href="#cb117-458" aria-hidden="true" tabindex="-1"></a>          <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-459"><a href="#cb117-459" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb117-460"><a href="#cb117-460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-461"><a href="#cb117-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-462"><a href="#cb117-462" aria-hidden="true" tabindex="-1"></a>Here, we have changed the random effects, which now look a little more complicated. The notation "(1 + reprocondition | subject)" tells the model to estimate differing baseline levels of grooming duration (the intercept, represented by 1) as well as differing responses to the main factor in question, which is reproductive condition in this case. We do the same for parity.</span>
<span id="cb117-463"><a href="#cb117-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-464"><a href="#cb117-464" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: It is equivalent to use just "(reprocondition | subject)" rather than "(1 + reprocondition | subject)" to specify that we want our analysis to estimate both an intercept and slope coefficient for each subject. We use the latter to be explicit, though, as we could used "(0 + reprocondition | subject)" to return a single intercept but different slopes for each subject, which is sometimes referred to as a "fixed intercept" model.</span></span>
<span id="cb117-465"><a href="#cb117-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-466"><a href="#cb117-466" aria-hidden="true" tabindex="-1"></a>Looking at the coefficients of the new model, we see the effects. Each female now has a different intercept **and** a different coefficient for the slopes of grooming duration as a function of both reproductive condition and parity.</span>
<span id="cb117-467"><a href="#cb117-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-470"><a href="#cb117-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-471"><a href="#cb117-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-472"><a href="#cb117-472" aria-hidden="true" tabindex="-1"></a><span class="fu">coefficients</span>(m)</span>
<span id="cb117-473"><a href="#cb117-473" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(m, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">method =</span> <span class="st">"boot"</span>)</span>
<span id="cb117-474"><a href="#cb117-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-475"><a href="#cb117-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-476"><a href="#cb117-476" aria-hidden="true" tabindex="-1"></a>Finally, effects plots of how the expected amount of grooming received varies with the fixed effects (**reprocondition** and **parity**) under our new random slope model is the same as that under the random intercept model.</span>
<span id="cb117-477"><a href="#cb117-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-480"><a href="#cb117-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-481"><a href="#cb117-481" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(m, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb117-482"><a href="#cb117-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-483"><a href="#cb117-483" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-484"><a href="#cb117-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-485"><a href="#cb117-485" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">term =</span> <span class="st">"reprocondition"</span>)</span>
<span id="cb117-486"><a href="#cb117-486" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model</span>(m, <span class="at">type =</span> <span class="st">"eff"</span>, <span class="at">term =</span> <span class="st">"parity"</span>)</span>
<span id="cb117-487"><a href="#cb117-487" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-488"><a href="#cb117-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-491"><a href="#cb117-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-492"><a href="#cb117-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-493"><a href="#cb117-493" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(m)</span>
<span id="cb117-494"><a href="#cb117-494" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixed_effects</span>(m)</span>
<span id="cb117-495"><a href="#cb117-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-496"><a href="#cb117-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-497"><a href="#cb117-497" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: Here, running the functions </span><span class="in">`extract_random_coefficients()`</span><span class="at"> and </span><span class="in">`extract_random_effect()`</span><span class="at"> would throw an error because we would be generating two (Intercept) terms per random effect level, one for each of two predictors.</span></span>
<span id="cb117-498"><a href="#cb117-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-499"><a href="#cb117-499" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residual Analysis</span></span>
<span id="cb117-500"><a href="#cb117-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-501"><a href="#cb117-501" aria-hidden="true" tabindex="-1"></a>Once again, we can use the {redres} package to do some visual residual analysis...</span>
<span id="cb117-502"><a href="#cb117-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-505"><a href="#cb117-505" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-506"><a href="#cb117-506" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_resqq</span>(m)</span>
<span id="cb117-507"><a href="#cb117-507" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_redres</span>(m)</span>
<span id="cb117-508"><a href="#cb117-508" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_redres</span>(m, <span class="at">xvar =</span> <span class="st">"subject"</span>)</span>
<span id="cb117-509"><a href="#cb117-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-510"><a href="#cb117-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-511"><a href="#cb117-511" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: Here, running the functions </span><span class="in">`plot_ranef()`</span><span class="at"> would throw an error because we would be generating two (Intercept) terms per random effect level, one for each of two predictors. If we wanted, we could run the </span><span class="in">`ranef()`</span><span class="at"> function on the model, look at the </span><span class="in">`$subject`</span><span class="at"> dataframe, and pull out the columns we wanted to plot against normal quantiles using </span><span class="in">`qqPlot()`</span><span class="at"> or </span><span class="in">`qqnorm()`</span><span class="at">.</span></span>
<span id="cb117-512"><a href="#cb117-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-513"><a href="#cb117-513" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inference using LRTs {.unnumbered}</span></span>
<span id="cb117-514"><a href="#cb117-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-515"><a href="#cb117-515" aria-hidden="true" tabindex="-1"></a>To then get p values associated with each of the fixed factors, we can use likelihood ratio tests...</span>
<span id="cb117-516"><a href="#cb117-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-519"><a href="#cb117-519" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-520"><a href="#cb117-520" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-521"><a href="#cb117-521" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-522"><a href="#cb117-522" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects only</span></span>
<span id="cb117-523"><a href="#cb117-523" aria-hidden="true" tabindex="-1"></a>null <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-524"><a href="#cb117-524" aria-hidden="true" tabindex="-1"></a>             duration <span class="sc">~</span></span>
<span id="cb117-525"><a href="#cb117-525" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb117-526"><a href="#cb117-526" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject),</span>
<span id="cb117-527"><a href="#cb117-527" aria-hidden="true" tabindex="-1"></a>             <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-528"><a href="#cb117-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-529"><a href="#cb117-529" aria-hidden="true" tabindex="-1"></a><span class="co"># full model with both fixed effects</span></span>
<span id="cb117-530"><a href="#cb117-530" aria-hidden="true" tabindex="-1"></a>full <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-531"><a href="#cb117-531" aria-hidden="true" tabindex="-1"></a>             duration <span class="sc">~</span></span>
<span id="cb117-532"><a href="#cb117-532" aria-hidden="true" tabindex="-1"></a>               reprocondition <span class="sc">+</span></span>
<span id="cb117-533"><a href="#cb117-533" aria-hidden="true" tabindex="-1"></a>               parity <span class="sc">+</span></span>
<span id="cb117-534"><a href="#cb117-534" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb117-535"><a href="#cb117-535" aria-hidden="true" tabindex="-1"></a>               (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject),</span>
<span id="cb117-536"><a href="#cb117-536" aria-hidden="true" tabindex="-1"></a>             <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-537"><a href="#cb117-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-538"><a href="#cb117-538" aria-hidden="true" tabindex="-1"></a><span class="co"># model without reproductive condition as a fixed effect</span></span>
<span id="cb117-539"><a href="#cb117-539" aria-hidden="true" tabindex="-1"></a>minusRC <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-540"><a href="#cb117-540" aria-hidden="true" tabindex="-1"></a>                duration <span class="sc">~</span></span>
<span id="cb117-541"><a href="#cb117-541" aria-hidden="true" tabindex="-1"></a>                  parity <span class="sc">+</span></span>
<span id="cb117-542"><a href="#cb117-542" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb117-543"><a href="#cb117-543" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject),</span>
<span id="cb117-544"><a href="#cb117-544" aria-hidden="true" tabindex="-1"></a>                <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-545"><a href="#cb117-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-546"><a href="#cb117-546" aria-hidden="true" tabindex="-1"></a><span class="co"># model without parity as a fixed effect</span></span>
<span id="cb117-547"><a href="#cb117-547" aria-hidden="true" tabindex="-1"></a>minusP <span class="ot">&lt;-</span> <span class="fu">lmer</span>(<span class="at">data =</span> d,</span>
<span id="cb117-548"><a href="#cb117-548" aria-hidden="true" tabindex="-1"></a>               duration <span class="sc">~</span></span>
<span id="cb117-549"><a href="#cb117-549" aria-hidden="true" tabindex="-1"></a>                 reprocondition <span class="sc">+</span></span>
<span id="cb117-550"><a href="#cb117-550" aria-hidden="true" tabindex="-1"></a>                 (<span class="dv">1</span> <span class="sc">+</span> reprocondition <span class="sc">|</span> subject) <span class="sc">+</span></span>
<span id="cb117-551"><a href="#cb117-551" aria-hidden="true" tabindex="-1"></a>                 (<span class="dv">1</span> <span class="sc">+</span> parity <span class="sc">|</span> subject),</span>
<span id="cb117-552"><a href="#cb117-552" aria-hidden="true" tabindex="-1"></a>               <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-553"><a href="#cb117-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-554"><a href="#cb117-554" aria-hidden="true" tabindex="-1"></a><span class="co"># p value for reproductive condition as a fixed effect</span></span>
<span id="cb117-555"><a href="#cb117-555" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(minusRC, full)</span>
<span id="cb117-556"><a href="#cb117-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-557"><a href="#cb117-557" aria-hidden="true" tabindex="-1"></a><span class="co"># p value for parity as a fixed effect</span></span>
<span id="cb117-558"><a href="#cb117-558" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(minusP, full)</span>
<span id="cb117-559"><a href="#cb117-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-560"><a href="#cb117-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-563"><a href="#cb117-563" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-564"><a href="#cb117-564" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(full, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb117-565"><a href="#cb117-565" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-566"><a href="#cb117-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-567"><a href="#cb117-567" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inference using AIC {.unnumbered}</span></span>
<span id="cb117-568"><a href="#cb117-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-569"><a href="#cb117-569" aria-hidden="true" tabindex="-1"></a>For a long time, the appropriateness of our mixed models was assessed as above - i.e., by evaluating the significance of each fixed effect using LRTs. As information theoretic approaches have become more popular, it is increasingly common to assess model fit by comparing the AIC values of different models, acknowledging the caveat that AIC can only tell us about the *relative* fit of alternative models, but not whether a particular model is a good fit, overall. Recall that AIC values are a way of inverting and scaling model log-likelihoods that penalizes models with greater numbers of parameters.</span>
<span id="cb117-570"><a href="#cb117-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-571"><a href="#cb117-571" aria-hidden="true" tabindex="-1"></a>The <span class="in">`aictab()`</span> function from {AICcmodavg} neatly prints out tables with AIC, Delta AIC, and log-likelihood values, along with AIC "weights".</span>
<span id="cb117-572"><a href="#cb117-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-575"><a href="#cb117-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-576"><a href="#cb117-576" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-577"><a href="#cb117-577" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-578"><a href="#cb117-578" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AICcmodavg)</span>
<span id="cb117-579"><a href="#cb117-579" aria-hidden="true" tabindex="-1"></a>(aic_table <span class="ot">&lt;-</span> <span class="fu">aictab</span>( <span class="fu">list</span>(full, minusRC, minusP, null),</span>
<span id="cb117-580"><a href="#cb117-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">modnames =</span> <span class="fu">c</span>(<span class="st">"full"</span>, <span class="st">"minusRC"</span>, <span class="st">"minusP"</span>, <span class="st">"null"</span>)))</span>
<span id="cb117-581"><a href="#cb117-581" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>AICcmodavg)</span>
<span id="cb117-582"><a href="#cb117-582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-583"><a href="#cb117-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-584"><a href="#cb117-584" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** Here we are printing out AICc values, rather than AIC values. AICc is simply a version of AIC with a correction added for small sample sizes. To print the uncorrected AIC values, which appear in the </span><span class="in">`anova()`</span><span class="at"> LRT output, we can add the argument "second.ord = TRUE" to the </span><span class="in">`aictab()`</span><span class="at"> function.</span></span>
<span id="cb117-585"><a href="#cb117-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-586"><a href="#cb117-586" aria-hidden="true" tabindex="-1"></a>$$AIC_c = AIC + \frac{2K^2 + 2K}{n-K-1}$$</span>
<span id="cb117-587"><a href="#cb117-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-588"><a href="#cb117-588" aria-hidden="true" tabindex="-1"></a>where $K$ is the number of parameters and $n$ is the sample size.</span>
<span id="cb117-589"><a href="#cb117-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-590"><a href="#cb117-590" aria-hidden="true" tabindex="-1"></a>In the table, for each model, $K$ is the number of model parameters, the $Delta\  AICc$ value is the difference between that model's AICc and the best model's AICc (again, here, that is the full model), and the $AICc\ weight$ is the relative likelihood of that model. <span class="co">[</span><span class="ot">The weights for a particular set of models sum to 1, with each weight equal to the model's likelihood divided by the summed likelihoods across all models.</span><span class="co">]</span></span>
<span id="cb117-591"><a href="#cb117-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-592"><a href="#cb117-592" aria-hidden="true" tabindex="-1"></a>Where the best model has a very high Akaike weight, e.g., &gt;0.9, it is reasonable to base inferences about the included variables on that single most parsimonious model, but when several models rank highly (e.g., several models have Delta AICc values &lt;2 to 4), it is common to model-average effect sizes for the variables that have the most support across that set of models. That is, "model averaging" means making inferences based on a **set** of candidate models, instead of on a single "best" model.</span>
<span id="cb117-593"><a href="#cb117-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-594"><a href="#cb117-594" aria-hidden="true" tabindex="-1"></a>Here, note that the full model containing both *reproductive condition* and *parity* has the highest likelihood (the least negative log-likelihood value) and a much lower AICc than any of the less complex alternative models tested. It also has a very high Akaike weight (0.91).</span>
<span id="cb117-595"><a href="#cb117-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-596"><a href="#cb117-596" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** When running a number of the above models and/or in doing the likelihood ratio tests, we saw a significant result but we also got either a warning that our null models "failed to converge" or we saw a warning about a "boundary (singular) fit". Both of these warning are due to having a LOT of parameters we are trying to estimate relative to the number of observations we have. Dealing with lack of convergence in fitting maximum likelihood models is beyond what we can cover here, but I encourage you to explore that on your own!</span></span>
<span id="cb117-597"><a href="#cb117-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-598"><a href="#cb117-598" aria-hidden="true" tabindex="-1"></a><span class="fu">### Other Methods for Assessing Fit {.unnumbered}</span></span>
<span id="cb117-599"><a href="#cb117-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-600"><a href="#cb117-600" aria-hidden="true" tabindex="-1"></a>Using AIC values for evaluating and expressing how well a particular model fits a dataset has some critical limitations:</span>
<span id="cb117-601"><a href="#cb117-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-602"><a href="#cb117-602" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>While AIC provides an estimate of the *relative* fit of various models, it does not say anything about the absolute fit</span>
<span id="cb117-603"><a href="#cb117-603" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>AIC does not address the amount of variance in a response variable explained by a model</span>
<span id="cb117-604"><a href="#cb117-604" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>AIC is not comparable across datasets, and so fit is not generalizable</span>
<span id="cb117-605"><a href="#cb117-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-606"><a href="#cb117-606" aria-hidden="true" tabindex="-1"></a>Nakagawa &amp; Schielzeth (2013) and Nakagawa et al. (2017) have published a simple and effective method for calculating a type of *pseudo-*$R^2$ (or coefficient of determination) value for generalized linear mixed models, and because linear mixed models are a specific type of GLMM, this method can be used with LMMs as well.</span>
<span id="cb117-607"><a href="#cb117-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-608"><a href="#cb117-608" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; See:</span></span>
<span id="cb117-609"><a href="#cb117-609" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb117-610"><a href="#cb117-610" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - Nakagawa, S., &amp; Schielzeth, H. (2013). A general and simple method for obtaining R2 from generalized linear mixed-effects models. *Methods in Ecology and Evolution*, 4, 133--142.</span></span>
<span id="cb117-611"><a href="#cb117-611" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb117-612"><a href="#cb117-612" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - Nakagawa, S., Johnson, P. C. D., &amp; Schielzeth, H. (2017). The coefficient of determination R2 and intra-class correlation coefficient from generalized linear mixed-effects models revisited and expanded. *Journal of the Royal Society Interface*, 14, article 20170213.</span></span>
<span id="cb117-613"><a href="#cb117-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-614"><a href="#cb117-614" aria-hidden="true" tabindex="-1"></a>In these papers, two measures are proposed for characterizing the amount of "variance explained" for mixed effects models:</span>
<span id="cb117-615"><a href="#cb117-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-616"><a href="#cb117-616" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Marginal\ R2GLMM(m)^2$ is the amount of variance explained on the latent (or link) scale rather than the original scale. We can interpret this as a measure of the variance explained by only the fixed effects.</span>
<span id="cb117-617"><a href="#cb117-617" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Conditional\ R2GLMM(c)^2$ is the amount of variance explained by both fixed and random effects, i.e., by the entire model.</span>
<span id="cb117-618"><a href="#cb117-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-619"><a href="#cb117-619" aria-hidden="true" tabindex="-1"></a>There is an easy way to calculate these two R2GLMM values in ***R*** using the <span class="in">`r.squaredGLMM()`</span> function in the package {MuMIn}.</span>
<span id="cb117-620"><a href="#cb117-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-621"><a href="#cb117-621" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb117-622"><a href="#cb117-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-623"><a href="#cb117-623" aria-hidden="true" tabindex="-1"></a>Compare the full, the two reduced, and the null mixed effects models from our random slope exercise using an information theoretic approach. Is the best model (full) the one that explains the greatest amount of variance in the dataset? In the full model, how much more of the total variance is explained by the random effects than by the fixed effects alone?</span>
<span id="cb117-624"><a href="#cb117-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-627"><a href="#cb117-627" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-628"><a href="#cb117-628" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-629"><a href="#cb117-629" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-630"><a href="#cb117-630" aria-hidden="true" tabindex="-1"></a>aic_table <span class="co"># re-print the AIC table</span></span>
<span id="cb117-631"><a href="#cb117-631" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MuMIn)</span>
<span id="cb117-632"><a href="#cb117-632" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(full)</span>
<span id="cb117-633"><a href="#cb117-633" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(minusRC)</span>
<span id="cb117-634"><a href="#cb117-634" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(minusP)</span>
<span id="cb117-635"><a href="#cb117-635" aria-hidden="true" tabindex="-1"></a><span class="fu">r.squaredGLMM</span>(null)</span>
<span id="cb117-636"><a href="#cb117-636" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>MuMIn)</span>
<span id="cb117-637"><a href="#cb117-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-638"><a href="#cb117-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-639"><a href="#cb117-639" aria-hidden="true" tabindex="-1"></a><span class="fu">## Generalized LMMs</span></span>
<span id="cb117-640"><a href="#cb117-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-641"><a href="#cb117-641" aria-hidden="true" tabindex="-1"></a>Just as we extended our standard linear modeling approach to include non-normally distributed response variables/error structures, so too can we extend our mixed effects modeling to such situations. This is referred to as **generalized linear mixed modeling, or GLMM**. There are several ***R*** packages we can use to do this under either a maximum likelihood (e.g., {lme4}, {glmmML}, the no-longer-maintained {glmmboot}) or Bayesian (e.g., {MCMCglmm}, {glmmTMB}, {brms}) framework. The methods for generating maximum likelihood and Bayesian parameter estimates under GLMMs are more complicated, but conceptually, the process is an extension of what we have talked about already. Below, we explore such a scenario.</span>
<span id="cb117-642"><a href="#cb117-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-643"><a href="#cb117-643" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb117-644"><a href="#cb117-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-645"><a href="#cb117-645" aria-hidden="true" tabindex="-1"></a>Boden-Parry et al. (2020) studied the effect of food type and abundance on the begging and food sharing behavior of otters in captivity. Here, we work with the dataset provided in the article below and replicate one of their models.</span>
<span id="cb117-646"><a href="#cb117-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-647"><a href="#cb117-647" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Bowden-Parry, M.; Postma, E.; and Boogert, N.J. (2020). Effects of food type and abundance on begging and sharing in Asian small-clawed otters (*Aonyx cinereus*). *PeerJ* 8: e10369.</span>
<span id="cb117-648"><a href="#cb117-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-649"><a href="#cb117-649" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 1  {.unnumbered}</span></span>
<span id="cb117-650"><a href="#cb117-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-651"><a href="#cb117-651" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Read in the data set and look at the variables included.</span>
<span id="cb117-652"><a href="#cb117-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-655"><a href="#cb117-655" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-656"><a href="#cb117-656" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-657"><a href="#cb117-657" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/Bowden-ParryOtterdata.csv"</span></span>
<span id="cb117-658"><a href="#cb117-658" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb117-659"><a href="#cb117-659" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb117-660"><a href="#cb117-660" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-661"><a href="#cb117-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-662"><a href="#cb117-662" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 2 {.unnumbered}</span></span>
<span id="cb117-663"><a href="#cb117-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-664"><a href="#cb117-664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a new random variable, **trial**, that joins together the variables **zoo** and **trialorder**. This will be used as a random effect.</span>
<span id="cb117-665"><a href="#cb117-665" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Create a new random variable, **obs**, that is simply an observation number. This will also be used as a random effect.</span>
<span id="cb117-666"><a href="#cb117-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-667"><a href="#cb117-667" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **HINT:** Check out the useful function </span><span class="in">`row_to_column_id()`</span></span>
<span id="cb117-668"><a href="#cb117-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-669"><a href="#cb117-669" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rename the variable **TotalSharebothharasspro** as **Shared**.</span>
<span id="cb117-670"><a href="#cb117-670" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Rename the variable **begreceived** as **BegRec**.</span>
<span id="cb117-671"><a href="#cb117-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-674"><a href="#cb117-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-675"><a href="#cb117-675" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-676"><a href="#cb117-676" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-677"><a href="#cb117-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-678"><a href="#cb117-678" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb117-679"><a href="#cb117-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">trial =</span> <span class="fu">paste0</span>(zoo, trialorder))</span>
<span id="cb117-680"><a href="#cb117-680" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">rowid_to_column</span>(d, <span class="at">var =</span> <span class="st">"obs"</span>)</span>
<span id="cb117-681"><a href="#cb117-681" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb117-682"><a href="#cb117-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Shared =</span> TotalSharebothharasspro,</span>
<span id="cb117-683"><a href="#cb117-683" aria-hidden="true" tabindex="-1"></a>         <span class="at">BegRec =</span> begreceived)</span>
<span id="cb117-684"><a href="#cb117-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-685"><a href="#cb117-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-686"><a href="#cb117-686" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 3 {.unnumbered}</span></span>
<span id="cb117-687"><a href="#cb117-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-688"><a href="#cb117-688" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Plot total food transferred (**Shared**) in relation to begging received (**BegReceived**).</span>
<span id="cb117-689"><a href="#cb117-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-692"><a href="#cb117-692" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-693"><a href="#cb117-693" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-694"><a href="#cb117-694" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-695"><a href="#cb117-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-696"><a href="#cb117-696" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(<span class="at">x =</span> BegRec, <span class="at">y =</span> Shared)) <span class="sc">+</span></span>
<span id="cb117-697"><a href="#cb117-697" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>() <span class="sc">+</span></span>
<span id="cb117-698"><a href="#cb117-698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Begging Received (total number)"</span>) <span class="sc">+</span></span>
<span id="cb117-699"><a href="#cb117-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Food Transfers (total number)"</span>)<span class="sc">+</span></span>
<span id="cb117-700"><a href="#cb117-700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb117-701"><a href="#cb117-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-702"><a href="#cb117-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-703"><a href="#cb117-703" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Step 4 {.unnumbered}</span></span>
<span id="cb117-704"><a href="#cb117-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-705"><a href="#cb117-705" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Does the amount of begging received influence sharing frequency?</span>
<span id="cb117-706"><a href="#cb117-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-707"><a href="#cb117-707" aria-hidden="true" tabindex="-1"></a>To test this, the researchers used a GLMM with Poisson error distribution to examine how the number of "food transfers" between otters (**Shared**) in trials was related to the total number of instances of "begging received" (**BegRec**) as a fixed effect.</span>
<span id="cb117-708"><a href="#cb117-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-709"><a href="#cb117-709" aria-hidden="true" tabindex="-1"></a>We also need to consider that the response variable, **Shared**, is implicitly expressed as a *rate*, i.e., it represents a count of the number of events that occured in over a particular length of time (the variable, **trial duration**). This allows the observation time to vary among records in the dataset. Our regression model, then, needs to contain time on the right-hand side of the regression formula in some way to acknowledge that counts are in some way dependent on the time over which they are collected (i.e., counts are expected to only increase with time).</span>
<span id="cb117-710"><a href="#cb117-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-711"><a href="#cb117-711" aria-hidden="true" tabindex="-1"></a>Additionally, recall that, in Poisson regression, given that our response variable is a *count* of events that occur within a given amount of time, what we are actually modeling as a function of our predictors is *log(count)*... so we need to include *log(time)* as what known as an *offset term* on the right-hand side of the formula. In ***R***, we use the function <span class="in">`offset()`</span> to indicate this in our regression formula. The offset term is, essentially, modeled an additional fixed effect though we will not generate a coefficient for it.</span>
<span id="cb117-712"><a href="#cb117-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-713"><a href="#cb117-713" aria-hidden="true" tabindex="-1"></a>$$log(count) \sim offset(log(time))\ +\ ...\ other\ predictors$$</span>
<span id="cb117-714"><a href="#cb117-714" aria-hidden="true" tabindex="-1"></a>Finally, the researchers included three random effects in their model: otter ID, trial, and an observation-level random effect. The first of these appears in the author's data frame, and latter two are our variables **trial** and **obs**.</span>
<span id="cb117-715"><a href="#cb117-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-716"><a href="#cb117-716" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: To me, it makes little sense to include the third of these random effects as there is no variance associated with this term, but to replicate the researchers' model, we include it.</span></span>
<span id="cb117-717"><a href="#cb117-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-720"><a href="#cb117-720" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-721"><a href="#cb117-721" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb117-722"><a href="#cb117-722" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb117-723"><a href="#cb117-723" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb117-724"><a href="#cb117-724" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb117-725"><a href="#cb117-725" aria-hidden="true" tabindex="-1"></a>  Shared <span class="sc">~</span></span>
<span id="cb117-726"><a href="#cb117-726" aria-hidden="true" tabindex="-1"></a>    BegRec <span class="sc">+</span></span>
<span id="cb117-727"><a href="#cb117-727" aria-hidden="true" tabindex="-1"></a>    <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb117-728"><a href="#cb117-728" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>ID) <span class="sc">+</span></span>
<span id="cb117-729"><a href="#cb117-729" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>trial) <span class="sc">+</span></span>
<span id="cb117-730"><a href="#cb117-730" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>obs),</span>
<span id="cb117-731"><a href="#cb117-731" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-732"><a href="#cb117-732" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb117-733"><a href="#cb117-733" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span>
<span id="cb117-734"><a href="#cb117-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-735"><a href="#cb117-735" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">glmer</span>(</span>
<span id="cb117-736"><a href="#cb117-736" aria-hidden="true" tabindex="-1"></a>  Shared <span class="sc">~</span></span>
<span id="cb117-737"><a href="#cb117-737" aria-hidden="true" tabindex="-1"></a>    <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb117-738"><a href="#cb117-738" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>ID) <span class="sc">+</span></span>
<span id="cb117-739"><a href="#cb117-739" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>trial) <span class="sc">+</span></span>
<span id="cb117-740"><a href="#cb117-740" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>obs),</span>
<span id="cb117-741"><a href="#cb117-741" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-742"><a href="#cb117-742" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> log))</span>
<span id="cb117-743"><a href="#cb117-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-744"><a href="#cb117-744" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m1, m2, <span class="at">test =</span> <span class="st">"F"</span>)</span>
<span id="cb117-745"><a href="#cb117-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-746"><a href="#cb117-746" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb117-747"><a href="#cb117-747" aria-hidden="true" tabindex="-1"></a>lmtest<span class="sc">::</span><span class="fu">lrtest</span>(m1, m2)</span>
<span id="cb117-748"><a href="#cb117-748" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-749"><a href="#cb117-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-750"><a href="#cb117-750" aria-hidden="true" tabindex="-1"></a>Looking at these results, we would conclude that the model with **BegRec** has a lower AIC, higher log likelihood, lower deviance than the model without **BegRec**, thus variance in the food sharing is associated with the amount of begging received. The coefficent for **BegRec** (~0.09) is positive, indicating that sharing increases with the amount of begging received.</span>
<span id="cb117-751"><a href="#cb117-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-752"><a href="#cb117-752" aria-hidden="true" tabindex="-1"></a>Again, the {mixedup} package allows us to neatly extract summary information from mixed effects models.</span>
<span id="cb117-753"><a href="#cb117-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-756"><a href="#cb117-756" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-757"><a href="#cb117-757" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-758"><a href="#cb117-758" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(m1)</span>
<span id="cb117-759"><a href="#cb117-759" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixed_effects</span>(m1)</span>
<span id="cb117-760"><a href="#cb117-760" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_coefficients</span>(m1) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb117-761"><a href="#cb117-761" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_random_effects</span>(m1) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb117-762"><a href="#cb117-762" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-763"><a href="#cb117-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-764"><a href="#cb117-764" aria-hidden="true" tabindex="-1"></a>The <span class="in">`glmmTMB()`</span> function from {glmmTMB} can also be used for mixed effects modeling and gives very similar results...</span>
<span id="cb117-765"><a href="#cb117-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-768"><a href="#cb117-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-769"><a href="#cb117-769" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb117-770"><a href="#cb117-770" aria-hidden="true" tabindex="-1"></a>  Shared <span class="sc">~</span></span>
<span id="cb117-771"><a href="#cb117-771" aria-hidden="true" tabindex="-1"></a>    BegRec <span class="sc">+</span></span>
<span id="cb117-772"><a href="#cb117-772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb117-773"><a href="#cb117-773" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>ID) <span class="sc">+</span></span>
<span id="cb117-774"><a href="#cb117-774" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>trial) <span class="sc">+</span></span>
<span id="cb117-775"><a href="#cb117-775" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>obs),</span>
<span id="cb117-776"><a href="#cb117-776" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-777"><a href="#cb117-777" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb117-778"><a href="#cb117-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-779"><a href="#cb117-779" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(m3)</span>
<span id="cb117-780"><a href="#cb117-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-781"><a href="#cb117-781" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">glmmTMB</span>(</span>
<span id="cb117-782"><a href="#cb117-782" aria-hidden="true" tabindex="-1"></a>  Shared <span class="sc">~</span></span>
<span id="cb117-783"><a href="#cb117-783" aria-hidden="true" tabindex="-1"></a>    <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb117-784"><a href="#cb117-784" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>ID) <span class="sc">+</span></span>
<span id="cb117-785"><a href="#cb117-785" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>trial) <span class="sc">+</span></span>
<span id="cb117-786"><a href="#cb117-786" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span><span class="sc">|</span>obs),</span>
<span id="cb117-787"><a href="#cb117-787" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-788"><a href="#cb117-788" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb117-789"><a href="#cb117-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-790"><a href="#cb117-790" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m3, m4, <span class="at">test =</span> <span class="st">"F"</span>)</span>
<span id="cb117-791"><a href="#cb117-791" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-792"><a href="#cb117-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-793"><a href="#cb117-793" aria-hidden="true" tabindex="-1"></a>Finally, the {MASS} package provides yet another function, <span class="in">`glmmPQL()`</span>, that can be used for mixed effects modeling. The structure for specifying the model is different than we have used before, with a list of the random effects being presented as a separate argument from the model including the fixed effects. Note the absence of **obs** as a random effect in the model below... including it causes the model to fail to run due to singular convergence, i.e., the variance in that random effect variable is essentially zero.</span>
<span id="cb117-794"><a href="#cb117-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-797"><a href="#cb117-797" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-798"><a href="#cb117-798" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb117-799"><a href="#cb117-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb117-800"><a href="#cb117-800" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">glmmPQL</span>(</span>
<span id="cb117-801"><a href="#cb117-801" aria-hidden="true" tabindex="-1"></a>  Shared <span class="sc">~</span></span>
<span id="cb117-802"><a href="#cb117-802" aria-hidden="true" tabindex="-1"></a>    BegRec <span class="sc">+</span></span>
<span id="cb117-803"><a href="#cb117-803" aria-hidden="true" tabindex="-1"></a>    <span class="fu">offset</span>(<span class="fu">log</span>(trialduration<span class="sc">/</span><span class="dv">60</span>)),</span>
<span id="cb117-804"><a href="#cb117-804" aria-hidden="true" tabindex="-1"></a>  <span class="at">random =</span> <span class="fu">list</span>(<span class="at">ID =</span> <span class="sc">~</span> <span class="dv">1</span>, <span class="at">trial =</span> <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb117-805"><a href="#cb117-805" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d,</span>
<span id="cb117-806"><a href="#cb117-806" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb117-807"><a href="#cb117-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-808"><a href="#cb117-808" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(m5)</span>
<span id="cb117-809"><a href="#cb117-809" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-810"><a href="#cb117-810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-811"><a href="#cb117-811" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE**: The coefficient values estimated by </span><span class="in">`glmmPQL()`</span><span class="at"> are similar to, but not the same, as those estimated by </span><span class="in">`glmer()`</span><span class="at"> and </span><span class="in">`glmmTMB()`</span><span class="at">.</span></span>
<span id="cb117-812"><a href="#cb117-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-815"><a href="#cb117-815" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb117-816"><a href="#cb117-816" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb117-817"><a href="#cb117-817" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>glmmTMB)</span>
<span id="cb117-818"><a href="#cb117-818" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>effects)</span>
<span id="cb117-819"><a href="#cb117-819" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>sjPlot)</span>
<span id="cb117-820"><a href="#cb117-820" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>lme4)</span>
<span id="cb117-821"><a href="#cb117-821" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>redres)</span>
<span id="cb117-822"><a href="#cb117-822" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>tidyverse)</span>
<span id="cb117-823"><a href="#cb117-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb117-824"><a href="#cb117-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-825"><a href="#cb117-825" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb117-826"><a href="#cb117-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-827"><a href="#cb117-827" aria-hidden="true" tabindex="-1"></a><span class="fu">## Concept Review {.unnumbered}</span></span>
<span id="cb117-828"><a href="#cb117-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-829"><a href="#cb117-829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>"Mixed" modeling extends general and generalized linear modeling to consider cases where we have additional "random" factors that are another source of possible variation in our response variable</span>
<span id="cb117-830"><a href="#cb117-830" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The approach allows us to estimate either different intercepts or different slopes *and* intercepts for each level of the random factor</span>
<span id="cb117-831"><a href="#cb117-831" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As in generalized linear modeling, likelihood ratio tests and information criteria approaches can be used to compare the explanatory power of different models</span>
<span id="cb117-832"><a href="#cb117-832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Though we do not address it in this class, regression modeling can be extended further to consider NONLINEAR relationships among predictor variables</span>
<span id="cb117-833"><a href="#cb117-833" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>The ***R*** packages {lme4} and {nlme} include functions for performing for "nonlinear mixed effects modeling"</span>
<span id="cb117-834"><a href="#cb117-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-835"><a href="#cb117-835" aria-hidden="true" tabindex="-1"></a>The website <span class="co">[</span><span class="ot">Mixed Models with R</span><span class="co">](https://m-clark.github.io/mixed-models-with-R/)</span> is great resource for information about mixed effects modeling.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>