<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>23&nbsp; Generalized Linear Models – Applied Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./24-module.html" rel="next">
<link href="./22-module.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./23-module.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Preliminaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Logistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-typography-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Typography and Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-programming-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>RStudio</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Extending the Functionality of <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentals of the <strong><em>R</em></strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basics of Version Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Additional Data Structures in <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting Data into <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Part II - Statistics and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Descriptive Statisics and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Probability and Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classical Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error, Power, and Effect Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Linear Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Multiple Regression and ANCOVA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Model Selection in Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-module.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixed Effects or Multilevel Modeling</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Part III - Miscellany</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-maximum_likelihood.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maximum Likelihood Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-geospatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic Geospatial Data Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-r-packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building Custom <strong><em>R</em></strong> Packages</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-python-from-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using <strong><em>Python</em></strong> from <strong><em>R</em></strong></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99-shiny.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Building Interactive Web Apps</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-05-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 05 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 06</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 06 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 07</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 08</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-08-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 08 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 9</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 10</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-analysis-replication-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis Replication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Packages Used</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">23.1</span> Objectives</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">23.2</span> Preliminaries</a></li>
  <li><a href="#extending-the-general-model" id="toc-extending-the-general-model" class="nav-link" data-scroll-target="#extending-the-general-model"><span class="header-section-number">23.3</span> Extending the “General” Model</a></li>
  <li><a href="#model-fitting-in-glm" id="toc-model-fitting-in-glm" class="nav-link" data-scroll-target="#model-fitting-in-glm"><span class="header-section-number">23.4</span> Model Fitting in GLM</a></li>
  <li><a href="#common-types-of-glms" id="toc-common-types-of-glms" class="nav-link" data-scroll-target="#common-types-of-glms"><span class="header-section-number">23.5</span> Common Types of GLMs</a>
  <ul class="collapse">
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">EXAMPLE:</a></li>
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">CHALLENGE</a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">CHALLENGE</a></li>
  <li><a href="#log-linear-or-poisson-regression" id="toc-log-linear-or-poisson-regression" class="nav-link" data-scroll-target="#log-linear-or-poisson-regression">Log-Linear or Poisson Regression</a></li>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">EXAMPLE:</a></li>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#concept-review" id="toc-concept-review" class="nav-link" data-scroll-target="#concept-review">Concept Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./23-module.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="module-23" class="quarto-section-identifier"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">23.1</span> Objectives</h2>
<blockquote class="blockquote">
<p>In this module, we extend our discussion of regression modeling to include generalized linear models.</p>
</blockquote>
</section>
<section id="preliminaries" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">23.2</span> Preliminaries</h2>
<ul>
<li>Install and load this package in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/lmtest/lmtest.pdf">{lmtest}</a></li>
<li>Load {tidyverse} and {broom}</li>
</ul>
</section>
<section id="extending-the-general-model" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="extending-the-general-model"><span class="header-section-number">23.3</span> Extending the “General” Model</h2>
<p>So far, our discussion of regression has centered on standard or “general” linear models that assume that our response variables are continuously distributed and have normally distributed error terms (residuals) from our fitted models and that these error terms show constant variance across the range of our predictor variables. If these assumptions of general linear regression are not met, we can sometimes transform our variables to meet them, but other times we cannot, e.g., when we have binary or count data for a response variable.</p>
<p>In these cases, however, we can use a different regression technique called <strong>generalized linear modeling</strong> instead of general linear modeling. Generalized linear models, then, extend traditional regression models to allow the expected value of our response variable to depend on our predictor variable(s) through what is called a <strong>link function</strong>. It allows the response variable to belong to any of a set of distributions belonging to the “exponential” family (e.g., normal, Poisson, binomial), and it does not require errors (residuals) to be normally distributed. It also does not require homogeneity of variance across the range of predictor variable values and allows for overdispersion (when the observed variance is larger than what the model assumes).</p>
<p>One of the most important differences is that in generalized linear modeling we no longer use ordinary least squares to estimate parameter values, but rather use maximum likelihood or Bayesian approaches.</p>
<p>A generalized linear model consists of three components:</p>
<ul>
<li><p>The <strong>systematic or linear component</strong>, which reflects the linear combination of predictor variables in our model. As in general linear regression, these can be be continuous and/or categorical. Interactions between predictors and polynomial functions of predictors can also be included, as in general linear modeling. [Recall that “linear” simply means the regression model is based on linear combinations of regression coefficients, not of variables.]</p></li>
<li><p>The <strong>error structure</strong> or <strong>random component</strong>, which refers to the probability distribution of the response variable and of the residuals in the response variable after the linear component has been removed. The probability distribution in a GLM must be from the exponential family of probability distributions, which includes the <em>normal</em> (Gaussian), <em>Poisson</em> (e.g., if our response variable consists of count data), <em>binomial</em> (e.g., if our response variable is binary, like “yes/no”, “presence/absence”), <em>gamma</em>, <em>negative binomial</em>, etc.</p></li>
<li><p>A <strong>link function</strong>, which links the expected value of the response variable to the predictors. You can think of this as a transformation function. In GLM, as in general linear modeling, our linear component yields a predicted value, but this value is not the predicted value of our response variable, <span class="math inline">\(Y\)</span>, <em>per se</em>. Rather, the predicted value from the regression model needs to be transformed back into a predicted <span class="math inline">\(Y\)</span> by applying the inverse of the link function.</p></li>
</ul>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> Using a particular link function is not the same as transforming the response variable. With the link function, we are modeling <strong>some function of the expectation of the response variable</strong> for given values of the predictor variables, but not the value of the response itself. Link functions typically transform the discontinuous scale of a categorical response variable to a continuous scale that is unbounded and that can thus be examined using regression. Predicted responses from a GLM (and the associated regression coefficients) typically need to be back-transformed to put them into the more intuitive scale of the original response variable.</p>
</blockquote>
<p>Common link functions include:</p>
<ul>
<li>The <strong>identity link</strong>, which is used to model <span class="math inline">\(\mu\)</span>, the mean value of <span class="math inline">\(Y\)</span> and is what we use implicitly in standard linear models. That is, our standard (or general) linear regression model is a particular case of the generalized linear model.</li>
<li>The <strong>log link</strong>, which is typically used to model <strong>log(</strong><span class="math inline">\(\lambda\)</span>), the log of the mean value of <span class="math inline">\(Y\)</span>. This link function is typically used for modeling for count data.</li>
<li>The <strong>logit link</strong>, which is <strong>log(</strong><span class="math inline">\(\pi\)</span>/(1-<span class="math inline">\(\pi\)</span>)), is typically used for modeling binary data, or “logistic” regression.</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Model</th>
<th>Error Structure</th>
<th>Canonical Link Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>linear</td>
<td>Gaussian</td>
<td>identity</td>
</tr>
<tr class="even">
<td>log linear</td>
<td>Poisson</td>
<td>log</td>
</tr>
<tr class="odd">
<td>logistic</td>
<td>binomial</td>
<td>logit</td>
</tr>
<tr class="even">
<td>gamma</td>
<td>Gamma</td>
<td>reciprocal (inverse)</td>
</tr>
</tbody>
</table>
<p>Standard or “general” linear regression can be viewed as a special case of GLM, where the random component of our model has a <em>normal distribution</em> and the link function is the <em>identity link</em> so that we are modeling an expected (mean) value for <span class="math inline">\(Y\)</span>.</p>
</section>
<section id="model-fitting-in-glm" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="model-fitting-in-glm"><span class="header-section-number">23.4</span> Model Fitting in GLM</h2>
<p>Model fitting and parameter estimation in GLM is commonly done using a maximum likelihood approach, which is an iterative process. To determine the fit of a given model, a GLM evaluates a linear predictor for each value of the response variable with a particular set of parameter values (i.e., <span class="math inline">\(\beta\)</span> coefficients), then back-transforms the predicted value into the scale of the <span class="math inline">\(Y\)</span> variable using the inverse of the link function. These predicted values are compared with the observed values of <span class="math inline">\(Y\)</span>. The parameters are then adjusted, and the model is refitted on the transformed scale in an iterative procedure until the fit stops improving. In ML approaches, then, the data are taken as a given, and we are trying to find the most likely parameter values and model to fit those data. We judge the fit of the particular model of the basis of <strong>how likely the data would be if the model were correct.</strong></p>
<p>The measure of discrepancy used in a GLM to assess the goodness of fit of the model to the data is called the <strong>deviance</strong>, which we can think of as analogous to the variance in a general linear model. Deviance is defined as <strong>2</strong> <span class="math inline">\(\times\)</span> (the log-likelihood of a “fully saturated” model minus the log-likelihood of the proposed model). The former is a model that fits the data perfectly. Its likelihood is 1 and its log-likelihood is thus 0, so deviance functionally can be calculated as <strong>-2</strong> <span class="math inline">\(\times\)</span> log-likelihood of the proposed model. Because the saturated model does not depend on any estimated parameters and has a likelihood of 1, <em>minimizing the deviance</em> for a particular model is the same as <em>maximizing the likelihood</em>. [For the ML process of parameter estimation, it is actually mathematically easier to maximize the log-likelihood, <strong>ln(L)</strong>, than it is to maximize the likelihood, <strong>L</strong>, so computationally that is what is usually done.] In generalized linear regression, the sum of squared “deviance residuals” of all the data points is analogous to the sum of squares of the residuals in a standard linear regression (i.e., this is what the model does not explain).</p>
<p>The <code>glm()</code> function in <strong><em>R</em></strong> can be used for many types of generalized linear modeling, using a similar formula notation to that we’ve used before, with an additional argument, <code>family=</code>, to specify the kind of error structure we expect in the response variable (“gaussian”, “poisson”, “binomial”, etc.): <code>glm(y ~ x, family = "gaussian")</code></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/zombies.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>## Rows: 1000 Columns: 10
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (4): first_name, last_name, gender, major
## dbl (6): id, height, weight, zombies_killed, years_of_education, age
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> age)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = height ~ weight + age, data = z)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.2278 -1.1782 -0.0574  1.1566  5.4117 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 31.763388   0.470797   67.47   &lt;2e-16 ***
## weight       0.163107   0.002976   54.80   &lt;2e-16 ***
## age          0.618270   0.018471   33.47   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.64 on 997 degrees of freedom
## Multiple R-squared:  0.8555, Adjusted R-squared:  0.8553 
## F-statistic:  2952 on 2 and 997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> age, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = height ~ weight + age, family = "gaussian", data = z)
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 31.763388   0.470797   67.47   &lt;2e-16 ***
## weight       0.163107   0.002976   54.80   &lt;2e-16 ***
## age          0.618270   0.018471   33.47   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 2.689027)
## 
##     Null deviance: 18559  on 999  degrees of freedom
## Residual deviance:  2681  on 997  degrees of freedom
## AIC: 3832.1
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
<p>As with previous models, our explanatory variable, <span class="math inline">\(X\)</span>, can be continuous (leading to a regression analysis) or categorical (leading to an ANOVA-like procedure called an <em>analysis of deviance</em>) or both.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>gender)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> gender)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = height ~ weight + gender, data = z)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.3328 -1.5538 -0.0057  1.4437  9.1060 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 40.714398   0.627933  64.839  &lt; 2e-16 ***
## weight       0.183945   0.004575  40.206  &lt; 2e-16 ***
## genderMale   0.878857   0.168299   5.222 2.15e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.358 on 997 degrees of freedom
## Multiple R-squared:  0.7014, Adjusted R-squared:  0.7008 
## F-statistic:  1171 on 2 and 997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> gender, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = height ~ weight + gender, family = "gaussian", 
##     data = z)
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 40.714398   0.627933  64.839  &lt; 2e-16 ***
## weight       0.183945   0.004575  40.206  &lt; 2e-16 ***
## genderMale   0.878857   0.168299   5.222 2.15e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 5.558875)
## 
##     Null deviance: 18558.6  on 999  degrees of freedom
## Residual deviance:  5542.2  on 997  degrees of freedom
## AIC: 4558.3
## 
## Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
</section>
<section id="common-types-of-glms" class="level2" data-number="23.5">
<h2 data-number="23.5" class="anchored" data-anchor-id="common-types-of-glms"><span class="header-section-number">23.5</span> Common Types of GLMs</h2>
<p>We will explore two types of GLMs… <strong>logistic regression</strong> (used when our response variable is binary) and <strong>log-linear or Poisson regression</strong> (used when our response variable is count data).</p>
<section id="logistic-regression" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="logistic-regression">Logistic Regression</h3>
<p>As alluded to above, when we have a binary response variable (i.e., a categorical variable with two levels, 0 or 1), we actually are interested in modeling <span class="math inline">\(\pi_i\)</span>, which is the <em>probability that</em> <span class="math inline">\(Y\)</span> equals 1 for a given value of <span class="math inline">\(X\)</span> (<span class="math inline">\(x_i\)</span>), rather than <span class="math inline">\(\mu_i\)</span>, the <em>mean value of</em> <span class="math inline">\(Y\)</span> for a given <span class="math inline">\(X\)</span>, which is what we typically model with general linear regression. The usual model we fit to such data is the logistic regression model, which is a nonlinear model with a sigmoidal shape. The errors or residuals from such a model are not normally distributed but rather have a binomial distribution.</p>
<p>When we do our regression, we actually use as our response variable the natural log of the <strong>odds ratio</strong> between our two possible outcomes, i.e., the ratio of the probabilities that <span class="math inline">\(y_i\)</span> = 1 versus that <span class="math inline">\(y_i\)</span> = 0 for a given <span class="math inline">\(x_i\)</span>, a ratio which we call the <em>logit</em>:</p>
<p><span class="math display">\[g = logit(\pi_i) = \ln[\frac{\pi_i}{(1-\pi_i)}] = \beta_0 + \beta_1x_i\]</span></p>
<p>where <span class="math inline">\(\pi_i\)</span> = the probability that <span class="math inline">\(y_i\)</span> equals 1 for a given value of <span class="math inline">\(x_i\)</span> and <span class="math inline">\((1-\pi)\)</span> = the probability that <span class="math inline">\(y_i\)</span> equals 0.</p>
<p>The <em>logit</em> transformation, then, is the link function connecting <span class="math inline">\(Y\)</span> to our predictors. The logit is useful as it converts probabilities, which lie in the range 0 to 1, into the scale of the whole real number line.</p>
<p>We can convert back from the <em>natural log of the odds ratio</em> to an actual odds ratio using the inverse of the <em>logit</em>, which is called the <em>expit</em>:</p>
<p><span class="math display">\[expit(g) = \frac{e^{g_i}}{1+e^{g_i}} = \frac{1}{1+e^{-g_i}}=p_i\]</span></p>
</section>
<section id="example" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example">EXAMPLE:</h3>
<p>Suppose we are interested in how a students’ GRE scores, grade point averages (GPA), and ranking of their undergraduate institution (into quartiles, 1 to 4, from high to low), affect admission into graduate school. The response variable, “admitted/not admitted”, is a binary variable, scored as 1/0.</p>
<p>Load in the “graddata.csv” dataset, which comes from <a href="https://stats.idre.ucla.edu/other/dae/">this website</a>, and then explore it using <code>head()</code>, <code>summary()</code>, <code>plot()</code>, <code>pairs()</code>, and <code>table()</code>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/graddata.csv"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or f &lt;- 'https://stats.idre.ucla.edu/stat/data/binary.csv'</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>## Rows: 400 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## dbl (4): admit, gre, gpa, rank
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>rank <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>rank)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 4
##   admit   gre   gpa rank 
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;
## 1     0   380  3.61 3    
## 2     1   660  3.67 3    
## 3     1   800  4    1    
## 4     1   640  3.19 4    
## 5     0   520  2.93 4    
## 6     1   760  3    2</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>##      admit             gre             gpa        rank   
##  Min.   :0.0000   Min.   :220.0   Min.   :2.260   1: 61  
##  1st Qu.:0.0000   1st Qu.:520.0   1st Qu.:3.130   2:151  
##  Median :0.0000   Median :580.0   Median :3.395   3:121  
##  Mean   :0.3175   Mean   :587.7   Mean   :3.390   4: 67  
##  3rd Qu.:1.0000   3rd Qu.:660.0   3rd Qu.:3.670          
##  Max.   :1.0000   Max.   :800.0   Max.   :4.000</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, some exploratory visualization</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"GPA"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Admit"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(Y) versus GPA"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"GRE"</span>) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Admit"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(Y) versus GRE"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>patchwork)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>(t <span class="ot">&lt;-</span> <span class="fu">group_by</span>(d, admit, rank) <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> rank, <span class="at">values_from =</span> n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>## `summarise()` has grouped output by 'admit'. You can override using the
## `.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 5
## # Groups:   admit [2]
##   admit   `1`   `2`   `3`   `4`
##   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     0    28    97    93    55
## 2     1    33    54    28    12</code></pre>
</div>
</div>
<p>To use logistic regression to look at how the <em>odds of admission</em> is influenced by <em>GRE scores</em>, we can call the <code>glm()</code> function with a model where <strong>admit</strong> is our response variable and <strong>gre</strong> is our predictor variable.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of admit~gre</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> gre, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = admit ~ gre, family = "binomial", data = d)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -2.901344   0.606038  -4.787 1.69e-06 ***
## gre          0.003582   0.000986   3.633  0.00028 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 486.06  on 398  degrees of freedom
## AIC: 490.06
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Here is the equation representing the results of our model: <span class="math display">\[logit(\pi_i) = -2.901344 + 0.003582 \times {gre}\]</span></p>
<section id="interpretation-and-hypothesis-testing" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="interpretation-and-hypothesis-testing">Interpretation and Hypothesis Testing</h4>
<p>When we get a <span class="math inline">\(\beta_1\)</span> estimate from a logistic regression, it represents the <em>change in the log(odds ratio)</em> of the <strong>outcome</strong> for an increase in one unit of our predictor variable, <span class="math inline">\(X\)</span>.</p>
<p>Looking at the coefficient for <strong>gre</strong>, we see it is positive and, while low, it is significantly different from 0. Thus, increasing GRE score results in an increase in the log(odds ratio) of admission (i.e., students with higher scores are more likely to be admitted). Here, for every one unit change in <strong>gre</strong>, the log odds of admission (versus non-admission) increases by 0.018172.</p>
<p>Using the <code>predict()</code> function, we can plot our data and fit the change in the admitted/not admitted ratio across the range of GRE scores.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(d<span class="sc">$</span>gre), <span class="at">to =</span> <span class="fu">max</span>(d<span class="sc">$</span>gre), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">900</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>logOR <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">gre =</span> x))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># this function will predict the log(odds ratio)... but if we add the argument</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># `type='response'`, the `predict()` function will return the expected response</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># on the scale of the Y variable, i.e., Pr(Y) running the `exp()` function,</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e., `exp(logOR)` will yield the actual odds ratio!</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">gre =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(logOR)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x, <span class="at">logOR =</span> logOR, <span class="at">pr_admit =</span> y, <span class="at">OR =</span> OR)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 4
##       x logOR pr_admit     OR
##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1   100 -2.54   0.0729 0.0786
## 2   101 -2.54   0.0731 0.0789
## 3   102 -2.54   0.0734 0.0792
## 4   103 -2.53   0.0736 0.0795
## 5   104 -2.53   0.0739 0.0798
## 6   105 -2.53   0.0741 0.0800</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 4
##       x logOR pr_admit    OR
##   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1   895 0.305    0.576  1.36
## 2   896 0.308    0.576  1.36
## 3   897 0.312    0.577  1.37
## 4   898 0.315    0.578  1.37
## 5   899 0.319    0.579  1.38
## 6   900 0.323    0.580  1.38</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gre, <span class="at">y =</span> admit)) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"GRE Score"</span>) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Pr(admit)"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(admit) versus GRE Score"</span>) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> res,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> pr_admit))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By exponentiating the regression coefficient, <span class="math inline">\(\beta_1\)</span>, we can get the actual odds ratio change, as opposed to the log(odds ratio) change, associated with a 1 unit change in GRE score.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(ORchange <span class="ot">&lt;-</span> <span class="fu">exp</span>(glm<span class="sc">$</span>coefficients[<span class="dv">2</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##      gre 
## 1.003589</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a 1 unit increase in gre results in a 0.36% increase in the odds of admission</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As in simple (general) linear regression, the key null hypothesis, <span class="math inline">\(H_0\)</span>, of relevance when fitting a simple logistic regression model is that our regression coefficient, <span class="math inline">\(\beta\)</span>, is zero, i.e.&nbsp;that there is no relationship between the binary response variable and the predictor variable.</p>
<p>There are two common ways to test this <span class="math inline">\(H_0\)</span>. The first is to calculate the <strong>Wald statistic</strong> for the predictor variable and compare this to the standard normal or <span class="math inline">\(z\)</span> distribution. This is like a maximum likelihood-based version of a <strong>t test</strong>. The Wald statistic is, like a t statistic, our <span class="math inline">\(\beta\)</span> parameter estimate divided by the standard error of that estimate: <span class="math inline">\(\frac{\beta_1}{SE( \beta_1)}\)</span>). This is most appropriate when sample sizes are large. The “z value” in the summary table for the model shows us the value of the Wald statistic.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = admit ~ gre, family = "binomial", data = d)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -2.901344   0.606038  -4.787 1.69e-06 ***
## gre          0.003582   0.000986   3.633  0.00028 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 486.06  on 398  degrees of freedom
## AIC: 490.06
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>If we wanted to calculate the Wald statistic by hand, we can do so easily. Below, we use the convenient <code>tidy()</code> function from the {broom} package to pull out a table of results from our GLM very easily. Note that <code>tidy()</code> works on lots of different linear model objects, e.g., those created by <code>lm()</code> and <code>glm()</code> (though not <code>lmer()</code>).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>(results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 5
##   term        estimate std.error statistic    p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1 (Intercept) -2.90     0.606        -4.79 0.00000169
## 2 gre          0.00358  0.000986      3.63 0.000280</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>wald <span class="ot">&lt;-</span> results<span class="sc">$</span>estimate<span class="sc">/</span>results<span class="sc">$</span>std.error</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(results<span class="sc">$</span>wald)))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 tailed p value associated with the Wald statistic</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 7
##   term        estimate std.error statistic    p.value  wald          p
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 (Intercept) -2.90     0.606        -4.79 0.00000169 -4.79 0.00000169
## 2 gre          0.00358  0.000986      3.63 0.000280    3.63 0.000280</code></pre>
</div>
</div>
<p>Just as when running an <code>lm()</code>, we can get the confidence intervals around our <code>glm()</code> model estimates several different ways. First, we can use the <code>confint()</code> function, giving our GLM model results as an argument, which yields a CI based on a maximum likelihood approach.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(glm, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##                    2.5 %       97.5 %
## (Intercept) -4.119988259 -1.739756286
## gre          0.001679963  0.005552748</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this function returns a CI based on log-likelihood, an iterative ML process</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, we can use the <code>confint.default()</code> function, which returns a CI based on standard errors, the way we have calculated them by hand previously.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> <span class="fu">confint.default</span>(glm, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##                    2.5 %       97.5 %
## (Intercept) -4.089156159 -1.713532380
## gre          0.001649677  0.005514746</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which is equivalent to how we have calculated CIs previously</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>lower <span class="ot">&lt;-</span> results<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> results<span class="sc">$</span>std.error</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>upper <span class="ot">&lt;-</span> results<span class="sc">$</span>estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> results<span class="sc">$</span>std.error</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> results[, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 3
##   term           lower    upper
##   &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept) -4.09    -1.71   
## 2 gre          0.00165  0.00551</code></pre>
</div>
</div>
</section>
</section>
<section id="challenge" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge">CHALLENGE</h3>
<p>Repeat the logistic regression above, but using <strong>gpa</strong> rather than <strong>gre</strong> as the predictor variable.</p>
<ul>
<li>Is <strong>gpa</strong> a significant predictor of the odds of admission?</li>
<li>What is the estimate of <span class="math inline">\(\beta_1\)</span> and the 95% CI around that estimate?</li>
<li>How much does an increase of 1 unit in <strong>gpa</strong> increase the actual <em>odds ratio</em> (as opposed to the <em>log(odds ratio)</em> for admission?</li>
<li>What is the 95% CI around this odds ratio?</li>
</ul>
<blockquote class="blockquote">
<p><strong>HINT:</strong> For the latter two questions, you will need to apply the <code>exp()</code> function and convert the <em>log(odds ratio)</em> into an actual <em>odds ratio</em>.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> gpa, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = admit ~ gpa, family = "binomial", data = d)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -4.3576     1.0353  -4.209 2.57e-05 ***
## gpa           1.0511     0.2989   3.517 0.000437 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 486.97  on 398  degrees of freedom
## AIC: 490.97
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>(logOR <span class="ot">&lt;-</span> glm<span class="sc">$</span>coefficients)  <span class="co"># pull out coefficients</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## (Intercept)         gpa 
##   -4.357587    1.051109</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(glm, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha))  <span class="co"># calculate CIs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>##                  2.5 %    97.5 %
## (Intercept) -6.4334239 -2.367430
## gpa          0.4742282  1.647959</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exponentiate to convert to odds ratio scale instead of log(odds ratio)</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>(OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(logOR))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## (Intercept)         gpa 
##  0.01280926  2.86082123</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>(CI_OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(CI))  <span class="co"># exponentiate to convert to odds ratio scal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>##                   2.5 %     97.5 %
## (Intercept) 0.001606939 0.09372126
## gpa         1.606773662 5.19636490</code></pre>
</div>
</div>
<ul>
<li>Graph the <strong>probability of admission</strong>, i.e., <em>Pr(admit)</em> or <span class="math inline">\(\pi_i\)</span>, for students with GPAs between 2.0 and 4.0 GPAs, superimposed on a point plot of admission (0 or 1) by <strong>gpa</strong>.</li>
</ul>
<blockquote class="blockquote">
<p><strong>HINT:</strong> Use the <code>predict()</code> function with <code>type="response"</code> to yield <span class="math inline">\(\pi_i\)</span> directly.</p>
</blockquote>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gpa =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">gpa =</span> x, <span class="fu">predict</span>(glm, <span class="at">newdata =</span> x, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: Using type='response' returns predictions on the scale of the Y</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co"># variable, in this case Pr(admit). Using the default for the `type=` argument</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># would return a prediction on the logit scale, i.e., the log(odds ratio),</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># which equals log(Pr(admit)/(1-Pr(admit)))</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>##        gpa        fit     se.fit residual.scale
## 1 2.000000 0.09488728 0.03825202              1
## 2 2.020202 0.09672673 0.03840310              1
## 3 2.040404 0.09859796 0.03854537              1
## 4 2.060606 0.10050136 0.03867851              1
## 5 2.080808 0.10243733 0.03880223              1
## 6 2.101010 0.10440626 0.03891621              1</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> prediction, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> fit)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"GPA"</span>) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Pr(admit)"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(admit) versus GPA"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> admit), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code>predict()</code> function can also be used to get confidence intervals around our estimate of the log(odds of admission) (if the <code>type=</code> argument is unspecified or set to “link”), or around the estimate of the probability of admission (if the <code>type=</code> argument is set to “response”), by using the argument <code>se.fit=TRUE</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">gpa =</span> x, <span class="fu">predict</span>(glm, <span class="at">newdata =</span> x, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>))</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>lower <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>upper <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##        gpa        fit     se.fit residual.scale      lower     upper
## 1 2.000000 0.09488728 0.03825202              1 0.01991469 0.1698599
## 2 2.020202 0.09672673 0.03840310              1 0.02145803 0.1719954
## 3 2.040404 0.09859796 0.03854537              1 0.02305043 0.1741455
## 4 2.060606 0.10050136 0.03867851              1 0.02469287 0.1763098
## 5 2.080808 0.10243733 0.03880223              1 0.02638636 0.1784883
## 6 2.101010 0.10440626 0.03891621              1 0.02813189 0.1806806</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prediction, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> fit)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"GPA"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Pr(admit)"</span>) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Pr(admit) versus GPA"</span>) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="likelihood-ratio-tests" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="likelihood-ratio-tests">Likelihood Ratio Tests</h4>
<p>To evaluate the significance of an <strong>overall model</strong> in a logistic regression, we can compare the fit of a more complex model to that of a nested, reduced model, just as when we discussed model selection approaches for simple linear regression using <strong>partial F tests</strong>.</p>
<p>For example, to test the null hypothesis of <span class="math inline">\(\beta_1\)</span> = 0 for a simple logistic regression model with a single predictor, we would compare the log-likelihood of the full model to that of the reduced, intercept only model. This is called a <strong>likelihood ratio test</strong>. Likelihood ratio tests are very similar to partial F tests in that they compare the full model with a nested, reduced model where the explanatory variables of interest are omitted. Now, however, instead of using a test statistic based on a ratio of <em>variances</em> explained by the two models and interpreting that by comparison to an <span class="math inline">\(F\)</span> distribution, we create a test statistic that is a ratio of the <em>log-likelihoods</em> of the two models and interpret that statistic by comparison to a <span class="math inline">\(\chi^2\)</span> distribution with a given number of degrees of freedom. Still, the underlying idea is conceptually the same.</p>
<p>A likelihood ratio test comparing a proposed and reduced model can be performed using the <code>anova()</code> function where we specify the <code>test=</code> argument to be either <code>LRT</code> or <code>Chisq</code> (these are equivalent).</p>
<p>Recall that when we used the <code>anova()</code> function to run F ratio tests to compare the proportion of <strong>variance</strong> explained by two general linear models, we specified that `test = “F” and generated an F statistic which was considered relative to an F distribution to calculate a p value. With generalized linear models, because we are working with deviances and likelihood ratios, the test statistic we generate is <em>ratio of likelihoods</em> (which is equivalent to a difference in deviances, see below) rather than a <em>ratio of variances</em>. That statistic is then considered relative to a <span class="math inline">\(\chi^2\)</span> distribution to determine the p value. The relevant degrees of freedom for the likelihood ratio test is the <strong># of parameters in the proposed model minus the # parameters in the nested model</strong> (here, df = 2 - 1 = 1).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>proposed <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> gpa, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, proposed, <span class="at">test =</span> <span class="st">"LRT"</span>)  <span class="co"># or `test = 'Chisq')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Analysis of Deviance Table
## 
## Model 1: admit ~ 1
## Model 2: admit ~ gpa
##   Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)    
## 1       399     499.98                         
## 2       398     486.97  1   13.009  0.00031 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>With this low p value, we would reject the null hypothesis that removing the variable of interest (<em>gpa</em>) from our model does not result in a loss of fit.</p>
<p>Alternatively, we could use the function <code>lrtest()</code> from the {lmtest} package to do the same likelihood ratio test of the two models.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(reduced, proposed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: admit ~ 1
## Model 2: admit ~ gpa
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   1 -249.99                         
## 2   2 -243.48  1 13.009    0.00031 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We can also perform a likelihood ratio test by hand by taking the difference between the <em>deviances</em> of the two models. The deviance for a generalized linear model is analogous to the the residual sum of squares (i.e., unexplained variance) in a general linear model - i.e, lower deviance and lower RSS both mean better models. Deviance is calculated as a kind of “distance” of given model from a fully “saturated” model, i.e., a model where each data point has its own parameters. The likelihood of a fully “saturated” model is 1, thus its log-likelihood is log(1) = 0.</p>
<ul>
<li><em>Deviance</em> = 2 <span class="math inline">\(\times\)</span> (log-likelihood of the saturated model - log-likelihood of the proposed model)</li>
<li><em>Deviance</em> = 2 <span class="math inline">\(\times\)</span> (0 - log-likelihood of the proposed model)</li>
<li><em>Deviance</em> = -2 <span class="math inline">\(\times\)</span> (log-likelihood of the proposed model)</li>
</ul>
<p>We can get the deviance associated with a given glm model object by accessing its <code>$deviance</code> slot or by using the <code>deviance()</code> function with the model object as an argument.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deviance of intercept only model</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>(D_reduced <span class="ot">&lt;-</span> reduced<span class="sc">$</span>deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 499.9765</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>(D_reduced <span class="ot">&lt;-</span> <span class="fu">deviance</span>(reduced))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 499.9765</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deviance of proposed model with intercept and one predictor</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>(D_proposed <span class="ot">&lt;-</span> proposed<span class="sc">$</span>deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 486.9676</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>(D_proposed <span class="ot">&lt;-</span> <span class="fu">deviance</span>(proposed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 486.9676</code></pre>
</div>
</div>
<p>The <span class="math inline">\(\chi^2\)</span> statistic is then just the difference of the deviances…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>(chisq <span class="ot">&lt;-</span> D_reduced <span class="sc">-</span> D_proposed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 13.0089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a measure of how much the fit improves by adding in the predictor</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(chisq, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.0003100148</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df = difference in number of parameters in the proposed versus reduced model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>$null.deviance</code> slot of a model object returns, for any model, the deviance associated with an intercept only null model.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> reduced<span class="sc">$</span>null.deviance <span class="sc">-</span> reduced<span class="sc">$</span>deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] -5.684342e-14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this is essentially 0 because here the `reduced` model *is* the intercept</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># only model!</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> <span class="dv">0</span>, <span class="at">df =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> proposed<span class="sc">$</span>null.deviance <span class="sc">-</span> proposed<span class="sc">$</span>deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 13.0089</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> x2, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.0003100148</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df = difference in number of parameters in the proposed versus reduced model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s some additional useful information about interpreting the results of <code>summary()</code> from running a logistic regression based on <a href="http://stats.stackexchange.com/questions/108995/interpreting-residual-and-null-deviance-in-glm-r">this post from <em>StackExchange</em></a> and <a href="http://www.theanalysisfactor.com/r-glm-model-fit/">this post from <em>The Analysis Factor</em></a></p>
<blockquote class="blockquote">
<p>Let <span class="math inline">\(n\)</span> = the number of observations in the data set and <span class="math inline">\(K\)</span> = the number of predictor terms in a proposed model.</p>
<ul>
<li><p>The <em>Saturated Model</em> is a model that assumes each data point has its own parameter, which means we have <span class="math inline">\(n\)</span> parameters to describe the data</p></li>
<li><p>The <em>Null Model</em> is a model that assumes exactly the opposite, i.e., one parameter describes all of the data points, which means only 1 parameter, the intercept, is estimated from the data</p></li>
<li><p>The <em>Proposed Model</em> is the model we are fitting by GLM, which has <span class="math inline">\(K\)</span> parameters terms (1 for the intercept, plus 1 for each predictor variable/interaction term)</p></li>
<li><p><em>Null Deviance</em> = deviance of the Null Model, calculated as <em>2(log-likelihood of the Saturated Model</em> <span class="math inline">\(-\)</span> log-likelihood of a Null Model), where df = <span class="math inline">\(n\)</span> - 1</p></li>
<li><p><em>Residual Deviance</em> = <em>2(log-likelihood of the saturated model</em> <span class="math inline">\(-\)</span> log-likelihood of the proposed model), where df = <span class="math inline">\(n\)</span> - <span class="math inline">\(K\)</span></p></li>
</ul>
<p>If the null deviance is really small, it means that the <em>Null Model</em> explains the data pretty well. Likewise, if the residual deviance is really small, then the <em>Proposed Model</em> explains the data pretty well.</p>
<p>If you want to compare a <em>Proposed Model</em> against a <em>Null</em>, or intercept-only model, then you can look at <em>Null Deviance</em> <span class="math inline">\(-\)</span> <em>Residual Deviance</em> for that model, which yields a difference that can be examined against a <span class="math inline">\(\chi^2\)</span> distribution with <span class="math inline">\(K\)</span> degrees of freedom.</p>
<p>If you want to compare one <em>Proposed Model</em> against a nested <em>Reduced Model</em>, then you can look at <em>Residual Deviance for the Reduced Model</em> <span class="math inline">\(-\)</span> <em>Residual Deviance for the Proposed Model</em>, which again yields a difference that can be examined against a <span class="math inline">\(\chi^2\)</span> distribution with df = (<span class="math inline">\(K\)</span> for Proposed Model) - (<span class="math inline">\(K\)</span> for Reduced Model).</p>
<p>This deviance-based, <span class="math inline">\(\chi^2\)</span>-like statistic is also referred to as a <strong>G Square</strong> or <strong>G</strong> statistic. If the p value associated with this statistic is less than the alpha level, it means that the the fuller model is associated with significantly reduced deviance relative to the nested reduced model, and thus has a better fit. We would thus reject the null hypothesis that the fuller model is not better than the reduced one.</p>
</blockquote>
</section>
<section id="multiple-logistic-regression" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="multiple-logistic-regression">Multiple Logistic Regression</h4>
<p>Logistic regression can be easily extended to situations with multiple predictor variables, including both continuous and categorical variables, as in our discussion of multiple regression under the general linear model.</p>
</section>
</section>
<section id="challenge-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-1">CHALLENGE</h3>
<p>Using the same “graddata.csv” dataset, run a multiple logistic regression analysis using <em>gpa</em>, <em>gre</em>, and <em>rank</em> to look at student admissions to graduate school. Do not, at first, include any interaction terms.</p>
<ul>
<li>What variables are significant predictors of the log(odds ratio) of admission?</li>
<li>What is the value of the log(odds ratio) coefficient and the 95% CIs around that value for the two continuous variable (<em>gpa</em> and <em>gre</em>), when taking the effects of the other and of rank into account? What do these translate into on the actual odds ratio scale?</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model with 3 predictors</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>glmGGR <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gpa <span class="sc">+</span> gre <span class="sc">+</span> rank, <span class="at">family =</span> binomial)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glmGGR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = admit ~ gpa + gre + rank, family = binomial, data = d)
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -3.989979   1.139951  -3.500 0.000465 ***
## gpa          0.804038   0.331819   2.423 0.015388 *  
## gre          0.002264   0.001094   2.070 0.038465 *  
## rank2       -0.675443   0.316490  -2.134 0.032829 *  
## rank3       -1.340204   0.345306  -3.881 0.000104 ***
## rank4       -1.551464   0.417832  -3.713 0.000205 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 499.98  on 399  degrees of freedom
## Residual deviance: 458.52  on 394  degrees of freedom
## AIC: 470.52
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>log_coeff <span class="ot">&lt;-</span> glmGGR<span class="sc">$</span>coefficients  <span class="co"># extract coefficients...</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>log_coeff_CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(glmGGR, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># and calculate 95% CIs around them</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>(results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(log_coeff, log_coeff_CI))  <span class="co"># none include 0!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>##                log_coeff         2.5 %       97.5 %
## (Intercept) -3.989979073 -6.2716202334 -1.792547080
## gpa          0.804037549  0.1602959439  1.464142727
## gre          0.002264426  0.0001375921  0.004435874
## rank2       -0.675442928 -1.3008888002 -0.056745722
## rank3       -1.340203916 -2.0276713127 -0.670372346
## rank4       -1.551463677 -2.4000265384 -0.753542605</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert results out of log scale</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>coeff <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_coeff)  <span class="co"># convert results out of log scale</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>coeff_CI <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_coeff_CI)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>(results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(coeff, coeff_CI))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>##                 coeff       2.5 %    97.5 %
## (Intercept) 0.0185001 0.001889165 0.1665354
## gpa         2.2345448 1.173858216 4.3238349
## gre         1.0022670 1.000137602 1.0044457
## rank2       0.5089310 0.272289674 0.9448343
## rank3       0.2617923 0.131641717 0.5115181
## rank4       0.2119375 0.090715546 0.4706961</code></pre>
</div>
</div>
<ul>
<li>Is the model including all three predictors better than models that include just two predictors?</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare 2 versus 3 factor models</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>glmGG <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gpa <span class="sc">+</span> gre, <span class="at">family =</span> binomial)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>glmGR <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gpa <span class="sc">+</span> rank, <span class="at">family =</span> binomial)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>glmRG <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gre <span class="sc">+</span> rank, <span class="at">family =</span> binomial)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmGG, glmGGR)  <span class="co"># or anova(glmGG, glmGGR, test='Chisq')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: admit ~ gpa + gre
## Model 2: admit ~ gpa + gre + rank
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   3 -240.17                         
## 2   6 -229.26  3 21.826  7.088e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmGR, glmGGR)  <span class="co"># or anova(glmGR, glmGGR, test='Chisq')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: admit ~ gpa + rank
## Model 2: admit ~ gpa + gre + rank
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
## 1   5 -231.44                       
## 2   6 -229.26  1 4.3578    0.03684 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmRG, glmGGR)  <span class="co"># or anova(glmRG, glmGGR, test='Chisq')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: admit ~ gre + rank
## Model 2: admit ~ gpa + gre + rank
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)  
## 1   5 -232.27                       
## 2   6 -229.26  1 6.0143    0.01419 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The 3-factor model is indeed better and any of the 2-factor models!</p>
</blockquote>
<ul>
<li>Compare a model that includes the three predictors with no interactions to one that includes the three predictors and all possible interactions.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare model with and model without interactions</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>glmNO <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> rank <span class="sc">+</span> gpa <span class="sc">+</span> gre, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>glmALL <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> rank <span class="sc">*</span> gpa <span class="sc">*</span> gre, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmNO, glmALL)  <span class="co"># or anova(glmNO,glmALL, test='Chisq')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: admit ~ rank + gpa + gre
## Model 2: admit ~ rank * gpa * gre
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)
## 1   6 -229.26                     
## 2  16 -225.19 10 8.1317      0.616</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Adding interaction terms to the 3-factor model does not significantly decrease the deviance!</p>
</blockquote>
</section>
<section id="log-linear-or-poisson-regression" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="log-linear-or-poisson-regression">Log-Linear or Poisson Regression</h3>
<p>Sometimes, we want to model a response variable that is in the form of count data (e.g., species richness on an island in terms of distance from the mainland, number of plants of a particular species found in a sampling plot in relation to altitude). Many discrete response variables have counts as possible outcomes. Binomial counts are the number of successes <span class="math inline">\(x\)</span> in a fixed number of trials, <span class="math inline">\(n\)</span>. Poisson counts are the number occurrences of some event in a certain interval of time (or space). While binomial counts only take values between 0 and n, Poisson counts have no upper bound. We are going to focus on Poisson counts here.</p>
<p>As we have discussed before, for Poisson-distributed variables, the mean and the variance are equal and represented by a single parameter (<span class="math inline">\(\lambda\)</span>), and therefore linear models based on normal distributions may not be appropriate. We have seen that sometimes we can simply transform a response variable with some kind of power transformation to make it appear more normally distributed, but an alternative is to use a GLM with a Poisson error term and use a <em>log</em> transformation as the link function, resulting in in a <strong>log-linear</strong> model. Thus, when we do Poisson regression, our regression model tries to predict the natural log of the expected value of <span class="math inline">\(Y\)</span>, i.e., <span class="math inline">\(\lambda_i\)</span>.</p>
<p>The link function is thus…</p>
<p><span class="math display">\[g=log(\mu_i)\]</span></p>
<p>… and the inverse link function is…</p>
<p><span class="math display">\[\lambda_i = e^{\lambda_i}\]</span></p>
<p>Our regression model formulation is the same as in logistic regression, above, except we use <code>family="Poisson"</code>, e.g, <code>glm(y ~ x, family = "poisson")</code></p>
</section>
<section id="example-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="example-1">EXAMPLE:</h3>
<p>Researchers studied the reproductive success of a set of male woolly monkeys over a period of 8 years. The age of each monkey at the beginning of the study and the number of successful matings they had during the 8 years were recorded, and they were also scored into ranks of “high”, “medium”, and “low”. We assume the number of matings follows a Poisson distribution, and we are interested in exploring whether mating success depends on the age of the monkey in question.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/woollydata.csv"</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Rows: 60 Columns: 4
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (2): name, rank
## dbl (2): success, age
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 4
##   name    success   age rank  
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
## 1 Aaron        15  9.8  medium
## 2 Adam         14 12.1  medium
## 3 Agustin      22 16.3  high  
## 4 Alan          9  8.79 low   
## 5 Andrew       12  6.81 low   
## 6 Anthony      11 14.8  low</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>name)</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>rank <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>rank)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##       name       success           age             rank   
##  James  : 2   Min.   : 5.00   Min.   : 5.740   high  :24  
##  Aaron  : 1   1st Qu.: 9.00   1st Qu.: 9.555   low   :24  
##  Adam   : 1   Median :12.00   Median :10.765   medium:12  
##  Agustin: 1   Mean   :12.12   Mean   :10.884              
##  Alan   : 1   3rd Qu.:14.00   3rd Qu.:12.285              
##  Andrew : 1   Max.   :24.00   Max.   :16.330              
##  (Other):53</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, some exploratory visualization</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> success)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Mating Success"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>rank, d<span class="sc">$</span>success)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##         
##          5 6 7 8 9 10 11 12 13 14 15 16 17 19 20 21 22 24
##   high   1 1 1 1 3  1  2  3  2  2  2  1  1  1  0  0  1  1
##   low    0 1 1 4 4  2  2  5  2  1  1  0  1  0  0  0  0  0
##   medium 0 0 0 0 1  1  2  1  1  2  1  0  0  1  1  1  0  0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success ~ age</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> age, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = success ~ age, family = "poisson", data = d)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.84007    0.17696  10.398  &lt; 2e-16 ***
## age          0.05920    0.01541   3.841 0.000122 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.972  on 59  degrees of freedom
## Residual deviance: 61.179  on 58  degrees of freedom
## AIC: 322.88
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can generate a nice summary table of results with `tidy()` setting</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'conf.int = TRUE' uses an ML approach to estimate the CI</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the <code>summary()</code>, note that the residual deviance is slighly higher than the residual degrees of freedom, which suggests that our data are slightly overdispersed (i.e., there is some extra, unexplained variation in the response, where the variance is greater than the mean). If this were dramatic, we might use “quasipoisson” for the family instead, but we will stick with “poisson”.</p>
<p>Now, let’s fit a “line” of best fit through our data, along with 95% CI around this “line”. We want to plot the relationship between <strong>success</strong>, rather than <strong>log(success)</strong>, and <strong>age</strong>, so this relationship will not actually be linear but log-linear.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5</span>, <span class="at">to =</span> <span class="dv">17</span>, <span class="at">by =</span> <span class="dv">1</span>))</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">age =</span> x, <span class="fu">predict</span>(glm, <span class="at">newdata =</span> x, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>))</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: Using the argument `type='response'` makes our prediction be in</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="co"># units of our actual Y variable, success, rather than log(success)</span></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>lower <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>upper <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##   age       fit    se.fit residual.scale     lower    upper
## 1   5  8.465986 0.8711054              1  6.758651 10.17332
## 2   6  8.982273 0.7966819              1  7.420806 10.54374
## 3   7  9.530046 0.7145099              1  8.129632 10.93046
## 4   8 10.111223 0.6274232              1  8.881497 11.34095
## 5   9 10.727844 0.5422279              1  9.665096 11.79059
## 6  10 11.382067 0.4739422              1 10.453158 12.31098</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> prediction, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> fit)) <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">data =</span> prediction,</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> fit, <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>p  <span class="co"># note the curvilinear 'line' of best fit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Is this model better than an intercept-only model? YES!</p>
<p>We can see this by doing a likelihood ratio test.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>proposed <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> age, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="co"># using the `lrtest()` function</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(reduced, proposed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Likelihood ratio test
## 
## Model 1: success ~ 1
## Model 2: success ~ age
##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    
## 1   1 -166.84                         
## 2   2 -159.44  1 14.794  0.0001199 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or, using the `anova()` function</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, proposed, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Analysis of Deviance Table
## 
## Model 1: success ~ 1
## Model 2: success ~ age
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1        59     75.972                          
## 2        58     61.179  1   14.794 0.0001199 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or, based on the deviance difference between the reduced and proposed models</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> reduced<span class="sc">$</span>deviance <span class="sc">-</span> proposed<span class="sc">$</span>deviance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 14.79362</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(x2, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.0001199407</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or, based on hand calculating model deviances using the `logLik()` function,</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="co"># which returns the log-likelihood of a model</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>(<span class="at">D_reduced =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(reduced))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'log Lik.' 333.6736 (df=1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">D_proposed =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(proposed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'log Lik.' 318.8799 (df=2)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> D_reduced <span class="sc">-</span> D_proposed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'log Lik.' 14.79362 (df=1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(x2, <span class="at">df =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'log Lik.' 0.0001199407 (df=1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df = difference in # of parameters in the proposed versus reduced model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As mentioned in <a href="22-module.html"><strong>Module 22</strong></a>, the Akaike Information Criterion, or AIC, is another way of evaluating and comparing related models. For similar models, those with lower AIC models are preferred over those with higher AIC. The AIC value is based on the deviance associated with the model, but it penalizes model complexity. Much like an adjusted <span class="math inline">\(R^2\)</span>, its intent is to prevent you from including irrelevant predictors when choosing among similar models. Models with low AICs represent a better fit to the data, and if many models have similarly low AICs, you should choose the one with the fewest model terms. For both continuous and categorical predictors, we prefer comparing full and reduced models against one another to test individual terms rather than comparing the fit of all possible models and trying and select a single “best” one. Thus, AIC values are useful for comparing models, but they are not interpretable on their own. The <code>logLik()</code> function returns the log-likelihood associated with a particular model and can be used to calculate AIC values by hand.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>(AICproposed <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(proposed))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'log Lik.' 322.8799 (df=2)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC = (2 * # parameters estimated() minus (2 * log-likelihood of model) for</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the proposed model, we estimated 2 parameters</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>(AICreduced <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(reduced))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 'log Lik.' 335.6736 (df=1)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for the reduced model, we estimated 1 parameter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, the log-likelihood of the model including <em>age</em> as a predictor is much lower than the log-likelihood of the reduced (intercept only) model, so we prefer the former.</p>
</section>
<section id="challenge-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-2">CHALLENGE</h3>
<p>Using the woolly monkey mating success data set, explore multiple Poisson regression models of [a] mating success in relation to <em>rank</em> and [b] mating success in relation to <em>age</em> + <em>rank</em>, and [c] mating success in relation to <em>age</em> + <em>rank</em> + their interaction on your own. What conclusions can you come to about the importance of rank and rank in combination with age versus age alone?</p>
<section id="mating-success-in-relation-to-rank" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="mating-success-in-relation-to-rank">Mating Success in Relation to Rank</h4>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success ~ rank</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> rank, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = success ~ rank, family = "poisson", data = d)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  2.53568    0.05745  44.138   &lt;2e-16 ***
## ranklow     -0.17247    0.08498  -2.029   0.0424 *  
## rankmedium   0.10931    0.09601   1.139   0.2549    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.972  on 59  degrees of freedom
## Residual deviance: 67.229  on 57  degrees of freedom
## AIC: 330.93
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 3 × 7
##   term        estimate std.error statistic p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    2.54     0.0574     44.1   0        2.42     2.65   
## 2 ranklow       -0.172    0.0850     -2.03  0.0424  -0.340   -0.00621
## 3 rankmedium     0.109    0.0960      1.14  0.255   -0.0807   0.296</code></pre>
</div>
</div>
</section>
<section id="mating-success-in-relation-to-age-rank" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="mating-success-in-relation-to-age-rank">Mating Success in Relation to Age + Rank</h4>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success~age+rank</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> age <span class="sc">+</span> rank, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = success ~ age + rank, family = "poisson", data = d)
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.89985    0.18016  10.546  &lt; 2e-16 ***
## age          0.05848    0.01547   3.780 0.000157 ***
## ranklow     -0.18419    0.08504  -2.166 0.030324 *  
## rankmedium   0.07981    0.09633   0.829 0.407344    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.972  on 59  degrees of freedom
## Residual deviance: 52.905  on 56  degrees of freedom
## AIC: 318.61
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm2, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 4 × 7
##   term        estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   1.90      0.180     10.5   5.32e-26   1.54      2.25  
## 2 age           0.0585    0.0155     3.78  1.57e- 4   0.0282    0.0888
## 3 ranklow      -0.184     0.0850    -2.17  3.03e- 2  -0.351    -0.0178
## 4 rankmedium    0.0798    0.0963     0.829 4.07e- 1  -0.111     0.267</code></pre>
</div>
</div>
</section>
<section id="mating-success-in-relation-to-age-rank-their-interaction" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="mating-success-in-relation-to-age-rank-their-interaction">Mating Success in Relation to Age + Rank + Their Interaction</h4>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success ~ age + rank + age:rank</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>glm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> age <span class="sc">*</span> rank, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## glm(formula = success ~ age * rank, family = "poisson", data = d)
## 
## Coefficients:
##                Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)     1.68099    0.27350   6.146 7.93e-10 ***
## age             0.07821    0.02398   3.261  0.00111 ** 
## ranklow         0.35253    0.39958   0.882  0.37763    
## rankmedium      0.19221    0.47173   0.407  0.68368    
## age:ranklow    -0.04820    0.03514  -1.372  0.17009    
## age:rankmedium -0.01052    0.04037  -0.261  0.79432    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 75.972  on 59  degrees of freedom
## Residual deviance: 50.925  on 54  degrees of freedom
## AIC: 320.63
## 
## Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm3, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 7
##   term           estimate std.error statistic  p.value conf.low conf.high
##   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)      1.68      0.273      6.15  7.93e-10   1.14      2.21  
## 2 age              0.0782    0.0240     3.26  1.11e- 3   0.0311    0.125 
## 3 ranklow          0.353     0.400      0.882 3.78e- 1  -0.433     1.13  
## 4 rankmedium       0.192     0.472      0.407 6.84e- 1  -0.742     1.11  
## 5 age:ranklow     -0.0482    0.0351    -1.37  1.70e- 1  -0.117     0.0208
## 6 age:rankmedium  -0.0105    0.0404    -0.261 7.94e- 1  -0.0894    0.0690</code></pre>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>## lattice theme set by effectsTheme()
## See ?effectsTheme for details.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(glm3, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(glm3, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="23-module_files/figure-html/unnamed-chunk-30-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
</section>
<section id="concept-review" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="concept-review">Concept Review</h2>
<ul>
<li>Generalized linear modeling extends general linear modeling to accommodate response variables that are not continuously distributed (e.g., binary responses, count data, proportion data)</li>
<li>What is being predicted in generalized linear model is some function of the expected value of an observed response, not the observed response <em>per se</em>
<ul>
<li>The link/inverse link function is what connects the response predicted by the GLM back to the scale of the original observed response</li>
</ul></li>
<li>For binary response variables, we use <strong>logistic</strong> regression, where the response variable is natural log of the <strong>odds ratio</strong> between two possible outcomes:</li>
</ul>
<p><span class="math display">\[\ln[\frac{\pi_i}{(1-\pi_i)}] = \beta_0 + \beta_1x_i\]</span></p>
<ul>
<li>For response variables that are open-ended counts, we use <strong>log-linear</strong> or <strong>Poisson regression</strong>, where the response variable is the natural log of the expected value of the count</li>
</ul>
<p><span class="math display">\[\lambda_i = \beta_0 + \beta_1x_i\]</span></p>
<ul>
<li>As with simple (or general) linear models, we can create generalized linear models with more than one predictor variable, with a combination of continuous and categorial predictors, and with interactions between predictors</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./22-module.html" class="pagination-link" aria-label="Model Selection in Regression">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Model Selection in Regression</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./24-module.html" class="pagination-link" aria-label="Mixed Effects or Multilevel Modeling">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Mixed Effects or Multilevel Modeling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb156" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Generalized Linear Models {#module-23}</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objectives</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In this module, we extend our discussion of regression modeling to include generalized linear models.</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install and load this package in ***R***: <span class="co">[</span><span class="ot">{lmtest}</span><span class="co">](https://cran.r-project.org/web/packages/lmtest/lmtest.pdf)</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load {tidyverse} and {broom}</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-15"><a href="#cb156-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb156-16"><a href="#cb156-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb156-17"><a href="#cb156-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb156-18"><a href="#cb156-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb156-19"><a href="#cb156-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb156-20"><a href="#cb156-20" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-21"><a href="#cb156-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-22"><a href="#cb156-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Extending the "General" Model</span></span>
<span id="cb156-23"><a href="#cb156-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-24"><a href="#cb156-24" aria-hidden="true" tabindex="-1"></a>So far, our discussion of regression has centered on standard or "general" linear models that assume that our response variables are continuously distributed and have normally distributed error terms (residuals) from our fitted models and that these error terms show constant variance across the range of our predictor variables. If these assumptions of general linear regression are not met, we can sometimes transform our variables to meet them, but other times we cannot, e.g., when we have binary or count data for a response variable.</span>
<span id="cb156-25"><a href="#cb156-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-26"><a href="#cb156-26" aria-hidden="true" tabindex="-1"></a>In these cases, however, we can use a different regression technique called **generalized linear modeling** instead of general linear modeling. Generalized linear models, then, extend traditional regression models to allow the expected value of our response variable to depend on our predictor variable(s) through what is called a **link function**. It allows the response variable to belong to any of a set of distributions belonging to the "exponential" family (e.g., normal, Poisson, binomial), and it does not require errors (residuals) to be normally distributed. It also does not require homogeneity of variance across the range of predictor variable values and allows for overdispersion (when the observed variance is larger than what the model assumes).</span>
<span id="cb156-27"><a href="#cb156-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-28"><a href="#cb156-28" aria-hidden="true" tabindex="-1"></a>One of the most important differences is that in generalized linear modeling we no longer use ordinary least squares to estimate parameter values, but rather use maximum likelihood or Bayesian approaches.</span>
<span id="cb156-29"><a href="#cb156-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-30"><a href="#cb156-30" aria-hidden="true" tabindex="-1"></a>A generalized linear model consists of three components:</span>
<span id="cb156-31"><a href="#cb156-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-32"><a href="#cb156-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The **systematic or linear component**, which reflects the linear combination of predictor variables in our model. As in general linear regression, these can be be continuous and/or categorical. Interactions between predictors and polynomial functions of predictors can also be included, as in general linear modeling. <span class="co">[</span><span class="ot">Recall that "linear" simply means the regression model is based on linear combinations of regression coefficients, not of variables.</span><span class="co">]</span></span>
<span id="cb156-33"><a href="#cb156-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-34"><a href="#cb156-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The **error structure** or **random component**, which refers to the probability distribution of the response variable and of the residuals in the response variable after the linear component has been removed. The probability distribution in a GLM must be from the exponential family of probability distributions, which includes the *normal* (Gaussian), *Poisson* (e.g., if our response variable consists of count data), *binomial* (e.g., if our response variable is binary, like "yes/no", "presence/absence"), *gamma*, *negative binomial*, etc.</span>
<span id="cb156-35"><a href="#cb156-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-36"><a href="#cb156-36" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>A **link function**, which links the expected value of the response variable to the predictors. You can think of this as a transformation function. In GLM, as in general linear modeling, our linear component yields a predicted value, but this value is not the predicted value of our response variable, $Y$, *per se*. Rather, the predicted value from the regression model needs to be transformed back into a predicted $Y$ by applying the inverse of the link function.</span>
<span id="cb156-37"><a href="#cb156-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-38"><a href="#cb156-38" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** Using a particular link function is not the same as transforming the response variable. With the link function, we are modeling **some function of the expectation of the response variable** for given values of the predictor variables, but not the value of the response itself. Link functions typically transform the discontinuous scale of a categorical response variable to a continuous scale that is unbounded and that can thus be examined using regression. Predicted responses from a GLM (and the associated regression coefficients) typically need to be back-transformed to put them into the more intuitive scale of the original response variable.</span></span>
<span id="cb156-39"><a href="#cb156-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-40"><a href="#cb156-40" aria-hidden="true" tabindex="-1"></a>Common link functions include:</span>
<span id="cb156-41"><a href="#cb156-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-42"><a href="#cb156-42" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The **identity link**, which is used to model $\mu$, the mean value of $Y$ and is what we use implicitly in standard linear models. That is, our standard (or general) linear regression model is a particular case of the generalized linear model.</span>
<span id="cb156-43"><a href="#cb156-43" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The **log link**, which is typically used to model **log(**$\lambda$), the log of the mean value of $Y$. This link function is typically used for modeling for count data.</span>
<span id="cb156-44"><a href="#cb156-44" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The **logit link**, which is **log(**$\pi$/(1-$\pi$)), is typically used for modeling binary data, or "logistic" regression.</span>
<span id="cb156-45"><a href="#cb156-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-46"><a href="#cb156-46" aria-hidden="true" tabindex="-1"></a>| Model      | Error Structure | Canonical Link Function |</span>
<span id="cb156-47"><a href="#cb156-47" aria-hidden="true" tabindex="-1"></a>|------------|-----------------|-------------------------|</span>
<span id="cb156-48"><a href="#cb156-48" aria-hidden="true" tabindex="-1"></a>| linear     | Gaussian        | identity                |</span>
<span id="cb156-49"><a href="#cb156-49" aria-hidden="true" tabindex="-1"></a>| log linear | Poisson         | log                     |</span>
<span id="cb156-50"><a href="#cb156-50" aria-hidden="true" tabindex="-1"></a>| logistic   | binomial        | logit                   |</span>
<span id="cb156-51"><a href="#cb156-51" aria-hidden="true" tabindex="-1"></a>| gamma      | Gamma           | reciprocal (inverse)    |</span>
<span id="cb156-52"><a href="#cb156-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-53"><a href="#cb156-53" aria-hidden="true" tabindex="-1"></a>Standard or "general" linear regression can be viewed as a special case of GLM, where the random component of our model has a *normal distribution* and the link function is the *identity link* so that we are modeling an expected (mean) value for $Y$.</span>
<span id="cb156-54"><a href="#cb156-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-55"><a href="#cb156-55" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Fitting in GLM</span></span>
<span id="cb156-56"><a href="#cb156-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-57"><a href="#cb156-57" aria-hidden="true" tabindex="-1"></a>Model fitting and parameter estimation in GLM is commonly done using a maximum likelihood approach, which is an iterative process. To determine the fit of a given model, a GLM evaluates a linear predictor for each value of the response variable with a particular set of parameter values (i.e., $\beta$ coefficients), then back-transforms the predicted value into the scale of the $Y$ variable using the inverse of the link function. These predicted values are compared with the observed values of $Y$. The parameters are then adjusted, and the model is refitted on the transformed scale in an iterative procedure until the fit stops improving. In ML approaches, then, the data are taken as a given, and we are trying to find the most likely parameter values and model to fit those data. We judge the fit of the particular model of the basis of **how likely the data would be if the model were correct.**</span>
<span id="cb156-58"><a href="#cb156-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-59"><a href="#cb156-59" aria-hidden="true" tabindex="-1"></a>The measure of discrepancy used in a GLM to assess the goodness of fit of the model to the data is called the **deviance**, which we can think of as analogous to the variance in a general linear model. Deviance is defined as **2** $\times$ (the log-likelihood of a "fully saturated" model minus the log-likelihood of the proposed model). The former is a model that fits the data perfectly. Its likelihood is 1 and its log-likelihood is thus 0, so deviance functionally can be calculated as **-2** $\times$ log-likelihood of the proposed model. Because the saturated model does not depend on any estimated parameters and has a likelihood of 1, *minimizing the deviance* for a particular model is the same as *maximizing the likelihood*. [For the ML process of parameter estimation, it is actually mathematically easier to maximize the log-likelihood, **ln(L)**, than it is to maximize the likelihood, **L**, so computationally that is what is usually done.] In generalized linear regression, the sum of squared "deviance residuals" of all the data points is analogous to the sum of squares of the residuals in a standard linear regression (i.e., this is what the model does not explain).</span>
<span id="cb156-60"><a href="#cb156-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-61"><a href="#cb156-61" aria-hidden="true" tabindex="-1"></a>The <span class="in">`glm()`</span> function in ***R*** can be used for many types of generalized linear modeling, using a similar formula notation to that we've used before, with an additional argument, <span class="in">`family=`</span>, to specify the kind of error structure we expect in the response variable ("gaussian", "poisson", "binomial", etc.): <span class="in">`glm(y ~ x, family = "gaussian")`</span></span>
<span id="cb156-62"><a href="#cb156-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-65"><a href="#cb156-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-66"><a href="#cb156-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-67"><a href="#cb156-67" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/zombies.csv"</span></span>
<span id="cb156-68"><a href="#cb156-68" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb156-69"><a href="#cb156-69" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> age)</span>
<span id="cb156-70"><a href="#cb156-70" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm)</span>
<span id="cb156-71"><a href="#cb156-71" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> age, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb156-72"><a href="#cb156-72" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span>
<span id="cb156-73"><a href="#cb156-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-74"><a href="#cb156-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-75"><a href="#cb156-75" aria-hidden="true" tabindex="-1"></a>As with previous models, our explanatory variable, $X$, can be continuous (leading to a regression analysis) or categorical (leading to an ANOVA-like procedure called an *analysis of deviance*) or both.</span>
<span id="cb156-76"><a href="#cb156-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-79"><a href="#cb156-79" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-80"><a href="#cb156-80" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-81"><a href="#cb156-81" aria-hidden="true" tabindex="-1"></a>z<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(z<span class="sc">$</span>gender)</span>
<span id="cb156-82"><a href="#cb156-82" aria-hidden="true" tabindex="-1"></a>lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> gender)</span>
<span id="cb156-83"><a href="#cb156-83" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm)</span>
<span id="cb156-84"><a href="#cb156-84" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> z, height <span class="sc">~</span> weight <span class="sc">+</span> gender, <span class="at">family =</span> <span class="st">"gaussian"</span>)</span>
<span id="cb156-85"><a href="#cb156-85" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span>
<span id="cb156-86"><a href="#cb156-86" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-87"><a href="#cb156-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-88"><a href="#cb156-88" aria-hidden="true" tabindex="-1"></a><span class="fu">## Common Types of GLMs</span></span>
<span id="cb156-89"><a href="#cb156-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-90"><a href="#cb156-90" aria-hidden="true" tabindex="-1"></a>We will explore two types of GLMs... **logistic regression** (used when our response variable is binary) and **log-linear or Poisson regression** (used when our response variable is count data).</span>
<span id="cb156-91"><a href="#cb156-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-92"><a href="#cb156-92" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic Regression {.unnumbered}</span></span>
<span id="cb156-93"><a href="#cb156-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-94"><a href="#cb156-94" aria-hidden="true" tabindex="-1"></a>As alluded to above, when we have a binary response variable (i.e., a categorical variable with two levels, 0 or 1), we actually are interested in modeling $\pi_i$, which is the *probability that* $Y$ equals 1 for a given value of $X$ ($x_i$), rather than $\mu_i$, the *mean value of* $Y$ for a given $X$, which is what we typically model with general linear regression. The usual model we fit to such data is the logistic regression model, which is a nonlinear model with a sigmoidal shape. The errors or residuals from such a model are not normally distributed but rather have a binomial distribution.</span>
<span id="cb156-95"><a href="#cb156-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-96"><a href="#cb156-96" aria-hidden="true" tabindex="-1"></a>When we do our regression, we actually use as our response variable the natural log of the **odds ratio** between our two possible outcomes, i.e., the ratio of the probabilities that $y_i$ = 1 versus that $y_i$ = 0 for a given $x_i$, a ratio which we call the *logit*:</span>
<span id="cb156-97"><a href="#cb156-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-98"><a href="#cb156-98" aria-hidden="true" tabindex="-1"></a>$$g = logit(\pi_i) = \ln<span class="co">[</span><span class="ot">\frac{\pi_i}{(1-\pi_i)}</span><span class="co">]</span> = \beta_0 + \beta_1x_i$$</span>
<span id="cb156-99"><a href="#cb156-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-100"><a href="#cb156-100" aria-hidden="true" tabindex="-1"></a>where $\pi_i$ = the probability that $y_i$ equals 1 for a given value of $x_i$ and $(1-\pi)$ = the probability that $y_i$ equals 0.</span>
<span id="cb156-101"><a href="#cb156-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-102"><a href="#cb156-102" aria-hidden="true" tabindex="-1"></a>The *logit* transformation, then, is the link function connecting $Y$ to our predictors. The logit is useful as it converts probabilities, which lie in the range 0 to 1, into the scale of the whole real number line.</span>
<span id="cb156-103"><a href="#cb156-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-104"><a href="#cb156-104" aria-hidden="true" tabindex="-1"></a>We can convert back from the *natural log of the odds ratio* to an actual odds ratio using the inverse of the *logit*, which is called the *expit*:</span>
<span id="cb156-105"><a href="#cb156-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-106"><a href="#cb156-106" aria-hidden="true" tabindex="-1"></a>$$expit(g) = \frac{e^{g_i}}{1+e^{g_i}} = \frac{1}{1+e^{-g_i}}=p_i$$</span>
<span id="cb156-107"><a href="#cb156-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-108"><a href="#cb156-108" aria-hidden="true" tabindex="-1"></a><span class="fu">### EXAMPLE: {.unnumbered}</span></span>
<span id="cb156-109"><a href="#cb156-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-110"><a href="#cb156-110" aria-hidden="true" tabindex="-1"></a>Suppose we are interested in how a students' GRE scores, grade point averages (GPA), and ranking of their undergraduate institution (into quartiles, 1 to 4, from high to low), affect admission into graduate school. The response variable, "admitted/not admitted", is a binary variable, scored as 1/0.</span>
<span id="cb156-111"><a href="#cb156-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-112"><a href="#cb156-112" aria-hidden="true" tabindex="-1"></a>Load in the "graddata.csv" dataset, which comes from <span class="co">[</span><span class="ot">this website</span><span class="co">](https://stats.idre.ucla.edu/other/dae/)</span>, and then explore it using <span class="in">`head()`</span>, <span class="in">`summary()`</span>, <span class="in">`plot()`</span>, <span class="in">`pairs()`</span>, and <span class="in">`table()`</span>.</span>
<span id="cb156-113"><a href="#cb156-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-116"><a href="#cb156-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-117"><a href="#cb156-117" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-118"><a href="#cb156-118" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/graddata.csv"</span></span>
<span id="cb156-119"><a href="#cb156-119" aria-hidden="true" tabindex="-1"></a><span class="co"># or f &lt;- "https://stats.idre.ucla.edu/stat/data/binary.csv"</span></span>
<span id="cb156-120"><a href="#cb156-120" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb156-121"><a href="#cb156-121" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>rank <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>rank)</span>
<span id="cb156-122"><a href="#cb156-122" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb156-123"><a href="#cb156-123" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span>
<span id="cb156-124"><a href="#cb156-124" aria-hidden="true" tabindex="-1"></a><span class="co"># first, some exploratory visualization</span></span>
<span id="cb156-125"><a href="#cb156-125" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">color=</span><span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb156-126"><a href="#cb156-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GPA"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Admit"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(Y) versus GPA"</span>)</span>
<span id="cb156-127"><a href="#cb156-127" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb156-128"><a href="#cb156-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GRE"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Admit"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(Y) versus GRE"</span>)</span>
<span id="cb156-129"><a href="#cb156-129" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb156-130"><a href="#cb156-130" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q</span>
<span id="cb156-131"><a href="#cb156-131" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>patchwork)</span>
<span id="cb156-132"><a href="#cb156-132" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d)</span>
<span id="cb156-133"><a href="#cb156-133" aria-hidden="true" tabindex="-1"></a>(t <span class="ot">&lt;-</span> <span class="fu">group_by</span>(d, admit, rank) <span class="sc">|&gt;</span></span>
<span id="cb156-134"><a href="#cb156-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb156-135"><a href="#cb156-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> rank, <span class="at">values_from =</span> n))</span>
<span id="cb156-136"><a href="#cb156-136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-137"><a href="#cb156-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-138"><a href="#cb156-138" aria-hidden="true" tabindex="-1"></a>To use logistic regression to look at how the *odds of admission* is influenced by *GRE scores*, we can call the `glm()` function with a model where **admit** is our response variable and **gre** is our predictor variable.</span>
<span id="cb156-139"><a href="#cb156-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-142"><a href="#cb156-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-143"><a href="#cb156-143" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of admit~gre</span></span>
<span id="cb156-144"><a href="#cb156-144" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> gre, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb156-145"><a href="#cb156-145" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span>
<span id="cb156-146"><a href="#cb156-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-147"><a href="#cb156-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-148"><a href="#cb156-148" aria-hidden="true" tabindex="-1"></a>Here is the equation representing the results of our model: $$logit(\pi_i) = -2.901344 + 0.003582 \times {gre}$$</span>
<span id="cb156-149"><a href="#cb156-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-150"><a href="#cb156-150" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Interpretation and Hypothesis Testing {.unnumbered}</span></span>
<span id="cb156-151"><a href="#cb156-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-152"><a href="#cb156-152" aria-hidden="true" tabindex="-1"></a>When we get a $\beta_1$ estimate from a logistic regression, it represents the *change in the log(odds ratio)* of the **outcome** for an increase in one unit of our predictor variable, $X$.</span>
<span id="cb156-153"><a href="#cb156-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-154"><a href="#cb156-154" aria-hidden="true" tabindex="-1"></a>Looking at the coefficient for **gre**, we see it is positive and, while low, it is significantly different from 0. Thus, increasing GRE score results in an increase in the log(odds ratio) of admission (i.e., students with higher scores are more likely to be admitted). Here, for every one unit change in **gre**, the log odds of admission (versus non-admission) increases by 0.018172.</span>
<span id="cb156-155"><a href="#cb156-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-156"><a href="#cb156-156" aria-hidden="true" tabindex="-1"></a>Using the <span class="in">`predict()`</span> function, we can plot our data and fit the change in the admitted/not admitted ratio across the range of GRE scores.</span>
<span id="cb156-157"><a href="#cb156-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-160"><a href="#cb156-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-161"><a href="#cb156-161" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(d<span class="sc">$</span>gre), <span class="at">to =</span> <span class="fu">max</span>(d<span class="sc">$</span>gre), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb156-162"><a href="#cb156-162" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">100</span>, <span class="at">to =</span> <span class="dv">900</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb156-163"><a href="#cb156-163" aria-hidden="true" tabindex="-1"></a>logOR <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">gre=</span>x))</span>
<span id="cb156-164"><a href="#cb156-164" aria-hidden="true" tabindex="-1"></a><span class="co"># this function will predict the log(odds ratio)... but if we add</span></span>
<span id="cb156-165"><a href="#cb156-165" aria-hidden="true" tabindex="-1"></a><span class="co"># the argument `type="response"`, the `predict()` function will return</span></span>
<span id="cb156-166"><a href="#cb156-166" aria-hidden="true" tabindex="-1"></a><span class="co"># the expected response on the scale of the Y variable, i.e., Pr(Y)</span></span>
<span id="cb156-167"><a href="#cb156-167" aria-hidden="true" tabindex="-1"></a><span class="co"># running the `exp()` function, i.e., `exp(logOR)` will yield the</span></span>
<span id="cb156-168"><a href="#cb156-168" aria-hidden="true" tabindex="-1"></a><span class="co"># actual odds ratio!</span></span>
<span id="cb156-169"><a href="#cb156-169" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(glm, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">gre =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb156-170"><a href="#cb156-170" aria-hidden="true" tabindex="-1"></a>OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(logOR)</span>
<span id="cb156-171"><a href="#cb156-171" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> x, <span class="at">logOR =</span> logOR, <span class="at">pr_admit =</span> y, <span class="at">OR =</span> OR)</span>
<span id="cb156-172"><a href="#cb156-172" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(res)</span>
<span id="cb156-173"><a href="#cb156-173" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(res)</span>
<span id="cb156-174"><a href="#cb156-174" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gre, <span class="at">y =</span> admit)) <span class="sc">+</span></span>
<span id="cb156-175"><a href="#cb156-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GRE Score"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Pr(admit)"</span>) <span class="sc">+</span></span>
<span id="cb156-176"><a href="#cb156-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Pr(admit) versus GRE Score"</span>) <span class="sc">+</span></span>
<span id="cb156-177"><a href="#cb156-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> res, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> pr_admit))</span>
<span id="cb156-178"><a href="#cb156-178" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb156-179"><a href="#cb156-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-180"><a href="#cb156-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-181"><a href="#cb156-181" aria-hidden="true" tabindex="-1"></a>By exponentiating the regression coefficient, $\beta_1$, we can get the actual odds ratio change, as opposed to the log(odds ratio) change, associated with a 1 unit change in GRE score.</span>
<span id="cb156-182"><a href="#cb156-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-185"><a href="#cb156-185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-186"><a href="#cb156-186" aria-hidden="true" tabindex="-1"></a>(ORchange <span class="ot">&lt;-</span> <span class="fu">exp</span>(glm<span class="sc">$</span>coefficients[<span class="dv">2</span>]))</span>
<span id="cb156-187"><a href="#cb156-187" aria-hidden="true" tabindex="-1"></a><span class="co"># a 1 unit increase in gre results in a 0.36% increase in the odds of admission</span></span>
<span id="cb156-188"><a href="#cb156-188" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-189"><a href="#cb156-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-190"><a href="#cb156-190" aria-hidden="true" tabindex="-1"></a>As in simple (general) linear regression, the key null hypothesis, $H_0$, of relevance when fitting a simple logistic regression model is that our regression coefficient, $\beta$, is zero, i.e. that there is no relationship between the binary response variable and the predictor variable.</span>
<span id="cb156-191"><a href="#cb156-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-192"><a href="#cb156-192" aria-hidden="true" tabindex="-1"></a>There are two common ways to test this $H_0$. The first is to calculate the **Wald statistic** for the predictor variable and compare this to the standard normal or $z$ distribution. This is like a maximum likelihood-based version of a **t test**. The Wald statistic is, like a t statistic, our $\beta$ parameter estimate divided by the standard error of that estimate: $\frac{\beta_1}{SE( \beta_1)}$). This is most appropriate when sample sizes are large. The "z value" in the summary table for the model shows us the value of the Wald statistic.</span>
<span id="cb156-193"><a href="#cb156-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-196"><a href="#cb156-196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-197"><a href="#cb156-197" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span>
<span id="cb156-198"><a href="#cb156-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-199"><a href="#cb156-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-200"><a href="#cb156-200" aria-hidden="true" tabindex="-1"></a>If we wanted to calculate the Wald statistic by hand, we can do so easily. Below, we use the convenient <span class="in">`tidy()`</span> function from the {broom} package to pull out a table of results from our GLM very easily. Note that <span class="in">`tidy()`</span> works on lots of different linear model objects, e.g., those created by <span class="in">`lm()`</span> and <span class="in">`glm()`</span> (though not <span class="in">`lmer()`</span>).</span>
<span id="cb156-201"><a href="#cb156-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-204"><a href="#cb156-204" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-205"><a href="#cb156-205" aria-hidden="true" tabindex="-1"></a>(results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm))</span>
<span id="cb156-206"><a href="#cb156-206" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>wald <span class="ot">&lt;-</span> results<span class="sc">$</span>estimate<span class="sc">/</span>results<span class="sc">$</span>std.error</span>
<span id="cb156-207"><a href="#cb156-207" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>p <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(results<span class="sc">$</span>wald)))</span>
<span id="cb156-208"><a href="#cb156-208" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 tailed p value associated with the Wald statistic</span></span>
<span id="cb156-209"><a href="#cb156-209" aria-hidden="true" tabindex="-1"></a>results</span>
<span id="cb156-210"><a href="#cb156-210" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-211"><a href="#cb156-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-212"><a href="#cb156-212" aria-hidden="true" tabindex="-1"></a>Just as when running an <span class="in">`lm()`</span>, we can get the confidence intervals around our <span class="in">`glm()`</span> model estimates several different ways. First, we can use the <span class="in">`confint()`</span> function, giving our GLM model results as an argument, which yields a CI based on a maximum likelihood approach.</span>
<span id="cb156-213"><a href="#cb156-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-216"><a href="#cb156-216" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-217"><a href="#cb156-217" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb156-218"><a href="#cb156-218" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb156-219"><a href="#cb156-219" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(glm, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha))</span>
<span id="cb156-220"><a href="#cb156-220" aria-hidden="true" tabindex="-1"></a><span class="co"># this function returns a CI based on log-likelihood, an iterative ML process</span></span>
<span id="cb156-221"><a href="#cb156-221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-222"><a href="#cb156-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-223"><a href="#cb156-223" aria-hidden="true" tabindex="-1"></a>Alternatively, we can use the <span class="in">`confint.default()`</span> function, which returns a CI based on standard errors, the way we have calculated them by hand previously.</span>
<span id="cb156-224"><a href="#cb156-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-227"><a href="#cb156-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-228"><a href="#cb156-228" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> <span class="fu">confint.default</span>(glm, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha))</span>
<span id="cb156-229"><a href="#cb156-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-230"><a href="#cb156-230" aria-hidden="true" tabindex="-1"></a><span class="co"># which is equivalent to how we have calculated CIs previously</span></span>
<span id="cb156-231"><a href="#cb156-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-232"><a href="#cb156-232" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>lower <span class="ot">&lt;-</span> results<span class="sc">$</span>estimate <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> results<span class="sc">$</span>std.error</span>
<span id="cb156-233"><a href="#cb156-233" aria-hidden="true" tabindex="-1"></a>results<span class="sc">$</span>upper <span class="ot">&lt;-</span> results<span class="sc">$</span>estimate <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> results<span class="sc">$</span>std.error</span>
<span id="cb156-234"><a href="#cb156-234" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> results[, <span class="fu">c</span>(<span class="st">"term"</span>, <span class="st">"lower"</span>, <span class="st">"upper"</span>)])</span>
<span id="cb156-235"><a href="#cb156-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-236"><a href="#cb156-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-237"><a href="#cb156-237" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb156-238"><a href="#cb156-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-239"><a href="#cb156-239" aria-hidden="true" tabindex="-1"></a>Repeat the logistic regression above, but using **gpa** rather than **gre** as the predictor variable.</span>
<span id="cb156-240"><a href="#cb156-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-241"><a href="#cb156-241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Is **gpa** a significant predictor of the odds of admission?</span>
<span id="cb156-242"><a href="#cb156-242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What is the estimate of $\beta_1$ and the 95% CI around that estimate?</span>
<span id="cb156-243"><a href="#cb156-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>How much does an increase of 1 unit in **gpa** increase the actual *odds ratio* (as opposed to the *log(odds ratio)* for admission?</span>
<span id="cb156-244"><a href="#cb156-244" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What is the 95% CI around this odds ratio?</span>
<span id="cb156-245"><a href="#cb156-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-246"><a href="#cb156-246" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **HINT:** For the latter two questions, you will need to apply the </span><span class="in">`exp()`</span><span class="at"> function and convert the *log(odds ratio)* into an actual *odds ratio*.</span></span>
<span id="cb156-247"><a href="#cb156-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-250"><a href="#cb156-250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-251"><a href="#cb156-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-252"><a href="#cb156-252" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb156-253"><a href="#cb156-253" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> gpa, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb156-254"><a href="#cb156-254" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span>
<span id="cb156-255"><a href="#cb156-255" aria-hidden="true" tabindex="-1"></a>(logOR <span class="ot">&lt;-</span> glm<span class="sc">$</span>coefficients) <span class="co"># pull out coefficients</span></span>
<span id="cb156-256"><a href="#cb156-256" aria-hidden="true" tabindex="-1"></a>(CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(glm, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha)) <span class="co"># calculate CIs</span></span>
<span id="cb156-257"><a href="#cb156-257" aria-hidden="true" tabindex="-1"></a><span class="co"># exponentiate to convert to odds ratio scale instead of log(odds ratio)</span></span>
<span id="cb156-258"><a href="#cb156-258" aria-hidden="true" tabindex="-1"></a>(OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(logOR)) </span>
<span id="cb156-259"><a href="#cb156-259" aria-hidden="true" tabindex="-1"></a>(CI_OR <span class="ot">&lt;-</span> <span class="fu">exp</span>(CI)) <span class="co"># exponentiate to convert to odds ratio scal</span></span>
<span id="cb156-260"><a href="#cb156-260" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-261"><a href="#cb156-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-262"><a href="#cb156-262" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Graph the **probability of admission**, i.e., *Pr(admit)* or $\pi_i$, for students with GPAs between 2.0 and 4.0 GPAs, superimposed on a point plot of admission (0 or 1) by **gpa**.</span>
<span id="cb156-263"><a href="#cb156-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-264"><a href="#cb156-264" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **HINT:** Use the </span><span class="in">`predict()`</span><span class="at"> function with </span><span class="in">`type="response"`</span><span class="at"> to yield $\pi_i$ directly.</span></span>
<span id="cb156-265"><a href="#cb156-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-268"><a href="#cb156-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-269"><a href="#cb156-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-270"><a href="#cb156-270" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">gpa =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb156-271"><a href="#cb156-271" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">gpa =</span> x,</span>
<span id="cb156-272"><a href="#cb156-272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(glm, <span class="at">newdata =</span> x, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>))</span>
<span id="cb156-273"><a href="#cb156-273" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: Using type="response" returns predictions on the scale of</span></span>
<span id="cb156-274"><a href="#cb156-274" aria-hidden="true" tabindex="-1"></a><span class="co"># the Y variable, in this case Pr(admit). Using the default for the</span></span>
<span id="cb156-275"><a href="#cb156-275" aria-hidden="true" tabindex="-1"></a><span class="co"># `type=` argument would return a prediction on the logit scale, i.e.,</span></span>
<span id="cb156-276"><a href="#cb156-276" aria-hidden="true" tabindex="-1"></a><span class="co"># the log(odds ratio), which equals log(Pr(admit)/(1-Pr(admit)))</span></span>
<span id="cb156-277"><a href="#cb156-277" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span>
<span id="cb156-278"><a href="#cb156-278" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> prediction, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> fit)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb156-279"><a href="#cb156-279" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GPA"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Pr(admit)"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(admit) versus GPA"</span>) <span class="sc">+</span></span>
<span id="cb156-280"><a href="#cb156-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb156-281"><a href="#cb156-281" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb156-282"><a href="#cb156-282" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-283"><a href="#cb156-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-284"><a href="#cb156-284" aria-hidden="true" tabindex="-1"></a>The <span class="in">`predict()`</span> function can also be used to get confidence intervals around our estimate of the log(odds of admission) (if the <span class="in">`type=`</span> argument is unspecified or set to "link"), or around the estimate of the probability of admission (if the <span class="in">`type=`</span> argument is set to "response"), by using the argument <span class="in">`se.fit=TRUE`</span>.</span>
<span id="cb156-285"><a href="#cb156-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-288"><a href="#cb156-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-289"><a href="#cb156-289" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb156-290"><a href="#cb156-290" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">gpa =</span> x,</span>
<span id="cb156-291"><a href="#cb156-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(glm, <span class="at">newdata =</span> x, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>))</span>
<span id="cb156-292"><a href="#cb156-292" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>lower <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb156-293"><a href="#cb156-293" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>upper <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb156-294"><a href="#cb156-294" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span>
<span id="cb156-295"><a href="#cb156-295" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(prediction, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> fit)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb156-296"><a href="#cb156-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"GPA"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Pr(admit)"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Pr(admit) versus GPA"</span>) <span class="sc">+</span></span>
<span id="cb156-297"><a href="#cb156-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb156-298"><a href="#cb156-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> gpa, <span class="at">y =</span> admit), <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb156-299"><a href="#cb156-299" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb156-300"><a href="#cb156-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-301"><a href="#cb156-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-302"><a href="#cb156-302" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Likelihood Ratio Tests {.unnumbered}</span></span>
<span id="cb156-303"><a href="#cb156-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-304"><a href="#cb156-304" aria-hidden="true" tabindex="-1"></a>To evaluate the significance of an **overall model** in a logistic regression, we can compare the fit of a more complex model to that of a nested, reduced model, just as when we discussed model selection approaches for simple linear regression using **partial F tests**.</span>
<span id="cb156-305"><a href="#cb156-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-306"><a href="#cb156-306" aria-hidden="true" tabindex="-1"></a>For example, to test the null hypothesis of $\beta_1$ = 0 for a simple logistic regression model with a single predictor, we would compare the log-likelihood of the full model to that of the reduced, intercept only model. This is called a **likelihood ratio test**. Likelihood ratio tests are very similar to partial F tests in that they compare the full model with a nested, reduced model where the explanatory variables of interest are omitted. Now, however, instead of using a test statistic based on a ratio of *variances* explained by the two models and interpreting that by comparison to an $F$ distribution, we create a test statistic that is a ratio of the *log-likelihoods* of the two models and interpret that statistic by comparison to a $\chi^2$ distribution with a given number of degrees of freedom. Still, the underlying idea is conceptually the same.</span>
<span id="cb156-307"><a href="#cb156-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-308"><a href="#cb156-308" aria-hidden="true" tabindex="-1"></a>A likelihood ratio test comparing a proposed and reduced model can be performed using the <span class="in">`anova()`</span> function where we specify the <span class="in">`test=`</span> argument to be either <span class="in">`LRT`</span> or <span class="in">`Chisq`</span> (these are equivalent).</span>
<span id="cb156-309"><a href="#cb156-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-310"><a href="#cb156-310" aria-hidden="true" tabindex="-1"></a>Recall that when we used the <span class="in">`anova()`</span> function to run F ratio tests to compare the proportion of **variance** explained by two general linear models, we specified that `test = "F" and generated an F statistic which was considered relative to an F distribution to calculate a p value. With generalized linear models, because we are working with deviances and likelihood ratios, the test statistic we generate is *ratio of likelihoods* (which is equivalent to a difference in deviances, see below) rather than a *ratio of variances*. That statistic is then considered relative to a $\chi^2$ distribution to determine the p value. The relevant degrees of freedom for the likelihood ratio test is the **\# of parameters in the proposed model minus the \# parameters in the nested model** (here, df = 2 - 1 = 1).</span>
<span id="cb156-311"><a href="#cb156-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-314"><a href="#cb156-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-315"><a href="#cb156-315" aria-hidden="true" tabindex="-1"></a>proposed <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> gpa, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb156-316"><a href="#cb156-316" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb156-317"><a href="#cb156-317" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, proposed, <span class="at">test =</span> <span class="st">"LRT"</span>) <span class="co"># or `test = "Chisq")</span></span>
<span id="cb156-318"><a href="#cb156-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-319"><a href="#cb156-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-320"><a href="#cb156-320" aria-hidden="true" tabindex="-1"></a>With this low p value, we would reject the null hypothesis that removing the variable of interest (*gpa*) from our model does not result in a loss of fit. </span>
<span id="cb156-321"><a href="#cb156-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-322"><a href="#cb156-322" aria-hidden="true" tabindex="-1"></a>Alternatively, we could use the function <span class="in">`lrtest()`</span> from the {lmtest} package to do the same likelihood ratio test of the two models.</span>
<span id="cb156-323"><a href="#cb156-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-326"><a href="#cb156-326" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-327"><a href="#cb156-327" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span> (reduced, proposed)</span>
<span id="cb156-328"><a href="#cb156-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-329"><a href="#cb156-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-330"><a href="#cb156-330" aria-hidden="true" tabindex="-1"></a>We can also perform a likelihood ratio test by hand by taking the difference between the *deviances* of the two models. The deviance for a generalized linear model is analogous to the the residual sum of squares (i.e., unexplained variance) in a general linear model - i.e, lower deviance and lower RSS both mean better models. Deviance is calculated as a kind of "distance" of given model from a fully "saturated" model, i.e., a model where each data point has its own parameters. The likelihood of a fully "saturated" model is 1, thus its log-likelihood is log(1) = 0.</span>
<span id="cb156-331"><a href="#cb156-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-332"><a href="#cb156-332" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*Deviance* = 2 $\times$ (log-likelihood of the saturated model - log-likelihood of the proposed model)</span>
<span id="cb156-333"><a href="#cb156-333" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*Deviance* = 2 $\times$ (0 - log-likelihood of the proposed model)</span>
<span id="cb156-334"><a href="#cb156-334" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*Deviance* = -2 $\times$ (log-likelihood of the proposed model)</span>
<span id="cb156-335"><a href="#cb156-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-336"><a href="#cb156-336" aria-hidden="true" tabindex="-1"></a>We can get the deviance associated with a given glm model object by accessing its <span class="in">`$deviance`</span> slot or by using the <span class="in">`deviance()`</span> function with the model object as an argument.</span>
<span id="cb156-337"><a href="#cb156-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-340"><a href="#cb156-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-341"><a href="#cb156-341" aria-hidden="true" tabindex="-1"></a><span class="co"># deviance of intercept only model</span></span>
<span id="cb156-342"><a href="#cb156-342" aria-hidden="true" tabindex="-1"></a>(D_reduced <span class="ot">&lt;-</span> reduced<span class="sc">$</span>deviance)</span>
<span id="cb156-343"><a href="#cb156-343" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb156-344"><a href="#cb156-344" aria-hidden="true" tabindex="-1"></a>(D_reduced <span class="ot">&lt;-</span> <span class="fu">deviance</span>(reduced))</span>
<span id="cb156-345"><a href="#cb156-345" aria-hidden="true" tabindex="-1"></a><span class="co"># deviance of proposed model with intercept and one predictor</span></span>
<span id="cb156-346"><a href="#cb156-346" aria-hidden="true" tabindex="-1"></a>(D_proposed <span class="ot">&lt;-</span> proposed<span class="sc">$</span>deviance)</span>
<span id="cb156-347"><a href="#cb156-347" aria-hidden="true" tabindex="-1"></a><span class="co"># or...</span></span>
<span id="cb156-348"><a href="#cb156-348" aria-hidden="true" tabindex="-1"></a>(D_proposed <span class="ot">&lt;-</span> <span class="fu">deviance</span>(proposed))</span>
<span id="cb156-349"><a href="#cb156-349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-350"><a href="#cb156-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-351"><a href="#cb156-351" aria-hidden="true" tabindex="-1"></a>The $\chi^2$ statistic is then just the difference of the deviances...</span>
<span id="cb156-352"><a href="#cb156-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-355"><a href="#cb156-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-356"><a href="#cb156-356" aria-hidden="true" tabindex="-1"></a>(chisq <span class="ot">&lt;-</span> D_reduced <span class="sc">-</span> D_proposed)</span>
<span id="cb156-357"><a href="#cb156-357" aria-hidden="true" tabindex="-1"></a><span class="co"># this is a measure of how much the fit improves by adding in the predictor</span></span>
<span id="cb156-358"><a href="#cb156-358" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(chisq, <span class="at">df =</span> <span class="dv">1</span>))</span>
<span id="cb156-359"><a href="#cb156-359" aria-hidden="true" tabindex="-1"></a><span class="co"># df = difference in number of parameters in the proposed versus reduced model</span></span>
<span id="cb156-360"><a href="#cb156-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-361"><a href="#cb156-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-362"><a href="#cb156-362" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$null.deviance`</span> slot of a model object returns, for any model, the deviance associated with an intercept only null model.</span>
<span id="cb156-363"><a href="#cb156-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-366"><a href="#cb156-366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-367"><a href="#cb156-367" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> reduced<span class="sc">$</span>null.deviance <span class="sc">-</span> reduced<span class="sc">$</span>deviance)</span>
<span id="cb156-368"><a href="#cb156-368" aria-hidden="true" tabindex="-1"></a><span class="co"># this is essentially 0 because here the `reduced` model *is* the intercept only model!</span></span>
<span id="cb156-369"><a href="#cb156-369" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> <span class="dv">0</span>, <span class="at">df =</span> <span class="dv">0</span>))</span>
<span id="cb156-370"><a href="#cb156-370" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> proposed<span class="sc">$</span>null.deviance <span class="sc">-</span> proposed<span class="sc">$</span>deviance)</span>
<span id="cb156-371"><a href="#cb156-371" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="at">q =</span> x2, <span class="at">df =</span> <span class="dv">1</span>))</span>
<span id="cb156-372"><a href="#cb156-372" aria-hidden="true" tabindex="-1"></a><span class="co"># df = difference in number of parameters in the proposed versus reduced model</span></span>
<span id="cb156-373"><a href="#cb156-373" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-374"><a href="#cb156-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-375"><a href="#cb156-375" aria-hidden="true" tabindex="-1"></a>Here's some additional useful information about interpreting the results of <span class="in">`summary()`</span> from running a logistic regression based on <span class="co">[</span><span class="ot">this post from *StackExchange*</span><span class="co">](http://stats.stackexchange.com/questions/108995/interpreting-residual-and-null-deviance-in-glm-r)</span> and <span class="co">[</span><span class="ot">this post from *The Analysis Factor*</span><span class="co">](http://www.theanalysisfactor.com/r-glm-model-fit/)</span></span>
<span id="cb156-376"><a href="#cb156-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-377"><a href="#cb156-377" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Let $n$ = the number of observations in the data set and $K$ = the number of predictor terms in a proposed model.</span></span>
<span id="cb156-378"><a href="#cb156-378" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-379"><a href="#cb156-379" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - The *Saturated Model* is a model that assumes each data point has its own parameter, which means we have $n$ parameters to describe the data</span></span>
<span id="cb156-380"><a href="#cb156-380" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-381"><a href="#cb156-381" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - The *Null Model* is a model that assumes exactly the opposite, i.e., one parameter describes all of the data points, which means only 1 parameter, the intercept, is estimated from the data</span></span>
<span id="cb156-382"><a href="#cb156-382" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-383"><a href="#cb156-383" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - The *Proposed Model* is the model we are fitting by GLM, which has $K$ parameters terms (1 for the intercept, plus 1 for each predictor variable/interaction term)</span></span>
<span id="cb156-384"><a href="#cb156-384" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-385"><a href="#cb156-385" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - *Null Deviance* = deviance of the Null Model, calculated as *2(log-likelihood of the Saturated Model* $-$ log-likelihood of a Null Model), where df = $n$ - 1</span></span>
<span id="cb156-386"><a href="#cb156-386" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-387"><a href="#cb156-387" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; - *Residual Deviance* = *2(log-likelihood of the saturated model* $-$ log-likelihood of the proposed model), where df = $n$ - $K$</span></span>
<span id="cb156-388"><a href="#cb156-388" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-389"><a href="#cb156-389" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; If the null deviance is really small, it means that the *Null Model* explains the data pretty well. Likewise, if the residual deviance is really small, then the *Proposed Model* explains the data pretty well.</span></span>
<span id="cb156-390"><a href="#cb156-390" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-391"><a href="#cb156-391" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; If you want to compare a *Proposed Model* against a *Null*, or intercept-only model, then you can look at *Null Deviance* $-$ *Residual Deviance* for that model, which yields a difference that can be examined against a $\chi^2$ distribution with $K$ degrees of freedom.</span></span>
<span id="cb156-392"><a href="#cb156-392" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-393"><a href="#cb156-393" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; If you want to compare one *Proposed Model* against a nested *Reduced Model*, then you can look at *Residual Deviance for the Reduced Model* $-$ *Residual Deviance for the Proposed Model*, which again yields a difference that can be examined against a $\chi^2$ distribution with df = ($K$ for Proposed Model) - ($K$ for Reduced Model).</span></span>
<span id="cb156-394"><a href="#cb156-394" aria-hidden="true" tabindex="-1"></a><span class="at">&gt;</span></span>
<span id="cb156-395"><a href="#cb156-395" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; This deviance-based, $\chi^2$-like statistic is also referred to as a **G Square** or **G** statistic. If the p value associated with this statistic is less than the alpha level, it means that the the fuller model is associated with significantly reduced deviance relative to the nested reduced model, and thus has a better fit. We would thus reject the null hypothesis that the fuller model is not better than the reduced one.</span></span>
<span id="cb156-396"><a href="#cb156-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-397"><a href="#cb156-397" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Multiple Logistic Regression {.unnumbered}</span></span>
<span id="cb156-398"><a href="#cb156-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-399"><a href="#cb156-399" aria-hidden="true" tabindex="-1"></a>Logistic regression can be easily extended to situations with multiple predictor variables, including both continuous and categorical variables, as in our discussion of multiple regression under the general linear model.</span>
<span id="cb156-400"><a href="#cb156-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-401"><a href="#cb156-401" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb156-402"><a href="#cb156-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-403"><a href="#cb156-403" aria-hidden="true" tabindex="-1"></a>Using the same "graddata.csv" dataset, run a multiple logistic regression analysis using *gpa*, *gre*, and *rank* to look at student admissions to graduate school. Do not, at first, include any interaction terms.</span>
<span id="cb156-404"><a href="#cb156-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-405"><a href="#cb156-405" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What variables are significant predictors of the log(odds ratio) of admission?</span>
<span id="cb156-406"><a href="#cb156-406" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What is the value of the log(odds ratio) coefficient and the 95% CIs around that value for the two continuous variable (*gpa* and *gre*), when taking the effects of the other and of rank into account? What do these translate into on the actual odds ratio scale?</span>
<span id="cb156-407"><a href="#cb156-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-410"><a href="#cb156-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-411"><a href="#cb156-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-412"><a href="#cb156-412" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb156-413"><a href="#cb156-413" aria-hidden="true" tabindex="-1"></a><span class="co"># model with 3 predictors</span></span>
<span id="cb156-414"><a href="#cb156-414" aria-hidden="true" tabindex="-1"></a>glmGGR <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gpa <span class="sc">+</span> gre <span class="sc">+</span> rank, <span class="at">family =</span> binomial)</span>
<span id="cb156-415"><a href="#cb156-415" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glmGGR)</span>
<span id="cb156-416"><a href="#cb156-416" aria-hidden="true" tabindex="-1"></a>log_coeff <span class="ot">&lt;-</span> glmGGR<span class="sc">$</span>coefficients <span class="co"># extract coefficients...</span></span>
<span id="cb156-417"><a href="#cb156-417" aria-hidden="true" tabindex="-1"></a>log_coeff_CI <span class="ot">&lt;-</span> <span class="fu">confint</span>(glmGGR, <span class="at">level =</span> <span class="dv">1</span> <span class="sc">-</span> alpha)</span>
<span id="cb156-418"><a href="#cb156-418" aria-hidden="true" tabindex="-1"></a><span class="co"># and calculate 95% CIs around them</span></span>
<span id="cb156-419"><a href="#cb156-419" aria-hidden="true" tabindex="-1"></a>(results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(log_coeff, log_coeff_CI)) <span class="co"># none include 0!</span></span>
<span id="cb156-420"><a href="#cb156-420" aria-hidden="true" tabindex="-1"></a><span class="co"># convert results out of log scale</span></span>
<span id="cb156-421"><a href="#cb156-421" aria-hidden="true" tabindex="-1"></a>coeff <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_coeff) <span class="co"># convert results out of log scale</span></span>
<span id="cb156-422"><a href="#cb156-422" aria-hidden="true" tabindex="-1"></a>coeff_CI <span class="ot">&lt;-</span> <span class="fu">exp</span>(log_coeff_CI)</span>
<span id="cb156-423"><a href="#cb156-423" aria-hidden="true" tabindex="-1"></a>(results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(coeff, coeff_CI))</span>
<span id="cb156-424"><a href="#cb156-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-425"><a href="#cb156-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-426"><a href="#cb156-426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Is the model including all three predictors better than models that include just two predictors?</span>
<span id="cb156-427"><a href="#cb156-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-430"><a href="#cb156-430" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-431"><a href="#cb156-431" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare 2 versus 3 factor models</span></span>
<span id="cb156-432"><a href="#cb156-432" aria-hidden="true" tabindex="-1"></a>glmGG <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gpa <span class="sc">+</span> gre, <span class="at">family =</span> binomial)</span>
<span id="cb156-433"><a href="#cb156-433" aria-hidden="true" tabindex="-1"></a>glmGR <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gpa <span class="sc">+</span> rank, <span class="at">family =</span> binomial)</span>
<span id="cb156-434"><a href="#cb156-434" aria-hidden="true" tabindex="-1"></a>glmRG <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, <span class="at">formula =</span> admit <span class="sc">~</span> gre <span class="sc">+</span> rank, <span class="at">family =</span> binomial)</span>
<span id="cb156-435"><a href="#cb156-435" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmGG, glmGGR) <span class="co"># or anova(glmGG, glmGGR, test="Chisq")</span></span>
<span id="cb156-436"><a href="#cb156-436" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmGR, glmGGR) <span class="co"># or anova(glmGR, glmGGR, test="Chisq")</span></span>
<span id="cb156-437"><a href="#cb156-437" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmRG, glmGGR)<span class="co"># or anova(glmRG, glmGGR, test="Chisq")</span></span>
<span id="cb156-438"><a href="#cb156-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-439"><a href="#cb156-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-440"><a href="#cb156-440" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The 3-factor model is indeed better and any of the 2-factor models!</span></span>
<span id="cb156-441"><a href="#cb156-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-442"><a href="#cb156-442" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Compare a model that includes the three predictors with no interactions to one that includes the three predictors and all possible interactions.</span>
<span id="cb156-443"><a href="#cb156-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-446"><a href="#cb156-446" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-447"><a href="#cb156-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare model with and model without interactions</span></span>
<span id="cb156-448"><a href="#cb156-448" aria-hidden="true" tabindex="-1"></a>glmNO <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> rank <span class="sc">+</span> gpa <span class="sc">+</span> gre, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb156-449"><a href="#cb156-449" aria-hidden="true" tabindex="-1"></a>glmALL <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, admit <span class="sc">~</span> rank <span class="sc">*</span> gpa <span class="sc">*</span> gre, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb156-450"><a href="#cb156-450" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(glmNO, glmALL) <span class="co"># or anova(glmNO,glmALL, test="Chisq")</span></span>
<span id="cb156-451"><a href="#cb156-451" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-452"><a href="#cb156-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-453"><a href="#cb156-453" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Adding interaction terms to the 3-factor model does not significantly decrease the deviance!</span></span>
<span id="cb156-454"><a href="#cb156-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-455"><a href="#cb156-455" aria-hidden="true" tabindex="-1"></a><span class="fu">### Log-Linear or Poisson Regression {.unnumbered}</span></span>
<span id="cb156-456"><a href="#cb156-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-457"><a href="#cb156-457" aria-hidden="true" tabindex="-1"></a>Sometimes, we want to model a response variable that is in the form of count data (e.g., species richness on an island in terms of distance from the mainland, number of plants of a particular species found in a sampling plot in relation to altitude). Many discrete response variables have counts as possible outcomes. Binomial counts are the number of successes $x$ in a fixed number of trials, $n$. Poisson counts are the number occurrences of some event in a certain interval of time (or space). While binomial counts only take values between 0 and n, Poisson counts have no upper bound. We are going to focus on Poisson counts here.</span>
<span id="cb156-458"><a href="#cb156-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-459"><a href="#cb156-459" aria-hidden="true" tabindex="-1"></a>As we have discussed before, for Poisson-distributed variables, the mean and the variance are equal and represented by a single parameter ($\lambda$), and therefore linear models based on normal distributions may not be appropriate. We have seen that sometimes we can simply transform a response variable with some kind of power transformation to make it appear more normally distributed, but an alternative is to use a GLM with a Poisson error term and use a *log* transformation as the link function, resulting in in a **log-linear** model. Thus, when we do Poisson regression, our regression model tries to predict the natural log of the expected value of $Y$, i.e., $\lambda_i$.</span>
<span id="cb156-460"><a href="#cb156-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-461"><a href="#cb156-461" aria-hidden="true" tabindex="-1"></a>The link function is thus...</span>
<span id="cb156-462"><a href="#cb156-462" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-463"><a href="#cb156-463" aria-hidden="true" tabindex="-1"></a>$$g=log(\mu_i)$$</span>
<span id="cb156-464"><a href="#cb156-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-465"><a href="#cb156-465" aria-hidden="true" tabindex="-1"></a>... and the inverse link function is...</span>
<span id="cb156-466"><a href="#cb156-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-467"><a href="#cb156-467" aria-hidden="true" tabindex="-1"></a>$$\lambda_i = e^{\lambda_i}$$</span>
<span id="cb156-468"><a href="#cb156-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-469"><a href="#cb156-469" aria-hidden="true" tabindex="-1"></a>Our regression model formulation is the same as in logistic regression, above, except we use <span class="in">`family="Poisson"`</span>, e.g, <span class="in">`glm(y ~ x, family = "poisson")`</span></span>
<span id="cb156-470"><a href="#cb156-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-471"><a href="#cb156-471" aria-hidden="true" tabindex="-1"></a><span class="fu">### EXAMPLE: {.unnumbered}</span></span>
<span id="cb156-472"><a href="#cb156-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-473"><a href="#cb156-473" aria-hidden="true" tabindex="-1"></a>Researchers studied the reproductive success of a set of male woolly monkeys over a period of 8 years. The age of each monkey at the beginning of the study and the number of successful matings they had during the 8 years were recorded, and they were also scored into ranks of "high", "medium", and "low". We assume the number of matings follows a Poisson distribution, and we are interested in exploring whether mating success depends on the age of the monkey in question.</span>
<span id="cb156-474"><a href="#cb156-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-477"><a href="#cb156-477" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-478"><a href="#cb156-478" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/woollydata.csv"</span></span>
<span id="cb156-479"><a href="#cb156-479" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb156-480"><a href="#cb156-480" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb156-481"><a href="#cb156-481" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>name)</span>
<span id="cb156-482"><a href="#cb156-482" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>rank <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>rank)</span>
<span id="cb156-483"><a href="#cb156-483" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(d)</span>
<span id="cb156-484"><a href="#cb156-484" aria-hidden="true" tabindex="-1"></a><span class="co"># first, some exploratory visualization</span></span>
<span id="cb156-485"><a href="#cb156-485" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> success)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb156-486"><a href="#cb156-486" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"Age"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mating Success"</span>))</span>
<span id="cb156-487"><a href="#cb156-487" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(d)</span>
<span id="cb156-488"><a href="#cb156-488" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(d<span class="sc">$</span>rank, d<span class="sc">$</span>success)</span>
<span id="cb156-489"><a href="#cb156-489" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success ~ age</span></span>
<span id="cb156-490"><a href="#cb156-490" aria-hidden="true" tabindex="-1"></a>glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data=</span>d, success <span class="sc">~</span> age, <span class="at">family=</span><span class="st">"poisson"</span>)</span>
<span id="cb156-491"><a href="#cb156-491" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm)</span>
<span id="cb156-492"><a href="#cb156-492" aria-hidden="true" tabindex="-1"></a><span class="co"># we can generate a nice summary table of results with `tidy()`</span></span>
<span id="cb156-493"><a href="#cb156-493" aria-hidden="true" tabindex="-1"></a><span class="co"># setting "conf.int = TRUE" uses an ML approach to estimate the CI</span></span>
<span id="cb156-494"><a href="#cb156-494" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(glm, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb156-495"><a href="#cb156-495" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-496"><a href="#cb156-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-497"><a href="#cb156-497" aria-hidden="true" tabindex="-1"></a>In the <span class="in">`summary()`</span>, note that the residual deviance is slighly higher than the residual degrees of freedom, which suggests that our data are slightly overdispersed (i.e., there is some extra, unexplained variation in the response, where the variance is greater than the mean). If this were dramatic, we might use "quasipoisson" for the family instead, but we will stick with "poisson".</span>
<span id="cb156-498"><a href="#cb156-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-499"><a href="#cb156-499" aria-hidden="true" tabindex="-1"></a>Now, let's fit a "line" of best fit through our data, along with 95% CI around this "line". We want to plot the relationship between **success**, rather than **log(success)**, and **age**, so this relationship will not actually be linear but log-linear.</span>
<span id="cb156-500"><a href="#cb156-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-503"><a href="#cb156-503" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-504"><a href="#cb156-504" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb156-505"><a href="#cb156-505" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">5</span>, <span class="at">to =</span> <span class="dv">17</span>, <span class="at">by =</span> <span class="dv">1</span>))</span>
<span id="cb156-506"><a href="#cb156-506" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">age =</span> x, <span class="fu">predict</span>(glm, <span class="at">newdata =</span> x, <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>))</span>
<span id="cb156-507"><a href="#cb156-507" aria-hidden="true" tabindex="-1"></a><span class="co"># IMPORTANT: Using the argument `type="response"` makes our prediction be</span></span>
<span id="cb156-508"><a href="#cb156-508" aria-hidden="true" tabindex="-1"></a><span class="co"># in units of our actual Y variable, success, rather than log(success)</span></span>
<span id="cb156-509"><a href="#cb156-509" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>lower <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb156-510"><a href="#cb156-510" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>upper <span class="ot">&lt;-</span> prediction<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> alpha <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> prediction<span class="sc">$</span>se.fit</span>
<span id="cb156-511"><a href="#cb156-511" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(prediction)</span>
<span id="cb156-512"><a href="#cb156-512" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">data =</span> prediction, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb156-513"><a href="#cb156-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> prediction, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> fit,</span>
<span id="cb156-514"><a href="#cb156-514" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">alpha =</span> <span class="fl">0.2</span>)</span>
<span id="cb156-515"><a href="#cb156-515" aria-hidden="true" tabindex="-1"></a>p <span class="co"># note the curvilinear "line" of best fit</span></span>
<span id="cb156-516"><a href="#cb156-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-517"><a href="#cb156-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-518"><a href="#cb156-518" aria-hidden="true" tabindex="-1"></a>Is this model better than an intercept-only model? YES!</span>
<span id="cb156-519"><a href="#cb156-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-520"><a href="#cb156-520" aria-hidden="true" tabindex="-1"></a>We can see this by doing a likelihood ratio test.</span>
<span id="cb156-521"><a href="#cb156-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-524"><a href="#cb156-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-525"><a href="#cb156-525" aria-hidden="true" tabindex="-1"></a>proposed <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> age, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb156-526"><a href="#cb156-526" aria-hidden="true" tabindex="-1"></a>reduced <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> <span class="dv">1</span>, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb156-527"><a href="#cb156-527" aria-hidden="true" tabindex="-1"></a><span class="co"># using the `lrtest()` function</span></span>
<span id="cb156-528"><a href="#cb156-528" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(reduced, proposed)</span>
<span id="cb156-529"><a href="#cb156-529" aria-hidden="true" tabindex="-1"></a><span class="co"># or, using the `anova()` function</span></span>
<span id="cb156-530"><a href="#cb156-530" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(reduced, proposed, <span class="at">test=</span><span class="st">"Chisq"</span>)</span>
<span id="cb156-531"><a href="#cb156-531" aria-hidden="true" tabindex="-1"></a><span class="co"># or, based on the deviance difference between the reduced and proposed models</span></span>
<span id="cb156-532"><a href="#cb156-532" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> reduced<span class="sc">$</span>deviance <span class="sc">-</span> proposed<span class="sc">$</span>deviance)</span>
<span id="cb156-533"><a href="#cb156-533" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(x2, <span class="at">df =</span> <span class="dv">1</span>))</span>
<span id="cb156-534"><a href="#cb156-534" aria-hidden="true" tabindex="-1"></a><span class="co"># or, based on hand calculating model deviances using the `logLik()` function,</span></span>
<span id="cb156-535"><a href="#cb156-535" aria-hidden="true" tabindex="-1"></a><span class="co"># which returns the log-likelihood of a model</span></span>
<span id="cb156-536"><a href="#cb156-536" aria-hidden="true" tabindex="-1"></a>(<span class="at">D_reduced =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(reduced))</span>
<span id="cb156-537"><a href="#cb156-537" aria-hidden="true" tabindex="-1"></a>(<span class="at">D_proposed =</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(proposed))</span>
<span id="cb156-538"><a href="#cb156-538" aria-hidden="true" tabindex="-1"></a>(x2 <span class="ot">&lt;-</span> D_reduced <span class="sc">-</span> D_proposed)</span>
<span id="cb156-539"><a href="#cb156-539" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(x2, <span class="at">df =</span> <span class="dv">1</span>))</span>
<span id="cb156-540"><a href="#cb156-540" aria-hidden="true" tabindex="-1"></a><span class="co"># df = difference in # of parameters in the proposed versus reduced model</span></span>
<span id="cb156-541"><a href="#cb156-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-542"><a href="#cb156-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-543"><a href="#cb156-543" aria-hidden="true" tabindex="-1"></a>As mentioned in <span class="co">[</span><span class="ot">**Module 22**</span><span class="co">](#module-22)</span>, the Akaike Information Criterion, or AIC, is another way of evaluating and comparing related models. For similar models, those with lower AIC models are preferred over those with higher AIC. The AIC value is based on the deviance associated with the model, but it penalizes model complexity. Much like an adjusted $R^2$, its intent is to prevent you from including irrelevant predictors when choosing among similar models. Models with low AICs represent a better fit to the data, and if many models have similarly low AICs, you should choose the one with the fewest model terms. For both continuous and categorical predictors, we prefer comparing full and reduced models against one another to test individual terms rather than comparing the fit of all possible models and trying and select a single "best" one. Thus, AIC values are useful for comparing models, but they are not interpretable on their own. The <span class="in">`logLik()`</span> function returns the log-likelihood associated with a particular model and can be used to calculate AIC values by hand.</span>
<span id="cb156-544"><a href="#cb156-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-547"><a href="#cb156-547" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-548"><a href="#cb156-548" aria-hidden="true" tabindex="-1"></a>(AICproposed <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(proposed))</span>
<span id="cb156-549"><a href="#cb156-549" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC = (2 * # parameters estimated() minus (2 * log-likelihood of model)</span></span>
<span id="cb156-550"><a href="#cb156-550" aria-hidden="true" tabindex="-1"></a><span class="co"># for the proposed model, we estimated 2 parameters</span></span>
<span id="cb156-551"><a href="#cb156-551" aria-hidden="true" tabindex="-1"></a>(AICreduced <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(reduced))</span>
<span id="cb156-552"><a href="#cb156-552" aria-hidden="true" tabindex="-1"></a><span class="co"># for the reduced model, we estimated 1 parameter</span></span>
<span id="cb156-553"><a href="#cb156-553" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-554"><a href="#cb156-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-555"><a href="#cb156-555" aria-hidden="true" tabindex="-1"></a>Here, the log-likelihood of the model including *age* as a predictor is much lower than the log-likelihood of the reduced (intercept only) model, so we prefer the former.</span>
<span id="cb156-556"><a href="#cb156-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-557"><a href="#cb156-557" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb156-558"><a href="#cb156-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-559"><a href="#cb156-559" aria-hidden="true" tabindex="-1"></a>Using the woolly monkey mating success data set, explore multiple Poisson regression models of <span class="co">[</span><span class="ot">a</span><span class="co">]</span> mating success in relation to *rank* and [b] mating success in relation to *age* + *rank*, and [c] mating success in relation to *age* + *rank* + their interaction on your own. What conclusions can you come to about the importance of rank and rank in combination with age versus age alone?</span>
<span id="cb156-560"><a href="#cb156-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-561"><a href="#cb156-561" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mating Success in Relation to Rank {.unnumbered}</span></span>
<span id="cb156-562"><a href="#cb156-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-565"><a href="#cb156-565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-566"><a href="#cb156-566" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-567"><a href="#cb156-567" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success ~ rank</span></span>
<span id="cb156-568"><a href="#cb156-568" aria-hidden="true" tabindex="-1"></a>glm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> rank, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb156-569"><a href="#cb156-569" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm1)</span>
<span id="cb156-570"><a href="#cb156-570" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm1, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb156-571"><a href="#cb156-571" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-572"><a href="#cb156-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-573"><a href="#cb156-573" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mating Success in Relation to Age + Rank {.unnumbered}</span></span>
<span id="cb156-574"><a href="#cb156-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-577"><a href="#cb156-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-578"><a href="#cb156-578" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-579"><a href="#cb156-579" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success~age+rank</span></span>
<span id="cb156-580"><a href="#cb156-580" aria-hidden="true" tabindex="-1"></a>glm2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data=</span>d, success<span class="sc">~</span>age<span class="sc">+</span>rank, <span class="at">family=</span><span class="st">"poisson"</span>)</span>
<span id="cb156-581"><a href="#cb156-581" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm2)</span>
<span id="cb156-582"><a href="#cb156-582" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm2, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb156-583"><a href="#cb156-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-584"><a href="#cb156-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-585"><a href="#cb156-585" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Mating Success in Relation to Age + Rank + Their Interaction {.unnumbered}</span></span>
<span id="cb156-586"><a href="#cb156-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-589"><a href="#cb156-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-590"><a href="#cb156-590" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb156-591"><a href="#cb156-591" aria-hidden="true" tabindex="-1"></a><span class="co"># glm of success ~ age + rank + age:rank</span></span>
<span id="cb156-592"><a href="#cb156-592" aria-hidden="true" tabindex="-1"></a>glm3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="at">data =</span> d, success <span class="sc">~</span> age <span class="sc">*</span> rank, <span class="at">family =</span> <span class="st">"poisson"</span>)</span>
<span id="cb156-593"><a href="#cb156-593" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm3)</span>
<span id="cb156-594"><a href="#cb156-594" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(glm3, <span class="at">conf.int =</span> <span class="cn">TRUE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span>
<span id="cb156-595"><a href="#cb156-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-596"><a href="#cb156-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-599"><a href="#cb156-599" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb156-600"><a href="#cb156-600" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(effects)</span>
<span id="cb156-601"><a href="#cb156-601" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">predictorEffects</span>(glm3, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb156-602"><a href="#cb156-602" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">allEffects</span>(glm3, <span class="at">partial.residuals =</span> <span class="cn">TRUE</span>))</span>
<span id="cb156-603"><a href="#cb156-603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-604"><a href="#cb156-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-605"><a href="#cb156-605" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb156-606"><a href="#cb156-606" aria-hidden="true" tabindex="-1"></a><span class="in">detach(package:lmtest)</span></span>
<span id="cb156-607"><a href="#cb156-607" aria-hidden="true" tabindex="-1"></a><span class="in">detach(package:broom)</span></span>
<span id="cb156-608"><a href="#cb156-608" aria-hidden="true" tabindex="-1"></a><span class="in">detach(package:tidyverse)</span></span>
<span id="cb156-609"><a href="#cb156-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb156-610"><a href="#cb156-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-611"><a href="#cb156-611" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb156-612"><a href="#cb156-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-613"><a href="#cb156-613" aria-hidden="true" tabindex="-1"></a><span class="fu">## Concept Review {.unnumbered}</span></span>
<span id="cb156-614"><a href="#cb156-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-615"><a href="#cb156-615" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Generalized linear modeling extends general linear modeling to accommodate response variables that are not continuously distributed (e.g., binary responses, count data, proportion data)</span>
<span id="cb156-616"><a href="#cb156-616" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>What is being predicted in generalized linear model is some function of the expected value of an observed response, not the observed response *per se*</span>
<span id="cb156-617"><a href="#cb156-617" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>The link/inverse link function is what connects the response predicted by the GLM back to the scale of the original observed response</span>
<span id="cb156-618"><a href="#cb156-618" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For binary response variables, we use **logistic** regression, where the response variable is natural log of the **odds ratio** between two possible outcomes:</span>
<span id="cb156-619"><a href="#cb156-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-620"><a href="#cb156-620" aria-hidden="true" tabindex="-1"></a>$$\ln<span class="co">[</span><span class="ot">\frac{\pi_i}{(1-\pi_i)}</span><span class="co">]</span> = \beta_0 + \beta_1x_i$$</span>
<span id="cb156-621"><a href="#cb156-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-622"><a href="#cb156-622" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For response variables that are open-ended counts, we use **log-linear** or **Poisson regression**, where the response variable is the natural log of the expected value of the count</span>
<span id="cb156-623"><a href="#cb156-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-624"><a href="#cb156-624" aria-hidden="true" tabindex="-1"></a>$$\lambda_i = \beta_0 + \beta_1x_i$$</span>
<span id="cb156-625"><a href="#cb156-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-626"><a href="#cb156-626" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>As with simple (or general) linear models, we can create generalized linear models with more than one predictor variable, with a combination of continuous and categorial predictors, and with interactions between predictors</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>