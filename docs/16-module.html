<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Data Analysis - 16&nbsp; Using Permutation Tests</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./17-module.html" rel="next">
<link href="./15-module.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./16-module.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Preliminaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Logistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-typography-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Typography and Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-programming-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>RStudio</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Extending the Functionality of <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentals of the <strong><em>R</em></strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basics of Version Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Additional Data Structures in <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting Data into <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part II - Statistics and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Central Tendency and Spread</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Probability and Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classical Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-module.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error, Power, and Effect Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Linear Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-analysis-replication-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis Replication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Packages Used</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">16.1</span> Objectives</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">16.2</span> Preliminaries</a></li>
  <li><a href="#permutation-methods" id="toc-permutation-methods" class="nav-link" data-scroll-target="#permutation-methods"><span class="header-section-number">16.3</span> Permutation Methods</a></li>
  <li><a href="#working-with-means" id="toc-working-with-means" class="nav-link" data-scroll-target="#working-with-means"><span class="header-section-number">16.4</span> Working with Means</a>
  <ul class="collapse">
  <li><a href="#one-sample-permutation-test" id="toc-one-sample-permutation-test" class="nav-link" data-scroll-target="#one-sample-permutation-test">One Sample Permutation Test</a></li>
  <li><a href="#two-sample-permutation-test" id="toc-two-sample-permutation-test" class="nav-link" data-scroll-target="#two-sample-permutation-test">Two Sample Permutation Test</a></li>
  </ul></li>
  <li><a href="#working-with-proportions" id="toc-working-with-proportions" class="nav-link" data-scroll-target="#working-with-proportions"><span class="header-section-number">16.5</span> Working with Proportions</a></li>
  <li><a href="#using-the-infer-package" id="toc-using-the-infer-package" class="nav-link" data-scroll-target="#using-the-infer-package"><span class="header-section-number">16.6</span> Using the {infer} Package</a>
  <ul class="collapse">
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#advantages-of-permutation-tests" id="toc-advantages-of-permutation-tests" class="nav-link" data-scroll-target="#advantages-of-permutation-tests"><span class="header-section-number">16.7</span> Advantages of Permutation Tests</a></li>
  <li><a href="#concept-review" id="toc-concept-review" class="nav-link" data-scroll-target="#concept-review">Concept Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./16-module.html"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="module-16" class="quarto-section-identifier"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2" data-number="16.1">
<h2 data-number="16.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">16.1</span> Objectives</h2>
<blockquote class="blockquote">
<p>The objective of this module is to extend our <em>hypothesis testing</em> framework to include permutation/randomization tests.</p>
</blockquote>
</section>
<section id="preliminaries" class="level2" data-number="16.2">
<h2 data-number="16.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">16.2</span> Preliminaries</h2>
<ul>
<li>Install the following packages in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/coin/coin.pdf">{coin}</a>, <a href="https://cran.r-project.org/web/packages/jmuOutlier/jmuOutlier.pdf">{jmuOutlier}</a>, and <a href="https://cran.r-project.org/web/packages/infer/infer.pdf">{infer}</a></li>
<li>Load {tidyverse} and {mosaic}</li>
</ul>
</section>
<section id="permutation-methods" class="level2" data-number="16.3">
<h2 data-number="16.3" class="anchored" data-anchor-id="permutation-methods"><span class="header-section-number">16.3</span> Permutation Methods</h2>
<p>The inferential framework described in <a href="15-module.html"><strong>Module 15</strong></a> is grounded in the idea that the sampling distributions for summary statistics of interest are appropriately modeled using well-known theoretical distributions… but that may not always be the case. An alternative approach is for us to build up (rather than assume) sampling distributions for statistics of interest using so-called “permutation” or “randomization” methods, which are a type of simulation. These approaches are conceptually related to the bootstrapping that we employed in <a href="14-module.html"><strong>Module 14</strong></a> as an alternative method of generating sampling distributions and CIs.</p>
<p>Like bootstrapping, permutation/randomization tests generate a kind of sampling distribution (called a “permutation distribution” or “null distribution) for the null hypothesis to which we compare a test statistic calculated from our observations. We generate the permutation or null distribution by <strong>resampling</strong> from a set of actually observed outcomes while permuting (”shuffling”) some attribute of our actual observations in accordance with what we would expect if our null hypothesis were true.</p>
<p>Thus, whereas a “bootstrap sampling distribution” for generating CIs is created via simulation by repeatedly resampling observations <strong>from a single sample with replacement</strong>, a “permutation distribution” or “null distribution” is generated by resampling many times from that sample <strong>without replacement</strong> while shuffling attributes of each observation. Depending on what type of test we are doing (e.g., comparing a mean or proportion from a single sample to a hypothesized expectation, comparing means or proportions between two samples, evaluating whether regression coefficients are significant, etc.), exactly what we are shuffling in each resampling simulation may vary. In general permutation/randomization tests are extremely flexible and can be used for virtually any kind of test we may imagine.</p>
<p>For a true “permutation test”, we would sample all possible permutations of our original data to construct the permutation distribution, which can be computationally prohibitive if the sample size is even moderately large. However, we can conduct “approximate permutation tests” by simply using a large number of resamples to approximate the permutation distribution. These are generally referred to as <strong>randomization tests</strong>.</p>
<p>Let’s use the same data we used in <a href="15-module.html"><strong>Module 15</strong></a> and conduct the same kinds of statistical tests we did previously, but this time we will use randomization to generate approximate permutation distributions for test statistics under the null hypothesis.</p>
</section>
<section id="working-with-means" class="level2" data-number="16.4">
<h2 data-number="16.4" class="anchored" data-anchor-id="working-with-means"><span class="header-section-number">16.4</span> Working with Means</h2>
<section id="one-sample-permutation-test" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="one-sample-permutation-test">One Sample Permutation Test</h3>
<p>Recall that in one of the tests we conducted in <a href="15-module.html"><strong>Module 15</strong></a> was to evaluate whether vervet monkeys trapped during the 2015 trapping season in South Africa differed in weight from the expectation based on previous years (i.e., <span class="math inline">\(H_0: \mu_0 = 5.0\ kg\)</span>). Here, we start by generating a test statistic that is the actual difference between our observed mean and the expected mean rather than an <span class="math inline">\(Z\)</span> or <span class="math inline">\(T\)</span> score estimating how many SEs our observed mean is away from the expected population mean.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/vervet-weights.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> d<span class="sc">$</span>weight  <span class="co"># current weights</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)  <span class="co"># average weight of our sample</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">5</span>  <span class="co"># expected weight (null hypothesis)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>(actual_diff <span class="ot">&lt;-</span> m <span class="sc">-</span> mu)  <span class="co"># difference between our sample and expected</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.3239216</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we use this as our test statistic!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Recall that permutation/randomization tests work by resampling and shuffling attributes of the observed data many times in order to come up with a distribution of test statistics that we might plausibly get under a particular null hypothesis. They do not rely on assuming that the data come from a particular theoretical distribution.</p>
<p>What is it that we would need to permute about our vervet body size data for it to be consistent with the null hypothesis of no difference between our sample mean of 2015 weights and the expectation based on weights from previous seasons, i.e., that <span class="math inline">\(mean\ observed - expected\ weights\)</span> (<span class="math inline">\(\mu_A - \mu_0\)</span>) = ZERO? Well, we could simply randomize the sign of the value of <span class="math inline">\(individual\ observed - expected\ weights\)</span> in each simulation and then take the mean to generate a permutation distribution of <span class="math inline">\(mean\ observed - expected\ weights\)</span> under the null hypothesis.</p>
<p>The <strong>p value</strong> calculated for a permutation/randomization test is the probability of getting a test statistic, by chance, as or more extreme than our observed one. We can calculate this empirically based on the permutation distribution, simply by counting the number of simulated test statistics that exceed our observed test statistic and then dividing by the number of permutations.</p>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> Sometimes, we add 1 to both the numerator and denominator for this calculation to ensure that we never have a p value of exactly 0.</p>
</blockquote>
<p>Below, we do 10,000 permutations where we randomly shuffle the sign of each individual observation’s difference from the expected mean under the null hypothesis. We then compare the observed difference between the mean of our sample and the expected mean to this distribution and calculate the p value associated with getting a difference as or more extreme than we observed. Lastly, we plot the approximate permutation distribution we generated and superimpose our observed difference as the test statistic.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># number of permutation simulations</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>permuted_diff <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> n)  <span class="co"># set up a dummy vector to hold results for each permutation</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># now we scramble the sign of individual observed - expected weights, and</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then take mean</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    permuted_diff[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="fu">length</span>(x), <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">abs</span>(x <span class="sc">-</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        mu))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the two.sided p value</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> (<span class="fu">sum</span>(permuted_diff <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_diff)) <span class="sc">+</span> <span class="fu">sum</span>(permuted_diff <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">abs</span>(actual_diff)))<span class="sc">/</span>nperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(permuted_diff) <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_diff))<span class="sc">/</span>nperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or add 1 to both numerator and denominator to avoid p = 0</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(permuted_diff, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"# Permutations"</span>, <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> actual_diff, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(<span class="at">x =</span> actual_diff, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The function <code>perm.test</code> from the package {jmuOutlier} conducts the same kind of test. By default, the function runs 10,000 simulations, and the test statistic being calculated is the mean, but other functions are possible.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jmuOutlier)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># first show plot</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">perm.test</span>(x, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">mu =</span> mu, <span class="at">plot =</span> <span class="cn">TRUE</span>, <span class="at">num.sim =</span> nperm)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> actual_diff, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x =</span> actual_diff, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.065</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">offset =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># then 2 tailed p value</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">perm.test</span>(x, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">mu =</span> mu, <span class="at">plot =</span> <span class="cn">FALSE</span>, <span class="at">num.sim =</span> nperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [[1]]
## [1] "One-sample permutation test was performed."
## 
## [[2]]
## [1] "p-value was estimated based on 10000 simulations."
## 
## $alternative
## [1] "two.sided"
## 
## $mu
## [1] 5
## 
## $p.value
## [1] 0.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>jmuOutlier)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can also write our own custom function to perform the same kind of 1-sample permutation test!</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>perm1samp <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">stat =</span> <span class="st">"mean"</span>, <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">nperm =</span> <span class="dv">10000</span>, <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">"two.sided"</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"less"</span>, <span class="st">"greater"</span>)) {</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># can modify function by adding alternative `stat=`</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> x <span class="sc">-</span> mu</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(test_data)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (stat <span class="sc">==</span> <span class="st">"mean"</span>) {</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        myfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(x)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    test_stat <span class="ot">&lt;-</span> <span class="fu">myfun</span>(test_data)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    perm_stat <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> nperm)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm) {</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        perm_stat[[i]] <span class="ot">&lt;-</span> <span class="fu">myfun</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">abs</span>(test_data))</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># or, as a 1-liner that does not require a loop perm_stat &lt;-</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># replicate(nperm, myfun(sample(c(-1,1), n, replace=TRUE) *</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># abs(test_data)))</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (alternative[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"less"</span>) {</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>        p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&lt;=</span> test_stat)<span class="sc">/</span>nperm</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (alternative[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"greater"</span>) {</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&gt;=</span> test_stat)<span class="sc">/</span>nperm</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(perm_stat) <span class="sc">&gt;=</span> <span class="fu">abs</span>(test_stat))<span class="sc">/</span>nperm</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">test_stat =</span> test_stat, <span class="at">perm_stat =</span> perm_stat, <span class="at">p_perm =</span> p_perm, <span class="at">type =</span> alternative[<span class="dv">1</span>])</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm1samp</span>(x, <span class="at">stat =</span> <span class="st">"mean"</span>, <span class="at">mu =</span> mu, <span class="at">nperm =</span> nperm)</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(output<span class="sc">$</span>perm_stat, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">ylab =</span> <span class="st">"# Permutations"</span>, <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="fu">ifelse</span>(output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span> output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>, <span class="fu">paste0</span>(<span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>type, <span class="st">" than test stat = "</span>, output<span class="sc">$</span>p_perm), <span class="fu">paste0</span>(<span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>p_perm)))</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"two.sided"</span>) {</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>))</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(<span class="at">x =</span> output<span class="sc">$</span>test_stat, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">offset =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="two-sample-permutation-test" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="two-sample-permutation-test">Two Sample Permutation Test</h3>
<p>Another of the tests we conducted in <a href="15-module.html"><strong>Module 15</strong></a> was to evaluate whether male and female black-and-white colobus differ in body weight. Let’s load in that data again and then calculate, as a test statistic, the difference in average weights for females versus males.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/colobus-weights.csv"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 6 × 3
##      id weight sex  
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;
## 1     1   7.24 male 
## 2     2   6.09 male 
## 3     3   6.97 male 
## 4     4   6.98 male 
## 5     5   6.08 male 
## 6     6   6.22 male</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"female"</span>, ]<span class="sc">$</span>weight</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span>, ]<span class="sc">$</span>weight</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>(actual_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">mean</span>(y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] -1.449</code></pre>
</div>
</div>
<p>To test whether this difference is significant by permutation, we would generate a permutation distribution consistent with a null hypothesis of <em>no difference in weight between the sexes</em> by simulation, where, for each simulation, we permute the sex assigned to each observation and then calculate the difference (female - male) between the sexes in each permuted set. We then calculate the p value associated with getting a difference between male and female mean weights as or more extreme than the one we observed. [We again calculate this as a “two-sided” probability, i.e., we are testing the <span class="math inline">\(H_A\)</span> that…</p>
<p><span class="math inline">\(mean(female) - mean(male) ≠ 0\)</span></p>
<p>rather than…</p>
<p><span class="math inline">\(mean(female) - mean(male) &gt; 0\)</span></p>
<p>or…</p>
<p><span class="math inline">\(mean(female) - mean(male) &lt; 0\)</span></p>
<p>both of which would be “one-sided” tests.]</p>
<p>Lastly, we visualize the approximate permutation distribution and superimpose our observed difference in weights between males and females.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span>  <span class="co"># number of permutation simulations</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dummy vector to hold results for each permutation</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>permuted_diff <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> n)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> d</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm) {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scramble the sex vector `sample()` with a vector as an argument yields a</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># random permutation of the vector</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    test_data<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">sample</span>(test_data<span class="sc">$</span>sex)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> test_data[test_data<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"female"</span>, ]<span class="sc">$</span>weight</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> test_data[test_data<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span>, ]<span class="sc">$</span>weight</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    permuted_diff[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> (<span class="fu">sum</span>(permuted_diff <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_diff)) <span class="sc">+</span> <span class="fu">sum</span>(permuted_diff <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">abs</span>(actual_diff)))<span class="sc">/</span>nperm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(permuted_diff, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">xlab =</span> <span class="st">""</span>, <span class="at">ylab =</span> <span class="st">"# Permutations"</span>, <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.75</span>, <span class="fl">1.75</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> actual_diff, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(<span class="at">x =</span> actual_diff, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>, <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-7-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The same <code>perm.test()</code> function from {jmuOutlier} that we used above for a 1-sample permutation test also allows for 2-sample tests.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(jmuOutlier) x &lt;- d[d$sex=='female',]$weight y &lt;-</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># d[d$sex=='male',]$weight mu &lt;- 0 # expected difference between means under</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># null perm.test(x, y, alternative = 'two.sided', mu = mu, plot = TRUE, num.sim</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># = nperm) abline(v=actual_diff) perm.test(x, y, alternative = 'two.sided', mu</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co"># = mu, plot = FALSE, num.sim = nperm) detach(package:jmuOutlier)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> In this example, the vertical line showing our actual difference in means is off-scale on the left-hand side of the plot!</p>
</blockquote>
<p>The function <code>independence_test()</code> from the {coin} package conducts the same kind of 2-sample test with a simpler construction that does not require us specifying two vectors to compare…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Loading required package: survival</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">independence_test</span>(weight <span class="sc">~</span> <span class="fu">as.factor</span>(sex), <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">distribution =</span> <span class="st">"approximate"</span>,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Approximative General Independence Test
## 
## data:  weight by as.factor(sex) (female, male)
## Z = -5.4998, p-value &lt; 1e-04
## alternative hypothesis: two.sided</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>coin)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, we can also write our own generic 2-sample permutation function that allows us to compare custom test statistics. Here, we first define a function for our test statistic, <code>mean_diff()</code>, i.e., a difference of means, and then define a function for the test.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>perm2samp <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">stat =</span> <span class="st">"mean_diff"</span>, <span class="at">nperm =</span> <span class="dv">10000</span>, <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">"two.sided"</span>,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"less"</span>, <span class="st">"greater"</span>)) {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># can modify function by adding alternative `stat=`</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (stat <span class="sc">==</span> <span class="st">"mean_diff"</span>) {</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        myfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    test_stat <span class="ot">&lt;-</span> <span class="fu">myfun</span>(x, y)</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)  <span class="co"># puts two vectors of samples together</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    perm_stat <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> nperm)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm) {</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        indexes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(test_data), <span class="fu">length</span>(x), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the row above generates a randomized vector of indices that is the</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># length of the x sample... this is equivalent to permuting which group</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the x sample belongs to</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        s1 <span class="ot">&lt;-</span> test_data[indexes]</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        s2 <span class="ot">&lt;-</span> test_data[<span class="sc">-</span>indexes]</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        perm_stat[[i]] <span class="ot">&lt;-</span> <span class="fu">myfun</span>(s1, s2)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (alternative[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"less"</span>) {</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&lt;=</span> test_stat)<span class="sc">/</span>nperm</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (alternative[<span class="dv">1</span>] <span class="sc">==</span> <span class="st">"greater"</span>) {</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&gt;=</span> test_stat)<span class="sc">/</span>nperm</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(perm_stat) <span class="sc">&gt;=</span> <span class="fu">abs</span>(test_stat))<span class="sc">/</span>nperm</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">test_stat =</span> test_stat, <span class="at">perm_stat =</span> perm_stat, <span class="at">p_perm =</span> p_perm, <span class="at">type =</span> alternative[<span class="dv">1</span>])</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"female"</span>, ]<span class="sc">$</span>weight</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span>, ]<span class="sc">$</span>weight</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm2samp</span>(x, y, <span class="at">stat =</span> <span class="st">"mean_diff"</span>, <span class="at">nperm =</span> <span class="dv">10000</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(output<span class="sc">$</span>perm_stat, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">ylab =</span> <span class="st">"# Permutations"</span>, <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="fu">ifelse</span>(output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span> output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>, <span class="fu">paste0</span>(<span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>type, <span class="st">" than test stat = "</span>, output<span class="sc">$</span>p_perm), <span class="fu">paste0</span>(<span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>p_perm)), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.75</span>, <span class="fl">1.75</span>))</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"two.sided"</span>) {</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>))</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(<span class="at">x =</span> output<span class="sc">$</span>test_stat, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">offset =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here’s a graphical version of what we are doing…</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/2-sample-perm-test.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="working-with-proportions" class="level2" data-number="16.5">
<h2 data-number="16.5" class="anchored" data-anchor-id="working-with-proportions"><span class="header-section-number">16.5</span> Working with Proportions</h2>
<p>We can take the same permutation/randomization approach and use the same 1- and 2-sample tests with proportion data.</p>
<p>In <a href="15-module.html"><strong>Module 15</strong></a>, we looked at a set of data on captures of birds in 30 nets on a morning of mist netting (i.e., a “success” or “failure” for every net during a netting session) and tested whether the proportion of “successes” was lower than the expectation of 80% was lower than in previous years. The code below lets us do this using a 1-sample randomization test.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># using {jmuOutlier} library(jmuOutlier) perm.test(v, alternative='less',</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># mu=0.8, plot=FALSE, num.sim = nperm) detach(package:jmuOutlier)</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># using our custom function</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm1samp</span>(v, <span class="at">stat =</span> <span class="st">"mean"</span>, <span class="at">mu =</span> <span class="fl">0.8</span>, <span class="at">alternative =</span> <span class="st">"less"</span>, <span class="at">nperm =</span> nperm)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(output<span class="sc">$</span>perm_stat, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">ylab =</span> <span class="st">"# Permutations"</span>, <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="fu">ifelse</span>(output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span> output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>, <span class="fu">paste0</span>(<span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>type, <span class="st">" than test stat = "</span>, output<span class="sc">$</span>p_perm), <span class="fu">paste0</span>(<span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>p_perm)))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"two.sided"</span>) {</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>))</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(<span class="at">x =</span> output<span class="sc">$</span>test_stat, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">offset =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In <a href="15-module.html"><strong>Module 15</strong></a>, we also compared data on captures of two species of bats over the course of a week of nightly mist-netting. For each species, the record indicates whether a captured female was lactating (1) or not (0), and we wanted to test whether this proportion differed between species. We can do this with a 2-sample randomization test.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>species1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>species2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>(actual_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(species1) <span class="sc">-</span> <span class="fu">mean</span>(species2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] -0.14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this calculates a difference in proportions</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># using {jmuOutlier} library(jmuOutlier) perm.test(species1, species2,</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># alternative = 'two.sided', plot=FALSE, num.sim = nperm)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># detach(package:jmuOutlier)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># using our custom function</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm2samp</span>(species1, species2, <span class="at">stat =</span> <span class="st">"mean_diff"</span>, <span class="at">nperm =</span> nperm)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(output<span class="sc">$</span>perm_stat, <span class="at">type =</span> <span class="st">"count"</span>, <span class="at">ylab =</span> <span class="st">"# Permutations"</span>, <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlab =</span> <span class="fu">ifelse</span>(output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span> output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>, <span class="fu">paste0</span>(<span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>type, <span class="st">" than test stat = "</span>, output<span class="sc">$</span>p_perm), <span class="fu">paste0</span>(<span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>        output<span class="sc">$</span>p_perm)))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"two.sided"</span>) {</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"red"</span>))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(<span class="at">x =</span> output<span class="sc">$</span>test_stat, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">4</span>, <span class="at">offset =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> The p values associated with these permutation/randomization based tests on proportions are not so close to those using the <code>prop.test()</code> function for the same data that we ran in <a href="15-module.html"><strong>Module 15</strong></a>. This is because <code>prop.test()</code> is calculating the p value associated with our test statistic presuming that the distribution of sampling proportions is roughly normal, whereas this test is calculating p values by counting the proportion of simulations!</p>
</blockquote>
</section>
<section id="using-the-infer-package" class="level2" data-number="16.6">
<h2 data-number="16.6" class="anchored" data-anchor-id="using-the-infer-package"><span class="header-section-number">16.6</span> Using the {infer} Package</h2>
<p>The {infer} package offers a convenient set of functions and a standard workflow for using permutation methods for hypothesis testing, whether we are dealing with means, differences between means, proportions, or differences in proportions.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/infer.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>The {infer} package includes a set of functions that allow us to easily generate shuffled or permuted datasets and then conduct hypothesis testing with these datasets just as we have done above. We will explore how we do this with the {infer} package using the black-and-white colobus weight data we used above.</p>
<p>We first read in our data and load the {infer} package:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/colobus-weights.csv"</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we use the function <code>specify()</code> to indicate the variables we are interested in. The <code>specify()</code> function takes an argument of <code>formula=</code> response~explanatory. If we are working with proportion data, we also need to provide an argument for what value of the explanatory variable counts as a success, using <code>success=</code>, but that is not the case for our colobus weight data, where our response variable is numeric, not binary.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">specify</span>(<span class="at">formula =</span> weight <span class="sc">~</span> sex)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># this does not change the data frame but adds some meta data</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Response: weight (numeric)
## Explanatory: sex (factor)
## # A tibble: 6 × 2
##   weight sex  
##    &lt;dbl&gt; &lt;fct&gt;
## 1   7.24 male 
## 2   6.09 male 
## 3   6.97 male 
## 4   6.98 male 
## 5   6.08 male 
## 6   6.22 male</code></pre>
</div>
</div>
<p>The function <code>hypothesize()</code> is then used to declare the null hypothesis we wish to test. We use the argument <code>null="point"</code> if we are doing a test of a single mean (<code>mu=</code>) or proportion (<code>p=</code>) or <code>null="independence"</code> if we are doing a test of the independence of two variables (i.e., a two-sample test).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># again, this does not change the data frame but adds some meta data</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## Response: weight (numeric)
## Explanatory: sex (factor)
## Null Hypothesis: independence
## # A tibble: 6 × 2
##   weight sex  
##    &lt;dbl&gt; &lt;fct&gt;
## 1   7.24 male 
## 2   6.09 male 
## 3   6.97 male 
## 4   6.98 male 
## 5   6.08 male 
## 6   6.22 male</code></pre>
</div>
</div>
<p>We then use the <code>generate()</code> function to generate replicates of “shuffled” or “permuted” data under the assumption that the null hypothesis is true. That is, we generating datasets from which we then derived a null distribution for our statistic of interest.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>d_permutations <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"permute"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 40</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(d_permutations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 40000</code></pre>
</div>
</div>
<p>Next, we use <code>calculate()</code> to calculate summary statistics of interest for each replicate. We can calculate a variety of different statistics, including the mean (“mean”), proportion (“prop”), difference in means (“diff in means”), difference in proportions (“diff in props”), and others. This step generates a null distribution for our summary statistic. For differences in means or proportions, we need to also include an argument specifying the order of the levels of the explanatory variable for subtraction.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>null_distribution <span class="ot">&lt;-</span> d_permutations <span class="sc">|&gt;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="co"># to subtract female weight from male weight</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then use the function <code>visualize()</code> to examine the null distribution (alternatively, we can use <code>histogram()</code>, in which case we then need to specify the variable <code>name="stat"</code>)</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(null_distribution<span class="sc">$</span>stat, <span class="at">nint =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So, now we have a null or permutation distribution for the test statistic… then, we can also use {infer} package functions to easily calculate hte observed summary statistic that we want to compare to this null distribution by simply leaving out the <code>hypothesize()</code> and <code>generate()</code> steps.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>observed_stat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">specify</span>(weight <span class="sc">~</span> sex) <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Rows: 40 Columns: 3
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: ","
## chr (1): sex
## dbl (2): id, weight
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>We can plot this observed test statistic atop the null distribution using the <code>shade_p_value()</code> function, which has two arguments: a value for <code>obs_stat=</code> and a <code>direction=</code> (“left,”right”, or “both”) corresponding to two different one-tailed or a two-tailed alternative hypothesis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> observed_stat,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> This is not very interesting because the observed statistic is way outside of the null distribution!</p>
</blockquote>
<p>The function <code>get_p_value()</code> with arguments of the null distribution, the observed statistic, and the direction will give us the p value generated by permutation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_p_value</span>(null_distribution, observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>## Warning: Please be cautious in reporting a p-value of 0. This result is an approximation
## based on the number of `reps` chosen in the `generate()` step.
## ℹ See `get_p_value()` (`?infer::get_p_value()`) for more information.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 1
##   p_value
##     &lt;dbl&gt;
## 1       0</code></pre>
</div>
</div>
<p>As an additional example of this approach, let’s consider the vervet trapping data from above once again. Recall that we want to evaluate whether vervet monkeys trapped during the 2015 trapping season differed in weight from the expectation based on previous years, which was 5.0 kg. How do we do this using the {infer} workflow?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/vervet-weights.csv"</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>null_distribution <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">specify</span>(<span class="at">response =</span> weight) <span class="sc">|&gt;</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># here we specify just a response, not a formula</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"point"</span>, <span class="at">mu =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># here we are comparing a sample to an expectation</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"mean"</span>)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that here type='bootstrap'! This is actually doing something a little</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co"># different than we did above... it is sampling *with replacement* from our set</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># of weights rather than randomly permuting the sign of the difference of each</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="co"># value from the mean! (Here, the number of observations sampled is equal to</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a><span class="co"># the original number of observations)</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>observed_stat <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">specify</span>(<span class="at">response =</span> weight) <span class="sc">|&gt;</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"mean"</span>)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> observed_stat,</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_p_value</span>(null_distribution, observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 1 × 1
##   p_value
##     &lt;dbl&gt;
## 1    0.01</code></pre>
</div>
</div>
<p>Note that this p value is pretty similar to that returned by <code>jmuOutlier::perm.test()</code> and by our custom <code>perm1samp()</code> function, though as noted above, those use slightly different permutation processes.</p>
<section id="challenge" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge">CHALLENGE</h3>
<p>As a final example of this approach, we will again examine data on captures of two species of bats over the course of a week of nightly mist-netting. For each species, remember that the record indicates whether a captured female was lactating (1) or not (0).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>species1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>species2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>First, we need to massage this data into the correct shape:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">species =</span> <span class="st">"species1"</span>, <span class="at">lactating =</span> species1)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">species =</span> <span class="st">"species2"</span>, <span class="at">lactating =</span> species2)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(s1, s2)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>lactating <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>lactating)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, use the {infer} workflow to test whether the proportion of lactating females among the captured bats differs between species.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>null_distribution <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">specify</span>(lactating <span class="sc">~</span> species, <span class="at">success =</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in props"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"species1"</span>, <span class="st">"species2"</span>))</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: This runs a LOT slower than our custom permutation function for the</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># same number of reps!</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>observed_stat <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">specify</span>(lactating <span class="sc">~</span> species, <span class="at">success =</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in props"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"species1"</span>, <span class="st">"species2"</span>))</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="fu">shade_p_value</span>(observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="16-module_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_p_value</span>(null_distribution, observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<details><summary>Show Output</summary>
<pre class="details" data-summary="Show Output"><code>## # A tibble: 1 × 1
##   p_value
##     &lt;dbl&gt;
## 1   0.412</code></pre>
</details>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>infer)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This p value is similar to that returned by our custom permutation test!</p>
</section>
</section>
<section id="advantages-of-permutation-tests" class="level2" data-number="16.7">
<h2 data-number="16.7" class="anchored" data-anchor-id="advantages-of-permutation-tests"><span class="header-section-number">16.7</span> Advantages of Permutation Tests</h2>
<p>Some of the key advantages of permutation tests include the following:</p>
<ul>
<li>They are “distribution-free” - i.e., they do not make any assumptions about the distribution of the underlying data</li>
<li>There is no presumption of random sampling from some imaginary hypothetical population</li>
<li>Unlike some other nonparametric tests, they do not depend on large sample sizes for their validity</li>
<li>Many common nonparametric tests <strong>are</strong> permutation tests, just carried out on RANKS</li>
<li>They can be used with many kinds of data (nominal, ordinal, interval/ratio)</li>
<li>They are relatively straightforward to conduct and interpret</li>
</ul>
<hr>
</section>
<section id="concept-review" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="concept-review">Concept Review</h2>
<ul>
<li><p>Permutation/randomization tests involve these steps:</p>
<ul>
<li>Compute a sample statistic of your choice (mean, median, proportion, etc.) using the set of original observations</li>
<li>Rearrange attributes of the original observations in all or a very large number of random possible permutations, computing the test statistic each time, to yield a permutation or null distribution for the test statistic under the null hypothesis</li>
<li>Look at the value of the sample statistic relative to the permutation distribution</li>
<li>Based on the permutation distribution, calculate the probability of seeing a sample statistic as high or higher than that observed, i.e., the portion of the permutation distribution that equals or exceed the value of the sample statistic… this is the permutation test p value</li>
</ul></li>
<li><p><code>jmuOutlier::perm.test()</code>, <code>coin::indepedence_test()</code>, or write your own!</p></li>
<li><p>{infer} workflow</p></li>
</ul>
<blockquote class="blockquote">
<p><strong>NOTE:</strong> This permutation-based approach to statistical inference is consistent with the philosophy promoted by statistician Allen Downey that, “There is really only test”, and that at all statistical tests are based on the same framework. Note that this is still a form of null hypothesis significance testing, or NHST!</p>
</blockquote>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/downey.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./15-module.html" class="pagination-link  aria-label=" &lt;span="" hypothesis="" testing&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classical Hypothesis Testing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./17-module.html" class="pagination-link" aria-label="<span class='chapter-number'>17</span>&nbsp; <span class='chapter-title'>Error, Power, and Effect Size</span>">
        <span class="nav-page-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error, Power, and Effect Size</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb62" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Using Permutation Tests {#module-16}</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objectives</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The objective of this module is to extend our *hypothesis testing* framework to include permutation/randomization tests.</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install the following packages in ***R***: <span class="co">[</span><span class="ot">{coin}</span><span class="co">](https://cran.r-project.org/web/packages/coin/coin.pdf)</span>, <span class="co">[</span><span class="ot">{jmuOutlier}</span><span class="co">](https://cran.r-project.org/web/packages/jmuOutlier/jmuOutlier.pdf)</span>, and <span class="co">[</span><span class="ot">{infer}</span><span class="co">](https://cran.r-project.org/web/packages/infer/infer.pdf)</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load {tidyverse} and {mosaic}</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="fu">## Permutation Methods</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>The inferential framework described in <span class="co">[</span><span class="ot">**Module 15**</span><span class="co">](#module-15)</span> is grounded in the idea that the sampling distributions for summary statistics of interest are appropriately modeled using well-known theoretical distributions... but that may not always be the case. An alternative approach is for us to build up (rather than assume) sampling distributions for statistics of interest using so-called "permutation" or "randomization" methods, which are a type of simulation. These approaches are conceptually related to the bootstrapping that we employed in <span class="co">[</span><span class="ot">**Module 14**</span><span class="co">](#module-14)</span> as an alternative method of generating sampling distributions and CIs.</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>Like bootstrapping, permutation/randomization tests generate a kind of sampling distribution (called a "permutation distribution" or "null distribution) for the null hypothesis to which we compare a test statistic calculated from our observations. We generate the permutation or null distribution by **resampling** from a set of actually observed outcomes while permuting ("shuffling") some attribute of our actual observations in accordance with what we would expect if our null hypothesis were true.</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>Thus, whereas a "bootstrap sampling distribution" for generating CIs is created via simulation by repeatedly resampling observations **from a single sample with replacement**, a "permutation distribution" or "null distribution" is generated by resampling many times from that sample **without replacement** while shuffling attributes of each observation. Depending on what type of test we are doing (e.g., comparing a mean or proportion from a single sample to a hypothesized expectation, comparing means or proportions between two samples, evaluating whether regression coefficients are significant, etc.), exactly what we are shuffling in each resampling simulation may vary. In general permutation/randomization tests are extremely flexible and can be used for virtually any kind of test we may imagine.</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>For a true "permutation test", we would sample all possible permutations of our original data to construct the permutation distribution, which can be computationally prohibitive if the sample size is even moderately large. However, we can conduct "approximate permutation tests" by simply using a large number of resamples to approximate the permutation distribution. These are generally referred to as **randomization tests**.</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>Let's use the same data we used in <span class="co">[</span><span class="ot">**Module 15**</span><span class="co">](#module-15)</span> and conduct the same kinds of statistical tests we did previously, but this time we will use randomization to generate approximate permutation distributions for test statistics under the null hypothesis.</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working with Means</span></span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="fu">### One Sample Permutation Test {.unnumbered}</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>Recall that in one of the tests we conducted in <span class="co">[</span><span class="ot">**Module 15**</span><span class="co">](#module-15)</span> was to evaluate whether vervet monkeys trapped during the 2015 trapping season in South Africa differed in weight from the expectation based on previous years (i.e., $H_0: \mu_0 = 5.0\ kg$). Here, we start by generating a test statistic that is the actual difference between our observed mean and the expected mean rather than an $Z$ or $T$ score estimating how many SEs our observed mean is away from the expected population mean.</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/vervet-weights.csv"</span></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> d<span class="sc">$</span>weight <span class="co"># current weights</span></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="co"># average weight of our sample</span></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">5</span> <span class="co"># expected weight (null hypothesis)</span></span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a>(actual_diff <span class="ot">&lt;-</span> m <span class="sc">-</span> mu) <span class="co"># difference between our sample and expected</span></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a><span class="co"># we use this as our test statistic!</span></span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>Recall that permutation/randomization tests work by resampling and shuffling attributes of the observed data many times in order to come up with a distribution of test statistics that we might plausibly get under a particular null hypothesis. They do not rely on assuming that the data come from a particular theoretical distribution.</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>What is it that we would need to permute about our vervet body size data for it to be consistent with the null hypothesis of no difference between our sample mean of 2015 weights and the expectation based on weights from previous seasons, i.e., that $mean\ observed - expected\ weights$ ($\mu_A - \mu_0$) = ZERO? Well, we could simply randomize the sign of the value of $individual\ observed - expected\ weights$ in each simulation and then take the mean to generate a permutation distribution of $mean\ observed - expected\ weights$ under the null hypothesis.</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>The **p value** calculated for a permutation/randomization test is the probability of getting a test statistic, by chance, as or more extreme than our observed one. We can calculate this empirically based on the permutation distribution, simply by counting the number of simulated test statistics that exceed our observed test statistic and then dividing by the number of permutations.</span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** Sometimes, we add 1 to both the numerator and denominator for this calculation to ensure that we never have a p value of exactly 0.</span></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>Below, we do 10,000 permutations where we randomly shuffle the sign of each individual observation's difference from the expected mean under the null hypothesis. We then compare the observed difference between the mean of our sample and the expected mean to this distribution and calculate the p value associated with getting a difference as or more extreme than we observed. Lastly, we plot the approximate permutation distribution we generated and superimpose our observed difference as the test statistic.</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># number of permutation simulations</span></span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a>permuted_diff <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span>n) <span class="co"># set up a dummy vector to hold results for each permutation</span></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm) {</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># now we scramble the sign of individual observed - expected weights, and then take mean</span></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a>    permuted_diff[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),<span class="fu">length</span>(x), <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">abs</span>(x<span class="sc">-</span>mu))</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the two.sided p value</span></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> (<span class="fu">sum</span>(permuted_diff <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_diff)) <span class="sc">+</span></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a>         <span class="fu">sum</span>(permuted_diff <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">abs</span>(actual_diff))) <span class="sc">/</span> nperm)</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(permuted_diff) <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_diff)) <span class="sc">/</span> nperm)</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a><span class="co"># or add 1 to both numerator and denominator to avoid p = 0</span></span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a>  permuted_diff,</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"count"</span>,</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"# Permutations"</span>,</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span></span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>actual_diff, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>))</span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(</span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> actual_diff,</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>,</span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Test Statistic"</span>,</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="dv">1</span></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`perm.test`</span> from the package {jmuOutlier} conducts the same kind of test. By default, the function runs 10,000 simulations, and the test statistic being calculated is the mean, but other functions are possible.</span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jmuOutlier)</span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a><span class="co"># first show plot</span></span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a><span class="fu">perm.test</span>(x, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">mu =</span> mu, <span class="at">plot =</span> <span class="cn">TRUE</span>, <span class="at">num.sim =</span> nperm)</span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>actual_diff, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="at">x=</span>actual_diff, <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.065</span>, <span class="st">"Test Statistic"</span>, <span class="at">srt=</span><span class="dv">90</span>, <span class="at">pos=</span><span class="dv">4</span>, <span class="at">offset=</span><span class="dv">1</span>)</span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a><span class="co"># then 2 tailed p value</span></span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a><span class="fu">perm.test</span>(x, <span class="at">alternative =</span> <span class="st">"two.sided"</span>, <span class="at">mu =</span> mu, <span class="at">plot =</span> <span class="cn">FALSE</span>, <span class="at">num.sim =</span> nperm)</span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>jmuOutlier)</span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a>We can also write our own custom function to perform the same kind of 1-sample permutation test!</span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a>perm1samp <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">stat=</span><span class="st">"mean"</span>, <span class="at">mu=</span><span class="dv">0</span>, <span class="at">nperm=</span><span class="dv">10000</span>,</span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative=</span><span class="fu">c</span>(<span class="st">"two.sided"</span>,<span class="st">"less"</span>,<span class="st">"greater"</span>)){</span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># can modify function by adding alternative `stat=`</span></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> x <span class="sc">-</span> mu</span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(test_data)</span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (stat<span class="sc">==</span><span class="st">"mean"</span>){</span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a>      myfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x)}</span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>    test_stat <span class="ot">&lt;-</span> <span class="fu">myfun</span>(test_data)</span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a>    perm_stat <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span>nperm)</span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm){</span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a>      perm_stat[[i]] <span class="ot">&lt;-</span> <span class="fu">myfun</span>(<span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), n, <span class="at">replace=</span><span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fu">abs</span>(test_data))</span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a>    <span class="co"># or, as a 1-liner that does not require a loop</span></span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a>    <span class="co"># perm_stat &lt;- replicate(nperm, myfun(sample(c(-1,1), n,</span></span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   replace=TRUE) * abs(test_data)))</span></span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(alternative[<span class="dv">1</span>]<span class="sc">==</span><span class="st">"less"</span>){</span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a>      p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&lt;=</span> test_stat) <span class="sc">/</span> nperm</span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span>(alternative[<span class="dv">1</span>]<span class="sc">==</span><span class="st">"greater"</span>){</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a>          p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&gt;=</span> test_stat) <span class="sc">/</span> nperm</span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a>          p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(perm_stat) <span class="sc">&gt;=</span> <span class="fu">abs</span>(test_stat)) <span class="sc">/</span> nperm</span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">test_stat=</span>test_stat, <span class="at">perm_stat=</span>perm_stat, <span class="at">p_perm=</span>p_perm, <span class="at">type=</span>alternative[<span class="dv">1</span>])</span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm1samp</span>(x, <span class="at">stat=</span><span class="st">"mean"</span>, <span class="at">mu=</span>mu, <span class="at">nperm=</span>nperm)</span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(</span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>perm_stat,</span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"count"</span>,</span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"# Permutations"</span>,</span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">ifelse</span>(</span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span></span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>,</span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a>      <span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type,</span>
<span id="cb62-163"><a href="#cb62-163" aria-hidden="true" tabindex="-1"></a>      <span class="st">" than test stat = "</span>,</span>
<span id="cb62-164"><a href="#cb62-164" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-170"><a href="#cb62-170" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-171"><a href="#cb62-171" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-172"><a href="#cb62-172" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>output<span class="sc">$</span>test_stat, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>))</span>
<span id="cb62-173"><a href="#cb62-173" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type<span class="sc">==</span><span class="st">"two.sided"</span>) {</span>
<span id="cb62-174"><a href="#cb62-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(</span>
<span id="cb62-175"><a href="#cb62-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat,</span>
<span id="cb62-176"><a href="#cb62-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb62-177"><a href="#cb62-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb62-178"><a href="#cb62-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span></span>
<span id="cb62-179"><a href="#cb62-179" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb62-180"><a href="#cb62-180" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-181"><a href="#cb62-181" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(</span>
<span id="cb62-182"><a href="#cb62-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel.text</span>(</span>
<span id="cb62-183"><a href="#cb62-183" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> output<span class="sc">$</span>test_stat,</span>
<span id="cb62-184"><a href="#cb62-184" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>,</span>
<span id="cb62-185"><a href="#cb62-185" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Test Statistic"</span>,</span>
<span id="cb62-186"><a href="#cb62-186" aria-hidden="true" tabindex="-1"></a>    <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb62-187"><a href="#cb62-187" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb62-188"><a href="#cb62-188" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="dv">1</span></span>
<span id="cb62-189"><a href="#cb62-189" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-190"><a href="#cb62-190" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-191"><a href="#cb62-191" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-192"><a href="#cb62-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-193"><a href="#cb62-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Two Sample Permutation Test {.unnumbered}</span></span>
<span id="cb62-194"><a href="#cb62-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-195"><a href="#cb62-195" aria-hidden="true" tabindex="-1"></a>Another of the tests we conducted in <span class="co">[</span><span class="ot">**Module 15**</span><span class="co">](#module-15)</span> was to evaluate whether male and female black-and-white colobus differ in body weight. Let's load in that data again and then calculate, as a test statistic, the difference in average weights for females versus males.</span>
<span id="cb62-196"><a href="#cb62-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-199"><a href="#cb62-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-200"><a href="#cb62-200" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb62-201"><a href="#cb62-201" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/colobus-weights.csv"</span></span>
<span id="cb62-202"><a href="#cb62-202" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-203"><a href="#cb62-203" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb62-204"><a href="#cb62-204" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"female"</span>,]<span class="sc">$</span>weight</span>
<span id="cb62-205"><a href="#cb62-205" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"male"</span>,]<span class="sc">$</span>weight</span>
<span id="cb62-206"><a href="#cb62-206" aria-hidden="true" tabindex="-1"></a>(actual_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">mean</span>(y))</span>
<span id="cb62-207"><a href="#cb62-207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-208"><a href="#cb62-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-209"><a href="#cb62-209" aria-hidden="true" tabindex="-1"></a>To test whether this difference is significant by permutation, we would generate a permutation distribution consistent with a null hypothesis of *no difference in weight between the sexes* by simulation, where, for each simulation, we permute the sex assigned to each observation and then calculate the difference (female - male) between the sexes in each permuted set. We then calculate the p value associated with getting a difference between male and female mean weights as or more extreme than the one we observed. [We again calculate this as a "two-sided" probability, i.e., we are testing the $H_A$ that...</span>
<span id="cb62-210"><a href="#cb62-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-211"><a href="#cb62-211" aria-hidden="true" tabindex="-1"></a>$mean(female) - mean(male) ≠ 0$</span>
<span id="cb62-212"><a href="#cb62-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-213"><a href="#cb62-213" aria-hidden="true" tabindex="-1"></a>rather than...</span>
<span id="cb62-214"><a href="#cb62-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-215"><a href="#cb62-215" aria-hidden="true" tabindex="-1"></a>$mean(female) - mean(male) &gt; 0$</span>
<span id="cb62-216"><a href="#cb62-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-217"><a href="#cb62-217" aria-hidden="true" tabindex="-1"></a>or...</span>
<span id="cb62-218"><a href="#cb62-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-219"><a href="#cb62-219" aria-hidden="true" tabindex="-1"></a>$mean(female) - mean(male) &lt; 0$</span>
<span id="cb62-220"><a href="#cb62-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-221"><a href="#cb62-221" aria-hidden="true" tabindex="-1"></a>both of which would be "one-sided" tests.]</span>
<span id="cb62-222"><a href="#cb62-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-223"><a href="#cb62-223" aria-hidden="true" tabindex="-1"></a>Lastly, we visualize the approximate permutation distribution and superimpose our observed difference in weights between males and females.</span>
<span id="cb62-224"><a href="#cb62-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-227"><a href="#cb62-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-228"><a href="#cb62-228" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># number of permutation simulations</span></span>
<span id="cb62-229"><a href="#cb62-229" aria-hidden="true" tabindex="-1"></a><span class="co"># create a dummy vector to hold results for each permutation</span></span>
<span id="cb62-230"><a href="#cb62-230" aria-hidden="true" tabindex="-1"></a>permuted_diff <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span>n)</span>
<span id="cb62-231"><a href="#cb62-231" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> d</span>
<span id="cb62-232"><a href="#cb62-232" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm) {</span>
<span id="cb62-233"><a href="#cb62-233" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scramble the sex vector</span></span>
<span id="cb62-234"><a href="#cb62-234" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `sample()` with a vector as an argument yields a random</span></span>
<span id="cb62-235"><a href="#cb62-235" aria-hidden="true" tabindex="-1"></a>  <span class="co"># permutation of the vector</span></span>
<span id="cb62-236"><a href="#cb62-236" aria-hidden="true" tabindex="-1"></a>  test_data<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">sample</span>(test_data<span class="sc">$</span>sex)</span>
<span id="cb62-237"><a href="#cb62-237" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> test_data[test_data<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"female"</span>,]<span class="sc">$</span>weight</span>
<span id="cb62-238"><a href="#cb62-238" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> test_data[test_data<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"male"</span>,]<span class="sc">$</span>weight</span>
<span id="cb62-239"><a href="#cb62-239" aria-hidden="true" tabindex="-1"></a>  permuted_diff[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">mean</span>(y)</span>
<span id="cb62-240"><a href="#cb62-240" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-241"><a href="#cb62-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-242"><a href="#cb62-242" aria-hidden="true" tabindex="-1"></a>(p <span class="ot">&lt;-</span> (<span class="fu">sum</span>(permuted_diff <span class="sc">&gt;=</span> <span class="fu">abs</span>(actual_diff)) <span class="sc">+</span></span>
<span id="cb62-243"><a href="#cb62-243" aria-hidden="true" tabindex="-1"></a>         <span class="fu">sum</span>(permuted_diff <span class="sc">&lt;=</span> <span class="sc">-</span><span class="fu">abs</span>(actual_diff))) <span class="sc">/</span> nperm)</span>
<span id="cb62-244"><a href="#cb62-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-245"><a href="#cb62-245" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(</span>
<span id="cb62-246"><a href="#cb62-246" aria-hidden="true" tabindex="-1"></a>  permuted_diff,</span>
<span id="cb62-247"><a href="#cb62-247" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"count"</span>,</span>
<span id="cb62-248"><a href="#cb62-248" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">""</span>,</span>
<span id="cb62-249"><a href="#cb62-249" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"# Permutations"</span>,</span>
<span id="cb62-250"><a href="#cb62-250" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb62-251"><a href="#cb62-251" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.75</span>, <span class="fl">1.75</span>)</span>
<span id="cb62-252"><a href="#cb62-252" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-253"><a href="#cb62-253" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>actual_diff, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>))</span>
<span id="cb62-254"><a href="#cb62-254" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(</span>
<span id="cb62-255"><a href="#cb62-255" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> actual_diff,</span>
<span id="cb62-256"><a href="#cb62-256" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>,</span>
<span id="cb62-257"><a href="#cb62-257" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Test Statistic"</span>,</span>
<span id="cb62-258"><a href="#cb62-258" aria-hidden="true" tabindex="-1"></a>  <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb62-259"><a href="#cb62-259" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb62-260"><a href="#cb62-260" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="dv">1</span></span>
<span id="cb62-261"><a href="#cb62-261" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb62-262"><a href="#cb62-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-263"><a href="#cb62-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-264"><a href="#cb62-264" aria-hidden="true" tabindex="-1"></a>The same <span class="in">`perm.test()`</span> function from {jmuOutlier} that we used above for a 1-sample permutation test also allows for 2-sample tests.</span>
<span id="cb62-265"><a href="#cb62-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-268"><a href="#cb62-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-269"><a href="#cb62-269" aria-hidden="true" tabindex="-1"></a><span class="co"># library(jmuOutlier)</span></span>
<span id="cb62-270"><a href="#cb62-270" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- d[d$sex=="female",]$weight</span></span>
<span id="cb62-271"><a href="#cb62-271" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- d[d$sex=="male",]$weight</span></span>
<span id="cb62-272"><a href="#cb62-272" aria-hidden="true" tabindex="-1"></a><span class="co"># mu &lt;- 0 # expected difference between means under null</span></span>
<span id="cb62-273"><a href="#cb62-273" aria-hidden="true" tabindex="-1"></a><span class="co"># perm.test(x, y, alternative = "two.sided", mu = mu, plot = TRUE, num.sim = nperm)</span></span>
<span id="cb62-274"><a href="#cb62-274" aria-hidden="true" tabindex="-1"></a><span class="co"># abline(v=actual_diff)</span></span>
<span id="cb62-275"><a href="#cb62-275" aria-hidden="true" tabindex="-1"></a><span class="co"># perm.test(x, y, alternative = "two.sided", mu = mu, plot = FALSE, num.sim = nperm)</span></span>
<span id="cb62-276"><a href="#cb62-276" aria-hidden="true" tabindex="-1"></a><span class="co"># detach(package:jmuOutlier)</span></span>
<span id="cb62-277"><a href="#cb62-277" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-278"><a href="#cb62-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-279"><a href="#cb62-279" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** In this example, the vertical line showing our actual difference in means is off-scale on the left-hand side of the plot!</span></span>
<span id="cb62-280"><a href="#cb62-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-281"><a href="#cb62-281" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`independence_test()`</span> from the {coin} package conducts the same kind of 2-sample test with a simpler construction that does not require us specifying two vectors to compare...</span>
<span id="cb62-282"><a href="#cb62-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-285"><a href="#cb62-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-286"><a href="#cb62-286" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coin)</span>
<span id="cb62-287"><a href="#cb62-287" aria-hidden="true" tabindex="-1"></a><span class="fu">independence_test</span>(</span>
<span id="cb62-288"><a href="#cb62-288" aria-hidden="true" tabindex="-1"></a>  weight <span class="sc">~</span> <span class="fu">as.factor</span>(sex),</span>
<span id="cb62-289"><a href="#cb62-289" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"two.sided"</span>,</span>
<span id="cb62-290"><a href="#cb62-290" aria-hidden="true" tabindex="-1"></a>  <span class="at">distribution =</span> <span class="st">"approximate"</span>,</span>
<span id="cb62-291"><a href="#cb62-291" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> d</span>
<span id="cb62-292"><a href="#cb62-292" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-293"><a href="#cb62-293" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>coin)</span>
<span id="cb62-294"><a href="#cb62-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-295"><a href="#cb62-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-296"><a href="#cb62-296" aria-hidden="true" tabindex="-1"></a>Finally, we can also write our own generic 2-sample permutation function that allows us to compare custom test statistics. Here, we first define a function for our test statistic, <span class="in">`mean_diff()`</span>, i.e., a difference of means, and then define a function for the test.</span>
<span id="cb62-297"><a href="#cb62-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-300"><a href="#cb62-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-301"><a href="#cb62-301" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb62-302"><a href="#cb62-302" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb62-303"><a href="#cb62-303" aria-hidden="true" tabindex="-1"></a>perm2samp <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">stat=</span><span class="st">"mean_diff"</span>, <span class="at">nperm=</span><span class="dv">10000</span>,</span>
<span id="cb62-304"><a href="#cb62-304" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative=</span><span class="fu">c</span>(<span class="st">"two.sided"</span>,<span class="st">"less"</span>,<span class="st">"greater"</span>)){</span>
<span id="cb62-305"><a href="#cb62-305" aria-hidden="true" tabindex="-1"></a>  <span class="co"># can modify function by adding alternative `stat=`</span></span>
<span id="cb62-306"><a href="#cb62-306" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (stat<span class="sc">==</span><span class="st">"mean_diff"</span>){</span>
<span id="cb62-307"><a href="#cb62-307" aria-hidden="true" tabindex="-1"></a>      myfun <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){<span class="fu">mean</span>(x) <span class="sc">-</span> <span class="fu">mean</span>(y)}</span>
<span id="cb62-308"><a href="#cb62-308" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-309"><a href="#cb62-309" aria-hidden="true" tabindex="-1"></a>    test_stat <span class="ot">&lt;-</span> <span class="fu">myfun</span>(x,y)  </span>
<span id="cb62-310"><a href="#cb62-310" aria-hidden="true" tabindex="-1"></a>    test_data <span class="ot">&lt;-</span> <span class="fu">c</span>(x,y) <span class="co"># puts two vectors of samples together</span></span>
<span id="cb62-311"><a href="#cb62-311" aria-hidden="true" tabindex="-1"></a>    perm_stat <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length=</span>nperm)</span>
<span id="cb62-312"><a href="#cb62-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nperm){</span>
<span id="cb62-313"><a href="#cb62-313" aria-hidden="true" tabindex="-1"></a>      indexes <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">length</span>(test_data), <span class="fu">length</span>(x), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-314"><a href="#cb62-314" aria-hidden="true" tabindex="-1"></a>      <span class="co"># the row above generates a randomized vector of indices that is the length</span></span>
<span id="cb62-315"><a href="#cb62-315" aria-hidden="true" tabindex="-1"></a>      <span class="co"># of the x sample... this is equivalent to permuting which group the x sample</span></span>
<span id="cb62-316"><a href="#cb62-316" aria-hidden="true" tabindex="-1"></a>      <span class="co"># belongs to</span></span>
<span id="cb62-317"><a href="#cb62-317" aria-hidden="true" tabindex="-1"></a>      s1 <span class="ot">&lt;-</span> test_data[indexes]</span>
<span id="cb62-318"><a href="#cb62-318" aria-hidden="true" tabindex="-1"></a>      s2 <span class="ot">&lt;-</span> test_data[<span class="sc">-</span>indexes]</span>
<span id="cb62-319"><a href="#cb62-319" aria-hidden="true" tabindex="-1"></a>      perm_stat[[i]] <span class="ot">&lt;-</span> <span class="fu">myfun</span>(s1,s2)</span>
<span id="cb62-320"><a href="#cb62-320" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-321"><a href="#cb62-321" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(alternative[<span class="dv">1</span>]<span class="sc">==</span><span class="st">"less"</span>){</span>
<span id="cb62-322"><a href="#cb62-322" aria-hidden="true" tabindex="-1"></a>      p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&lt;=</span> test_stat) <span class="sc">/</span> nperm</span>
<span id="cb62-323"><a href="#cb62-323" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span>(alternative[<span class="dv">1</span>]<span class="sc">==</span><span class="st">"greater"</span>){</span>
<span id="cb62-324"><a href="#cb62-324" aria-hidden="true" tabindex="-1"></a>          p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(perm_stat <span class="sc">&gt;=</span> test_stat) <span class="sc">/</span> nperm</span>
<span id="cb62-325"><a href="#cb62-325" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb62-326"><a href="#cb62-326" aria-hidden="true" tabindex="-1"></a>          p_perm <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">abs</span>(perm_stat) <span class="sc">&gt;=</span> <span class="fu">abs</span>(test_stat)) <span class="sc">/</span> nperm</span>
<span id="cb62-327"><a href="#cb62-327" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb62-328"><a href="#cb62-328" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">test_stat=</span>test_stat, <span class="at">perm_stat=</span>perm_stat, <span class="at">p_perm=</span>p_perm, <span class="at">type=</span>alternative[<span class="dv">1</span>])</span>
<span id="cb62-329"><a href="#cb62-329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-330"><a href="#cb62-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-331"><a href="#cb62-331" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"female"</span>,]<span class="sc">$</span>weight</span>
<span id="cb62-332"><a href="#cb62-332" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> d[d<span class="sc">$</span>sex<span class="sc">==</span><span class="st">"male"</span>,]<span class="sc">$</span>weight</span>
<span id="cb62-333"><a href="#cb62-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-334"><a href="#cb62-334" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm2samp</span>(x, y, <span class="at">stat=</span><span class="st">"mean_diff"</span>, <span class="at">nperm =</span> <span class="dv">10000</span>)</span>
<span id="cb62-335"><a href="#cb62-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-336"><a href="#cb62-336" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(</span>
<span id="cb62-337"><a href="#cb62-337" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>perm_stat,</span>
<span id="cb62-338"><a href="#cb62-338" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"count"</span>,</span>
<span id="cb62-339"><a href="#cb62-339" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"# Permutations"</span>,</span>
<span id="cb62-340"><a href="#cb62-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb62-341"><a href="#cb62-341" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">ifelse</span>(</span>
<span id="cb62-342"><a href="#cb62-342" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span></span>
<span id="cb62-343"><a href="#cb62-343" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>,</span>
<span id="cb62-344"><a href="#cb62-344" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-345"><a href="#cb62-345" aria-hidden="true" tabindex="-1"></a>      <span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb62-346"><a href="#cb62-346" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type,</span>
<span id="cb62-347"><a href="#cb62-347" aria-hidden="true" tabindex="-1"></a>      <span class="st">" than test stat = "</span>,</span>
<span id="cb62-348"><a href="#cb62-348" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-349"><a href="#cb62-349" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-350"><a href="#cb62-350" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-351"><a href="#cb62-351" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb62-352"><a href="#cb62-352" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-353"><a href="#cb62-353" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-354"><a href="#cb62-354" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb62-355"><a href="#cb62-355" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.75</span>, <span class="fl">1.75</span>)</span>
<span id="cb62-356"><a href="#cb62-356" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-357"><a href="#cb62-357" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>output<span class="sc">$</span>test_stat, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>))</span>
<span id="cb62-358"><a href="#cb62-358" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type<span class="sc">==</span><span class="st">"two.sided"</span>) {</span>
<span id="cb62-359"><a href="#cb62-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(</span>
<span id="cb62-360"><a href="#cb62-360" aria-hidden="true" tabindex="-1"></a>    <span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat,</span>
<span id="cb62-361"><a href="#cb62-361" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb62-362"><a href="#cb62-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb62-363"><a href="#cb62-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span></span>
<span id="cb62-364"><a href="#cb62-364" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb62-365"><a href="#cb62-365" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-366"><a href="#cb62-366" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(</span>
<span id="cb62-367"><a href="#cb62-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">panel.text</span>(</span>
<span id="cb62-368"><a href="#cb62-368" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> output<span class="sc">$</span>test_stat,</span>
<span id="cb62-369"><a href="#cb62-369" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>,</span>
<span id="cb62-370"><a href="#cb62-370" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Test Statistic"</span>,</span>
<span id="cb62-371"><a href="#cb62-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb62-372"><a href="#cb62-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb62-373"><a href="#cb62-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">offset =</span> <span class="dv">1</span></span>
<span id="cb62-374"><a href="#cb62-374" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-375"><a href="#cb62-375" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-376"><a href="#cb62-376" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-377"><a href="#cb62-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-378"><a href="#cb62-378" aria-hidden="true" tabindex="-1"></a>Here's a graphical version of what we are doing...</span>
<span id="cb62-379"><a href="#cb62-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-382"><a href="#cb62-382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-383"><a href="#cb62-383" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb62-384"><a href="#cb62-384" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb62-385"><a href="#cb62-385" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/2-sample-perm-test.png"</span>)</span>
<span id="cb62-386"><a href="#cb62-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-387"><a href="#cb62-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-388"><a href="#cb62-388" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working with Proportions</span></span>
<span id="cb62-389"><a href="#cb62-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-390"><a href="#cb62-390" aria-hidden="true" tabindex="-1"></a>We can take the same permutation/randomization approach and use the same 1- and 2-sample tests with proportion data.</span>
<span id="cb62-391"><a href="#cb62-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-392"><a href="#cb62-392" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">**Module 15**</span><span class="co">](#module-15)</span>, we looked at a set of data on captures of birds in 30 nets on a morning of mist netting (i.e., a "success" or "failure" for every net during a netting session) and tested whether the proportion of "successes" was lower than the expectation of 80% was lower than in previous years. The code below lets us do this using a 1-sample randomization test.</span>
<span id="cb62-393"><a href="#cb62-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-396"><a href="#cb62-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-397"><a href="#cb62-397" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb62-398"><a href="#cb62-398" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb62-399"><a href="#cb62-399" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb62-400"><a href="#cb62-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-401"><a href="#cb62-401" aria-hidden="true" tabindex="-1"></a><span class="co"># using {jmuOutlier}</span></span>
<span id="cb62-402"><a href="#cb62-402" aria-hidden="true" tabindex="-1"></a><span class="co"># library(jmuOutlier)</span></span>
<span id="cb62-403"><a href="#cb62-403" aria-hidden="true" tabindex="-1"></a><span class="co"># perm.test(v, alternative="less", mu=0.8, plot=FALSE, num.sim = nperm)</span></span>
<span id="cb62-404"><a href="#cb62-404" aria-hidden="true" tabindex="-1"></a><span class="co"># detach(package:jmuOutlier)</span></span>
<span id="cb62-405"><a href="#cb62-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-406"><a href="#cb62-406" aria-hidden="true" tabindex="-1"></a><span class="co"># using our custom function</span></span>
<span id="cb62-407"><a href="#cb62-407" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm1samp</span>(v, <span class="at">stat=</span><span class="st">"mean"</span>, <span class="at">mu=</span><span class="fl">0.8</span>, <span class="at">alternative=</span><span class="st">"less"</span>, <span class="at">nperm=</span>nperm)</span>
<span id="cb62-408"><a href="#cb62-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-409"><a href="#cb62-409" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(</span>
<span id="cb62-410"><a href="#cb62-410" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>perm_stat,</span>
<span id="cb62-411"><a href="#cb62-411" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"count"</span>,</span>
<span id="cb62-412"><a href="#cb62-412" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"# Permutations"</span>,</span>
<span id="cb62-413"><a href="#cb62-413" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb62-414"><a href="#cb62-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">ifelse</span>(</span>
<span id="cb62-415"><a href="#cb62-415" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span></span>
<span id="cb62-416"><a href="#cb62-416" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>,</span>
<span id="cb62-417"><a href="#cb62-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-418"><a href="#cb62-418" aria-hidden="true" tabindex="-1"></a>      <span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb62-419"><a href="#cb62-419" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type,</span>
<span id="cb62-420"><a href="#cb62-420" aria-hidden="true" tabindex="-1"></a>      <span class="st">" than test stat = "</span>,</span>
<span id="cb62-421"><a href="#cb62-421" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-422"><a href="#cb62-422" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-423"><a href="#cb62-423" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-424"><a href="#cb62-424" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb62-425"><a href="#cb62-425" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-426"><a href="#cb62-426" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-427"><a href="#cb62-427" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-428"><a href="#cb62-428" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-429"><a href="#cb62-429" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>( <span class="at">v =</span> output<span class="sc">$</span>test_stat, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>))</span>
<span id="cb62-430"><a href="#cb62-430" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"two.sided"</span>) {</span>
<span id="cb62-431"><a href="#cb62-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(</span>
<span id="cb62-432"><a href="#cb62-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat,</span>
<span id="cb62-433"><a href="#cb62-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb62-434"><a href="#cb62-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb62-435"><a href="#cb62-435" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span></span>
<span id="cb62-436"><a href="#cb62-436" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb62-437"><a href="#cb62-437" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-438"><a href="#cb62-438" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(</span>
<span id="cb62-439"><a href="#cb62-439" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> output<span class="sc">$</span>test_stat,</span>
<span id="cb62-440"><a href="#cb62-440" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>,</span>
<span id="cb62-441"><a href="#cb62-441" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Test Statistic"</span>,</span>
<span id="cb62-442"><a href="#cb62-442" aria-hidden="true" tabindex="-1"></a>  <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb62-443"><a href="#cb62-443" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb62-444"><a href="#cb62-444" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="dv">1</span></span>
<span id="cb62-445"><a href="#cb62-445" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb62-446"><a href="#cb62-446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-447"><a href="#cb62-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-448"><a href="#cb62-448" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">**Module 15**</span><span class="co">](#module-15)</span>, we also compared data on captures of two species of bats over the course of a week of nightly mist-netting. For each species, the record indicates whether a captured female was lactating (1) or not (0), and we wanted to test whether this proportion differed between species. We can do this with a 2-sample randomization test.</span>
<span id="cb62-449"><a href="#cb62-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-452"><a href="#cb62-452" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-453"><a href="#cb62-453" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb62-454"><a href="#cb62-454" aria-hidden="true" tabindex="-1"></a>species1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb62-455"><a href="#cb62-455" aria-hidden="true" tabindex="-1"></a>species2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb62-456"><a href="#cb62-456" aria-hidden="true" tabindex="-1"></a>(actual_diff <span class="ot">&lt;-</span> <span class="fu">mean</span>(species1)<span class="sc">-</span><span class="fu">mean</span>(species2))</span>
<span id="cb62-457"><a href="#cb62-457" aria-hidden="true" tabindex="-1"></a><span class="co"># this calculates a difference in proportions</span></span>
<span id="cb62-458"><a href="#cb62-458" aria-hidden="true" tabindex="-1"></a>nperm <span class="ot">&lt;-</span> <span class="dv">10000</span></span>
<span id="cb62-459"><a href="#cb62-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-460"><a href="#cb62-460" aria-hidden="true" tabindex="-1"></a><span class="co"># using {jmuOutlier}</span></span>
<span id="cb62-461"><a href="#cb62-461" aria-hidden="true" tabindex="-1"></a><span class="co"># library(jmuOutlier)</span></span>
<span id="cb62-462"><a href="#cb62-462" aria-hidden="true" tabindex="-1"></a><span class="co"># perm.test(species1, species2, alternative = "two.sided", plot=FALSE, num.sim = nperm)</span></span>
<span id="cb62-463"><a href="#cb62-463" aria-hidden="true" tabindex="-1"></a><span class="co"># detach(package:jmuOutlier)</span></span>
<span id="cb62-464"><a href="#cb62-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-465"><a href="#cb62-465" aria-hidden="true" tabindex="-1"></a><span class="co"># using our custom function</span></span>
<span id="cb62-466"><a href="#cb62-466" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">perm2samp</span>(species1, species2, <span class="at">stat=</span><span class="st">"mean_diff"</span>, <span class="at">nperm=</span>nperm)</span>
<span id="cb62-467"><a href="#cb62-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-468"><a href="#cb62-468" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(</span>
<span id="cb62-469"><a href="#cb62-469" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>perm_stat,</span>
<span id="cb62-470"><a href="#cb62-470" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"count"</span>,</span>
<span id="cb62-471"><a href="#cb62-471" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">"# Permutations"</span>,</span>
<span id="cb62-472"><a href="#cb62-472" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Histogram of Permutation Distribution"</span>,</span>
<span id="cb62-473"><a href="#cb62-473" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">ifelse</span>(</span>
<span id="cb62-474"><a href="#cb62-474" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"less"</span> <span class="sc">|</span></span>
<span id="cb62-475"><a href="#cb62-475" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type <span class="sc">==</span> <span class="st">"greater"</span>,</span>
<span id="cb62-476"><a href="#cb62-476" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-477"><a href="#cb62-477" aria-hidden="true" tabindex="-1"></a>      <span class="st">"One-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution "</span>,</span>
<span id="cb62-478"><a href="#cb62-478" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>type,</span>
<span id="cb62-479"><a href="#cb62-479" aria-hidden="true" tabindex="-1"></a>      <span class="st">" than test stat = "</span>,</span>
<span id="cb62-480"><a href="#cb62-480" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-481"><a href="#cb62-481" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-482"><a href="#cb62-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb62-483"><a href="#cb62-483" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Two-Sided Test</span><span class="sc">\n</span><span class="st">Proportion of distribution more extreme than test stat = "</span>,</span>
<span id="cb62-484"><a href="#cb62-484" aria-hidden="true" tabindex="-1"></a>      output<span class="sc">$</span>p_perm</span>
<span id="cb62-485"><a href="#cb62-485" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-486"><a href="#cb62-486" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-487"><a href="#cb62-487" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-488"><a href="#cb62-488" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>output<span class="sc">$</span>test_stat, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>))</span>
<span id="cb62-489"><a href="#cb62-489" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (output<span class="sc">$</span>type<span class="sc">==</span><span class="st">"two.sided"</span>) {</span>
<span id="cb62-490"><a href="#cb62-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ladd</span>(<span class="fu">panel.abline</span>(</span>
<span id="cb62-491"><a href="#cb62-491" aria-hidden="true" tabindex="-1"></a>    <span class="at">v =</span> <span class="sc">-</span>output<span class="sc">$</span>test_stat,</span>
<span id="cb62-492"><a href="#cb62-492" aria-hidden="true" tabindex="-1"></a>    <span class="at">lty =</span> <span class="dv">3</span>,</span>
<span id="cb62-493"><a href="#cb62-493" aria-hidden="true" tabindex="-1"></a>    <span class="at">lwd =</span> <span class="dv">2</span>,</span>
<span id="cb62-494"><a href="#cb62-494" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"red"</span></span>
<span id="cb62-495"><a href="#cb62-495" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb62-496"><a href="#cb62-496" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-497"><a href="#cb62-497" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.text</span>(</span>
<span id="cb62-498"><a href="#cb62-498" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> output<span class="sc">$</span>test_stat,</span>
<span id="cb62-499"><a href="#cb62-499" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> nperm <span class="sc">*</span> <span class="fl">0.08</span>,</span>
<span id="cb62-500"><a href="#cb62-500" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Test Statistic"</span>,</span>
<span id="cb62-501"><a href="#cb62-501" aria-hidden="true" tabindex="-1"></a>  <span class="at">srt =</span> <span class="dv">90</span>,</span>
<span id="cb62-502"><a href="#cb62-502" aria-hidden="true" tabindex="-1"></a>  <span class="at">pos =</span> <span class="dv">4</span>,</span>
<span id="cb62-503"><a href="#cb62-503" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset =</span> <span class="dv">1</span></span>
<span id="cb62-504"><a href="#cb62-504" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb62-505"><a href="#cb62-505" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-506"><a href="#cb62-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-507"><a href="#cb62-507" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** The p values associated with these permutation/randomization based tests on proportions are not so close to those using the `prop.test()` function for the same data that we ran in [**Module 15**](#module-15). This is because </span><span class="in">`prop.test()`</span><span class="at"> is calculating the p value associated with our test statistic presuming that the distribution of sampling proportions is roughly normal, whereas this test is calculating p values by counting the proportion of simulations!</span></span>
<span id="cb62-508"><a href="#cb62-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-509"><a href="#cb62-509" aria-hidden="true" tabindex="-1"></a><span class="fu">## Using the {infer} Package</span></span>
<span id="cb62-510"><a href="#cb62-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-511"><a href="#cb62-511" aria-hidden="true" tabindex="-1"></a>The {infer} package offers a convenient set of functions and a standard workflow for using permutation methods for hypothesis testing, whether we are dealing with means, differences between means, proportions, or differences in proportions.</span>
<span id="cb62-512"><a href="#cb62-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-515"><a href="#cb62-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-516"><a href="#cb62-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb62-517"><a href="#cb62-517" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb62-518"><a href="#cb62-518" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/infer.png"</span>)</span>
<span id="cb62-519"><a href="#cb62-519" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-520"><a href="#cb62-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-521"><a href="#cb62-521" aria-hidden="true" tabindex="-1"></a>The {infer} package includes a set of functions that allow us to easily generate shuffled or permuted datasets and then conduct hypothesis testing with these datasets just as we have done above. We will explore how we do this with the {infer} package using the black-and-white colobus weight data we used above.</span>
<span id="cb62-522"><a href="#cb62-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-523"><a href="#cb62-523" aria-hidden="true" tabindex="-1"></a>We first read in our data and load the {infer} package:</span>
<span id="cb62-524"><a href="#cb62-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-527"><a href="#cb62-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-528"><a href="#cb62-528" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb62-529"><a href="#cb62-529" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/colobus-weights.csv"</span></span>
<span id="cb62-530"><a href="#cb62-530" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names=</span><span class="cn">TRUE</span>)</span>
<span id="cb62-531"><a href="#cb62-531" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(infer)</span>
<span id="cb62-532"><a href="#cb62-532" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-533"><a href="#cb62-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-534"><a href="#cb62-534" aria-hidden="true" tabindex="-1"></a>Then, we use the function <span class="in">`specify()`</span> to indicate the variables we are interested in. The <span class="in">`specify()`</span> function takes an argument of <span class="in">`formula=`</span> response\~explanatory. If we are working with proportion data, we also need to provide an argument for what value of the explanatory variable counts as a success, using <span class="in">`success=`</span>, but that is not the case for our colobus weight data, where our response variable is numeric, not binary.</span>
<span id="cb62-535"><a href="#cb62-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-538"><a href="#cb62-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-539"><a href="#cb62-539" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">specify</span>(<span class="at">formula =</span> weight<span class="sc">~</span>sex)</span>
<span id="cb62-540"><a href="#cb62-540" aria-hidden="true" tabindex="-1"></a><span class="co"># this does not change the data frame but adds some meta data</span></span>
<span id="cb62-541"><a href="#cb62-541" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb62-542"><a href="#cb62-542" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-543"><a href="#cb62-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-544"><a href="#cb62-544" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`hypothesize()`</span> is then used to declare the null hypothesis we wish to test. We use the argument <span class="in">`null="point"`</span> if we are doing a test of a single mean (<span class="in">`mu=`</span>) or proportion (<span class="in">`p=`</span>) or <span class="in">`null="independence"`</span> if we are doing a test of the independence of two variables (i.e., a two-sample test).</span>
<span id="cb62-545"><a href="#cb62-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-548"><a href="#cb62-548" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-549"><a href="#cb62-549" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>)</span>
<span id="cb62-550"><a href="#cb62-550" aria-hidden="true" tabindex="-1"></a><span class="co"># again, this does not change the data frame but adds some meta data</span></span>
<span id="cb62-551"><a href="#cb62-551" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(d)</span>
<span id="cb62-552"><a href="#cb62-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-553"><a href="#cb62-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-554"><a href="#cb62-554" aria-hidden="true" tabindex="-1"></a>We then use the <span class="in">`generate()`</span> function to generate replicates of "shuffled" or "permuted" data under the assumption that the null hypothesis is true. That is, we generating datasets from which we then derived a null distribution for our statistic of interest.</span>
<span id="cb62-555"><a href="#cb62-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-558"><a href="#cb62-558" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-559"><a href="#cb62-559" aria-hidden="true" tabindex="-1"></a>d_permutations <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span> <span class="fu">generate</span>(<span class="at">reps=</span><span class="dv">1000</span>, <span class="at">type=</span><span class="st">"permute"</span>)</span>
<span id="cb62-560"><a href="#cb62-560" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(d)</span>
<span id="cb62-561"><a href="#cb62-561" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(d_permutations)</span>
<span id="cb62-562"><a href="#cb62-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-563"><a href="#cb62-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-564"><a href="#cb62-564" aria-hidden="true" tabindex="-1"></a>Next, we use <span class="in">`calculate()`</span> to calculate summary statistics of interest for each replicate. We can calculate a variety of different statistics, including the mean ("mean"), proportion ("prop"), difference in means ("diff in means"), difference in proportions ("diff in props"), and others. This step generates a null distribution for our summary statistic. For differences in means or proportions, we need to also include an argument specifying the order of the levels of the explanatory variable for subtraction.</span>
<span id="cb62-565"><a href="#cb62-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-568"><a href="#cb62-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-569"><a href="#cb62-569" aria-hidden="true" tabindex="-1"></a>null_distribution <span class="ot">&lt;-</span> d_permutations <span class="sc">|&gt;</span></span>
<span id="cb62-570"><a href="#cb62-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat=</span><span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"male"</span>,<span class="st">"female"</span>))</span>
<span id="cb62-571"><a href="#cb62-571" aria-hidden="true" tabindex="-1"></a><span class="co"># to subtract female weight from male weight</span></span>
<span id="cb62-572"><a href="#cb62-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-573"><a href="#cb62-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-574"><a href="#cb62-574" aria-hidden="true" tabindex="-1"></a>We can then use the function <span class="in">`visualize()`</span> to examine the null distribution (alternatively, we can use <span class="in">`histogram()`</span>, in which case we then need to specify the variable <span class="in">`name="stat"`</span>)</span>
<span id="cb62-575"><a href="#cb62-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-578"><a href="#cb62-578" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-579"><a href="#cb62-579" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins=</span><span class="dv">20</span>)</span>
<span id="cb62-580"><a href="#cb62-580" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(null_distribution<span class="sc">$</span>stat, <span class="at">nint=</span><span class="dv">20</span>)</span>
<span id="cb62-581"><a href="#cb62-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-582"><a href="#cb62-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-583"><a href="#cb62-583" aria-hidden="true" tabindex="-1"></a>So, now we have a null or permutation distribution for the test statistic... then, we can also use {infer} package functions to easily calculate hte observed summary statistic that we want to compare to this null distribution by simply leaving out the <span class="in">`hypothesize()`</span> and <span class="in">`generate()`</span> steps.</span>
<span id="cb62-584"><a href="#cb62-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-587"><a href="#cb62-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-588"><a href="#cb62-588" aria-hidden="true" tabindex="-1"></a>observed_stat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-589"><a href="#cb62-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(weight <span class="sc">~</span> sex) <span class="sc">|&gt;</span></span>
<span id="cb62-590"><a href="#cb62-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in means"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>))</span>
<span id="cb62-591"><a href="#cb62-591" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-592"><a href="#cb62-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-593"><a href="#cb62-593" aria-hidden="true" tabindex="-1"></a>We can plot this observed test statistic atop the null distribution using the <span class="in">`shade_p_value()`</span> function, which has two arguments: a value for <span class="in">`obs_stat=`</span> and a <span class="in">`direction=`</span> ("left, "right", or "both") corresponding to two different one-tailed or a two-tailed alternative hypothesis.</span>
<span id="cb62-594"><a href="#cb62-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-597"><a href="#cb62-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-598"><a href="#cb62-598" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb62-599"><a href="#cb62-599" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb62-600"><a href="#cb62-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-601"><a href="#cb62-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-602"><a href="#cb62-602" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** This is not very interesting because the observed statistic is way outside of the null distribution!</span></span>
<span id="cb62-603"><a href="#cb62-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-604"><a href="#cb62-604" aria-hidden="true" tabindex="-1"></a>The function <span class="in">`get_p_value()`</span> with arguments of the null distribution, the observed statistic, and the direction will give us the p value generated by permutation.</span>
<span id="cb62-605"><a href="#cb62-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-608"><a href="#cb62-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-609"><a href="#cb62-609" aria-hidden="true" tabindex="-1"></a><span class="fu">get_p_value</span>(null_distribution,observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb62-610"><a href="#cb62-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-611"><a href="#cb62-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-612"><a href="#cb62-612" aria-hidden="true" tabindex="-1"></a>As an additional example of this approach, let's consider the vervet trapping data from above once again. Recall that we want to evaluate whether vervet monkeys trapped during the 2015 trapping season differed in weight from the expectation based on previous years, which was 5.0 kg. How do we do this using the {infer} workflow?</span>
<span id="cb62-613"><a href="#cb62-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-616"><a href="#cb62-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-617"><a href="#cb62-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb62-618"><a href="#cb62-618" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/vervet-weights.csv"</span></span>
<span id="cb62-619"><a href="#cb62-619" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-620"><a href="#cb62-620" aria-hidden="true" tabindex="-1"></a>null_distribution <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb62-621"><a href="#cb62-621" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(<span class="at">response =</span> weight) <span class="sc">|&gt;</span></span>
<span id="cb62-622"><a href="#cb62-622" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here we specify just a response, not a formula</span></span>
<span id="cb62-623"><a href="#cb62-623" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"point"</span>, <span class="at">mu =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-624"><a href="#cb62-624" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here we are comparing a sample to an expectation</span></span>
<span id="cb62-625"><a href="#cb62-625" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"bootstrap"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-626"><a href="#cb62-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"mean"</span>)</span>
<span id="cb62-627"><a href="#cb62-627" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note that here type="bootstrap"! This is actually doing something a little different than we did above... it is sampling *with replacement* from our set of weights  rather than randomly permuting the sign of the difference of each value from the mean! (Here, the number of observations sampled is equal to the original number of observations)</span></span>
<span id="cb62-628"><a href="#cb62-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-629"><a href="#cb62-629" aria-hidden="true" tabindex="-1"></a>observed_stat <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb62-630"><a href="#cb62-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(<span class="at">response =</span> weight) <span class="sc">|&gt;</span></span>
<span id="cb62-631"><a href="#cb62-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat=</span><span class="st">"mean"</span>)</span>
<span id="cb62-632"><a href="#cb62-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-633"><a href="#cb62-633" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb62-634"><a href="#cb62-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_p_value</span>(<span class="at">obs_stat =</span> observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb62-635"><a href="#cb62-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-636"><a href="#cb62-636" aria-hidden="true" tabindex="-1"></a><span class="fu">get_p_value</span>(null_distribution, observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb62-637"><a href="#cb62-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-638"><a href="#cb62-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-639"><a href="#cb62-639" aria-hidden="true" tabindex="-1"></a>Note that this p value is pretty similar to that returned by <span class="in">`jmuOutlier::perm.test()`</span> and by our custom <span class="in">`perm1samp()`</span> function, though as noted above, those use slightly different permutation processes.</span>
<span id="cb62-640"><a href="#cb62-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-641"><a href="#cb62-641" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb62-642"><a href="#cb62-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-643"><a href="#cb62-643" aria-hidden="true" tabindex="-1"></a>As a final example of this approach, we will again examine data on captures of two species of bats over the course of a week of nightly mist-netting. For each species, remember that the record indicates whether a captured female was lactating (1) or not (0).</span>
<span id="cb62-644"><a href="#cb62-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-647"><a href="#cb62-647" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-648"><a href="#cb62-648" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: last</span></span>
<span id="cb62-649"><a href="#cb62-649" aria-hidden="true" tabindex="-1"></a>species1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb62-650"><a href="#cb62-650" aria-hidden="true" tabindex="-1"></a>species2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb62-651"><a href="#cb62-651" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-652"><a href="#cb62-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-653"><a href="#cb62-653" aria-hidden="true" tabindex="-1"></a>First, we need to massage this data into the correct shape:</span>
<span id="cb62-654"><a href="#cb62-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-657"><a href="#cb62-657" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-658"><a href="#cb62-658" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">species=</span><span class="st">"species1"</span>, <span class="at">lactating=</span>species1)</span>
<span id="cb62-659"><a href="#cb62-659" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">species=</span><span class="st">"species2"</span>, <span class="at">lactating=</span>species2)</span>
<span id="cb62-660"><a href="#cb62-660" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(s1,s2)</span>
<span id="cb62-661"><a href="#cb62-661" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>lactating <span class="ot">&lt;-</span> <span class="fu">factor</span>(d<span class="sc">$</span>lactating)</span>
<span id="cb62-662"><a href="#cb62-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-663"><a href="#cb62-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-664"><a href="#cb62-664" aria-hidden="true" tabindex="-1"></a>Now, use the {infer} workflow to test whether the proportion of lactating females among the captured bats differs between species.</span>
<span id="cb62-665"><a href="#cb62-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-668"><a href="#cb62-668" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-669"><a href="#cb62-669" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb62-670"><a href="#cb62-670" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb62-671"><a href="#cb62-671" aria-hidden="true" tabindex="-1"></a><span class="co">#| attr.output: '.details summary="Show Output"'</span></span>
<span id="cb62-672"><a href="#cb62-672" aria-hidden="true" tabindex="-1"></a>null_distribution <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb62-673"><a href="#cb62-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(lactating <span class="sc">~</span> species, <span class="at">success =</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-674"><a href="#cb62-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">hypothesize</span>(<span class="at">null =</span> <span class="st">"independence"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-675"><a href="#cb62-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generate</span>(<span class="at">reps =</span> <span class="dv">1000</span>, <span class="at">type =</span> <span class="st">"permute"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-676"><a href="#cb62-676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in props"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"species1"</span>, <span class="st">"species2"</span>))</span>
<span id="cb62-677"><a href="#cb62-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-678"><a href="#cb62-678" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: This runs a LOT slower than our custom permutation function for the same number of reps!</span></span>
<span id="cb62-679"><a href="#cb62-679" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins=</span><span class="dv">20</span>)</span>
<span id="cb62-680"><a href="#cb62-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-681"><a href="#cb62-681" aria-hidden="true" tabindex="-1"></a>observed_stat <span class="ot">&lt;-</span> d <span class="sc">|&gt;</span></span>
<span id="cb62-682"><a href="#cb62-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">specify</span>(lactating <span class="sc">~</span> species, <span class="at">success =</span> <span class="st">"1"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-683"><a href="#cb62-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">calculate</span>(<span class="at">stat =</span> <span class="st">"diff in props"</span>, <span class="at">order =</span> <span class="fu">c</span>(<span class="st">"species1"</span>, <span class="st">"species2"</span>))</span>
<span id="cb62-684"><a href="#cb62-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-685"><a href="#cb62-685" aria-hidden="true" tabindex="-1"></a><span class="fu">visualize</span>(null_distribution, <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb62-686"><a href="#cb62-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">shade_p_value</span>(observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb62-687"><a href="#cb62-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-688"><a href="#cb62-688" aria-hidden="true" tabindex="-1"></a><span class="fu">get_p_value</span>(null_distribution, observed_stat, <span class="at">direction =</span> <span class="st">"both"</span>)</span>
<span id="cb62-689"><a href="#cb62-689" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>infer)</span>
<span id="cb62-690"><a href="#cb62-690" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-691"><a href="#cb62-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-692"><a href="#cb62-692" aria-hidden="true" tabindex="-1"></a>This p value is similar to that returned by our custom permutation test!</span>
<span id="cb62-693"><a href="#cb62-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-694"><a href="#cb62-694" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advantages of Permutation Tests</span></span>
<span id="cb62-695"><a href="#cb62-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-696"><a href="#cb62-696" aria-hidden="true" tabindex="-1"></a>Some of the key advantages of permutation tests include the following:</span>
<span id="cb62-697"><a href="#cb62-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-698"><a href="#cb62-698" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>They are "distribution-free" - i.e., they do not make any assumptions about the distribution of the underlying data</span>
<span id="cb62-699"><a href="#cb62-699" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>There is no presumption of random sampling from some imaginary hypothetical population</span>
<span id="cb62-700"><a href="#cb62-700" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unlike some other nonparametric tests, they do not depend on large sample sizes for their validity</span>
<span id="cb62-701"><a href="#cb62-701" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Many common nonparametric tests **are** permutation tests, just carried out on RANKS</span>
<span id="cb62-702"><a href="#cb62-702" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>They can be used with many kinds of data (nominal, ordinal, interval/ratio)</span>
<span id="cb62-703"><a href="#cb62-703" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>They are relatively straightforward to conduct and interpret</span>
<span id="cb62-704"><a href="#cb62-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-705"><a href="#cb62-705" aria-hidden="true" tabindex="-1"></a><span class="in">```{r include=FALSE}</span></span>
<span id="cb62-706"><a href="#cb62-706" aria-hidden="true" tabindex="-1"></a><span class="in">detach(package:mosaic)</span></span>
<span id="cb62-707"><a href="#cb62-707" aria-hidden="true" tabindex="-1"></a><span class="in">detach(package:tidyverse)</span></span>
<span id="cb62-708"><a href="#cb62-708" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-709"><a href="#cb62-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-710"><a href="#cb62-710" aria-hidden="true" tabindex="-1"></a>&lt;hr&gt;</span>
<span id="cb62-711"><a href="#cb62-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-712"><a href="#cb62-712" aria-hidden="true" tabindex="-1"></a><span class="fu">## Concept Review {.unnumbered}</span></span>
<span id="cb62-713"><a href="#cb62-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-714"><a href="#cb62-714" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Permutation/randomization tests involve these steps:</span>
<span id="cb62-715"><a href="#cb62-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-716"><a href="#cb62-716" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Compute a sample statistic of your choice (mean, median, proportion, etc.) using the set of original observations</span>
<span id="cb62-717"><a href="#cb62-717" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Rearrange attributes of the original observations in all or a very large number of random possible permutations, computing the test statistic each time, to yield a permutation or null distribution for the test statistic under the null hypothesis</span>
<span id="cb62-718"><a href="#cb62-718" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Look at the value of the sample statistic relative to the permutation distribution</span>
<span id="cb62-719"><a href="#cb62-719" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Based on the permutation distribution, calculate the probability of seeing a sample statistic as high or higher than that observed, i.e., the portion of the permutation distribution that equals or exceed the value of the sample statistic... this is the permutation test p value</span>
<span id="cb62-720"><a href="#cb62-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-721"><a href="#cb62-721" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`jmuOutlier::perm.test()`</span>, <span class="in">`coin::indepedence_test()`</span>, or write your own!</span>
<span id="cb62-722"><a href="#cb62-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-723"><a href="#cb62-723" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>{infer} workflow</span>
<span id="cb62-724"><a href="#cb62-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-725"><a href="#cb62-725" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **NOTE:** This permutation-based approach to statistical inference is consistent with the philosophy promoted by statistician Allen Downey that, "There is really only test", and that at all statistical tests are based on the same framework. Note that this is still a form of null hypothesis significance testing, or NHST!</span></span>
<span id="cb62-726"><a href="#cb62-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-729"><a href="#cb62-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-730"><a href="#cb62-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb62-731"><a href="#cb62-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "90%"</span></span>
<span id="cb62-732"><a href="#cb62-732" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/downey.png"</span>)</span>
<span id="cb62-733"><a href="#cb62-733" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>