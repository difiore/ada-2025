<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.548">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Data Analysis - 19&nbsp; Elements of Regression Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./20-module.html" rel="next">
<link href="./18-module.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="css/style.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./19-module.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Preliminaries</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-logistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Logistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-course-schedule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Schedule</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-typography-and-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Typography and Formatting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-programming-style-guide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Programming Style Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Resources</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Part I - Using <strong><em>R</em></strong> and <strong><em>RStudio</em></strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started with <strong><em>RStudio</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Extending the Functionality of <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Fundamentals of the <strong><em>R</em></strong> Language</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Basics of Version Control</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Reproducible Research</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Additional Data Structures in <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Getting Data into <strong><em>R</em></strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Data Wrangling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Functions and Flow Control</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Part II - Statistics and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Descriptive Statisics and Sampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Probability and Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Confidence Intervals</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Classical Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Using Permutation Tests</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Error, Power, and Effect Size</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Linear Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-module.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 01</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 02</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 03</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-04-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 04 Solution</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 05</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 07</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exercise-06-solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exercise 07 Solution</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">Assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-analysis-replication-assignment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Analysis Replication</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">List of Packages Used</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">19.1</span> Objectives</a></li>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries"><span class="header-section-number">19.2</span> Preliminaries</a></li>
  <li><a href="#analysis-of-variance-tables" id="toc-analysis-of-variance-tables" class="nav-link" data-scroll-target="#analysis-of-variance-tables"><span class="header-section-number">19.3</span> Analysis of Variance Tables</a></li>
  <li><a href="#standard-errors-of-coefficients" id="toc-standard-errors-of-coefficients" class="nav-link" data-scroll-target="#standard-errors-of-coefficients"><span class="header-section-number">19.4</span> Standard Errors of Coefficients</a></li>
  <li><a href="#model-checking" id="toc-model-checking" class="nav-link" data-scroll-target="#model-checking"><span class="header-section-number">19.5</span> Model Checking</a>
  <ul class="collapse">
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">CHALLENGE</a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#data-transformations" id="toc-data-transformations" class="nav-link" data-scroll-target="#data-transformations"><span class="header-section-number">19.6</span> Data Transformations</a>
  <ul class="collapse">
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">CHALLENGE</a></li>
  </ul></li>
  <li><a href="#concept-review" id="toc-concept-review" class="nav-link" data-scroll-target="#concept-review">Concept Review</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./12-module.html">Part II - Statistics and Inference</a></li><li class="breadcrumb-item"><a href="./19-module.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="module-19" class="quarto-section-identifier"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Elements of Regression Analysis</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objectives" class="level2" data-number="19.1">
<h2 data-number="19.1" class="anchored" data-anchor-id="objectives"><span class="header-section-number">19.1</span> Objectives</h2>
<blockquote class="blockquote">
<p>The objective of this module is to continue our discussion of simple linear regression analysis to understand how the goal of regression is to partition variance in the response variable among different sources, i.e., into that explained <strong>by the regression model</strong> itself (and, we will see later on in our discussion of multivariate regression, among different factors in that model) versus the left-over <strong>error or residual variance</strong>. We also go through how to calculate the <strong>standard errors</strong> for our various regression coefficients and for the predicted values of our response variable based on our regression model, which, as we have seen, are returned by the <code>lm()</code> function. Finally, we also briefly discuss ways to transform non-normally distributed data to make them more appropriate for analysis using linear regression.</p>
</blockquote>
</section>
<section id="preliminaries" class="level2" data-number="19.2">
<h2 data-number="19.2" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">19.2</span> Preliminaries</h2>
<ul>
<li>Install the following package in <strong><em>R</em></strong>: <a href="https://cran.r-project.org/web/packages/broom/ggpubr.pdf">{ggpubr}</a></li>
<li>Load {tidyverse}, {mosiac}, {car}, {broom}</li>
</ul>
</section>
<section id="analysis-of-variance-tables" class="level2" data-number="19.3">
<h2 data-number="19.3" class="anchored" data-anchor-id="analysis-of-variance-tables"><span class="header-section-number">19.3</span> Analysis of Variance Tables</h2>
<p>In our linear models, we can separate or “partition” the total variation in our <strong>y</strong> variable (the <em>sum of squares of y</em>, or <span class="math inline">\(SSY\)</span>) into that explained by our model (the <em>regression sum of squares</em>, or <span class="math inline">\(SSR\)</span>) and that which is left over as “error” (the <em>error sum of squares</em>, or <span class="math inline">\(SSE\)</span>):</p>
<p><span class="math display">\[SSY = SSR + SSE\]</span></p>
<p>Graphically…</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/partitioningSS.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Let’s make sure we have our zombie apocalypse survivors dataset loaded…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/zombies.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we run a straightforward bivariate regression model and, using the raw data (which are duplicated in the <code>$model</code> data structure within our model object), we will calculate the various sums of squares of our variables and identify the numbers of degrees of freedom associated with each source of variation. This allows us to generate the ANOVA table for our model, which is a summary of how variance is partitioned among different sources.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, height <span class="sc">~</span> weight)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># height - mean(height)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>SSY <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>height <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>height))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>SSY</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 18558.61</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted height - mean height</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>fitted.values <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>height))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>SSR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 12864.82</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># height - predicted height</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>height <span class="sc">-</span> m<span class="sc">$</span>fitted.values)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>SSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 5693.785</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>(m<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>SSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 5693.785</code></pre>
</div>
</div>
<p>From here, we can calculate the variance in each of these components, typically referred to as the <em>mean square</em>, by dividing each sum of squares by its corresponding degrees of freedom (recall that a variance can be thought of as an average “sum of squares”).</p>
<p>The degrees of freedom for the regression sum of squares (<span class="math inline">\(SSR\)</span>) is equal to the number of predictor variables (<span class="math inline">\(p\)</span>), which in this case is one (given our regression equation, we need to know only one piece of information, the value of our predictor variable, in order to calculate the predicted value of the response variable). The number of degrees of freedom for the error sum of squares (<span class="math inline">\(SSE\)</span>) is equal to <span class="math inline">\(n-2\)</span> (or <span class="math inline">\(n - p - 1\)</span>). This is because we need to estimate two parameters (<span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span>) from our data before we can calculate the error sum of squares. Finally, the number of degrees of freedom for the total sum of squares (<span class="math inline">\(SSY\)</span>) is <span class="math inline">\(n-1\)</span>… we need to estimate one parameter from our data (the mean value of <strong>y</strong>) before we can calculate <span class="math inline">\(SSY\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(df_regression <span class="ot">&lt;-</span> <span class="dv">1</span>)  <span class="co"># p = 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(df_error <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> df_regression <span class="sc">-</span> <span class="dv">1</span>)  <span class="co"># n - p - 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 998</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(df_y <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> df_regression)  <span class="co"># n - p</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 999</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>MSR <span class="ot">&lt;-</span> SSR<span class="sc">/</span>df_regression  <span class="co"># mean variance explained by the regression equation</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> SSE<span class="sc">/</span>df_error  <span class="co"># mean remaining variance</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>MSY <span class="ot">&lt;-</span> SSY<span class="sc">/</span>df_y  <span class="co"># mean overall variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The last item we need to calculate is the <strong>F ratio</strong>, the ratio of the variance explained by the regression model to the remaining, unexplained variance: <span class="math inline">\(MSR/MSE\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fratio <span class="ot">&lt;-</span> MSR<span class="sc">/</span>MSE</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fratio</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 2254.931</code></pre>
</div>
</div>
<p>Together, the values we have calculated above form the main entries in the <strong>ANOVA Table</strong> for our regression.</p>
<table class="table">
<colgroup>
<col style="width: 14%">
<col style="width: 22%">
<col style="width: 24%">
<col style="width: 25%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Source</th>
<th style="text-align: center;">Sum of Squares</th>
<th style="text-align: center;">Degrees of Freedom</th>
<th style="text-align: center;">Mean Square (SS/df)</th>
<th style="text-align: center;">F ratio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Regression</td>
<td style="text-align: center;"><span class="math inline">\(SSR\)</span> = 12864.82</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><span class="math inline">\(MSR\)</span> = 12864.82</td>
<td style="text-align: center;">2254.139</td>
</tr>
<tr class="even">
<td style="text-align: center;">Error</td>
<td style="text-align: center;"><span class="math inline">\(SSE\)</span> = 5693.79</td>
<td style="text-align: center;"><span class="math inline">\(n-2\)</span> = 998</td>
<td style="text-align: center;"><span class="math inline">\(MSE\)</span> = 5.7072</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Total</td>
<td style="text-align: center;"><span class="math inline">\(SSY\)</span> = 18558.61</td>
<td style="text-align: center;"><span class="math inline">\(n-1\)</span> = 999</td>
<td style="text-align: center;"><span class="math inline">\(MSY\)</span> = 18.57719</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p>We can then test the overall significance of our regression model by evaluating our F ratio test statistic against an <span class="math inline">\(F\)</span> distribution, taking into account the number of degrees of freedom in each. The <span class="math inline">\(F\)</span> distribution is a continuous probability distribution, defined for <span class="math inline">\(x≥0\)</span> and governed by two parameters, <span class="math inline">\(df1\)</span> and <span class="math inline">\(df2\)</span>. The critical value for the <span class="math inline">\(F\)</span> statistic above which we would reject the idea that the variance in our two sources is comparable is given by <code>qf(p, df1, df2)</code>, where <strong>p</strong> is 1-<span class="math inline">\(\alpha\)</span> and <strong>df1</strong> and <strong>df2</strong> are the degrees of freedom in the sources being compared (regression versus error).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">10</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"Some Example F Distributions"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">sub =</span> <span class="st">"red vertical line shows critical value</span><span class="sc">\n</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="st">            for df1=1, df2=998"</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylab =</span> <span class="st">"f(x)"</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">key =</span> <span class="fu">list</span>(<span class="at">space =</span> <span class="st">"right"</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"df1=1, df2=1"</span>, <span class="st">"df1=2, df2=2"</span>, <span class="st">"df1=4, df2=4"</span>, <span class="st">"df1=8, df2=100"</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"df1=1, df2=998"</span>)), <span class="at">lines =</span> <span class="fu">list</span>(<span class="at">col =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">"black"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">bty =</span> <span class="st">"n"</span>, <span class="at">cex =</span> <span class="fl">0.75</span>)))</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1 =</span> <span class="dv">2</span>, <span class="at">df2 =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1 =</span> <span class="dv">4</span>, <span class="at">df2 =</span> <span class="dv">4</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1 =</span> <span class="dv">8</span>, <span class="at">df2 =</span> <span class="dv">100</span>, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>crit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 3.850793</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> crit, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <code>qf()</code> function allows us to calculate critical values under an <span class="math inline">\(F\)</span> distribution given the number of degrees of freedom for the regression and error.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>, <span class="at">main =</span> <span class="st">"df1 = 1, df2 = 998"</span>, <span class="at">xlab =</span> <span class="st">"x"</span>, <span class="at">ylab =</span> <span class="st">"f(x)"</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>))</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>crit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 3.850793</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v =</span> crit, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">1</span>))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.polygon</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(crit, <span class="fu">seq</span>(<span class="at">from =</span> crit, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">length.out =</span> <span class="dv">1000</span>), <span class="dv">12</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">df</span>(<span class="fu">seq</span>(<span class="at">from =</span> crit, <span class="at">to =</span> <span class="dv">12</span>, <span class="at">length.out =</span> <span class="dv">1000</span>), <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>), <span class="dv">0</span>)),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">border =</span> <span class="st">"black"</span>, <span class="at">col =</span> <span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For our data, the value for the F ratio statistic well exceeds this critical value!</p>
<p>Alternatively, we can use the following formulation to directly estimate a p value associated with our value for the F statistic. The p value is simply the area under the <span class="math inline">\(F\)</span> distribution curve to the right of the F statistic value (or 1 minus the cumulative probability up to that point):</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pf</span>(<span class="at">q =</span> fratio, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 2.646279e-258</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> fratio, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0</code></pre>
</div>
</div>
<p>… and we see that the p value associated with this high of an F statistic is infintessimally small.</p>
<p>As usual, <strong><em>R</em></strong> can handle all of the calculations above for easily. The <code>aov()</code> function, like the <code>lm()</code> function, returns a model object that we can use <code>summary()</code> on to look at the results we want. Alternatively, we can run the function <code>summary.aov()</code> using the model object resulting from <code>lm()</code> as an argument. In either case, the results returned are the same as we calculated by hand above.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, height <span class="sc">~</span> weight)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## weight        1  12865   12865    2255 &lt;2e-16 ***
## Residuals   998   5694       6                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##              Df Sum Sq Mean Sq F value Pr(&gt;F)    
## weight        1  12865   12865    2255 &lt;2e-16 ***
## Residuals   998   5694       6                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Recall that the results returned by <code>summary()</code> of our regression model also shows the coefficient of determination, or the “R-squared value”, which we defined above as the fraction of the total variation explained by the model. We can calculate this value directly from our ANOVA table as simply <span class="math inline">\(SSR/SSY\)</span>. The correlation coefficient, <span class="math inline">\(\rho\)</span>, between our response and predictor variable is simply the square root of this value.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>rsq <span class="ot">&lt;-</span> SSR<span class="sc">/</span>SSY</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>rsq</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.6931998</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rsq)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>rho</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.8325862</code></pre>
</div>
</div>
</section>
<section id="standard-errors-of-coefficients" class="level2" data-number="19.4">
<h2 data-number="19.4" class="anchored" data-anchor-id="standard-errors-of-coefficients"><span class="header-section-number">19.4</span> Standard Errors of Coefficients</h2>
<p>Recall that <code>lm()</code> returned the standard errors associated with each of the various components of our regression model, i.e., the slope and intercept and each predicted value of <strong>y</strong>. We can calculate standard errors directly to show how <strong><em>R</em></strong> is deriving them.</p>
<p>The formula for the standard error of the regression slope, <span class="math inline">\(\beta_1\)</span>, is calculated as:</p>
<p><span class="math display">\[SE_{\beta_1} = \sqrt{\frac{MSE}{SSX}}\]</span></p>
<p>Using our data…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>SSX <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>weight))<span class="sc">^</span><span class="dv">2</span>)  <span class="co"># how much x variation there is</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>SEbeta1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(MSE<span class="sc">/</span>SSX)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>SEbeta1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.004106858</code></pre>
</div>
</div>
<p>The standard error of the intercept, <span class="math inline">\(\beta_0\)</span>, is calculated as:</p>
<p><span class="math display">\[SE_{\beta_0} = \sqrt{\frac{MSE \times \sum{x^2}}{n \times SSX}} = SE_{\beta_1} \times \sqrt{\frac{\sum{x^2}}{n}} \]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>SEbeta0 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((MSE <span class="sc">*</span> <span class="fu">sum</span>(m<span class="sc">$</span>model<span class="sc">$</span>weight<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span>(<span class="dv">1000</span> <span class="sc">*</span> SSX))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>SEbeta0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.5958147</code></pre>
</div>
</div>
<p>Finally, the standard error of each predicted value of y is calculated as:</p>
<p><span class="math display">\[SE_{\hat{y}} = \sqrt{MSE \times {\biggl[\frac{1}{n} + \frac{(x-\hat{x})^2}{SSX}}{\biggr]}}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>SEyhat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(MSE <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span> <span class="sc">+</span> (m<span class="sc">$</span>model<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>weight))<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>SSX))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SEyhat)  <span class="co"># just the first 6 rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.08978724 0.07620966 0.08414480 0.09533986 0.08904151 0.08341218</code></pre>
</div>
</div>
<p>These same standard errors for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are exactly what are returned by the <code>lm()</code> function.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = height ~ weight, data = d)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7.1519 -1.5206 -0.0535  1.5167  9.4439 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 39.565446   0.595815   66.41   &lt;2e-16 ***
## weight       0.195019   0.004107   47.49   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.389 on 998 degrees of freedom
## Multiple R-squared:  0.6932, Adjusted R-squared:  0.6929 
## F-statistic:  2255 on 1 and 998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Note that the t statistic is calculated as simply the estimate value divided by the corresponding SE value, and the p value just comes from comparing that statistic to a <span class="math inline">\(t\)</span> distribution with the appropriate degrees of freedom (i.e., number of observations - 2). We can run another model with higher p values to see this. Here, too, we use the convenient <code>tidy()</code> function from the {broom} package to pull out a table of results from our linear model very easily.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(zombies_killed <span class="sc">~</span> age, <span class="at">data =</span> d)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="fu">tidy</span>(m)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> coefficients <span class="sc">|&gt;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">t.calc =</span> estimate<span class="sc">/</span>std.error)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> coefficients <span class="sc">|&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">p.calc =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(<span class="fu">abs</span>(t.calc), <span class="at">df =</span> <span class="fu">nrow</span>(m<span class="sc">$</span>model) <span class="sc">-</span> <span class="dv">2</span>)))</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># the p value is 2 times the tail probability implied by the t statistic</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 2 × 7
##   term        estimate std.error statistic  p.value  t.calc   p.calc
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 (Intercept)  3.01       0.378     7.97   4.35e-15  7.97   4.44e-15
## 2 age         -0.00111    0.0187   -0.0596 9.53e- 1 -0.0596 9.53e- 1</code></pre>
</div>
</div>
</section>
<section id="model-checking" class="level2" data-number="19.5">
<h2 data-number="19.5" class="anchored" data-anchor-id="model-checking"><span class="header-section-number">19.5</span> Model Checking</h2>
<p>So far, we’ve derived a bunch of summary statistics describing our model and we have looked at parametric ways of testing whether those summary statistics are significantly different from zero. That is…</p>
<ul>
<li>We have seen whether our overall regression model explains a significant portion of the variance in <strong>y</strong> by means of the <strong>F ratio</strong> <strong>test</strong>.</li>
<li>We have calculated standard errors for our <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_0\)</span> estimates and seen whether they are significantly different from zero by means of <strong>t tests</strong>.</li>
<li>We have calculated standard errors for our prediction of <strong>y</strong> (i.e., <span class="math inline">\(\hat{y}\)</span>) at each value of <strong>x</strong>.</li>
<li>We have estimated the proportion of the total variance in <strong>y</strong> explained by our model (i.e., <span class="math inline">\(R-squared\)</span>).</li>
</ul>
<p>What we have not done yet, however, is checked our model fit critically in other ways… particularly, we have not checked whether two key assumptions of linear modeling are met: that our residuals (or errors) are normally distributed and that there is constancy of variance in our <strong>y</strong> values across the range of <strong>x</strong>s (or, “homoscedasticity”).</p>
<p>We can investigate our residuals as one way of assessing model fit.</p>
<section id="challenge" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge">CHALLENGE</h3>
<p>Calculate the residuals from the regression of zombie apocalypse survivor height on weight and plot these in relation to weight (as the <strong>x</strong> variable). There are lots of ways to do this quickly.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, height <span class="sc">~</span> weight)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> m<span class="sc">$</span>residuals</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>weight, <span class="at">y =</span> e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or we could use the function `resid()`</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(m)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>weight, <span class="at">y =</span> e)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now, plot a histogram of your residuals… ideally they are normally distributed!</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(e, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span> <span class="sc">*</span> <span class="fu">sd</span>(e), <span class="dv">4</span> <span class="sc">*</span> <span class="fu">sd</span>(e)), <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Histogram of Residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>An additional way to quickly examine your residuals is to use the <code>plot()</code> function with your model as an argument. This prints out four plots that each tell you something.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The first (top left) plot of “Residuals vs Fitted” values of <strong>y</strong> should, like the plot residuals versus <strong>x</strong>, not show any structure. We hope to see equally spread residuals around a horizontal line without distinct patterns.</p>
<p>The second (top right) plot is “Normal Q-Q” plot of theoretical quantiles versus standardized quantiles for the residual values. These should fall on roughly a straight line if the residuals are normally distributed.</p>
<p>The third (bottom left) plot (“Scale-Location”) is similar to the first, but graphs the square root of the standardized residuals versus fitted values of <strong>y</strong> and shows whether or the magnitude of residuals differs across the fitted values of <strong>y</strong>. Again, it is good if you see a horizontal line with equally spread points rather than a decrease or increase in spread across the range of fitted <strong>y</strong>s, which would indicate that the error variance increases or decreases across the relationship between <strong>y</strong> and <strong>x</strong> in your model.</p>
<p>The fourth (bottom right) plot (“Residuals vs.&nbsp;Leverage”) highlights whether there are any particular observations with disproportionate influence on the model. In particular, we look to see if there are cases that fall in the upper or lower right portion of the plot.</p>
<p>We can also do a QQ plot of our residuals…</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(m<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<p>Perhaps more helpful QQ plots can be found in the {car} and {ggpubr} package. The functions <code>qqPlot()</code> and <code>ggqqplot()</code> provides a trend line and confidence intervals that allow us to see exactly which points make the sample fall outside of normality (if any). Let’s take a look:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(m, <span class="at">distribution =</span> <span class="st">"norm"</span>, <span class="at">id =</span> <span class="cn">FALSE</span>)  <span class="co"># qqPlot from {car}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `id=FALSE` means that outlier observations will not be labelled</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqqplot</span>(m<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-21-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>ggpubr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, there are a number of tests for normality that we can run within the <strong><em>R</em></strong> framework and using other packages. A <strong>Shapiro-Wilk Normality Test</strong> is perhaps the most widely used, where a low p value would indicate deviation from normality (technically, a measure of how far the trend line of the residuals deviates from the Q-Q plot line).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>(s <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(m<span class="sc">$</span>residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  m$residuals
## W = 0.99713, p-value = 0.07041</code></pre>
</div>
</div>
<p>As you can see, although there are some points at the higher quantiles that suggest non-normality, the Shapiro-Wilk test suggests that it is not quite non-normal, so our use of parametric statistics should be okay.</p>
<p>Some other popular tests for normality, and the cases in which they are best used, are listed below:</p>
<ul>
<li><p><strong>Anderson-Darling test</strong> from the {nortest} package</p>
<ul>
<li>Very popular, not quite as powerful as Shapiro-Wilk</li>
<li>Best used when <span class="math inline">\(n\)</span> ≥ 8</li>
<li><code>nortest:: ad.test()</code></li>
</ul></li>
<li><p><strong>Martinez-Iglewicz test</strong> from the {PoweR} package</p>
<ul>
<li>Tests for dispersion from the median</li>
<li>Very powerful for heavy-tailed distributions</li>
<li>Best with small sample sizes (<span class="math inline">\(n\)</span> ≥ 3)</li>
<li><code>PoweR::stat0032.MartinezIglewicz()</code></li>
</ul></li>
<li><p><strong>Kolmogorov-Smirnov test</strong> (with Lilliefors adjustment) from the {nortest} package</p>
<ul>
<li>Not as good as Anderson-Darling, but historically popular</li>
<li>Requires that <span class="math inline">\(n\)</span> ≥ 4.</li>
<li><code>nortest::lillie.test()</code></li>
</ul></li>
<li><p><strong>D-Agostino Omnibus test</strong> (based on assessment of skew and kurtosis) from the {fBasics} package</p>
<ul>
<li>Robust against identical values in distribution</li>
<li>Skewness test requires <span class="math inline">\(n\)</span> ≥ 8</li>
<li>Kurtosis test requires <span class="math inline">\(n\)</span> ≥ 20</li>
<li><code>fBasics::dagoTest()</code></li>
</ul></li>
</ul>
<p>For a good discussion/demonstration of the relative power of each of these tests (meaning the probability that the test will correctly reject the null hypothesis) at different sample sizes, check out <a href="https://ncss-wpengine.netdna-ssl.com/wp-content/themes/ncss/pdf/Procedures/PASS/Normality_Tests-Simulation.pdf">this link</a> or <a href="img/Normality_Tests-Simulation.pdf">this pdf</a>, especially the tables on pages 670-8 and 670-9 and the plots on 670-10. This can help you better understand which test is best for a given sample size, and how much faith to put in these tests given your sample!</p>
</section>
<section id="challenge-1" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-1">CHALLENGE</h3>
<p>Load in the “KamilarAndCooper.csv” dataset and develop a linear model to look at the relationship between “weaning age” and “female body mass”. You will probably need to look at the data and variable names again to find the appropriate variables to examine.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/KamilarAndCooperData.csv"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  [1] "Scientific_Name"         "Family"                 
##  [3] "Genus"                   "Species"                
##  [5] "Brain_Size_Species_Mean" "Brain_Size_Female_Mean" 
##  [7] "Brain_size_Ref"          "Body_mass_male_mean"    
##  [9] "Body_mass_female_mean"   "Mass_Dimorphism"        
## [11] "Mass_Ref"                "MeanGroupSize"          
## [13] "AdultMales"              "AdultFemale"            
## [15] "AdultSexRatio"           "Social_Organization_Ref"
## [17] "InterbirthInterval_d"    "Gestation"              
## [19] "WeaningAge_d"            "MaxLongevity_m"         
## [21] "LitterSz"                "Life_History_Ref"       
## [23] "GR_MidRangeLat_dd"       "Precip_Mean_mm"         
## [25] "Temp_Mean_degC"          "AET_Mean_mm"            
## [27] "PET_Mean_mm"             "Climate_Ref"            
## [29] "HomeRange_km2"           "HomeRangeRef"           
## [31] "DayLength_km"            "DayLengthRef"           
## [33] "Territoriality"          "Fruit"                  
## [35] "Leaves"                  "Fauna"                  
## [37] "DietRef1"                "Canine_Dimorphism"      
## [39] "Canine_Dimorphism_Ref"   "Feed"                   
## [41] "Move"                    "Rest"                   
## [43] "Social"                  "Activity_Budget_Ref"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">select</span>(d, <span class="at">WeaningAge =</span> <span class="st">"WeaningAge_d"</span>, <span class="at">FemaleBodyMass =</span> <span class="st">"Body_mass_female_mean"</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># keep select columns</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(d)  <span class="co"># get rid of NAs</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> FemaleBodyMass, <span class="at">y =</span> WeaningAge)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Using the procedures outlined above and in <a href="18-module.html"><strong>Module 18</strong></a>, calculate estimates of <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> by hand and by using the <code>lm()</code> function. Are the regression coefficients estimated under a simple linear model statistically significantly different from zero?</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by hand</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fu">cor</span>(d<span class="sc">$</span>FemaleBodyMass, d<span class="sc">$</span>WeaningAge) <span class="sc">*</span> (<span class="fu">sd</span>(d<span class="sc">$</span>WeaningAge)<span class="sc">/</span><span class="fu">sd</span>(d<span class="sc">$</span>FemaleBodyMass))</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>beta1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 0.02012737</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(d<span class="sc">$</span>WeaningAge) <span class="sc">-</span> beta1 <span class="sc">*</span> <span class="fu">mean</span>(d<span class="sc">$</span>FemaleBodyMass)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>beta0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## [1] 201.634</code></pre>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using lm()</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, WeaningAge <span class="sc">~</span> FemaleBodyMass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<ul>
<li>Construct an ANOVA table by hand and compare your values to the results of running <code>lm()</code> and then looking at <code>summary.aov(lm())</code>.</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># by hand</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>SSY <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>fitted.values <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge <span class="sc">-</span> m<span class="sc">$</span>fitted.values)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>DFR <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>DFE <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> DFR <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>DFY <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> DFR</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>MSR <span class="ot">&lt;-</span> SSR<span class="sc">/</span>DFR</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> SSE<span class="sc">/</span>DFE</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>MSY <span class="ot">&lt;-</span> SSY<span class="sc">/</span>DFY</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>fratio <span class="ot">&lt;-</span> MSR<span class="sc">/</span>MSE</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> fratio, <span class="at">df1 =</span> DFR, <span class="at">df2 =</span> DFE)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>(aov_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Source =</span> <span class="fu">c</span>(<span class="st">"Regression"</span>, <span class="st">"Error"</span>, <span class="st">"Total"</span>), <span class="at">df =</span> <span class="fu">c</span>(DFR, DFE,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>    DFY), <span class="st">`</span><span class="at">Sum Sq</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(SSR, SSE, SSY), <span class="st">`</span><span class="at">Mean Sq</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(MSR, MSE, MSY), <span class="st">`</span><span class="at">F value</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(fratio,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">p =</span> <span class="fu">c</span>(p, <span class="cn">NA</span>, <span class="cn">NA</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## # A tibble: 3 × 6
##   Source        df `Sum Sq` `Mean Sq` `F value`     p
##   &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1 Regression     1 3668116.  3668116.      109.     0
## 2 Error        114 3833822.    33630.       NA     NA
## 3 Total        115 7501938.    65234.       NA     NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># using summary.aov()</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##                 Df  Sum Sq Mean Sq F value Pr(&gt;F)    
## FemaleBodyMass   1 3668116 3668116   109.1 &lt;2e-16 ***
## Residuals      114 3833822   33630                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ul>
<li>Generate the residuals for your linear model, plot them in relation to female body mass, and make a histogram of the residuals. Do they appear to be normally distributed?</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> m<span class="sc">$</span>residuals</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuals <span class="sc">~</span> d<span class="sc">$</span>FemaleBodyMass, <span class="at">xlab =</span> <span class="st">"Female Body Mass"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(residuals, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Histogram of Residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-26-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Run the <code>plot()</code> command on the result of <code>lm()</code> and examine the 4 plots produced.</li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Again, based on examination of the residuals and the results of Shapiro-Wilks test, does it look like your model has good fit?</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(m<span class="sc">$</span>residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="384"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>(s <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(m<span class="sc">$</span>residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  m$residuals
## W = 0.86291, p-value = 5.825e-09</code></pre>
</div>
</div>
</section>
</section>
<section id="data-transformations" class="level2" data-number="19.6">
<h2 data-number="19.6" class="anchored" data-anchor-id="data-transformations"><span class="header-section-number">19.6</span> Data Transformations</h2>
<p>Recall, again, that for linear regression modeling to be appropriate, two important conditions need to be met: [1] our variables (and the error variance in our variables) should be approximately <strong>normally distributed</strong> and [2] there should be <strong>homogeneity of variance</strong> (“homoscedasticity”) in our response variable around the range of our predictor variable.</p>
<p>In many cases, these conditions may not be met… for example, the continuous metric data we have may not, in fact, be normally distributed. Nonetheless, we can sometimes apply some kind of mathematical transformation to our data to change their distribution to more closely approximate the normal.</p>
<p>The logarithmic or “log” transformation (where we take the log value of each data point) is often applied to positive numeric variables with heavy skew to dramatically reduce the overall range of the data and bring extreme observations closer to a measure of centrality. The logarithm for a number is the power to which you must raise a base value (e.g., <span class="math inline">\(e\)</span>, the natural log) in order to obtain that number. This is an example of a “power transformation”, other examples of which include the square root transformation and the reciprocal (or multiplicative inverse) transformation.</p>
<section id="challenge-2" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="challenge-2">CHALLENGE</h3>
<p>Return to the original “KamilarAndCooper.csv” dataset you were looking at above, <code>log()</code> transform both of your variables, and then run a simple, bivariate linear model.</p>
<p>Do you notice a difference between these results and those obtained using untransformed variables?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/KamilarAndCooperData.csv"</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>##  [1] "Scientific_Name"         "Family"                 
##  [3] "Genus"                   "Species"                
##  [5] "Brain_Size_Species_Mean" "Brain_Size_Female_Mean" 
##  [7] "Brain_size_Ref"          "Body_mass_male_mean"    
##  [9] "Body_mass_female_mean"   "Mass_Dimorphism"        
## [11] "Mass_Ref"                "MeanGroupSize"          
## [13] "AdultMales"              "AdultFemale"            
## [15] "AdultSexRatio"           "Social_Organization_Ref"
## [17] "InterbirthInterval_d"    "Gestation"              
## [19] "WeaningAge_d"            "MaxLongevity_m"         
## [21] "LitterSz"                "Life_History_Ref"       
## [23] "GR_MidRangeLat_dd"       "Precip_Mean_mm"         
## [25] "Temp_Mean_degC"          "AET_Mean_mm"            
## [27] "PET_Mean_mm"             "Climate_Ref"            
## [29] "HomeRange_km2"           "HomeRangeRef"           
## [31] "DayLength_km"            "DayLengthRef"           
## [33] "Territoriality"          "Fruit"                  
## [35] "Leaves"                  "Fauna"                  
## [37] "DietRef1"                "Canine_Dimorphism"      
## [39] "Canine_Dimorphism_Ref"   "Feed"                   
## [41] "Move"                    "Rest"                   
## [43] "Social"                  "Activity_Budget_Ref"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># keep select columns</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">select</span>(d, <span class="at">WeaningAge =</span> <span class="st">"WeaningAge_d"</span>, <span class="at">FemaleBodyMass =</span> <span class="st">"Body_mass_female_mean"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(d)  <span class="co"># get rid of NAs</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>logWeaningAge <span class="ot">&lt;-</span> <span class="fu">log</span>(d<span class="sc">$</span>WeaningAge)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>logFemaleBodyMass <span class="ot">&lt;-</span> <span class="fu">log</span>(d<span class="sc">$</span>FemaleBodyMass)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> logFemaleBodyMass, <span class="at">y =</span> logWeaningAge)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or plot(data=d, logWeaningAge ~ logFemaleBodyMass)</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, logWeaningAge <span class="sc">~</span> logFemaleBodyMass)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
## Call:
## lm(formula = logWeaningAge ~ logFemaleBodyMass, data = d)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.10639 -0.32736  0.00848  0.32214  1.11010 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         1.7590     0.2196   8.011 1.08e-12 ***
## logFemaleBodyMass   0.4721     0.0278  16.983  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.4532 on 114 degrees of freedom
## Multiple R-squared:  0.7167, Adjusted R-squared:  0.7142 
## F-statistic: 288.4 on 1 and 114 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(m<span class="sc">$</span>residuals)  <span class="do">## qqPlot from {car}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-29-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>## [1]  24 116</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>(s <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(m<span class="sc">$</span>residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>## 
##  Shapiro-Wilk normality test
## 
## data:  m$residuals
## W = 0.99367, p-value = 0.8793</code></pre>
</div>
</div>
<p>The following chart and graphs shows some other common numerical transformations that are often useful for changing a variable’s distribution to more closely approximate the normal.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="img/transformations.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:70.0%"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># LOG X</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> <span class="fu">log</span>(x)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"untransformed"</span>)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(x), y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"log(x)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LOG Y - a log transformation for the response variable is useful when the</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># variance in the explanatory variable is not consistent across the range of</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># explanatory variable values</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">1000</span>)</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"untransformed"</span>)</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">log</span>(y), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"log(y)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ASYMPTOTIC</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (a <span class="sc">*</span> x)<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> b <span class="sc">*</span> x)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"untransformed"</span>)</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">/</span>x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"1/x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RECIPROCAL</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">/</span>x</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"untransformed"</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">/</span>x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"1/x"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># POWER - a power transformation for the explanatory variable is useful # if</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># there is a curvilinear relationship between the explanatory variable and the</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># response variable</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">100</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">*</span> x<span class="sc">^</span>b</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"untransformed"</span>)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span>b, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"x^b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># EXPONENTIAL</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">*</span> <span class="fu">exp</span>(b <span class="sc">*</span> x)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"untransformed"</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="fu">log</span>(y), <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"log(y)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="19-module_files/figure-html/unnamed-chunk-31-6.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Applying a function to transform a complete dataset is the most common way of attempting to squeeze your data into matching a normal distribution so that you can use parametric statistics. This is a very common practice, and much has been written on this topic, including its drawbacks.</p>
<p>For a good discussion on common transformations, see <strong><em>R in Action</em></strong> Chapter 8.5 (“Corrective Measures”), and please do note the section titled <strong>A caution concerning transformations</strong>. When trying out transformations, keep your normalization tests handy so that you can retest the transformed data and see if the transformation achieved its intended purpose.</p>
<hr>
</section>
</section>
<section id="concept-review" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="concept-review">Concept Review</h2>
<ul>
<li>Regression analysis partitions the variance in a response variable into components associated with the various predictor variables plus an “error” component, or residual</li>
<li>The significance of the overall regression model, and of individual predictors, is evaluated by comparing F ratios (the ratio of the variance explained by the predictor to the unexplained variance) against an F distribution, taking into account the number of degrees of freedom in each</li>
<li>After running a model, we need to confirm that key assumptions for linear regression are met, including that residuals are normally distributed and observations show homogeneity of variance across the range of predictor values</li>
<li>If these assumptions are not met, data transformation of the raw variables may sometimes be helpful</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./18-module.html" class="pagination-link  aria-label=" &lt;span="" to="" linear="" modeling&lt;="" span&gt;"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Introduction to Linear Modeling</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./20-module.html" class="pagination-link" aria-label="<span class='chapter-number'>20</span>&nbsp; <span class='chapter-title'>Categorical Data Analysis</span>">
        <span class="nav-page-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb91" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Elements of Regression Analysis {#module-19}</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objectives</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The objective of this module is to continue our discussion of simple linear regression analysis to understand how the goal of regression is to partition variance in the response variable among different sources, i.e., into that explained **by the regression model** itself (and, we will see later on in our discussion of multivariate regression, among different factors in that model) versus the left-over **error or residual variance**. We also go through how to calculate the **standard errors** for our various regression coefficients and for the predicted values of our response variable based on our regression model, which, as we have seen, are returned by the </span><span class="in">`lm()`</span><span class="at"> function. Finally, we also briefly discuss ways to transform non-normally distributed data to make them more appropriate for analysis using linear regression.</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Preliminaries</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Install the following package in ***R***: <span class="co">[</span><span class="ot">{ggpubr}</span><span class="co">](https://cran.r-project.org/web/packages/broom/ggpubr.pdf)</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Load {tidyverse}, {mosiac}, {car}, {broom}</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mosaic)</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## Analysis of Variance Tables</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>In our linear models, we can separate or "partition" the total variation in our **y** variable (the *sum of squares of y*, or $SSY$) into that explained by our model (the *regression sum of squares*, or $SSR$) and that which is left over as "error" (the *error sum of squares*, or $SSE$):</span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>$$SSY = SSR + SSE$$</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a>Graphically...</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "70%"</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/partitioningSS.png"</span>)</span>
<span id="cb91-37"><a href="#cb91-37" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-38"><a href="#cb91-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-39"><a href="#cb91-39" aria-hidden="true" tabindex="-1"></a>Let's make sure we have our zombie apocalypse survivors dataset loaded...</span>
<span id="cb91-40"><a href="#cb91-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-43"><a href="#cb91-43" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-44"><a href="#cb91-44" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-45"><a href="#cb91-45" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/zombies.csv"</span></span>
<span id="cb91-46"><a href="#cb91-46" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-47"><a href="#cb91-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-48"><a href="#cb91-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-49"><a href="#cb91-49" aria-hidden="true" tabindex="-1"></a>Now, we run a straightforward bivariate regression model and, using the raw data (which are duplicated in the <span class="in">`$model`</span> data structure within our model object), we will calculate the various sums of squares of our variables and identify the numbers of degrees of freedom associated with each source of variation. This allows us to generate the ANOVA table for our model, which is a summary of how variance is partitioned among different sources.</span>
<span id="cb91-50"><a href="#cb91-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-53"><a href="#cb91-53" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-54"><a href="#cb91-54" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, height <span class="sc">~</span> weight)</span>
<span id="cb91-55"><a href="#cb91-55" aria-hidden="true" tabindex="-1"></a><span class="co"># height - mean(height)</span></span>
<span id="cb91-56"><a href="#cb91-56" aria-hidden="true" tabindex="-1"></a>SSY <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>height <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>height)) <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb91-57"><a href="#cb91-57" aria-hidden="true" tabindex="-1"></a>SSY</span>
<span id="cb91-58"><a href="#cb91-58" aria-hidden="true" tabindex="-1"></a><span class="co"># predicted height - mean height</span></span>
<span id="cb91-59"><a href="#cb91-59" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>fitted.values <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>height)) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb91-60"><a href="#cb91-60" aria-hidden="true" tabindex="-1"></a>SSR</span>
<span id="cb91-61"><a href="#cb91-61" aria-hidden="true" tabindex="-1"></a><span class="co"># height - predicted height</span></span>
<span id="cb91-62"><a href="#cb91-62" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>height <span class="sc">-</span> m<span class="sc">$</span>fitted.values) <span class="sc">^</span> <span class="dv">2</span>) </span>
<span id="cb91-63"><a href="#cb91-63" aria-hidden="true" tabindex="-1"></a>SSE</span>
<span id="cb91-64"><a href="#cb91-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-65"><a href="#cb91-65" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb91-66"><a href="#cb91-66" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>(m<span class="sc">$</span>residuals <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb91-67"><a href="#cb91-67" aria-hidden="true" tabindex="-1"></a>SSE</span>
<span id="cb91-68"><a href="#cb91-68" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-69"><a href="#cb91-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-70"><a href="#cb91-70" aria-hidden="true" tabindex="-1"></a>From here, we can calculate the variance in each of these components, typically referred to as the *mean square*, by dividing each sum of squares by its corresponding degrees of freedom (recall that a variance can be thought of as an average "sum of squares").</span>
<span id="cb91-71"><a href="#cb91-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-72"><a href="#cb91-72" aria-hidden="true" tabindex="-1"></a>The degrees of freedom for the regression sum of squares ($SSR$) is equal to the number of predictor variables ($p$), which in this case is one (given our regression equation, we need to know only one piece of information, the value of our predictor variable, in order to calculate the predicted value of the response variable). The number of degrees of freedom for the error sum of squares ($SSE$) is equal to $n-2$ (or $n - p - 1$). This is because we need to estimate two parameters ($\beta_0$ and $\beta_1$) from our data before we can calculate the error sum of squares. Finally, the number of degrees of freedom for the total sum of squares ($SSY$) is $n-1$... we need to estimate one parameter from our data (the mean value of **y**) before we can calculate $SSY$.</span>
<span id="cb91-73"><a href="#cb91-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-76"><a href="#cb91-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-77"><a href="#cb91-77" aria-hidden="true" tabindex="-1"></a>(df_regression <span class="ot">&lt;-</span> <span class="dv">1</span>) <span class="co"># p = 1</span></span>
<span id="cb91-78"><a href="#cb91-78" aria-hidden="true" tabindex="-1"></a>(df_error <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> df_regression <span class="sc">-</span> <span class="dv">1</span>) <span class="co"># n - p - 1</span></span>
<span id="cb91-79"><a href="#cb91-79" aria-hidden="true" tabindex="-1"></a>(df_y <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> df_regression) <span class="co"># n - p</span></span>
<span id="cb91-80"><a href="#cb91-80" aria-hidden="true" tabindex="-1"></a>MSR <span class="ot">&lt;-</span> SSR<span class="sc">/</span>df_regression <span class="co"># mean variance explained by the regression equation</span></span>
<span id="cb91-81"><a href="#cb91-81" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> SSE<span class="sc">/</span>df_error <span class="co"># mean remaining variance</span></span>
<span id="cb91-82"><a href="#cb91-82" aria-hidden="true" tabindex="-1"></a>MSY <span class="ot">&lt;-</span> SSY<span class="sc">/</span>df_y <span class="co"># mean overall variance</span></span>
<span id="cb91-83"><a href="#cb91-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-84"><a href="#cb91-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-85"><a href="#cb91-85" aria-hidden="true" tabindex="-1"></a>The last item we need to calculate is the **F ratio**, the ratio of the variance explained by the regression model to the remaining, unexplained variance: $MSR/MSE$.</span>
<span id="cb91-86"><a href="#cb91-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-89"><a href="#cb91-89" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-90"><a href="#cb91-90" aria-hidden="true" tabindex="-1"></a>fratio <span class="ot">&lt;-</span> MSR <span class="sc">/</span> MSE</span>
<span id="cb91-91"><a href="#cb91-91" aria-hidden="true" tabindex="-1"></a>fratio</span>
<span id="cb91-92"><a href="#cb91-92" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-93"><a href="#cb91-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-94"><a href="#cb91-94" aria-hidden="true" tabindex="-1"></a>Together, the values we have calculated above form the main entries in the **ANOVA Table** for our regression.</span>
<span id="cb91-95"><a href="#cb91-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-96"><a href="#cb91-96" aria-hidden="true" tabindex="-1"></a>|   Source   |  Sum of Squares  | Degrees of Freedom | Mean Square (SS/df) | F ratio  |</span>
<span id="cb91-97"><a href="#cb91-97" aria-hidden="true" tabindex="-1"></a>|:----------:|:----------------:|:------------------:|:-------------------:|:--------:|</span>
<span id="cb91-98"><a href="#cb91-98" aria-hidden="true" tabindex="-1"></a>| Regression | $SSR$ = 12864.82 |         1          |  $MSR$ = 12864.82   | 2254.139 |</span>
<span id="cb91-99"><a href="#cb91-99" aria-hidden="true" tabindex="-1"></a>|   Error    | $SSE$ = 5693.79  |    $n-2$ = 998     |   $MSE$ = 5.7072    |          |</span>
<span id="cb91-100"><a href="#cb91-100" aria-hidden="true" tabindex="-1"></a>|   Total    | $SSY$ = 18558.61 |    $n-1$ = 999     |  $MSY$ = 18.57719   |          |</span>
<span id="cb91-101"><a href="#cb91-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-102"><a href="#cb91-102" aria-hidden="true" tabindex="-1"></a>We can then test the overall significance of our regression model by evaluating our F ratio test statistic against an $F$ distribution, taking into account the number of degrees of freedom in each. The $F$ distribution is a continuous probability distribution, defined for $x≥0$ and governed by two parameters, $df1$ and $df2$. The critical value for the $F$ statistic above which we would reject the idea that the variance in our two sources is comparable is given by <span class="in">`qf(p, df1, df2)`</span>, where **p** is 1-$\alpha$ and **df1** and **df2** are the degrees of freedom in the sources being compared (regression versus error).</span>
<span id="cb91-103"><a href="#cb91-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-106"><a href="#cb91-106" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-107"><a href="#cb91-107" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb91-108"><a href="#cb91-108" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1=</span><span class="dv">1</span>, <span class="at">df2=</span><span class="dv">10</span>, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb91-109"><a href="#cb91-109" aria-hidden="true" tabindex="-1"></a>          <span class="at">main=</span><span class="st">"Some Example F Distributions"</span>,</span>
<span id="cb91-110"><a href="#cb91-110" aria-hidden="true" tabindex="-1"></a>          <span class="at">sub =</span> <span class="st">"red vertical line shows critical value</span><span class="sc">\n</span></span>
<span id="cb91-111"><a href="#cb91-111" aria-hidden="true" tabindex="-1"></a><span class="st">            for df1=1, df2=998"</span>,</span>
<span id="cb91-112"><a href="#cb91-112" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab=</span><span class="st">"f(x)"</span>,</span>
<span id="cb91-113"><a href="#cb91-113" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab=</span><span class="st">"x"</span>,</span>
<span id="cb91-114"><a href="#cb91-114" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>),</span>
<span id="cb91-115"><a href="#cb91-115" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>),</span>
<span id="cb91-116"><a href="#cb91-116" aria-hidden="true" tabindex="-1"></a>          <span class="at">key=</span><span class="fu">list</span>(<span class="at">space=</span><span class="st">"right"</span>,</span>
<span id="cb91-117"><a href="#cb91-117" aria-hidden="true" tabindex="-1"></a>          <span class="at">text=</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"df1=1, df2=1"</span>, <span class="st">"df1=2, df2=2"</span>, <span class="st">"df1=4, df2=4"</span>,</span>
<span id="cb91-118"><a href="#cb91-118" aria-hidden="true" tabindex="-1"></a>            <span class="st">"df1=8, df2=100"</span>, <span class="st">"df1=1, df2=998"</span>)),</span>
<span id="cb91-119"><a href="#cb91-119" aria-hidden="true" tabindex="-1"></a>          <span class="at">lines=</span><span class="fu">list</span>(<span class="at">col=</span><span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>,<span class="st">"purple"</span>,<span class="st">"black"</span>),</span>
<span id="cb91-120"><a href="#cb91-120" aria-hidden="true" tabindex="-1"></a>            <span class="at">lty=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>), <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">bty=</span><span class="st">'n'</span>, <span class="at">cex=</span>.<span class="dv">75</span>)))</span>
<span id="cb91-121"><a href="#cb91-121" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1=</span><span class="dv">2</span>, <span class="at">df2=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-122"><a href="#cb91-122" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1=</span><span class="dv">4</span>, <span class="at">df2=</span><span class="dv">4</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-123"><a href="#cb91-123" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1=</span><span class="dv">8</span>, <span class="at">df2=</span><span class="dv">100</span>, <span class="at">col=</span><span class="st">"purple"</span>, <span class="at">lty=</span><span class="dv">3</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-124"><a href="#cb91-124" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1=</span><span class="dv">1</span>, <span class="at">df2=</span><span class="dv">998</span>, <span class="at">col=</span><span class="st">"black"</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span>
<span id="cb91-125"><a href="#cb91-125" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb91-126"><a href="#cb91-126" aria-hidden="true" tabindex="-1"></a>crit</span>
<span id="cb91-127"><a href="#cb91-127" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>crit, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">1</span>))</span>
<span id="cb91-128"><a href="#cb91-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-129"><a href="#cb91-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-130"><a href="#cb91-130" aria-hidden="true" tabindex="-1"></a>The <span class="in">`qf()`</span> function allows us to calculate critical values under an $F$ distribution given the number of degrees of freedom for the regression and error.</span>
<span id="cb91-131"><a href="#cb91-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-134"><a href="#cb91-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-135"><a href="#cb91-135" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-keep: "last"</span></span>
<span id="cb91-136"><a href="#cb91-136" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDist</span>(<span class="st">"f"</span>, <span class="at">df1=</span><span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>,</span>
<span id="cb91-137"><a href="#cb91-137" aria-hidden="true" tabindex="-1"></a>          <span class="at">main=</span><span class="st">"df1 = 1, df2 = 998"</span>,</span>
<span id="cb91-138"><a href="#cb91-138" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab=</span><span class="st">"x"</span>,</span>
<span id="cb91-139"><a href="#cb91-139" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylab=</span><span class="st">"f(x)"</span>,</span>
<span id="cb91-140"><a href="#cb91-140" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>),</span>
<span id="cb91-141"><a href="#cb91-141" aria-hidden="true" tabindex="-1"></a>          <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">1.5</span>))</span>
<span id="cb91-142"><a href="#cb91-142" aria-hidden="true" tabindex="-1"></a>crit <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> <span class="fl">0.95</span>, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb91-143"><a href="#cb91-143" aria-hidden="true" tabindex="-1"></a>crit</span>
<span id="cb91-144"><a href="#cb91-144" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.abline</span>(<span class="at">v=</span>crit, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd=</span><span class="dv">1</span>))</span>
<span id="cb91-145"><a href="#cb91-145" aria-hidden="true" tabindex="-1"></a><span class="fu">ladd</span>(<span class="fu">panel.polygon</span>(<span class="fu">cbind</span>(<span class="fu">c</span>(crit,<span class="fu">seq</span>(<span class="at">from=</span>crit, <span class="at">to=</span><span class="dv">12</span>, <span class="at">length.out=</span><span class="dv">1000</span>), <span class="dv">12</span>),</span>
<span id="cb91-146"><a href="#cb91-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">df</span>(<span class="fu">seq</span>(<span class="at">from=</span>crit, <span class="at">to=</span><span class="dv">12</span>, <span class="at">length.out=</span><span class="dv">1000</span>),<span class="at">df1=</span><span class="dv">1</span>,<span class="at">df2=</span><span class="dv">998</span>),<span class="dv">0</span>)),</span>
<span id="cb91-147"><a href="#cb91-147" aria-hidden="true" tabindex="-1"></a>  <span class="at">border=</span><span class="st">"black"</span>, <span class="at">col=</span><span class="fu">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)))</span>
<span id="cb91-148"><a href="#cb91-148" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-149"><a href="#cb91-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-150"><a href="#cb91-150" aria-hidden="true" tabindex="-1"></a>For our data, the value for the F ratio statistic well exceeds this critical value!</span>
<span id="cb91-151"><a href="#cb91-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-152"><a href="#cb91-152" aria-hidden="true" tabindex="-1"></a>Alternatively, we can use the following formulation to directly estimate a p value associated with our value for the F statistic. The p value is simply the area under the $F$ distribution curve to the right of the F statistic value (or 1 minus the cumulative probability up to that point):</span>
<span id="cb91-153"><a href="#cb91-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-156"><a href="#cb91-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-157"><a href="#cb91-157" aria-hidden="true" tabindex="-1"></a><span class="fu">pf</span>(<span class="at">q =</span> fratio, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb91-158"><a href="#cb91-158" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb91-159"><a href="#cb91-159" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> fratio, <span class="at">df1 =</span> <span class="dv">1</span>, <span class="at">df2 =</span> <span class="dv">998</span>)</span>
<span id="cb91-160"><a href="#cb91-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-161"><a href="#cb91-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-162"><a href="#cb91-162" aria-hidden="true" tabindex="-1"></a>... and we see that the p value associated with this high of an F statistic is infintessimally small.</span>
<span id="cb91-163"><a href="#cb91-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-164"><a href="#cb91-164" aria-hidden="true" tabindex="-1"></a>As usual, ***R*** can handle all of the calculations above for easily. The <span class="in">`aov()`</span> function, like the <span class="in">`lm()`</span> function, returns a model object that we can use <span class="in">`summary()`</span> on to look at the results we want. Alternatively, we can run the function <span class="in">`summary.aov()`</span> using the model object resulting from <span class="in">`lm()`</span> as an argument. In either case, the results returned are the same as we calculated by hand above.</span>
<span id="cb91-165"><a href="#cb91-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-168"><a href="#cb91-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-169"><a href="#cb91-169" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">data =</span> d, height <span class="sc">~</span> weight)</span>
<span id="cb91-170"><a href="#cb91-170" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(a)</span>
<span id="cb91-171"><a href="#cb91-171" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(m)</span>
<span id="cb91-172"><a href="#cb91-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-173"><a href="#cb91-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-174"><a href="#cb91-174" aria-hidden="true" tabindex="-1"></a>Recall that the results returned by <span class="in">`summary()`</span> of our regression model also shows the coefficient of determination, or the "R-squared value", which we defined above as the fraction of the total variation explained by the model. We can calculate this value directly from our ANOVA table as simply $SSR/SSY$. The correlation coefficient, $\rho$, between our response and predictor variable is simply the square root of this value.</span>
<span id="cb91-175"><a href="#cb91-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-178"><a href="#cb91-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-179"><a href="#cb91-179" aria-hidden="true" tabindex="-1"></a>rsq <span class="ot">&lt;-</span> SSR <span class="sc">/</span> SSY</span>
<span id="cb91-180"><a href="#cb91-180" aria-hidden="true" tabindex="-1"></a>rsq</span>
<span id="cb91-181"><a href="#cb91-181" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(rsq)</span>
<span id="cb91-182"><a href="#cb91-182" aria-hidden="true" tabindex="-1"></a>rho</span>
<span id="cb91-183"><a href="#cb91-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-184"><a href="#cb91-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-185"><a href="#cb91-185" aria-hidden="true" tabindex="-1"></a><span class="fu">## Standard Errors of Coefficients</span></span>
<span id="cb91-186"><a href="#cb91-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-187"><a href="#cb91-187" aria-hidden="true" tabindex="-1"></a>Recall that <span class="in">`lm()`</span> returned the standard errors associated with each of the various components of our regression model, i.e., the slope and intercept and each predicted value of **y**. We can calculate standard errors directly to show how ***R*** is deriving them.</span>
<span id="cb91-188"><a href="#cb91-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-189"><a href="#cb91-189" aria-hidden="true" tabindex="-1"></a>The formula for the standard error of the regression slope, $\beta_1$, is calculated as:</span>
<span id="cb91-190"><a href="#cb91-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-191"><a href="#cb91-191" aria-hidden="true" tabindex="-1"></a>$$SE_{\beta_1} = \sqrt{\frac{MSE}{SSX}}$$</span>
<span id="cb91-192"><a href="#cb91-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-193"><a href="#cb91-193" aria-hidden="true" tabindex="-1"></a>Using our data...</span>
<span id="cb91-194"><a href="#cb91-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-197"><a href="#cb91-197" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-198"><a href="#cb91-198" aria-hidden="true" tabindex="-1"></a>SSX <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>weight)) <span class="sc">^</span> <span class="dv">2</span>) <span class="co"># how much x variation there is</span></span>
<span id="cb91-199"><a href="#cb91-199" aria-hidden="true" tabindex="-1"></a>SEbeta1 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(MSE <span class="sc">/</span> SSX) </span>
<span id="cb91-200"><a href="#cb91-200" aria-hidden="true" tabindex="-1"></a>SEbeta1</span>
<span id="cb91-201"><a href="#cb91-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-202"><a href="#cb91-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-203"><a href="#cb91-203" aria-hidden="true" tabindex="-1"></a>The standard error of the intercept, $\beta_0$, is calculated as:</span>
<span id="cb91-204"><a href="#cb91-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-205"><a href="#cb91-205" aria-hidden="true" tabindex="-1"></a>$$SE_{\beta_0} = \sqrt{\frac{MSE \times \sum{x^2}}{n \times SSX}} = SE_{\beta_1} \times \sqrt{\frac{\sum{x^2}}{n}} $$</span>
<span id="cb91-206"><a href="#cb91-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-209"><a href="#cb91-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-210"><a href="#cb91-210" aria-hidden="true" tabindex="-1"></a>SEbeta0 <span class="ot">&lt;-</span> <span class="fu">sqrt</span>((MSE <span class="sc">*</span> <span class="fu">sum</span>(m<span class="sc">$</span>model<span class="sc">$</span>weight <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> (<span class="dv">1000</span> <span class="sc">*</span> SSX))</span>
<span id="cb91-211"><a href="#cb91-211" aria-hidden="true" tabindex="-1"></a>SEbeta0</span>
<span id="cb91-212"><a href="#cb91-212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-213"><a href="#cb91-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-214"><a href="#cb91-214" aria-hidden="true" tabindex="-1"></a>Finally, the standard error of each predicted value of y is calculated as:</span>
<span id="cb91-215"><a href="#cb91-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-216"><a href="#cb91-216" aria-hidden="true" tabindex="-1"></a>$$SE_{\hat{y}} = \sqrt{MSE \times {\biggl<span class="co">[</span><span class="ot">\frac{1}{n} + \frac{(x-\hat{x})^2}{SSX}}{\biggr</span><span class="co">]</span>}}$$</span>
<span id="cb91-217"><a href="#cb91-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-220"><a href="#cb91-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-221"><a href="#cb91-221" aria-hidden="true" tabindex="-1"></a>SEyhat <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(MSE <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">+</span> (m<span class="sc">$</span>model<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>weight)) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">/</span> SSX))</span>
<span id="cb91-222"><a href="#cb91-222" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SEyhat) <span class="co"># just the first 6 rows</span></span>
<span id="cb91-223"><a href="#cb91-223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-224"><a href="#cb91-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-225"><a href="#cb91-225" aria-hidden="true" tabindex="-1"></a>These same standard errors for $\beta_0$ and $\beta_1$ are exactly what are returned by the <span class="in">`lm()`</span> function.</span>
<span id="cb91-226"><a href="#cb91-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-229"><a href="#cb91-229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-230"><a href="#cb91-230" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb91-231"><a href="#cb91-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-232"><a href="#cb91-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-233"><a href="#cb91-233" aria-hidden="true" tabindex="-1"></a>Note that the t statistic is calculated as simply the estimate value divided by the corresponding SE value, and the p value just comes from comparing that statistic to a $t$ distribution with the appropriate degrees of freedom (i.e., number of observations - 2). We can run another model with higher p values to see this. Here, too, we use the convenient <span class="in">`tidy()`</span> function from the {broom} package to pull out a table of results from our linear model very easily.</span>
<span id="cb91-234"><a href="#cb91-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-237"><a href="#cb91-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-238"><a href="#cb91-238" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(zombies_killed <span class="sc">~</span> age, <span class="at">data =</span> d)</span>
<span id="cb91-239"><a href="#cb91-239" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> <span class="fu">tidy</span>(m)</span>
<span id="cb91-240"><a href="#cb91-240" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> coefficients <span class="sc">|&gt;</span></span>
<span id="cb91-241"><a href="#cb91-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">t.calc</span><span class="st">`</span> <span class="ot">=</span> estimate <span class="sc">/</span> std.error)</span>
<span id="cb91-242"><a href="#cb91-242" aria-hidden="true" tabindex="-1"></a>coefficients <span class="ot">&lt;-</span> coefficients <span class="sc">|&gt;</span></span>
<span id="cb91-243"><a href="#cb91-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">p.calc</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(<span class="fu">abs</span>(t.calc), <span class="at">df =</span> <span class="fu">nrow</span>(m<span class="sc">$</span>model)<span class="sc">-</span><span class="dv">2</span>)))</span>
<span id="cb91-244"><a href="#cb91-244" aria-hidden="true" tabindex="-1"></a><span class="co"># the p value is 2 times the tail probability implied by the t statistic</span></span>
<span id="cb91-245"><a href="#cb91-245" aria-hidden="true" tabindex="-1"></a>coefficients</span>
<span id="cb91-246"><a href="#cb91-246" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-247"><a href="#cb91-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-248"><a href="#cb91-248" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Checking</span></span>
<span id="cb91-249"><a href="#cb91-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-250"><a href="#cb91-250" aria-hidden="true" tabindex="-1"></a>So far, we've derived a bunch of summary statistics describing our model and we have looked at parametric ways of testing whether those summary statistics are significantly different from zero. That is...</span>
<span id="cb91-251"><a href="#cb91-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-252"><a href="#cb91-252" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have seen whether our overall regression model explains a significant portion of the variance in **y** by means of the **F ratio** **test**.</span>
<span id="cb91-253"><a href="#cb91-253" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have calculated standard errors for our $\beta_1$ and $\beta_0$ estimates and seen whether they are significantly different from zero by means of **t tests**.</span>
<span id="cb91-254"><a href="#cb91-254" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have calculated standard errors for our prediction of **y** (i.e., $\hat{y}$) at each value of **x**.</span>
<span id="cb91-255"><a href="#cb91-255" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We have estimated the proportion of the total variance in **y** explained by our model (i.e., $R-squared$).</span>
<span id="cb91-256"><a href="#cb91-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-257"><a href="#cb91-257" aria-hidden="true" tabindex="-1"></a>What we have not done yet, however, is checked our model fit critically in other ways... particularly, we have not checked whether two key assumptions of linear modeling are met: that our residuals (or errors) are normally distributed and that there is constancy of variance in our **y** values across the range of **x**s (or, "homoscedasticity").</span>
<span id="cb91-258"><a href="#cb91-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-259"><a href="#cb91-259" aria-hidden="true" tabindex="-1"></a>We can investigate our residuals as one way of assessing model fit.</span>
<span id="cb91-260"><a href="#cb91-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-261"><a href="#cb91-261" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb91-262"><a href="#cb91-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-263"><a href="#cb91-263" aria-hidden="true" tabindex="-1"></a>Calculate the residuals from the regression of zombie apocalypse survivor height on weight and plot these in relation to weight (as the **x** variable). There are lots of ways to do this quickly.</span>
<span id="cb91-264"><a href="#cb91-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-267"><a href="#cb91-267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-268"><a href="#cb91-268" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb91-269"><a href="#cb91-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb91-270"><a href="#cb91-270" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, height <span class="sc">~</span> weight)</span>
<span id="cb91-271"><a href="#cb91-271" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> m<span class="sc">$</span>residuals</span>
<span id="cb91-272"><a href="#cb91-272" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>weight, <span class="at">y =</span> e)</span>
<span id="cb91-273"><a href="#cb91-273" aria-hidden="true" tabindex="-1"></a><span class="co"># or we could use the function `resid()`</span></span>
<span id="cb91-274"><a href="#cb91-274" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">resid</span>(m)</span>
<span id="cb91-275"><a href="#cb91-275" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> d<span class="sc">$</span>weight, <span class="at">y =</span> e)</span>
<span id="cb91-276"><a href="#cb91-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-277"><a href="#cb91-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-278"><a href="#cb91-278" aria-hidden="true" tabindex="-1"></a>Now, plot a histogram of your residuals... ideally they are normally distributed!</span>
<span id="cb91-279"><a href="#cb91-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-282"><a href="#cb91-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-283"><a href="#cb91-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb91-284"><a href="#cb91-284" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb91-285"><a href="#cb91-285" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb91-286"><a href="#cb91-286" aria-hidden="true" tabindex="-1"></a><span class="fu">histogram</span>(e, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span> <span class="sc">*</span> <span class="fu">sd</span>(e), <span class="dv">4</span> <span class="sc">*</span> <span class="fu">sd</span>(e)), <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Histogram of Residuals"</span>)</span>
<span id="cb91-287"><a href="#cb91-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-288"><a href="#cb91-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-289"><a href="#cb91-289" aria-hidden="true" tabindex="-1"></a>An additional way to quickly examine your residuals is to use the <span class="in">`plot()`</span> function with your model as an argument. This prints out four plots that each tell you something.</span>
<span id="cb91-290"><a href="#cb91-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-293"><a href="#cb91-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-294"><a href="#cb91-294" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb91-295"><a href="#cb91-295" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span>
<span id="cb91-296"><a href="#cb91-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-297"><a href="#cb91-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-298"><a href="#cb91-298" aria-hidden="true" tabindex="-1"></a>The first (top left) plot of "Residuals vs Fitted" values of **y** should, like the plot residuals versus **x**, not show any structure. We hope to see equally spread residuals around a horizontal line without distinct patterns.</span>
<span id="cb91-299"><a href="#cb91-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-300"><a href="#cb91-300" aria-hidden="true" tabindex="-1"></a>The second (top right) plot is "Normal Q-Q" plot of theoretical quantiles versus standardized quantiles for the residual values. These should fall on roughly a straight line if the residuals are normally distributed.</span>
<span id="cb91-301"><a href="#cb91-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-302"><a href="#cb91-302" aria-hidden="true" tabindex="-1"></a>The third (bottom left) plot ("Scale-Location") is similar to the first, but graphs the square root of the standardized residuals versus fitted values of **y** and shows whether or the magnitude of residuals differs across the fitted values of **y**. Again, it is good if you see a horizontal line with equally spread points rather than a decrease or increase in spread across the range of fitted **y**s, which would indicate that the error variance increases or decreases across the relationship between **y** and **x** in your model.</span>
<span id="cb91-303"><a href="#cb91-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-304"><a href="#cb91-304" aria-hidden="true" tabindex="-1"></a>The fourth (bottom right) plot ("Residuals vs. Leverage") highlights whether there are any particular observations with disproportionate influence on the model. In particular, we look to see if there are cases that fall in the upper or lower right portion of the plot.</span>
<span id="cb91-305"><a href="#cb91-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-306"><a href="#cb91-306" aria-hidden="true" tabindex="-1"></a>We can also do a QQ plot of our residuals...</span>
<span id="cb91-307"><a href="#cb91-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-310"><a href="#cb91-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-311"><a href="#cb91-311" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-312"><a href="#cb91-312" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "70%"</span></span>
<span id="cb91-313"><a href="#cb91-313" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb91-314"><a href="#cb91-314" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb91-315"><a href="#cb91-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-316"><a href="#cb91-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-317"><a href="#cb91-317" aria-hidden="true" tabindex="-1"></a>Perhaps more helpful QQ plots can be found in the {car} and {ggpubr} package. The functions <span class="in">`qqPlot()`</span> and <span class="in">`ggqqplot()`</span> provides a trend line and confidence intervals that allow us to see exactly which points make the sample fall outside of normality (if any). Let's take a look:</span>
<span id="cb91-318"><a href="#cb91-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-321"><a href="#cb91-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-322"><a href="#cb91-322" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-323"><a href="#cb91-323" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "70%"</span></span>
<span id="cb91-324"><a href="#cb91-324" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(m, <span class="at">distribution =</span> <span class="st">"norm"</span>, <span class="at">id =</span> <span class="cn">FALSE</span>) <span class="co"># qqPlot from {car}</span></span>
<span id="cb91-325"><a href="#cb91-325" aria-hidden="true" tabindex="-1"></a><span class="co"># `id=FALSE` means that outlier observations will not be labelled</span></span>
<span id="cb91-326"><a href="#cb91-326" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb91-327"><a href="#cb91-327" aria-hidden="true" tabindex="-1"></a><span class="fu">ggqqplot</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb91-328"><a href="#cb91-328" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>ggpubr)</span>
<span id="cb91-329"><a href="#cb91-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-330"><a href="#cb91-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-331"><a href="#cb91-331" aria-hidden="true" tabindex="-1"></a>Finally, there are a number of tests for normality that we can run within the ***R*** framework and using other packages. A **Shapiro-Wilk Normality Test** is perhaps the most widely used, where a low p value would indicate deviation from normality (technically, a measure of how far the trend line of the residuals deviates from the Q-Q plot line).</span>
<span id="cb91-332"><a href="#cb91-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-335"><a href="#cb91-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-336"><a href="#cb91-336" aria-hidden="true" tabindex="-1"></a>(s <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(m<span class="sc">$</span>residuals))</span>
<span id="cb91-337"><a href="#cb91-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-338"><a href="#cb91-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-339"><a href="#cb91-339" aria-hidden="true" tabindex="-1"></a>As you can see, although there are some points at the higher quantiles that suggest non-normality, the Shapiro-Wilk test suggests that it is not quite non-normal, so our use of parametric statistics should be okay.</span>
<span id="cb91-340"><a href="#cb91-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-341"><a href="#cb91-341" aria-hidden="true" tabindex="-1"></a>Some other popular tests for normality, and the cases in which they are best used, are listed below:</span>
<span id="cb91-342"><a href="#cb91-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-343"><a href="#cb91-343" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Anderson-Darling test** from the {nortest} package</span>
<span id="cb91-344"><a href="#cb91-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-345"><a href="#cb91-345" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Very popular, not quite as powerful as Shapiro-Wilk</span>
<span id="cb91-346"><a href="#cb91-346" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Best used when $n$ ≥ 8</span>
<span id="cb91-347"><a href="#cb91-347" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`nortest:: ad.test()`</span></span>
<span id="cb91-348"><a href="#cb91-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-349"><a href="#cb91-349" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Martinez-Iglewicz test** from the {PoweR} package</span>
<span id="cb91-350"><a href="#cb91-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-351"><a href="#cb91-351" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Tests for dispersion from the median</span>
<span id="cb91-352"><a href="#cb91-352" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Very powerful for heavy-tailed distributions</span>
<span id="cb91-353"><a href="#cb91-353" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Best with small sample sizes ($n$ ≥ 3)</span>
<span id="cb91-354"><a href="#cb91-354" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`PoweR::stat0032.MartinezIglewicz()`</span></span>
<span id="cb91-355"><a href="#cb91-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-356"><a href="#cb91-356" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Kolmogorov-Smirnov test** (with Lilliefors adjustment) from the {nortest} package</span>
<span id="cb91-357"><a href="#cb91-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-358"><a href="#cb91-358" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Not as good as Anderson-Darling, but historically popular</span>
<span id="cb91-359"><a href="#cb91-359" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Requires that $n$ ≥ 4.</span>
<span id="cb91-360"><a href="#cb91-360" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`nortest::lillie.test()`</span></span>
<span id="cb91-361"><a href="#cb91-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-362"><a href="#cb91-362" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**D-Agostino Omnibus test** (based on assessment of skew and kurtosis) from the {fBasics} package</span>
<span id="cb91-363"><a href="#cb91-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-364"><a href="#cb91-364" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Robust against identical values in distribution</span>
<span id="cb91-365"><a href="#cb91-365" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Skewness test requires $n$ ≥ 8</span>
<span id="cb91-366"><a href="#cb91-366" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>Kurtosis test requires $n$ ≥ 20</span>
<span id="cb91-367"><a href="#cb91-367" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span><span class="in">`fBasics::dagoTest()`</span></span>
<span id="cb91-368"><a href="#cb91-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-369"><a href="#cb91-369" aria-hidden="true" tabindex="-1"></a>For a good discussion/demonstration of the relative power of each of these tests (meaning the probability that the test will correctly reject the null hypothesis) at different sample sizes, check out <span class="co">[</span><span class="ot">this link</span><span class="co">](https://ncss-wpengine.netdna-ssl.com/wp-content/themes/ncss/pdf/Procedures/PASS/Normality_Tests-Simulation.pdf)</span> or <span class="co">[</span><span class="ot">this pdf</span><span class="co">](img/Normality_Tests-Simulation.pdf)</span>, especially the tables on pages 670-8 and 670-9 and the plots on 670-10. This can help you better understand which test is best for a given sample size, and how much faith to put in these tests given your sample!</span>
<span id="cb91-370"><a href="#cb91-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-371"><a href="#cb91-371" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb91-372"><a href="#cb91-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-373"><a href="#cb91-373" aria-hidden="true" tabindex="-1"></a>Load in the "KamilarAndCooper.csv" dataset and develop a linear model to look at the relationship between "weaning age" and "female body mass". You will probably need to look at the data and variable names again to find the appropriate variables to examine.</span>
<span id="cb91-374"><a href="#cb91-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-377"><a href="#cb91-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-378"><a href="#cb91-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-379"><a href="#cb91-379" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/KamilarAndCooperData.csv"</span></span>
<span id="cb91-380"><a href="#cb91-380" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-381"><a href="#cb91-381" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)</span>
<span id="cb91-382"><a href="#cb91-382" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">select</span>(d, <span class="at">WeaningAge =</span> <span class="st">"WeaningAge_d"</span>,</span>
<span id="cb91-383"><a href="#cb91-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">FemaleBodyMass =</span> <span class="st">"Body_mass_female_mean"</span>)</span>
<span id="cb91-384"><a href="#cb91-384" aria-hidden="true" tabindex="-1"></a><span class="co"># keep select columns</span></span>
<span id="cb91-385"><a href="#cb91-385" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(d) <span class="co"># get rid of NAs</span></span>
<span id="cb91-386"><a href="#cb91-386" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">x =</span> FemaleBodyMass, <span class="at">y =</span> WeaningAge)) <span class="sc">+</span></span>
<span id="cb91-387"><a href="#cb91-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb91-388"><a href="#cb91-388" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-389"><a href="#cb91-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-390"><a href="#cb91-390" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Using the procedures outlined above and in <span class="co">[</span><span class="ot">**Module 18**</span><span class="co">](#module-18)</span>, calculate estimates of $\beta_0$ and $\beta_1$ by hand and by using the <span class="in">`lm()`</span> function. Are the regression coefficients estimated under a simple linear model statistically significantly different from zero?</span>
<span id="cb91-391"><a href="#cb91-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-394"><a href="#cb91-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-395"><a href="#cb91-395" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb91-396"><a href="#cb91-396" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb91-397"><a href="#cb91-397" aria-hidden="true" tabindex="-1"></a><span class="co"># by hand</span></span>
<span id="cb91-398"><a href="#cb91-398" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fu">cor</span>(d<span class="sc">$</span>FemaleBodyMass, d<span class="sc">$</span>WeaningAge) <span class="sc">*</span> (<span class="fu">sd</span>(d<span class="sc">$</span>WeaningAge) <span class="sc">/</span> <span class="fu">sd</span>(d<span class="sc">$</span>FemaleBodyMass))</span>
<span id="cb91-399"><a href="#cb91-399" aria-hidden="true" tabindex="-1"></a>beta1</span>
<span id="cb91-400"><a href="#cb91-400" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(d<span class="sc">$</span>WeaningAge) <span class="sc">-</span> beta1 <span class="sc">*</span> <span class="fu">mean</span>(d<span class="sc">$</span>FemaleBodyMass)</span>
<span id="cb91-401"><a href="#cb91-401" aria-hidden="true" tabindex="-1"></a>beta0</span>
<span id="cb91-402"><a href="#cb91-402" aria-hidden="true" tabindex="-1"></a><span class="co"># using lm()</span></span>
<span id="cb91-403"><a href="#cb91-403" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, WeaningAge <span class="sc">~</span> FemaleBodyMass)</span>
<span id="cb91-404"><a href="#cb91-404" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-405"><a href="#cb91-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-406"><a href="#cb91-406" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Construct an ANOVA table by hand and compare your values to the results of running <span class="in">`lm()`</span> and then looking at <span class="in">`summary.aov(lm())`</span>.</span>
<span id="cb91-407"><a href="#cb91-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-410"><a href="#cb91-410" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-411"><a href="#cb91-411" aria-hidden="true" tabindex="-1"></a><span class="co"># by hand</span></span>
<span id="cb91-412"><a href="#cb91-412" aria-hidden="true" tabindex="-1"></a>SSY <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge)) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb91-413"><a href="#cb91-413" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>fitted.values <span class="sc">-</span> <span class="fu">mean</span>(m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge)) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb91-414"><a href="#cb91-414" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>((m<span class="sc">$</span>model<span class="sc">$</span>WeaningAge <span class="sc">-</span> m<span class="sc">$</span>fitted.values) <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb91-415"><a href="#cb91-415" aria-hidden="true" tabindex="-1"></a>DFR <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb91-416"><a href="#cb91-416" aria-hidden="true" tabindex="-1"></a>DFE <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> DFR <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb91-417"><a href="#cb91-417" aria-hidden="true" tabindex="-1"></a>DFY <span class="ot">&lt;-</span> <span class="fu">nrow</span>(d) <span class="sc">-</span> DFR</span>
<span id="cb91-418"><a href="#cb91-418" aria-hidden="true" tabindex="-1"></a>MSR <span class="ot">&lt;-</span> SSR<span class="sc">/</span>DFR</span>
<span id="cb91-419"><a href="#cb91-419" aria-hidden="true" tabindex="-1"></a>MSE <span class="ot">&lt;-</span> SSE<span class="sc">/</span>DFE</span>
<span id="cb91-420"><a href="#cb91-420" aria-hidden="true" tabindex="-1"></a>MSY <span class="ot">&lt;-</span> SSY<span class="sc">/</span>DFY</span>
<span id="cb91-421"><a href="#cb91-421" aria-hidden="true" tabindex="-1"></a>fratio <span class="ot">&lt;-</span> MSR<span class="sc">/</span>MSE</span>
<span id="cb91-422"><a href="#cb91-422" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(<span class="at">q=</span>fratio,<span class="at">df1=</span>DFR,<span class="at">df2=</span>DFE)</span>
<span id="cb91-423"><a href="#cb91-423" aria-hidden="true" tabindex="-1"></a>(aov_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"Source"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"Regression"</span>,<span class="st">"Error"</span>,<span class="st">"Total"</span>),</span>
<span id="cb91-424"><a href="#cb91-424" aria-hidden="true" tabindex="-1"></a>  <span class="st">"df"</span><span class="ot">=</span><span class="fu">c</span>(DFR,DFE,DFY), <span class="st">"Sum Sq"</span><span class="ot">=</span><span class="fu">c</span>(SSR,SSE,SSY),</span>
<span id="cb91-425"><a href="#cb91-425" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mean Sq"</span><span class="ot">=</span><span class="fu">c</span>(MSR,MSE,MSY),</span>
<span id="cb91-426"><a href="#cb91-426" aria-hidden="true" tabindex="-1"></a>  <span class="st">"F value"</span><span class="ot">=</span><span class="fu">c</span>(fratio,<span class="cn">NA</span>,<span class="cn">NA</span>),</span>
<span id="cb91-427"><a href="#cb91-427" aria-hidden="true" tabindex="-1"></a>  <span class="st">"p"</span><span class="ot">=</span><span class="fu">c</span>(p,<span class="cn">NA</span>,<span class="cn">NA</span>)))</span>
<span id="cb91-428"><a href="#cb91-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-429"><a href="#cb91-429" aria-hidden="true" tabindex="-1"></a><span class="co"># using summary.aov()</span></span>
<span id="cb91-430"><a href="#cb91-430" aria-hidden="true" tabindex="-1"></a><span class="fu">summary.aov</span>(m)</span>
<span id="cb91-431"><a href="#cb91-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-432"><a href="#cb91-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-433"><a href="#cb91-433" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Generate the residuals for your linear model, plot them in relation to female body mass, and make a histogram of the residuals. Do they appear to be normally distributed?</span>
<span id="cb91-434"><a href="#cb91-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-437"><a href="#cb91-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-438"><a href="#cb91-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb91-439"><a href="#cb91-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb91-440"><a href="#cb91-440" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb91-441"><a href="#cb91-441" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> m<span class="sc">$</span>residuals</span>
<span id="cb91-442"><a href="#cb91-442" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(residuals <span class="sc">~</span> d<span class="sc">$</span>FemaleBodyMass, <span class="at">xlab =</span> <span class="st">"Female Body Mass"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb91-443"><a href="#cb91-443" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(residuals, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"Histogram of Residuals"</span>)</span>
<span id="cb91-444"><a href="#cb91-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-445"><a href="#cb91-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-446"><a href="#cb91-446" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Run the <span class="in">`plot()`</span> command on the result of <span class="in">`lm()`</span> and examine the 4 plots produced.</span>
<span id="cb91-447"><a href="#cb91-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-450"><a href="#cb91-450" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-451"><a href="#cb91-451" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb91-452"><a href="#cb91-452" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb91-453"><a href="#cb91-453" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb91-454"><a href="#cb91-454" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span>
<span id="cb91-455"><a href="#cb91-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-456"><a href="#cb91-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-457"><a href="#cb91-457" aria-hidden="true" tabindex="-1"></a>Again, based on examination of the residuals and the results of Shapiro-Wilks test, does it look like your model has good fit?</span>
<span id="cb91-458"><a href="#cb91-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-461"><a href="#cb91-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-462"><a href="#cb91-462" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb91-463"><a href="#cb91-463" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-summary: "Show Code"</span></span>
<span id="cb91-464"><a href="#cb91-464" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 4</span></span>
<span id="cb91-465"><a href="#cb91-465" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb91-466"><a href="#cb91-466" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb91-467"><a href="#cb91-467" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(m<span class="sc">$</span>residuals)</span>
<span id="cb91-468"><a href="#cb91-468" aria-hidden="true" tabindex="-1"></a>(s <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(m<span class="sc">$</span>residuals))</span>
<span id="cb91-469"><a href="#cb91-469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-470"><a href="#cb91-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-471"><a href="#cb91-471" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Transformations</span></span>
<span id="cb91-472"><a href="#cb91-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-473"><a href="#cb91-473" aria-hidden="true" tabindex="-1"></a>Recall, again, that for linear regression modeling to be appropriate, two important conditions need to be met: <span class="co">[</span><span class="ot">1</span><span class="co">]</span> our variables (and the error variance in our variables) should be approximately **normally distributed** and [2] there should be **homogeneity of variance** ("homoscedasticity") in our response variable around the range of our predictor variable.</span>
<span id="cb91-474"><a href="#cb91-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-475"><a href="#cb91-475" aria-hidden="true" tabindex="-1"></a>In many cases, these conditions may not be met... for example, the continuous metric data we have may not, in fact, be normally distributed. Nonetheless, we can sometimes apply some kind of mathematical transformation to our data to change their distribution to more closely approximate the normal.</span>
<span id="cb91-476"><a href="#cb91-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-477"><a href="#cb91-477" aria-hidden="true" tabindex="-1"></a>The logarithmic or "log" transformation (where we take the log value of each data point) is often applied to positive numeric variables with heavy skew to dramatically reduce the overall range of the data and bring extreme observations closer to a measure of centrality. The logarithm for a number is the power to which you must raise a base value (e.g., $e$, the natural log) in order to obtain that number. This is an example of a "power transformation", other examples of which include the square root transformation and the reciprocal (or multiplicative inverse) transformation.</span>
<span id="cb91-478"><a href="#cb91-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-479"><a href="#cb91-479" aria-hidden="true" tabindex="-1"></a><span class="fu">### CHALLENGE {.unnumbered}</span></span>
<span id="cb91-480"><a href="#cb91-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-481"><a href="#cb91-481" aria-hidden="true" tabindex="-1"></a>Return to the original "KamilarAndCooper.csv" dataset you were looking at above, <span class="in">`log()`</span> transform both of your variables, and then run a simple, bivariate linear model.</span>
<span id="cb91-482"><a href="#cb91-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-483"><a href="#cb91-483" aria-hidden="true" tabindex="-1"></a>Do you notice a difference between these results and those obtained using untransformed variables?</span>
<span id="cb91-484"><a href="#cb91-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-487"><a href="#cb91-487" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-488"><a href="#cb91-488" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb91-489"><a href="#cb91-489" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/difiore/ada-datasets/main/KamilarAndCooperData.csv"</span></span>
<span id="cb91-490"><a href="#cb91-490" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(f,<span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-491"><a href="#cb91-491" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(d)</span>
<span id="cb91-492"><a href="#cb91-492" aria-hidden="true" tabindex="-1"></a><span class="co"># keep select columns</span></span>
<span id="cb91-493"><a href="#cb91-493" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">select</span>(d, <span class="at">WeaningAge=</span><span class="st">"WeaningAge_d"</span>,</span>
<span id="cb91-494"><a href="#cb91-494" aria-hidden="true" tabindex="-1"></a>  <span class="at">FemaleBodyMass=</span><span class="st">"Body_mass_female_mean"</span>)</span>
<span id="cb91-495"><a href="#cb91-495" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(d) <span class="co"># get rid of NAs</span></span>
<span id="cb91-496"><a href="#cb91-496" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>logWeaningAge <span class="ot">&lt;-</span> <span class="fu">log</span>(d<span class="sc">$</span>WeaningAge)</span>
<span id="cb91-497"><a href="#cb91-497" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>logFemaleBodyMass <span class="ot">&lt;-</span> <span class="fu">log</span>(d<span class="sc">$</span>FemaleBodyMass)</span>
<span id="cb91-498"><a href="#cb91-498" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>d,<span class="fu">aes</span>(<span class="at">x=</span>logFemaleBodyMass, <span class="at">y=</span>logWeaningAge)) <span class="sc">+</span></span>
<span id="cb91-499"><a href="#cb91-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>)</span>
<span id="cb91-500"><a href="#cb91-500" aria-hidden="true" tabindex="-1"></a><span class="co"># or plot(data=d, logWeaningAge ~ logFemaleBodyMass)</span></span>
<span id="cb91-501"><a href="#cb91-501" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">data =</span> d, logWeaningAge <span class="sc">~</span> logFemaleBodyMass)</span>
<span id="cb91-502"><a href="#cb91-502" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb91-503"><a href="#cb91-503" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb91-504"><a href="#cb91-504" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m)</span>
<span id="cb91-505"><a href="#cb91-505" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb91-506"><a href="#cb91-506" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(m<span class="sc">$</span>residuals) <span class="do">## qqPlot from {car}</span></span>
<span id="cb91-507"><a href="#cb91-507" aria-hidden="true" tabindex="-1"></a>(s <span class="ot">&lt;-</span> <span class="fu">shapiro.test</span>(m<span class="sc">$</span>residuals))</span>
<span id="cb91-508"><a href="#cb91-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-509"><a href="#cb91-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-510"><a href="#cb91-510" aria-hidden="true" tabindex="-1"></a>The following chart and graphs shows some other common numerical transformations that are often useful for changing a variable's distribution to more closely approximate the normal.</span>
<span id="cb91-511"><a href="#cb91-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-514"><a href="#cb91-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-515"><a href="#cb91-515" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb91-516"><a href="#cb91-516" aria-hidden="true" tabindex="-1"></a><span class="co">#| out-width: "70%"</span></span>
<span id="cb91-517"><a href="#cb91-517" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">"img/transformations.png"</span>)</span>
<span id="cb91-518"><a href="#cb91-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-519"><a href="#cb91-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-522"><a href="#cb91-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-523"><a href="#cb91-523" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 3</span></span>
<span id="cb91-524"><a href="#cb91-524" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb91-525"><a href="#cb91-525" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb91-526"><a href="#cb91-526" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb91-527"><a href="#cb91-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-528"><a href="#cb91-528" aria-hidden="true" tabindex="-1"></a><span class="co"># LOG X</span></span>
<span id="cb91-529"><a href="#cb91-529" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">100</span>, <span class="at">length.out=</span><span class="dv">1000</span>)</span>
<span id="cb91-530"><a href="#cb91-530" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">+</span> b <span class="sc">*</span> <span class="fu">log</span>(x)</span>
<span id="cb91-531"><a href="#cb91-531" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"untransformed"</span>)</span>
<span id="cb91-532"><a href="#cb91-532" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">log</span>(x),y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"log(x)"</span>)</span>
<span id="cb91-533"><a href="#cb91-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-534"><a href="#cb91-534" aria-hidden="true" tabindex="-1"></a><span class="co"># LOG Y - a log transformation for the response variable is useful</span></span>
<span id="cb91-535"><a href="#cb91-535" aria-hidden="true" tabindex="-1"></a><span class="co"># when the variance in the explanatory variable is not consistent</span></span>
<span id="cb91-536"><a href="#cb91-536" aria-hidden="true" tabindex="-1"></a><span class="co"># across the range of explanatory variable values</span></span>
<span id="cb91-537"><a href="#cb91-537" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">10</span>, <span class="at">length.out=</span><span class="dv">1000</span>)</span>
<span id="cb91-538"><a href="#cb91-538" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span>x)</span>
<span id="cb91-539"><a href="#cb91-539" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"untransformed"</span>)</span>
<span id="cb91-540"><a href="#cb91-540" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">log</span>(y), <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"log(y)"</span>)</span>
<span id="cb91-541"><a href="#cb91-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-542"><a href="#cb91-542" aria-hidden="true" tabindex="-1"></a><span class="co"># ASYMPTOTIC</span></span>
<span id="cb91-543"><a href="#cb91-543" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="dv">100</span>,<span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb91-544"><a href="#cb91-544" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> (a <span class="sc">*</span> x) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> b<span class="sc">*</span>x)</span>
<span id="cb91-545"><a href="#cb91-545" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"untransformed"</span>)</span>
<span id="cb91-546"><a href="#cb91-546" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">/</span>x, y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"1/x"</span>)</span>
<span id="cb91-547"><a href="#cb91-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-548"><a href="#cb91-548" aria-hidden="true" tabindex="-1"></a><span class="co"># RECIPROCAL</span></span>
<span id="cb91-549"><a href="#cb91-549" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="dv">100</span>,<span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb91-550"><a href="#cb91-550" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">/</span>x</span>
<span id="cb91-551"><a href="#cb91-551" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"untransformed"</span>)</span>
<span id="cb91-552"><a href="#cb91-552" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">/</span>x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"1/x"</span>)</span>
<span id="cb91-553"><a href="#cb91-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-554"><a href="#cb91-554" aria-hidden="true" tabindex="-1"></a><span class="co"># POWER - a power transformation for the explanatory variable is useful</span></span>
<span id="cb91-555"><a href="#cb91-555" aria-hidden="true" tabindex="-1"></a><span class="co"># # if there is a curvilinear relationship between the explanatory</span></span>
<span id="cb91-556"><a href="#cb91-556" aria-hidden="true" tabindex="-1"></a><span class="co"># variable and the response variable</span></span>
<span id="cb91-557"><a href="#cb91-557" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="dv">100</span>,<span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb91-558"><a href="#cb91-558" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">*</span> x<span class="sc">^</span>b</span>
<span id="cb91-559"><a href="#cb91-559" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"untransformed"</span>)</span>
<span id="cb91-560"><a href="#cb91-560" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x<span class="sc">^</span>b, y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"x^b"</span>)</span>
<span id="cb91-561"><a href="#cb91-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-562"><a href="#cb91-562" aria-hidden="true" tabindex="-1"></a><span class="co"># EXPONENTIAL</span></span>
<span id="cb91-563"><a href="#cb91-563" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>,<span class="at">to=</span><span class="dv">10</span>,<span class="at">length.out=</span><span class="dv">100</span>)</span>
<span id="cb91-564"><a href="#cb91-564" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> a <span class="sc">*</span> <span class="fu">exp</span>(b<span class="sc">*</span>x)</span>
<span id="cb91-565"><a href="#cb91-565" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y, <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"untransformed"</span>)</span>
<span id="cb91-566"><a href="#cb91-566" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">log</span>(y), <span class="at">type=</span><span class="st">"l"</span>,<span class="at">main=</span><span class="st">"log(y)"</span>)</span>
<span id="cb91-567"><a href="#cb91-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-568"><a href="#cb91-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-569"><a href="#cb91-569" aria-hidden="true" tabindex="-1"></a>Applying a function to transform a complete dataset is the most common way of attempting to squeeze your data into matching a normal distribution so that you can use parametric statistics. This is a very common practice, and much has been written on this topic, including its drawbacks.</span>
<span id="cb91-570"><a href="#cb91-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-571"><a href="#cb91-571" aria-hidden="true" tabindex="-1"></a>For a good discussion on common transformations, see ***R in Action*** Chapter 8.5 ("Corrective Measures"), and please do note the section titled **A caution concerning transformations**. When trying out transformations, keep your normalization tests handy so that you can retest the transformed data and see if the transformation achieved its intended purpose.</span>
<span id="cb91-572"><a href="#cb91-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-575"><a href="#cb91-575" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb91-576"><a href="#cb91-576" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb91-577"><a href="#cb91-577" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>mosaic)</span>
<span id="cb91-578"><a href="#cb91-578" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>broom)</span>
<span id="cb91-579"><a href="#cb91-579" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>car)</span>
<span id="cb91-580"><a href="#cb91-580" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>tidyverse)</span>
<span id="cb91-581"><a href="#cb91-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb91-582"><a href="#cb91-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-583"><a href="#cb91-583" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb91-584"><a href="#cb91-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-585"><a href="#cb91-585" aria-hidden="true" tabindex="-1"></a><span class="fu">## Concept Review {.unnumbered}</span></span>
<span id="cb91-586"><a href="#cb91-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-587"><a href="#cb91-587" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regression analysis partitions the variance in a response variable into components associated with the various predictor variables plus an "error" component, or residual</span>
<span id="cb91-588"><a href="#cb91-588" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The significance of the overall regression model, and of individual predictors, is evaluated by comparing F ratios (the ratio of the variance explained by the predictor to the unexplained variance) against an F distribution, taking into account the number of degrees of freedom in each</span>
<span id="cb91-589"><a href="#cb91-589" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>After running a model, we need to confirm that key assumptions for linear regression are met, including that residuals are normally distributed and observations show homogeneity of variance across the range of predictor values</span>
<span id="cb91-590"><a href="#cb91-590" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If these assumptions are not met, data transformation of the raw variables may sometimes be helpful</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>